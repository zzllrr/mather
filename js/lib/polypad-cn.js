/* Polypad API v4.5.4, (c) Mathigon */
"use strict";(()=>{var Oc=Object.defineProperty,af=Object.defineProperties,lf=Object.getOwnPropertyDescriptor,cf=Object.getOwnPropertyDescriptors;var Dc=Object.getOwnPropertySymbols;var hf=Object.prototype.hasOwnProperty,pf=Object.prototype.propertyIsEnumerable;var Lc=(e,s,t)=>s in e?Oc(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t,U=(e,s)=>{for(var t in s||(s={}))hf.call(s,t)&&Lc(e,t,s[t]);if(Dc)for(var t of Dc(s))pf.call(s,t)&&Lc(e,t,s[t]);return e},it=(e,s)=>af(e,cf(s));var w=(e,s,t,i)=>{for(var r=i>1?void 0:i?lf(s,t):s,o=e.length-1,n;o>=0;o--)(n=e[o])&&(r=(i?n(s,t,r):n(r))||r);return i&&r&&Oc(s,t,r),r};var H=(e,s,t)=>new Promise((i,r)=>{var o=l=>{try{a(t.next(l))}catch(c){r(c)}},n=l=>{try{a(t.throw(l))}catch(c){r(c)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(o,n);a((t=t.apply(e,s)).next())});var C={accessibility:"<path d=M20.8,7a1.1,1.1,0,0,0-1.3-.8A31.3,31.3,0,0,1,12,7a31.3,31.3,0,0,1-7.5-.8A1.1,1.1,0,0,0,3.2,7,1,1,0,0,0,4,8.2,27.4,27.4,0,0,0,9,9V21a1,1,0,0,0,2,0V16h2v5a1,1,0,0,0,2,0V9a28.9,28.9,0,0,0,5-.8A1,1,0,0,0,20.8,7ZM12,6a2,2,0,1,0-2-2A2,2,0,0,0,12,6Z />","add-image":"<path d=M21,5H19V3a.9.9,0,0,0-1-1h0a.9.9,0,0,0-1,1V5H15a.9.9,0,0,0-1,1h0a.9.9,0,0,0,1,1h2V9a.9.9,0,0,0,1,1h0a.9.9,0,0,0,1-1V7h2a.9.9,0,0,0,1-1h0A.9.9,0,0,0,21,5ZM16,9V8H15a2.1,2.1,0,0,1-2-2,1.7,1.7,0,0,1,.3-1H5A2,2,0,0,0,3,7V19a2,2,0,0,0,2,2H17a2,2,0,0,0,2-2V10.7a1.7,1.7,0,0,1-1,.3A2,2,0,0,1,16,9Zm0,10H6c-.4,0-.7-.5-.4-.8l2-2.6a.5.5,0,0,1,.8,0L10,18l2.6-3.5a.5.5,0,0,1,.8,0l3,3.7A.5.5,0,0,1,16,19Z />",aguitar:'<path d="m20.43 1.95c-.1 0-.2.02-.28.09l-2.25 1.8c-.23.18-.32.49-.23.77.08.25.02.53-.17.72l-4.69 4.69c-.96-.79-1.88-1.16-2.74-1.08-1.42.13-2.29 1.39-2.8 2.15-.12.18-.24.35-.3.41-.52.52-1.06.69-1.68.88-.71.22-1.51.46-2.34 1.29-.97.97-1.24 2.08-.8 3.3.4 1.13 1.36 2.16 2.04 2.85s1.72 1.64 2.85 2.04c.34.12 1.82.68 3.3-.8.82-.82 1.07-1.63 1.29-2.34.19-.62.36-1.16.88-1.68.07-.07.23-.18.41-.3.75-.52 2.02-1.38 2.15-2.8.08-.86-.29-1.78-1.08-2.74l4.41-4.41.06-.06.22-.22c.19-.19.47-.25.72-.17.28.09.59 0 .77-.23l1.8-2.25c.13-.16.12-.4-.03-.55l-1.23-1.23c-.07-.07-.17-.11-.27-.12zm-10.04 10.22c.37 0 .74.14 1.02.42.56.56.56 1.48 0 2.04s-1.48.56-2.04 0-.56-1.48 0-2.04c.28-.28.65-.42 1.02-.42zm-4.12 3.3c.16 0 .32.06.44.18l1.65 1.65c.24.24.24.63 0 .87-.12.12-.28.18-.44.18s-.32-.06-.44-.18l-1.65-1.65c-.24-.24-.24-.63 0-.87.12-.12.28-.18.44-.18z"/>',algebra:'<path d="m19.5 9h-2.6l1.3-1.2c.9-.9 1.4-1.5 1.4-2.5s-1-2.2-2.5-2.2a4 4 0 0 0 -2.4.7h-.1l.2 1.7h.2a2.9 2.9 0 0 1 1.8-.7c.3 0 .9.1.9.6s-.3.8-.7 1.3l-2.5 2.5v1.4h5.2z"/><path d="m9.2 13-1.2-2.9-2.4.4 2 4.4-3.7 4.8h2.7l2.1-2.9 1.3 3v.1l2.4-.3-2.1-4.7 3.3-4.5.2-.1h-2.7z"/>',"area-chart":"<path d=M21,18H3a1,1,0,0,0,0,2H21a1,1,0,0,0,0-2Z /><path d=M5,17H19a.9.9,0,0,0,1-1V5a.9.9,0,0,0-.6-.9.9.9,0,0,0-1.1.2L13,9.6,10.7,7.3a1,1,0,0,0-1.4,0l-5,5A.9.9,0,0,0,4,13v3A.9.9,0,0,0,5,17Z />",audio:"<path d=M16.6,7.9a1,1,0,1,0-1.3,1.5,3.4,3.4,0,0,1,0,5.2,1,1,0,0,0-.1,1.4.9.9,0,0,0,.7.4.9.9,0,0,0,.7-.3,5.4,5.4,0,0,0,0-8.2Z /><path d=M19,5.3a.9.9,0,0,0-1.4.1,1,1,0,0,0,0,1.4,6.8,6.8,0,0,1,0,10.4,1,1,0,0,0,0,1.4.8.8,0,0,0,.7.4,1.1,1.1,0,0,0,.7-.3A9,9,0,0,0,19,5.3Z /><path d=M11.7,3.3,7,8H4a2,2,0,0,0-2,2v4a2,2,0,0,0,2,2H7l4.7,4.5a1.3,1.3,0,0,0,2.3-.9V4.3A1.4,1.4,0,0,0,11.7,3.3Z />",axes:"<path d=M22.2,16.5,15.9,14c-.2,0-.4,0-.5.2s-.2.3-.1.5l.6,1.3H8V8.1l1.3.6h.2l.3-.2c.2-.1.2-.3.2-.5L7.5,1.8a.6.6,0,0,0-1,0L4,8.1c0,.2,0,.4.2.5s.3.2.5.1L6,8.1V16H2a1,1,0,0,0,0,2H6v4a.9.9,0,0,0,1,1,.9.9,0,0,0,1-1V18h7.9l-.6,1.3c-.1.2-.1.4.1.5a.5.5,0,0,0,.4.2h.1l6.3-2.5a.6.6,0,0,0,0-1Z />",bark:'<path d="m11.69 2.54c-.29 0-.36.21-.55.66-.26.66-.76 1.89-1.58 2.68-.73.73-.9 1.67-.94 2.08-.41.31-1.62 1.22-2.72 2.22-1.45 1.18-3.22 3.08-3.3 3.16-.08.09-.12.19-.11.31.01.07 1.18 7.19 7.34 7.81h.04c.09 0 .18-.03.25-.09.08-.07.13-.17.13-.27 0-.06.04-1.42.04-1.91 0-1.24.75-2.59 1.97-2.59.97 0 2.39.36 3.78.96.5.21.92.31 1.29.31.56 0 .95-.23 1.22-.44.08-.06.15-.12.24-.19.41-.32.97-.76 1.79-1.91.64-.37.94-.78.91-1.23-.03-.47-.42-.87-1.18-1.19-.7-.8-1.85-1.71-3.04-2.37-.04-.03-.08-.19-.12-.31-.13-.43-.34-1.08-1.18-1.56-.81-.47-2.23-.9-2.8-1.07-.02-.26-.05-.73-.05-1.52 0-1.64-.88-3.54-1.45-3.54zm2.71.69c-.22 0-.31.07-.84.81.22.72.34 1.47.34 2.04 0 .39 0 .7.01.95.31.1.67.22 1.02.34.07-.23.12-.48.14-.74.13-1.5-.09-2.96-.38-3.28-.07-.08-.19-.13-.3-.13zm.64 7.25c.42 0 .76.34.76.76s-.34.76-.76.76-.76-.34-.76-.76.34-.76.76-.76z"/>',bass:'<path d="m3.2 4c-.88 0-1.6.72-1.6 1.6v12.8c0 .88.72 1.6 1.6 1.6h17.6c.88 0 1.6-.72 1.6-1.6v-12.8c0-.88-.72-1.6-1.6-1.6zm1.6 1.6h7.2c.44 0 .8.36.8.8v3.2c0 .44-.36.8-.8.8h-7.2c-.44 0-.8-.36-.8-.8v-3.2c0-.44.36-.8.8-.8zm11.2 1.6c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm3.2 0c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm-16 5.6h2.4v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h.8v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h2.4v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h.8v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h.8v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h2.4v5.6h-17.6z"/>',boing:'<path d="m4.8 2.68c-2.03 0-3.15 4.64-3.15 9s1.13 9 3.15 9 3.15-4.64 3.15-9-1.13-9-3.15-9zm3.6.04c-.43.03-.85.28-1.21.68.31.54.62 1.22.8 1.94l.1-.18c.14-.23.26-.4.31-.49.45.72 1.13 3.01.86 7.1-.18 2.43-.59 4.19-1.04 5.36-.31 1.35-.76 2.56-1.43 3.38.14.09.31.14.49.14h.08c1.98 0 3.38-4.45 3.7-8.78.36-4.32-.4-9.01-2.48-9.14-.06 0-.12 0-.18 0zm3.68.17c-.4.05-.8.28-1.17.65.27.54.5 1.21.68 1.93l.1-.13c.18-.27.36-.46.45-.55.4.76.81 3.43.04 7.52-.14.72-.31 1.4-.45 2.03-.45 2.7-1.35 5.67-2.97 6.75.09.05.18.08.27.08s.18.04.27.04c.9 0 1.8-.84 2.66-2.42s1.58-3.79 2.03-6.13c.81-4.41.58-9.36-1.49-9.76-.14-.02-.27-.03-.41-.01zm-7.28 1.77c.59.81 1.35 3.37 1.35 7.02s-.76 6.25-1.35 7.02c-.59-.76-1.35-3.33-1.35-7.02s.76-6.25 1.35-7.02zm12.33.34c-.57.02-1.23.41-1.94 1.05.09.81.14 1.72.1 2.62l.27-.37c.5-.63.85-.98 1.17-1.21 0 .27-.05.67-.14 1.17-.27 1.53-.9 3.46-1.84 5.4-.09.14-.14.31-.23.45-.45 1.94-1.08 3.73-1.84 5.08-.5.95-1.04 1.63-1.58 2.12.59-.23 1.26-.76 1.98-1.62 1.13-1.3 2.29-3.16 3.28-5.27s1.71-4.18 1.98-5.89c.36-1.85.09-3.06-.68-3.42-.17-.08-.34-.12-.53-.11zm3.91 2.59c-.49 0-1.05.24-1.7.63 0 .18-.05.36-.1.53-.14.68-.31 1.44-.53 2.21l.41-.37c.59-.54 1.03-.85 1.39-1.03-.18.99-.94 3.01-2.97 5.85-.09.14-.18.31-.18.53 0 .5.4.9.9.9.31 0 .62-.18.76-.45 2.48-3.46 4.28-7.51 2.8-8.59-.22-.15-.48-.23-.77-.23z"/>',bold:"<path d=M15.2,11.6h0a3.8,3.8,0,0,0,2-3.4c0-2.6-2.1-4.1-5-4.1H7.5a.9.9,0,0,0-1,1V19a.9.9,0,0,0,1,1h4.8c2.9,0,5.5-1.4,5.5-4.6A3.7,3.7,0,0,0,15.2,11.6ZM9.4,6.5h2.8a1.8,1.8,0,0,1,2,2,1.9,1.9,0,0,1-2,2H9.4Zm3.1,11H9.4V12.9h3.1a2.1,2.1,0,0,1,2.3,2.3A2.2,2.2,0,0,1,12.5,17.5Z />",brackets:"<rect x=8 y=6 width=8 height=12 rx=1 opacity=.4 /><path d=M18,21h-.5a1.1,1.1,0,0,1-.4-1.4A15.5,15.5,0,0,0,19,12a15.5,15.5,0,0,0-1.9-7.5,1.1,1.1,0,0,1,.4-1.4,1.1,1.1,0,0,1,1.4.4,18.3,18.3,0,0,1,0,17A1.1,1.1,0,0,1,18,21Z /><path d=M6,21a1.1,1.1,0,0,1-.9-.5,18.3,18.3,0,0,1,0-17,1.1,1.1,0,0,1,1.4-.4,1.1,1.1,0,0,1,.4,1.4A15.5,15.5,0,0,0,5,12a15.5,15.5,0,0,0,1.9,7.5,1.1,1.1,0,0,1-.4,1.4Z />",brightness:"<path d=M1.4,11.3,4,8.7V5A1,1,0,0,1,5,4H8.7l2.6-2.6a1,1,0,0,1,1.4,0L15.3,4H19a.9.9,0,0,1,1,1V8.7l2.6,2.6a1,1,0,0,1,0,1.4L20,15.3V19a1,1,0,0,1-1,1H15.3l-2.6,2.6a1,1,0,0,1-1.4,0L8.7,20H5a1.1,1.1,0,0,1-1-1V15.3L1.4,12.7A1,1,0,0,1,1.4,11.3ZM6.1,13A5.7,5.7,0,0,0,10,17.6a5.3,5.3,0,0,0,3.5.2c.4-.1.4-.6.1-.9a5.9,5.9,0,0,1,0-9.8c.3-.3.3-.8-.2-.9a5.4,5.4,0,0,0-3.5.2A5.8,5.8,0,0,0,6.1,11,3.8,3.8,0,0,0,6,12,3.8,3.8,0,0,0,6.1,13Z />",calculate:'<path d="m19 3h-14a2 2 0 0 0 -2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-14a2 2 0 0 0 -2-2zm-5.4 3.5a.7.7 0 0 1 1 0l.9.9.9-.9a.7.7 0 0 1 1 0 .8.8 0 0 1 0 1.1l-.8.9.8.9a.7.7 0 0 1 0 1 .7.7 0 0 1 -1 0l-.9-.9-.9.9a.7.7 0 0 1 -1 0 .7.7 0 0 1 0-1l.8-.9-.8-.9a.8.8 0 0 1 0-1.1zm-6.6 1.2h3.5a.8.8 0 0 1 .7.8.7.7 0 0 1 -.7.7h-3.5a.8.8 0 0 1 -.8-.7.9.9 0 0 1 .8-.8zm3.8 8.3h-1.3v1.2a.7.7 0 0 1 -.7.8.7.7 0 0 1 -.8-.8v-1.2h-1.2a.7.7 0 0 1 -.8-.8.7.7 0 0 1 .8-.7h1.2v-1.3a.7.7 0 0 1 .8-.7.7.7 0 0 1 .7.7v1.3h1.3a.7.7 0 0 1 .7.7.7.7 0 0 1 -.7.8zm6.4 1.2h-3.4a.7.7 0 0 1 -.8-.7.7.7 0 0 1 .8-.7h3.4a.7.7 0 0 1 .8.7.7.7 0 0 1 -.8.7zm0-2.4h-3.4a.8.8 0 0 1 -.8-.8.8.8 0 0 1 .8-.8h3.4a.8.8 0 0 1 .8.8.8.8 0 0 1 -.8.8z"/>',cards:"<path d=M18,2H10A4,4,0,0,0,6,6a4,4,0,0,0-4,4v8a4,4,0,0,0,4,4h8a4,4,0,0,0,4-4,4,4,0,0,0,4-4V6A4,4,0,0,0,18,2ZM16,18a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V10A2,2,0,0,1,6,8h8a2,2,0,0,1,2,2Zm4-4a2,2,0,0,1-2,2V10a4,4,0,0,0-4-4H8a2,2,0,0,1,2-2h8a2,2,0,0,1,2,2Z />",cello:'<path d="m11.61 10.6 4.18-3.73-.06-.06c-.92-.8-1.88-1.21-2.85-1.21-.76 0-1.48.25-2.13.74-.23.18-.58.42-.97.7-.22.15-.45.31-.69.48-.1.07-.16.17-.17.29s.03.23.1.32c.46.51.53 1.09-.64 2.26-.64.64-1.14.95-1.55.95-.25 0-.49-.12-.77-.37-.17-.17-.21-.26-.22-.3-.03-.14-.14-.25-.27-.29-.14-.04-.28-.01-.39.08-.57.49-1.16.99-1.66 1.5-1.02 1.02-1.52 2.16-1.51 3.39.02 1.35.68 2.73 1.9 4.02l.38-.52 3.36-3.73 1.27 1.27-3.72 3.36-.51.38c-.13-.12-.27-.25-.4-.38s-.25-.26-.38-.38l-1.87 2.52.12.12 2.52-1.87c1.32 1.22 2.71 1.87 4.07 1.87 1.2 0 2.32-.51 3.32-1.51.56-.56 1.05-1.11 1.5-1.67.08-.1.11-.22.08-.34s-.11-.22-.22-.28c-.12-.06-.25-.16-.38-.29-.63-.63-.49-1.22.57-2.33 1.02-1.02 1.62-1.2 2.26-.64.09.08.2.11.32.1.11-.01.22-.08.29-.17.17-.24.33-.47.48-.69.28-.4.52-.74.7-.99 1.12-1.54.96-3.34-.46-4.97l-.04-.04-3.76 4.23-1.8-1.8z"/><path d="m22.37 4.01-.78-.79.92-1.03-.7-.7-1.9 1.69-.74-.74c-.12-.12-.29-.2-.49-.2-.33 0-.57.33-.57.66s.29.62.61.62c.04 0 .12-.04.16-.04l.33.33-.39.35-.88-.88c-.12-.12-.29-.21-.49-.21-.33 0-.57.33-.57.66s.29.61.61.61c.04 0 .12-.04.16-.04l.48.48-2.34 2.09 1.38 1.31 2.82-3.17.52.53s-.04.12-.04.16c0 .33.29.61.61.61s.61-.29.61-.61c.04-.16-.04-.33-.16-.45l-.93-.93.35-.39.38.38s-.04.12-.04.16c0 .33.29.61.61.61s.65-.25.65-.57c0-.2-.08-.37-.2-.49z"/>',"chart-grouped":"<path d=M21,18H20V9a.9.9,0,0,0-1-1H17V5a.9.9,0,0,0-1-1H14a.9.9,0,0,0-1,1V18H11V11a.9.9,0,0,0-1-1H8V9A.9.9,0,0,0,7,8H5A.9.9,0,0,0,4,9v9H3a1,1,0,0,0,0,2H21a1,1,0,0,0,0-2ZM19,9v9H17V9Zm-9,2v7H8V11Z />","chart-percentage":"<path d=M21,18H20V5a.9.9,0,0,0-1-1H17a.9.9,0,0,0-1,1V18H14V5a.9.9,0,0,0-1-1H11a.9.9,0,0,0-1,1V18H8V5A.9.9,0,0,0,7,4H5A.9.9,0,0,0,4,5V18H3a1,1,0,0,0,0,2H21a1,1,0,0,0,0-2ZM17,5h2v9H17ZM11,5h2v5H11ZM5,5H7v7H5Z />","chart-stacked":"<path d=M21,18H20V13a.9.9,0,0,0-1-1H17a.9.9,0,0,0-1,1v5H14V5a.9.9,0,0,0-1-1H11a.9.9,0,0,0-1,1V18H8V9A.9.9,0,0,0,7,8H5A.9.9,0,0,0,4,9v9H3a1,1,0,0,0,0,2H21a1,1,0,0,0,0-2Zm-4-5h2v2H17ZM11,5h2v6H11ZM5,9H7v4H5Z />",clap:'<path d="m13.08 2.8c.24 0 .48.09.66.27.37.37.37.96 0 1.33l-3.25 3.25c-.04-.09-.07-.18-.11-.26-.29-.52-.69-.91-1.15-1.13l3.18-3.18c.18-.18.42-.27.66-.27zm2.65 1.06c.24 0 .48.09.66.27.37.37.37.96 0 1.33l-2.58 2.58-2.92 1.64c-.01-.42-.06-.84-.14-1.23l4.31-4.31c.18-.18.42-.27.66-.27zm-11.55 1.25c.28.02.61.15.94.48.56.56.91 1.74 1.09 2.57 0 .04.05.16.05.16s-.25 1.11-.6 2.08c-.05.12-.2.48-.41.93-.86 1.84-1.18 3.1-1.04 4.36-.13-.17-.25-.35-.36-.51-.98-1.55-.98-2.89-.85-3.76.2-1.26.41-2.69.27-4.51-.07-.86-.13-1.19.27-1.59.13-.13.36-.23.65-.22zm4.06 2.05c.35-.02.81.16 1.16.77.49.88.38 2.61.3 3.36-.02.15.15.26.28.18l7.12-3.99c.45-.25 1.02-.09 1.28.36s.09 1.02-.36 1.28l-4.5 2.52c-.18.1-.25.33-.14.51.1.18.33.25.51.14l5.48-3.07c.45-.25 1.02-.09 1.28.36.25.45.09 1.02-.36 1.28l-5.48 3.07c-.18.1-.25.33-.14.51.1.18.33.25.51.14l4.5-2.52c.45-.25 1.02-.09 1.28.36.25.45.09 1.02-.36 1.28l-5.48 3.07c-.18.1-.25.33-.14.51s.33.25.51.14l3.84-2.15c.45-.25 1.02-.09 1.28.36.25.45.09 1.02-.36 1.28l-6.38 3.57c-2.78 1.56-6.19.46-7.57-1.99-1.47-2.62-.99-4.48-.51-5.52.53-1.16 1.12-2.48 1.48-4.27.17-.85.2-1.18.69-1.46.08-.05.19-.08.3-.08z"/>',close:"<path d=M18.7,16.5,14.1,12l4.6-4.5a2.1,2.1,0,0,0,.4-1.1,1.5,1.5,0,0,0-.4-1h0a1.6,1.6,0,0,0-2.2,0L12,9.9,7.5,5.3a1.8,1.8,0,0,0-2.2,0,2.1,2.1,0,0,0-.4,1.1,2.1,2.1,0,0,0,.4,1.1L9.9,12,5.3,16.5a2.1,2.1,0,0,0-.4,1.1,2.1,2.1,0,0,0,.4,1.1,1.8,1.8,0,0,0,2.2,0L12,14.1l4.5,4.6a2.1,2.1,0,0,0,1.1.4,2.1,2.1,0,0,0,1.1-.4,2.1,2.1,0,0,0,.4-1.1A2.1,2.1,0,0,0,18.7,16.5Z />",clubs:"<path d=M12,2a4.4,4.4,0,0,1,4.3,4.2A4.5,4.5,0,0,1,14,10a6.7,6.7,0,0,1,2.5-.5A4.3,4.3,0,0,1,21,13.8,4.2,4.2,0,0,1,16.5,18,8.6,8.6,0,0,1,13,17s-.3,2,2,5H9c2.3-3,2-5,2-5a8.6,8.6,0,0,1-3.5,1A4.2,4.2,0,0,1,3,13.8,4.3,4.3,0,0,1,7.5,9.5,6.7,6.7,0,0,1,10,10,4.5,4.5,0,0,1,7.7,6.2,4.4,4.4,0,0,1,12,2Z />",color:"<path d=M12,3a9,9,0,0,0,0,18,1.5,1.5,0,0,0,1.5-1.5,1.3,1.3,0,0,0-.4-1,1.8,1.8,0,0,1-.4-1A1.5,1.5,0,0,1,14.2,16H16a5,5,0,0,0,5-5C21,6.6,17,3,12,3ZM6.5,12a1.5,1.5,0,0,1,0-3,1.5,1.5,0,0,1,0,3Zm3-4A1.5,1.5,0,0,1,8,6.5a1.5,1.5,0,0,1,3,0A1.5,1.5,0,0,1,9.5,8Zm5,0A1.5,1.5,0,0,1,13,6.5a1.5,1.5,0,0,1,3,0A1.5,1.5,0,0,1,14.5,8Zm3,4A1.5,1.5,0,1,1,19,10.5,1.5,1.5,0,0,1,17.5,12Z />","column-chart":"<path d=M21,18H20V13a.9.9,0,0,0-1-1H17a.9.9,0,0,0-1,1v5H14V5a.9.9,0,0,0-1-1H11a.9.9,0,0,0-1,1V18H8V9A.9.9,0,0,0,7,8H5A.9.9,0,0,0,4,9v9H3a1,1,0,0,0,0,2H21a1,1,0,0,0,0-2Z />","combine-dots":"<path d=M15.15,18.14l-2.79-2.78a.51.51,0,0,0-.71,0L8.86,18.14a.49.49,0,0,0,.35.85H11v2a1,1,0,0,0,2,0V19h1.79A.5.5,0,0,0,15.15,18.14Z /><path d=M8.85,5.86l2.79,2.78a.51.51,0,0,0,.71,0l2.79-2.78A.49.49,0,0,0,14.79,5H13V3a1,1,0,0,0-2,0V5H9.21A.5.5,0,0,0,8.85,5.86Z /><path d=M5.86,15.15l2.78-2.79a.51.51,0,0,0,0-.71L5.86,8.86A.49.49,0,0,0,5,9.21V11H3a1,1,0,0,0,0,2H5v1.79A.5.5,0,0,0,5.86,15.15Z /><path d=M18.14,8.85l-2.78,2.79a.51.51,0,0,0,0,.71l2.78,2.79a.49.49,0,0,0,.85-.35V13h2a1,1,0,0,0,0-2H19V9.21A.5.5,0,0,0,18.14,8.85Z /><circle cx=12 cy=12 r=2 />",construction:'<path d="m13.4 15.5 4.4 4.4a1.5 1.5 0 0 0 2.1 0 1.4 1.4 0 0 0 0-2.1l-4.4-4.4z"/><path d="m16.3 9.8a3.6 3.6 0 0 0 3.1-.4 3.1 3.1 0 0 0 1.5-2.3 2.7 2.7 0 0 0 -.2-2l-2.4 2.4-1.8-1.8 2.4-2.4a3.4 3.4 0 0 0 -2-.3 3.5 3.5 0 0 0 -2.3 1.6 3.6 3.6 0 0 0 -.4 3.1l-2.2 2.2-1.7-1.7a1 1 0 0 0 0-1.4l-.5-.6 2.3-2.3a3.5 3.5 0 0 0 -2.3-.9 3.1 3.1 0 0 0 -2.2.9l-2.9 2.9a1 1 0 0 0 0 1.4l.5.5h-1.7l-.5.2a.7.7 0 0 0 0 1l2 2a.7.7 0 0 0 1 0 .8.8 0 0 0 .2-.5v-1.7l.6.5a1 1 0 0 0 1.4 0l1.7 1.8-5.8 5.8a1.4 1.4 0 0 0 0 2.1 1.4 1.4 0 0 0 2.1 0l5.4-5.3z"/>',controls:"<path d=M3,18a1.1,1.1,0,0,0,1,1H9V17H4A1.1,1.1,0,0,0,3,18ZM3,6A1,1,0,0,0,4,7h9V5H4A1,1,0,0,0,3,6ZM13,20V19h7a1,1,0,0,0,0-2H13V16a1,1,0,0,0-2,0v4a1,1,0,0,0,2,0ZM7,10v1H4a1,1,0,0,0,0,2H7v1a.9.9,0,0,0,1,1,.9.9,0,0,0,1-1V10A.9.9,0,0,0,8,9,.9.9,0,0,0,7,10Zm14,2a1,1,0,0,0-1-1H11v2h9A1,1,0,0,0,21,12ZM16,9a1,1,0,0,0,1-1V7h3a1,1,0,0,0,0-2H17V4a1,1,0,0,0-2,0V8A.9.9,0,0,0,16,9Z />",copy:"<path d=M15,4H5V17a.9.9,0,0,1-1,1H4a1,1,0,0,1-1-1V4A2,2,0,0,1,5,2H15a1,1,0,0,1,1,1h0A1,1,0,0,1,15,4Zm5,4V20a2,2,0,0,1-2,2H9a2,2,0,0,1-2-2V8A2,2,0,0,1,9,6h9A2,2,0,0,1,20,8ZM18,8H9V20h9Z />",cow:'<path d="m1.56 7.01c-.19.19-.23.38-.23.51 0 .69.93 2.49 2.98 2.5.12 0 .25 0 .36-.02.04-1.29.24-2.57.95-3.64-.27-.05-.54-.08-.83-.09-1.51-.02-2.77.28-3.25.74z"/><path d="m21.94 7.01c-.47-.46-1.75-.76-3.25-.74-.28 0-.56.03-.83.09.71 1.07.91 2.35.95 3.64.12.02.25.02.36.02 2.06 0 2.98-1.81 2.98-2.5 0-.12-.04-.32-.23-.51z"/><path d="m16.19 6.06c1.37-.98 2.59-3.99 1.18-4.35-.37-.09-.76.08-.94.41-.5.93-1.01 1.33-1.64 1.51-.88-.91-5.2-.91-6.08 0-.63-.18-1.14-.58-1.64-1.51-.16-.29-.47-.46-.8-.43-1.63.19-.35 3.38 1.04 4.38-.12.24-.27.49-.46.73-1.44 1.88-1.11 5.75.13 7.46.35.69.76 1.37.9 2.08-.27.39-.33 1.76-.32 2.9 0 1.22 1.3 2.44 4.18 2.44s4.18-1.21 4.18-2.44c.02-1.14-.05-2.51-.31-2.9.15-.71.55-1.39.9-2.08 1.23-1.72 1.57-5.59.13-7.46-.2-.25-.34-.49-.46-.74zm-8.85 5.13c-.13-.3.11-.63.44-.6 1.61.17 1.91 1.35 1.69 1.6-.27.32-1.48.51-2.14-1.01zm3.4 8.71c-.88.95-2.38.67-2.27-.56 0 0 .09-.39.65-.64s.73-.21.92-.13 1.12.88.7 1.33zm2.02 0c-.43-.46.5-1.26.7-1.33s.36-.12.92.13.65.64.65.64c.12 1.23-1.39 1.51-2.27.56zm3.4-8.71c-.65 1.51-1.87 1.32-2.14 1.01-.21-.25.09-1.43 1.69-1.6.33-.03.57.29.44.6z"/>',cowbell:'<path d="m14.73 7.8c-.06-.46-.45-.8-.92-.8h-2.81v-2c0-.55-.45-1-1-1h-1c-.55 0-1 .45-1 1v2h-2.7c-.46 0-.85.34-.92.8l-1.74 12.15c-.08.56.35 1.06.92 1.06h11.88c.56 0 .99-.49.92-1.05l-1.63-12.15z"/><path d="m15.19 3.69c0 .77.55 1.43 1.31 1.57l3.53 9.9c.13.42.58.65 1.01.52s.65-.58.52-1.01c0-.02-.01-.03-.02-.05l-3.53-9.9c.25-.29.38-.66.38-1.04 0-.88-.72-1.6-1.6-1.6s-1.6.72-1.6 1.6z"/>',crash:'<path d="m10.54 4.01c2.28.11 4.71 1.19 6.62 3.16 3.4 3.5 3.8 8.52 1 11.22s-7.88 1.91-11.28-1.59-3.9-8.52-1-11.22c1.23-1.14 2.89-1.64 4.66-1.56zm1.25 3.47c-.71.05-1.38.32-1.91.81-1.4 1.1-1.1 3.49.5 5.19s4.01 2.01 5.41.81c1.4-1.3 1.1-3.61-.5-5.31-1-1.06-2.31-1.58-3.5-1.5zm.81 1.12c.64.09 1.28.42 1.78.97 1.1 1.1 1.18 2.7.28 3.5s-2.5.6-3.5-.5c-1.1-1.1-1.18-2.7-.28-3.5.45-.4 1.08-.55 1.72-.47z"/>',cursor:"<path d=M8.3,3.2,17.8,12a.8.8,0,0,1-.5,1.3l-4.1.4L16,19.9a1.2,1.2,0,0,1-.6,1.6h0a1.2,1.2,0,0,1-1.6-.6l-2.7-6.3L8.3,17.3A.8.8,0,0,1,7,16.8V3.8A.8.8,0,0,1,8.3,3.2Z />",delete:"<path d=M6,19a2,2,0,0,0,2,2h8a2,2,0,0,0,2-2V7H6Zm3.2-6.4a1,1,0,1,1,1.4-1.4L12,12.6l1.4-1.4a1,1,0,1,1,1.4,1.4L13.4,14l1.4,1.4a1,1,0,1,1-1.4,1.4L12,15.4l-1.4,1.4a1,1,0,1,1-1.4-1.4L10.6,14ZM18,4H15.5l-.7-.7a.9.9,0,0,0-.7-.3H9.9a.9.9,0,0,0-.7.3L8.5,4H6A.9.9,0,0,0,5,5,.9.9,0,0,0,6,6H18a1,1,0,0,0,0-2Z />",diamonds:'<path d="m19 12-7 10-7-10 7-10"/>',"donut-chart":"<path d=M14.2,2.3a1.1,1.1,0,0,0-.8.1.9.9,0,0,0-.4.8V7.4a.9.9,0,0,0,.6.9,4.3,4.3,0,0,1,2.1,2.1.9.9,0,0,0,.9.6h4.2a.9.9,0,0,0,.8-.4,1.1,1.1,0,0,0,.1-.8A9.9,9.9,0,0,0,14.2,2.3Z /><path d=M20.8,13H16.6a.9.9,0,0,0-.9.6A4,4,0,0,1,12,16h-.5a1.2,1.2,0,0,0-.9.5L8.4,20.1a1.4,1.4,0,0,0,0,.9c.1.2.3.5.6.5a10.5,10.5,0,0,0,3,.5,9.9,9.9,0,0,0,9.7-7.8,1.1,1.1,0,0,0-.1-.8A.9.9,0,0,0,20.8,13Z /><path d=M8.8,14.3A3.8,3.8,0,0,1,8,12a4,4,0,0,1,2.4-3.7.9.9,0,0,0,.6-.9V3.2a.9.9,0,0,0-.4-.8,1.1,1.1,0,0,0-.8-.1A9.9,9.9,0,0,0,2,12a9.7,9.7,0,0,0,3.2,7.3.9.9,0,0,0,.7.3H6a1.3,1.3,0,0,0,.7-.5l2.1-3.7A1.1,1.1,0,0,0,8.8,14.3Z />",duck:'<path d="m16.06 3.84c-1.42 0-2.58 1.16-2.58 2.58s.55 2.55 1.01 3.23c-1.65-.33-6.62-.89-11.96 2.78-.1.07-.15.18-.15.3s.06.23.16.29c.04 0 2.7 1.25 7.45.7.3-.03.56.18.59.47s-.18.56-.47.59c-2.98.34-5.33-.01-6.63-.33l-1.32.94c-.11.08-.16.2-.15.34.01.13.1.24.23.29.17.07 4.03 1.52 9.06 1.58v1.26l-.62.12c-.27.05-.46.3-.46.57 0 .31.25.59.56.59h3.87c.31 0 .56-.25.56-.56 0-.29-.22-.53-.5-.56l-2-.22v-1.22c4.88-.28 7.43-2.43 7.43-4.55 0-1.35-.79-2.36-1.48-3.25-.51-.66-.95-1.23-.95-1.77 0-.39.32-.71.71-.71h2.86c.39 0 .71-.32.71-.71s-.32-.71-.71-.71h-2.44c-.2-.15-.38-.38-.6-.68-.45-.6-1.01-1.35-2.18-1.35z"/>',eguitar:'<path d="m2.25 13.49c-.94.37-1.47 1.36-.63 2.2.32.32.71.44 1.4.51l3.99.36c.16.02.25.04.3.1s.08.14.1.3l.36 3.99c.06.68.19 1.08.51 1.4.84.84 1.83.31 2.2-.63l4.42-11.44 3.68-3.68c1.81-1.81 3.46-2.86 3.72-3.11.22-.22.21-.5 0-.71-.13-.13-.35-.17-.75-.16l-3.76.26c-.31.02-.48.25-.39.53.41 1.01.54 1.38-.05 1.97l-3.68 3.68zm7.39 4.49c-.21-.21-.21-.57 0-.79s.59-.22.79-.02c.22.22.21.6 0 .81s-.59.21-.8 0zm.6-1.45c-.21-.21-.21-.58 0-.79s.6-.21.8 0c.22.22.22.59 0 .81s-.58.21-.8 0zm.6-1.46c-.21-.21-.21-.58 0-.79s.6-.23.81-.02.21.59-.02.81-.57.21-.79 0z"/>',equation:"<path d=M7,14.4,4.9,10.1C4.6,9.5,5,9,5.7,9H6.8a1,1,0,0,1,1,.6L8.7,12l.2.7H9l.5-.7,1.8-2.4A1.3,1.3,0,0,1,12.4,9h1.1c.8,0,.9.5.4,1.1l-3.6,4.3,2.2,4.5a.8.8,0,0,1-.8,1.1H10.6a.8.8,0,0,1-.9-.6L8.6,16.8a3.9,3.9,0,0,1-.2-.6H8.3a2.9,2.9,0,0,1-.4.6l-2,2.6a1.4,1.4,0,0,1-1.2.6h-1c-.7,0-.9-.5-.4-1.1Z /><path d=M15.5,10.2c0-3,3.4-3.5,3.4-4.6a.8.8,0,0,0-.9-.8,1.2,1.2,0,0,0-.8.4c-.3.3-.6.4-.9.1L15.9,5c-.3-.3-.4-.5-.2-.8A3.1,3.1,0,0,1,18.2,3a2.4,2.4,0,0,1,2.7,2.4c0,2.5-3.2,2.9-3.3,3.9h2.8c.4,0,.6.3.6.7v.4a.5.5,0,0,1-.6.6H16.1a.5.5,0,0,1-.6-.6Z />",eraser:"<path d=M20.4,8.4,16.6,4.6A2.2,2.2,0,0,0,15.1,4a2,2,0,0,0-1.4.6L3.6,14.7a2.1,2.1,0,0,0,0,2.9L6,20h5.7l8.7-8.7A2.1,2.1,0,0,0,20.4,8.4Z /><path d=M20,18H16l-2,2h6a1,1,0,0,0,0-2Z />","eye-off":"<path d=M22.6,10.7A11.7,11.7,0,0,0,12,4a12.2,12.2,0,0,0-4.3.8l2.5,2.6A3.9,3.9,0,0,1,12,7a4.5,4.5,0,0,1,4.5,4.5,3.9,3.9,0,0,1-.4,1.8l3.2,3.2a12.1,12.1,0,0,0,3.3-4.2A1.5,1.5,0,0,0,22.6,10.7Z /><path d=M12,8.8h-.3l3,3v-.3A2.7,2.7,0,0,0,12,8.8Z /><path d=M3.5,3.5a1,1,0,0,0-1.4,0h0a1,1,0,0,0,0,1.4L4.2,7a10.1,10.1,0,0,0-2.8,3.7,1.5,1.5,0,0,0,0,1.6A11.7,11.7,0,0,0,12,19a10.5,10.5,0,0,0,3.6-.6l3.5,3.5a1,1,0,0,0,1.4-1.4ZM12,16a4.5,4.5,0,0,1-4.5-4.5c0-.4.1-.7.1-1l1.8,1.7a3.1,3.1,0,0,0,1.8,1.9L13,15.9Z />","font-grow":'<path d="m6.8 4.7c.1-.5.4-.7 1-.7h1.3a.9.9 0 0 1 1 .7l4.7 13.3a.7.7 0 0 1 -.7 1h-1a1 1 0 0 1 -1-.7l-1.1-3.1h-5.2l-1 3.1a1 1 0 0 1 -1 .7h-1c-.7 0-.9-.4-.7-1zm3.6 8.2-2-6.3-1.9 6.3z"/><path d="m0 .1h24v24h-24z" fill=none /><path d="m21.7 9.3-3-3a1 1 0 0 0 -1.4 0l-3 3a1 1 0 0 0 1.4 1.4l1.3-1.3v4.6a1 1 0 0 0 2 0v-4.6l1.3 1.3a1 1 0 0 0 1.4 0 1 1 0 0 0 0-1.4z"/>',"font-shrink":'<path d="m21.7 10.3a1 1 0 0 0 -1.4 0l-1.3 1.3v-4.6a1 1 0 0 0 -2 0v4.6l-1.3-1.3a1 1 0 0 0 -1.4 1.4l3 3a1 1 0 0 0 1.4 0l3-3a1 1 0 0 0 0-1.4z"/><path d="m14.3 18-3.7-10.3a.8.8 0 0 0 -.9-.7h-1.1a1 1 0 0 0 -.9.6l-3.6 10.4a.8.8 0 0 0 0 .7.7.7 0 0 0 .6.3h.8a.8.8 0 0 0 .9-.7l.8-2.3h3.9l.8 2.3a.9.9 0 0 0 .9.7h.8a.6.6 0 0 0 .6-.3c.2-.1.2-.4.1-.7zm-3.8-4h-2.7l1.4-4.4z"/>',"fraction-down":"<path d=M20,2H4A2.002,2.002,0,0,0,2,4V9a2.002,2.002,0,0,0,2,2H20a2.002,2.002,0,0,0,2-2V4A2.002,2.002,0,0,0,20,2ZM4,4h7V9H4Zm9,5V4h7l.0015,5Z /><path d=M20,13H4a2.002,2.002,0,0,0-2,2v5a2.002,2.002,0,0,0,2,2H20a2.002,2.002,0,0,0,2-2V15A2.002,2.002,0,0,0,20,13Zm-6,2v5H10V15ZM4,15H8v5H4Zm12,5V15h4l.0015,5Z opacity=.4 />","fraction-up":"<path d=M20,2H4A2.002,2.002,0,0,0,2,4V9a2.002,2.002,0,0,0,2,2H20a2.002,2.002,0,0,0,2-2V4A2.002,2.002,0,0,0,20,2ZM4,4h7V9H4Zm9,5V4h7l.0015,5Z opacity=.4 /><path d=M20,13H4a2.002,2.002,0,0,0-2,2v5a2.002,2.002,0,0,0,2,2H20a2.002,2.002,0,0,0,2-2V15A2.002,2.002,0,0,0,20,13Zm-6,2v5H10V15ZM4,15H8v5H4Zm12,5V15h4l.0015,5Z />",fraction:"<path d=M17,13H7a1,1,0,0,1,0-2H17a1,1,0,0,1,0,2Z /><rect x=8 y=2 width=8 height=8 rx=1 opacity=.4 /><rect x=8 y=14 width=8 height=8 rx=1 opacity=.4 />",fractions:'<path d="m11.6 3.9v6.2h2v-8.1h-1.8l-2.1 1 .2 1.5z"/><path d="m11.5 20.6 1.6-1.6c1-1 1.6-1.7 1.6-2.8s-1.1-2.3-2.7-2.3a4.3 4.3 0 0 0 -2.7.8l.2 1.7a4 4 0 0 1 2.2-.8c.6 0 1 .3 1 .8a2.1 2.1 0 0 1 -.8 1.5l-2.8 2.8v1.4h5.7l-.2-1.5z"/><path d="m17 11h-10a1 1 0 0 0 0 2h10a1 1 0 0 0 0-2z"/>',"fullscreen-reverse":'<path d="m20.1 8.2-1.4-1.5 2.2-2.2a1 1 0 0 0 0-1.4 1 1 0 0 0 -1.4 0l-2.2 2.2-1.5-1.4a.4.4 0 0 0 -.8.3v4.3a.5.5 0 0 0 .5.5h4.3a.4.4 0 0 0 .3-.8z"/><path d="m8.2 3.9-1.5 1.4-2.2-2.2a1 1 0 0 0 -1.4 0 1 1 0 0 0 0 1.4l2.2 2.2-1.4 1.4a.5.5 0 0 0 .3.9h4.3a.5.5 0 0 0 .5-.5v-4.3a.4.4 0 0 0 -.8-.3z"/><path d="m3.9 15.9 1.4 1.4-2.2 2.2a1 1 0 0 0 0 1.4 1 1 0 0 0 1.4 0l2.2-2.2 1.4 1.5a.6.6 0 0 0 .9-.4v-4.3a.5.5 0 0 0 -.5-.5h-4.3a.5.5 0 0 0 -.3.9z"/><path d="m15.9 20.1 1.4-1.4 2.2 2.2a1 1 0 0 0 1.4 0 1 1 0 0 0 0-1.4l-2.2-2.2 1.4-1.4a.5.5 0 0 0 -.3-.9h-4.3a.5.5 0 0 0 -.5.5v4.3a.5.5 0 0 0 .9.3z"/>',"geo-angle-bisector":"<path d=M21.7,2.3a1,1,0,0,0-1.4,0L5.4,17.2,4.5,17A2.5,2.5,0,0,0,2,19.5a2.9,2.9,0,0,0,.2.9l-.9.9a1,1,0,0,0,0,1.4A.9.9,0,0,0,2,23a.9.9,0,0,0,.7-.3l.9-.9.9.2A2.5,2.5,0,0,0,7,19.5a2.9,2.9,0,0,0-.2-.9L21.7,3.7A1,1,0,0,0,21.7,2.3Z /><path d=M20.5,12.5A2.5,2.5,0,0,0,18,14.7L5.5,18.5,9.3,6a2.5,2.5,0,0,0,2.2-2.5A2.5,2.5,0,1,0,7.4,5.4L3,19.7H3v.4h.1a.1.1,0,0,0,.1.1c0,.1,0,.1.1.2h.1l.3.2h.6l14.3-4.4a2.5,2.5,0,1,0,1.9-4.1Z opacity=.4 />","geo-angle":"<path d=M20.5,12.5A2.5,2.5,0,0,0,18,14.7L6.6,18.2a3,3,0,0,0-.8-.8L9.3,6a2.5,2.5,0,0,0,2.2-2.5A2.5,2.5,0,1,0,7.4,5.4L3.8,17.1a2.5,2.5,0,1,0,3.1,3.1l11.7-3.6a2.5,2.5,0,1,0,1.9-4.1Z /><g opacity=.4><path d=M5.8,17.4a3,3,0,0,1,.8.8l8.7-2.7A12,12,0,0,0,8.5,8.7Z /></g>","geo-centroid":"<path d=M4,23a1,1,0,0,1-1-.8l-2-8a1.3,1.3,0,0,1,.1-.6l6-12a.9.9,0,0,1,1.2-.5l11,4a.8.8,0,0,1,.7.7l3,13a1.3,1.3,0,0,1-.2.8c-.1.2-.4.3-.6.4l-18,3Zm-.9-8.9,1.6,6.8,16.1-2.7L18.1,6.8,8.5,3.2Z opacity=.4 /><circle cx=12.5 cy=13 r=2.5 />","geo-circle":"<circle cx=12 cy=12 r=2.5 /><path d=M14.4,2.3A2.6,2.6,0,0,0,12,.5,2.6,2.6,0,0,0,9.6,2.3a10,10,0,1,0,4.8,0ZM12,20A8,8,0,0,1,9.9,4.3a2.4,2.4,0,0,0,4.2,0A8,8,0,0,1,12,20Z />","geo-circumcircle":"<path d=M12,23A11,11,0,1,1,23,12,11,11,0,0,1,12,23ZM12,3a9,9,0,1,0,9,9A9,9,0,0,0,12,3Z /><path d=M4.7,20,3.6,18.5l9.7-17H15l7.4,13L21.7,16ZM14.1,4,6.5,17.5,20,14.3Z opacity=.4 />","geo-incircle":"<path d=M13.9,19.2a6.5,6.5,0,1,1,6.4-6.4A6.4,6.4,0,0,1,13.9,19.2Zm0-10.9a4.5,4.5,0,1,0,4.4,4.5A4.5,4.5,0,0,0,13.9,8.3Z /><path d=M2,23a.9.9,0,0,1-.8-.4,1.1,1.1,0,0,1-.1-1.1l12-20a1.1,1.1,0,0,1,1.8,0l8,14a1.4,1.4,0,0,1,0,.9.9.9,0,0,1-.6.6l-20,6ZM14,4,4.2,20.3l16.3-4.9Z opacity=.4 />","geo-line":"<path d=M19.5,2A2.5,2.5,0,0,0,17,4.5a2.9,2.9,0,0,0,.2.9L5.4,17.2,4.5,17a2.5,2.5,0,0,0,0,5A2.5,2.5,0,0,0,7,19.5a2.9,2.9,0,0,0-.2-.9L18.6,6.8l.9.2A2.5,2.5,0,0,0,22,4.5,2.5,2.5,0,0,0,19.5,2Z />","geo-midpoint":"<path d=M20.5,1A2.5,2.5,0,0,0,18,3.5a2.9,2.9,0,0,0,.2.9L4.4,18.2,3.5,18a2.5,2.5,0,0,0,0,5A2.5,2.5,0,0,0,6,20.5a2.9,2.9,0,0,0-.2-.9L19.6,5.8l.9.2A2.5,2.5,0,0,0,23,3.5,2.5,2.5,0,0,0,20.5,1Z opacity=.4 /><circle cx=12 cy=12 r=2.5 />","geo-parallel":"<path d=M3,23a1.2,1.2,0,0,1-.8-.4,1.1,1.1,0,0,1,.2-1.4l18-12a1,1,0,1,1,1.2,1.6l-18,12Z opacity=.4 /><path d=M21.8,2.4a1.1,1.1,0,0,0-1.4-.2L13.3,6.9A1.8,1.8,0,0,0,12,6.5,2.5,2.5,0,0,0,9.5,9v.4L2.4,14.2a1.1,1.1,0,0,0-.2,1.4A1.2,1.2,0,0,0,3,16l.6-.2,7.1-4.7a1.8,1.8,0,0,0,1.3.4A2.5,2.5,0,0,0,14.5,9V8.6l7.1-4.8A1.1,1.1,0,0,0,21.8,2.4Z />","geo-perp-bisector":"<path d=M21,22a.9.9,0,0,1-.7-.3l-18-18a1,1,0,0,1,0-1.4,1,1,0,0,1,1.4,0l18,18a1,1,0,0,1,0,1.4A.9.9,0,0,1,21,22Z /><path d=M20.5,1A2.5,2.5,0,0,0,18,3.5a2.9,2.9,0,0,0,.2.9L4.4,18.2,3.5,18a2.5,2.5,0,0,0,0,5A2.5,2.5,0,0,0,6,20.5a2.9,2.9,0,0,0-.2-.9L19.6,5.8l.9.2A2.5,2.5,0,0,0,23,3.5,2.5,2.5,0,0,0,20.5,1Z opacity=.4 />","geo-perpendicular":"<path d=M3,23a1.2,1.2,0,0,1-.8-.4,1.1,1.1,0,0,1,.2-1.4l18-12a1,1,0,1,1,1.2,1.6l-18,12Z opacity=.4 /><path d=M16.8,20.4,8.1,7.3A1.8,1.8,0,0,0,8.5,6,2.5,2.5,0,0,0,6,3.5H5.6L4.8,2.4a1.1,1.1,0,0,0-1.4-.2,1.1,1.1,0,0,0-.2,1.4l.7,1.1A1.8,1.8,0,0,0,3.5,6,2.5,2.5,0,0,0,6,8.5h.4l8.8,13.1a1.2,1.2,0,0,0,.8.4l.6-.2A1.1,1.1,0,0,0,16.8,20.4Z />","geo-rectangle":"<path d=M21,14.7V7a.9.9,0,0,0-1-1H6.3A2.5,2.5,0,0,0,4,4.5,2.5,2.5,0,0,0,1.5,7,2.5,2.5,0,0,0,3,9.3V17a.9.9,0,0,0,1,1H17.7A2.5,2.5,0,0,0,20,19.5,2.5,2.5,0,0,0,22.5,17,2.5,2.5,0,0,0,21,14.7ZM5,9.3A2.7,2.7,0,0,0,6.3,8H19v6.7A2.7,2.7,0,0,0,17.7,16H5Z />","geo-scale":'<path d="m21.7 16.1c.2.5-.1.9-.7.9h-10.5c-.6 0-1-.4-1-1v-13c0-.6.4-1 1-1h5.5c.6 0 1.1.4 1.3.9l4.4 13.1z" opacity=.4 /><path d="m9.2 21.1c.2.5-.1.9-.7.9h-5.5c-.6 0-1-.4-1-1v-7c0-.6.4-1 1-1h2.5c.6 0 1.1.4 1.3.9l2.4 7.1z" opacity=.4 /><path d="m21.7 16.7c0-.2-.3-.3-.5-.3l-5.4.2c-.2 0-.4.1-.5.3 0 .2 0 .4.2.5l.7.6-7.1 3.1c-.5.2-.7.8-.5 1.3.1.3.4.5.7.6h.7l7.1-3.1v.9c0 .2 0 .4.3.5.2 0 .4 0 .5-.1l3.8-3.8c.1-.1.2-.4.1-.6z"/><path d="m10.1 2.4c-.2-.1-.4-.1-.6 0l-4.6 2.8c-.2.1-.3.3-.2.5 0 .2.2.4.4.4l.9.2-4.8 6.1c-.3.4-.3 1.1.2 1.4.3.2.6.2.8.2s.4-.2.6-.4l4.7-6.2.4.8c0 .2.3.3.5.3.2 0 .3-.2.4-.4l1.4-5.2c0-.2 0-.4-.2-.5z"/>',"geo-tangent":"<path d=M10,22.9A8.9,8.9,0,1,1,18.9,14,8.9,8.9,0,0,1,10,22.9Zm0-16A7.1,7.1,0,1,0,17.1,14,7.1,7.1,0,0,0,10,6.9Z opacity=.4 /><path d=M22.4,9.4,15.5,6.5h0A2.5,2.5,0,0,0,13,4a2.9,2.9,0,0,0-1.8.7L2.4,1.1a1,1,0,0,0-.8,1.8l8.9,3.7A2.6,2.6,0,0,0,13,9a2.8,2.8,0,0,0,1.7-.7l6.9,2.9H22a.9.9,0,0,0,.9-.6A1,1,0,0,0,22.4,9.4Z />",geometry:"<path d=M22.3,13.1,16.7,3.2a1.9,1.9,0,0,0-3.4,0L12.3,5l-.6-.5a3,3,0,0,0-3.4,0L2.5,8.8A3,3,0,0,0,1.4,12l2.3,6.9a2.8,2.8,0,0,0,2.7,1.9h7.2a2.8,2.8,0,0,0,2.7-1.9l1-2.9h3.3a1.9,1.9,0,0,0,1.6-.9A2,2,0,0,0,22.3,13.1Zm-7.9,5.1a.8.8,0,0,1-.8.6H6.4a.8.8,0,0,1-.8-.6L3.3,11.4a.9.9,0,0,1,.3-1L9.5,6.2a.7.7,0,0,1,1,0l.8.6L7.7,13.1a2,2,0,0,0,.1,2,1.9,1.9,0,0,0,1.6.9h5.8ZM9.6,14,15,4.3,20.4,14Z />",grid:"<path d=M20,2H4A2,2,0,0,0,2,4V20a2,2,0,0,0,2,2H20a2,2,0,0,0,2-2V4A2,2,0,0,0,20,2ZM8,20H4V16H8Zm0-6H4V10H8ZM8,8H4V4H8Zm6,12H10V16h4Zm0-6H10V10h4Zm0-6H10V4h4Zm6,12H16V16h4Zm0-6H16V10h4Zm0-6H16V4h4Z />",group:"<path d=M22,5V3a.9.9,0,0,0-1-1H19a.9.9,0,0,0-1,1H6A.9.9,0,0,0,5,2H3A.9.9,0,0,0,2,3V5A.9.9,0,0,0,3,6V18a.9.9,0,0,0-1,1v2a.9.9,0,0,0,1,1H5a.9.9,0,0,0,1-1H18a.9.9,0,0,0,1,1h2a.9.9,0,0,0,1-1V19a.9.9,0,0,0-1-1V6A.9.9,0,0,0,22,5ZM19,18a.9.9,0,0,0-1,1H6a.9.9,0,0,0-1-1V6A.9.9,0,0,0,6,5H18a.9.9,0,0,0,1,1Z /><path d=M16,10H14V8a2,2,0,0,0-2-2H8A2,2,0,0,0,6,8v4a2,2,0,0,0,2,2h2v2a2,2,0,0,0,2,2h4a2,2,0,0,0,2-2V12A2,2,0,0,0,16,10Zm-6,2H8V8h4v2h0A2,2,0,0,0,10,12Zm2,4V12h4v4Z />",hand:"<path d=M19.5,10A1.5,1.5,0,0,0,18,11.5v-1a1.5,1.5,0,0,0-3,0v-1a1.5,1.5,0,0,0-3,0v-6a1.5,1.5,0,0,0-3,0V13.9L4.9,11.6a1.4,1.4,0,0,0-1.8.2,1.4,1.4,0,0,0,0,2.1l6.8,6.9A3.6,3.6,0,0,0,12.7,22H17a4,4,0,0,0,4-4V11.5A1.5,1.5,0,0,0,19.5,10Z />",handles:"<path d=M19,3H4.9A2,2,0,0,0,3,4.9V18.1A2,2,0,0,0,4.9,20h8.3A2.9,2.9,0,0,0,16,22a2.9,2.9,0,0,0,3-3,2.9,2.9,0,0,0-2-2.8V9h2a2.9,2.9,0,0,0,3-3A2.9,2.9,0,0,0,19,3ZM15,16.2A3.2,3.2,0,0,0,13.2,18H5V5H15Z />",hearts:"<path d=M12,21.4,10.6,20C5.4,15.4,2,12.3,2,8.5A5.4,5.4,0,0,1,7.5,3,6,6,0,0,1,12,5.1,6,6,0,0,1,16.5,3,5.4,5.4,0,0,1,22,8.5c0,3.8-3.4,6.9-8.6,11.5Z />",highlighter:"<path d=M10.2,9.5l-5.9,6a1.9,1.9,0,0,0,.1,2.8L.8,22H6.4l.8-.8a1.8,1.8,0,0,0,2.7.1l6-6.1Zm12.5-4L19.9,2.6a2.1,2.1,0,0,0-2.9,0L11.3,8.4l5.6,5.8,5.7-5.8A2.1,2.1,0,0,0,22.7,5.5Z fill-rule=evenodd />","hihat-closed":'<path d="m12 10.5c5.6 0 9.5-1.58 9.5-3s-3.56-2.85-8.75-2.99v-1.51c0-.41-.34-.75-.75-.75s-.75.34-.75.75v1.51c-5.19.13-8.75 1.63-8.75 2.99s3.9 3 9.5 3z"/><path d="m12 11.5c-3.64 0-7.41-.73-9.28-2.09-.14.2-.22.39-.22.59 0 1.42 3.9 3 9.5 3s9.5-1.58 9.5-3c0-.19-.08-.39-.22-.59-1.87 1.36-5.64 2.09-9.28 2.09z"/><path d="m11.25 13.99v7.01c0 .41.34.75.75.75s.75-.34.75-.75v-7.01c-.25 0-.5.01-.75.01s-.5 0-.75-.01z"/>',"hihat-open":'<path d="m12 10.5c5.6 0 9.5-1.58 9.5-3s-3.56-2.85-8.75-2.99v-1.51c0-.41-.34-.75-.75-.75s-.75.34-.75.75v1.51c-5.19.13-8.75 1.63-8.75 2.99s3.9 3 9.5 3z"/><path d="m11.25 15.49v5.51c0 .41.34.75.75.75s.75-.34.75-.75v-5.51c-.25 0-.5.01-.75.01s-.5 0-.75-.01z"/><path d="m20.19 10.05c-2.05.95-5.16 1.45-8.19 1.45s-6.14-.5-8.19-1.45c-.84.46-1.31.96-1.31 1.45 0 1.42 3.9 3 9.5 3s9.5-1.58 9.5-3c0-.49-.47-1-1.31-1.45z"/>',honk:'<path d="m21.17 6.58c-.25 0-.42.17-.42.42 0 2.17-8.33 3.25-11.58 3.33.21.5.33 1.08.33 1.67s-.13 1.17-.33 1.67c3.17 0 11.58.79 11.58 3.33 0 .25.17.42.42.42h.42c.25 0 .42-.17.42-.42v-10c0-.25-.17-.42-.42-.42zm-15.83 2.08c-1.84 0-3.33 1.49-3.33 3.33s1.49 3.33 3.33 3.33 3.33-1.49 3.33-3.33-1.49-3.33-3.33-3.33z"/>',italic:'<path d="m14.5 19v-.4a.8.8 0 0 0 -.8-1h-1.4l2.3-11.2h1.6a1.3 1.3 0 0 0 1.2-1v-.4a.8.8 0 0 0 -.8-1h-6a1.2 1.2 0 0 0 -1.1 1v-.2.8-.2a.8.8 0 0 0 .8 1h1.5l-2.4 11.2h-1.6a1.3 1.3 0 0 0 -1.2 1v-.2.8-.2a.8.8 0 0 0 .8 1h6a1.2 1.2 0 0 0 1.1-1z"/>',keyboard:'<path d="m3.2 4c-.88 0-1.6.72-1.6 1.6v12.8c0 .88.72 1.6 1.6 1.6h17.6c.88 0 1.6-.72 1.6-1.6v-12.8c0-.88-.72-1.6-1.6-1.6zm1.6 1.6h7.2c.44 0 .8.36.8.8v3.2c0 .44-.36.8-.8.8h-7.2c-.44 0-.8-.36-.8-.8v-3.2c0-.44.36-.8.8-.8zm11.2 1.6c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm3.2 0c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm-16 5.6h2.4v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h.8v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h2.4v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h.8v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h.8v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h2.4v5.6h-17.6z"/>',kick:'<path d="m18.66 17.65c1.6-1.66 2.59-3.92 2.59-6.4 0-5.1-4.15-9.25-9.25-9.25s-9.25 4.15-9.25 9.25c0 2.48.99 4.74 2.59 6.4l-1.97 3.21c-.22.35-.11.81.25 1.03.12.08.26.11.39.11.25 0 .5-.13.64-.36l1.84-2.99c1.07.8 2.31 1.38 3.66 1.66l-.06.69c-.05.55.37 1 .92 1h2c.55 0 .96-.45.92-1l-.06-.69c1.35-.28 2.59-.86 3.66-1.66l1.84 2.99c.14.23.39.36.64.36.13 0 .27-.04.39-.11.35-.22.46-.68.25-1.03l-1.97-3.21zm-5.08-.65c-.05-.55-.53-1-1.08-1v-3.09c.58-.21 1-.76 1-1.41 0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5c0 .65.42 1.2 1 1.41v3.09c-.55 0-1.04.45-1.08 1l-.15 1.8c-3.44-.79-6.02-3.87-6.02-7.55 0-4.27 3.48-7.75 7.75-7.75s7.75 3.48 7.75 7.75c0 3.68-2.58 6.76-6.02 7.55z"/>',"layer-back":"<path d=M9,7H7V9H9Zm0,4H7v2H9ZM9,3A2,2,0,0,0,7,5H9Zm4,12H11v2h2ZM19,3V5h2A2,2,0,0,0,19,3ZM13,3H11V5h2ZM9,17V15H7A2,2,0,0,0,9,17Zm10-4h2V11H19Zm0-4h2V7H19Zm0,8a2,2,0,0,0,2-2H19ZM4,7A1,1,0,0,0,3,8V19a2,2,0,0,0,2,2H16a1,1,0,0,0,0-2H6a1,1,0,0,1-1-1V8A.9.9,0,0,0,4,7ZM15,5h2V3H15Zm0,12h2V15H15Z />","layer-front":"<path d=M3,13H5V11H3Zm0,4H5V15H3Zm2,4V19H3A2,2,0,0,0,5,21ZM3,9H5V7H3ZM15,21h2V19H15ZM19,3H9A2,2,0,0,0,7,5V15a2,2,0,0,0,2,2H19a2,2,0,0,0,2-2V5A2,2,0,0,0,19,3ZM18,15H10a.9.9,0,0,1-1-1V6a.9.9,0,0,1,1-1h8a1,1,0,0,1,1,1v8A1,1,0,0,1,18,15Zm-7,6h2V19H11ZM7,21H9V19H7Z />",lightbulb:"<path d=M9,19h6a0,0,0,0,1,0,0v2a2,2,0,0,1-2,2H11a2,2,0,0,1-2-2V19A0,0,0,0,1,9,19Z /><path d=M12,2A7,7,0,0,0,5,9c0,2.8,4,6,4,9h2.5A17.2,17.2,0,0,0,8.8,9.8a.4.4,0,0,1,0-.5A.5.5,0,0,1,9.2,9h5.6a.5.5,0,0,1,.4.3.4.4,0,0,1,0,.5A17.2,17.2,0,0,0,12.5,18H15c0-3,4-6.2,4-9A7,7,0,0,0,12,2Z /><path d=M10.1,10A22.8,22.8,0,0,1,12,14.6,22.8,22.8,0,0,1,13.9,10Z />","line-chart":'<path d=M20,4a2,2,0,0,0-2,2,.9.9,0,0,0,.1.5l-3.6,3.6h-1L11.9,8.5A.9.9,0,0,0,12,8,2,2,0,0,0,8,8a.9.9,0,0,0,.1.5L4.5,12.1H4a2,2,0,1,0,2,2,.9.9,0,0,0-.1-.5L9.5,9.9h1l1.6,1.6a.9.9,0,0,0-.1.5,2,2,0,0,0,4,0,.9.9,0,0,0-.1-.5l3.6-3.6H20a2,2,0,0,0,0-4ZM4,15a1,1,0,0,1,0-2,1,1,0,0,1,0,2ZM9,8a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1,.9.9,0,0,1-1,1A.9.9,0,0,1,9,8Zm5,5a1,1,0,1,1,1-1A.9.9,0,0,1,14,13Zm6-6a.9.9,0,0,1-1-1,1,1,0,0,1,2,0A.9.9,0,0,1,20,7Z /><rect x=11 y=9 width=2 height=20 rx=1 transform="translate(-7 31) rotate(-90)"/>',lock:"<path d=M18,8H17V6A5,5,0,0,0,7,6V8H6a2,2,0,0,0-2,2V20a2,2,0,0,0,2,2H18a2,2,0,0,0,2-2V10A2,2,0,0,0,18,8Zm-6,9a2,2,0,1,1,2-2A2,2,0,0,1,12,17ZM9,8V6a3,3,0,0,1,6,0V8Z />",marimba:'<path d="m2 3.2c-.44 0-.8.36-.8.8v14.4c0 .44.36.8.8.8h3.2c.44 0 .8-.36.8-.8v-14.4c0-.44-.36-.8-.8-.8zm5.6 0c-.44 0-.8.36-.8.8v12c0 .44.36.8.8.8h3.2c.44 0 .8-.36.8-.8v-12c0-.44-.36-.8-.8-.8zm5.6 0c-.44 0-.8.36-.8.8v9.6c0 .44.36.8.8.8h3.2c.44 0 .8-.36.8-.8v-9.6c0-.44-.36-.8-.8-.8zm5.6 0c-.44 0-.8.36-.8.8v7.2c0 .44.36.8.8.8h3.2c.44 0 .8-.36.8-.8v-7.2c0-.44-.36-.8-.8-.8zm-15.2 1.6c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm5.6 0c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm5.6 0c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm5.6 0c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm0 4c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm-5.6 2.4c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm-5.6 2.4c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8zm11.2.8c-.77 0-1.43.55-1.57 1.31l-9.9 3.53c-.42.13-.65.58-.52 1.01s.58.65 1.01.52c.02 0 .03-.01.05-.02l9.9-3.53c.29.25.66.38 1.04.38.88 0 1.6-.72 1.6-1.6s-.72-1.6-1.6-1.6zm-16.8 1.6c.44 0 .8.36.8.8s-.36.8-.8.8-.8-.36-.8-.8.36-.8.8-.8z"/>',marker:'<path d="m9.7 9.5 4.3 4.3-6.6 6.5-.7-.7-1.4 1.4a2.1 2.1 0 0 1 -2.9 0 1.9 1.9 0 0 1 0-2.8l1.5-1.5-.8-.7zm11.6-5.8-1.5-1.5a1.9 1.9 0 0 0 -2.8 0l-6.2 6.2 4.2 4.3 6.3-6.2a2.1 2.1 0 0 0 0-2.8z" fill-rule=evenodd />',more:'<path d="m12 8a2 2 0 1 0 -2-2 2 2 0 0 0 2 2zm0 2a2 2 0 1 0 2 2 2 2 0 0 0 -2-2zm0 6a2 2 0 1 0 2 2 2 2 0 0 0 -2-2z"/>',"move-off":"<path d=M12.9984,13.004v-.0056h.0044l-2.0044-2.0056v.0056H10.994L3.51,3.51A.997.997,0,0,0,2.1,4.92l6.0749,6.0784H5.99v-1.79a.4949.4949,0,0,0-.85-.35l-2.78,2.79a.5136.5136,0,0,0,0,.71l2.78,2.79a.5.5,0,0,0,.85-.36v-1.79h4.1836l.8248.8252V18.01h-1.79a.4949.4949,0,0,0-.35.85l2.79,2.78a.5136.5136,0,0,0,.71,0l2.79-2.78a.5.5,0,0,0-.36-.85h-1.79V15.8248L19.07,21.9a.997.997,0,0,0,1.41-1.41Z /><path d=M21.64,11.6484l-2.78-2.79a.4949.4949,0,0,0-.85.35v1.79H13.8232l1.9988,2H18.01v1.79a.5.5,0,0,0,.85.36l2.78-2.79A.5136.5136,0,0,0,21.64,11.6484Z /><path d=M9.2084,5.99h1.79V8.1719l2,2.0012V5.99h1.79a.5.5,0,0,0,.36-.85l-2.79-2.78a.5136.5136,0,0,0-.71,0l-2.79,2.78A.4949.4949,0,0,0,9.2084,5.99Z />",move:"<path d=M10.5,9h3a.5.5,0,0,0,.5-.5V6h1.8a.4.4,0,0,0,.3-.8L12.3,1.4a.5.5,0,0,0-.7,0L7.8,5.2c-.3.3,0,.8.4.8H10V8.5A.5.5,0,0,0,10.5,9Zm-2,1H6V8.2a.4.4,0,0,0-.8-.3L1.4,11.6a.6.6,0,0,0,0,.8l3.8,3.7a.4.4,0,0,0,.8-.3V14H8.5a.5.5,0,0,0,.5-.5v-3A.5.5,0,0,0,8.5,10Zm14.1,1.6L18.9,7.9a.5.5,0,0,0-.9.3V10H15.5a.5.5,0,0,0-.5.5v3a.5.5,0,0,0,.5.5H18v1.8a.5.5,0,0,0,.9.3l3.7-3.8C22.8,12.2,22.8,11.8,22.6,11.6ZM13.5,15h-3a.5.5,0,0,0-.5.5V18H8.2a.5.5,0,0,0-.3.9l3.7,3.7a.6.6,0,0,0,.8,0l3.7-3.8a.4.4,0,0,0-.3-.8H14V15.5A.5.5,0,0,0,13.5,15Z />",music:'<path d="m12 5v8.55c-.94-.54-2.1-.75-3.33-.32-1.34.48-2.37 1.67-2.61 3.07-.46 2.74 1.86 5.08 4.59 4.65 1.96-.31 3.35-2.11 3.35-4.1v-9.85h2c1.1 0 2-.9 2-2s-.9-2-2-2h-2c-1.1 0-2 .9-2 2z"/>',numbers:'<path d="m2.1 9.5.2 1.8 2.1-.7v8.2h2.2v-10.5h-1.9z"/><path d="m20.7 12.3a2.5 2.5 0 0 0 1.5-2.4c0-1.7-1.4-2.8-3.5-2.8a5.8 5.8 0 0 0 -3.2 1h-.1l.3 1.9.2-.2a5 5 0 0 1 2.6-.8c.7 0 1.5.1 1.5 1.1s-.7 1.2-2.1 1.2h-1l.3 1.8h.7c2.1 0 2.3.9 2.3 1.5s-1.1 1.4-1.7 1.4a4.3 4.3 0 0 1 -2.7-.8h-.2l-.3 2a6.9 6.9 0 0 0 3.2.8c2.4 0 3.9-1.3 3.9-3.2a2.5 2.5 0 0 0 -1.7-2.5z"/><path d="m10.9 11.9 2.2-2.2c1.2-1.3 1.9-2.1 1.9-3.5s-1.3-3-3.4-3a4.7 4.7 0 0 0 -3.3 1.1h-.1l.3 2.1.2-.2a4.5 4.5 0 0 1 2.7-1.1c.9 0 1.4.4 1.4 1.3s-.4 1.2-1.1 2l-3.7 3.7v1.6h7.2l-.3-1.9z"/>',pause:'<path d="m8 19a2 2 0 0 0 2-2v-10a2 2 0 0 0 -2-2 2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2zm6-12v10a2 2 0 0 0 2 2 2 2 0 0 0 2-2v-10a2 2 0 0 0 -2-2 2 2 0 0 0 -2 2z"/>',pen:'<path d="m15.9 11.8-3.7-3.7-7.8 7.7-1.2 1.3c-.2.1-.2.2-.2.4v3a.5.5 0 0 0 .5.5h3c.2 0 .3 0 .4-.2l2.8-2.7 1.1-1.2 1.7-1.6z"/><path d="m21.6 10.4c0-.4-.5-.9-.9-1.4s-.7-.6-.7-1 .4-.6.7-1h.1a1.4 1.4 0 0 0 .2-.6.9.9 0 0 0 -.3-.6l-2.3-2.5h-.1l-.6-.3a.9.9 0 0 0 -.7.3l-.5.5-3.4 3.3 3.8 3.8 1.4-1.4.9.9-3.5 3.6a.8.8 0 0 0 -.3.7 1.1 1.1 0 0 0 1 1 1.1 1.1 0 0 0 .7-.3l3.4-3.5c.6-.5 1.1-1 1.1-1.5z"/>',piano:'<path d="m8 3.2c-3.09 0-5.6 2.51-5.6 5.6v11.2c0 .44.36.8.8.8h17.6c.44 0 .8-.36.8-.8v-8c0-2.21-1.79-4-4-4h-.77c-1.04 0-2.04-.41-2.79-1.13l-1.95-1.9c-1.06-1.12-2.53-1.76-4.08-1.76zm-4 12.8h1.6v2c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-2h.8v2c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-2h2.4v2c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-2h.8v2c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-2h.8v2c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-2h1.6v3.2h-16z"/>',"pie-chart":"<path d=M5.9,19.6H6a1.3,1.3,0,0,0,.7-.5L10.9,12a1.1,1.1,0,0,0,.1-.5V3.2a.9.9,0,0,0-.4-.8,1.1,1.1,0,0,0-.8-.1A9.9,9.9,0,0,0,2,12a9.7,9.7,0,0,0,3.2,7.3A.9.9,0,0,0,5.9,19.6Z /><path d=M14,11h6.8a.9.9,0,0,0,.8-.4,1.1,1.1,0,0,0,.1-.8,9.9,9.9,0,0,0-7.5-7.5,1.1,1.1,0,0,0-.8.1.9.9,0,0,0-.4.8V10A.9.9,0,0,0,14,11Z /><path d=M20.8,13H13.1a1,1,0,0,0-.8.5L8.4,20.1a1.4,1.4,0,0,0,0,.9c.1.2.3.5.6.5a10.5,10.5,0,0,0,3,.5,9.9,9.9,0,0,0,9.7-7.8,1.1,1.1,0,0,0-.1-.8A.9.9,0,0,0,20.8,13Z />",pin:"<path d=M19,12.9a1,1,0,0,0-.8-1A3,3,0,0,1,16,9V4h1a1.1,1.1,0,0,0,1-1,1.1,1.1,0,0,0-1-1H7A1,1,0,0,0,7,4H8V9a3,3,0,0,1-2.2,2.9,1,1,0,0,0-.8,1H5a.9.9,0,0,0,1,1h5v7a1,1,0,0,0,2,0V14h5a1,1,0,0,0,1-1Z />",play:"<path d=M8,6.8V17.2a.9.9,0,0,0,1.5.8l8.2-5.2a1,1,0,0,0,0-1.7L9.5,6A1,1,0,0,0,8,6.8Z />",power:"<rect height=7 opacity=.4 rx=1 width=7 x=14 y=3 /><rect height=14 opacity=.4 rx=1 width=9 x=4 y=7 />",probability:"<path d=M17.3,3H6.7A3.8,3.8,0,0,0,3,6.7V17.3A3.8,3.8,0,0,0,6.7,21H17.3A3.8,3.8,0,0,0,21,17.3V6.7A3.8,3.8,0,0,0,17.3,3ZM19,17.3A1.8,1.8,0,0,1,17.3,19H6.7A1.8,1.8,0,0,1,5,17.3V6.7A1.8,1.8,0,0,1,6.7,5H17.3A1.8,1.8,0,0,1,19,6.7Z /><circle cx=8.5 cy=8.5 r=1.5 /><circle cx=15.5 cy=8.5 r=1.5 /><circle cx=8.5 cy=15.5 r=1.5 /><circle cx=12 cy=12 r=1.5 /><circle cx=15.5 cy=15.5 r=1.5 />",quack:'<path d="m105.57 101.81c9.889-6.368 27.417-16.464 28.106-42.166.536-20.278-9.971-49.506-49.155-50.878-31.482-1.108-44.623 19.484-48.452 37.972l-.928-.126c-1.932 0-3.438 1.28-5.34 2.889-2.084 1.784-4.683 3.979-7.792 4.308-3.573.361-8.111-1.206-11.698-2.449-4.193-1.431-6.624-2.047-8.265-.759-1.503 1.163-2.178 3.262-2.028 6.226.331 6.326 4.971 18.917 16.016 25.778 7.67 4.765 16.248 5.482 20.681 5.482h.006c2.37 0 4.945-.239 7.388-.726 2.741 4.218 5.228 7.476 6.037 9.752 2.054 5.851-27.848 25.087-27.848 55.01 0 29.916 22.013 48.475 56.727 48.475h55.004c30.593 0 70.814-29.908 75.291-92.48-28.541 24.072-42.294-9.969-103.75-6.308zm-86.631-23.866c-10.166-6.328-13.949-19.023-13.647-22.42.897.24 2.194.689 3.228 1.042 4.105 1.415 9.416 3.228 14.068 2.707 4.799-.499 8.253-3.437 10.778-5.574.607-.509 1.393-1.176 1.872-1.491.87.315.962.693 1.176 3.14.196 2.26.473 5.37 2.362 9.006 1.437 2.761 3.581 5.705 5.646 8.542 1.701 2.336 4.278 5.871 4.535 6.404-.445 1.184-4.907 3.282-12.229 3.282-6.553.008-13.04-1.679-17.789-4.638zm37.919-28.577c0-4.938 4.001-8.943 8.931-8.943 4.941 0 8.942 4.005 8.942 8.943 0 4.931-4.001 8.942-8.942 8.942-4.937.001-8.931-4.011-8.931-8.942zm92.299 106.03-20.63 11.169 13.408 9.293s-49.854 15.813-72.198-6.885c-11.006-11.16-13.06-28.533 4.124-38.84 17.184-10.312 84.609 3.943 84.609 3.943l-24.177 13.722z"/>',redo:"<path d=M18.4,10.6a10.5,10.5,0,0,0-14.8,1,11.4,11.4,0,0,0-1.5,2.3,1.2,1.2,0,0,0,.6,1.7h.1A1.2,1.2,0,0,0,4.3,15,8,8,0,0,1,15,11.3a9.1,9.1,0,0,1,1.6,1.1l-1.9,1.9a1,1,0,0,0,0,1.4.9.9,0,0,0,.7.3H21a.9.9,0,0,0,1-1V9.4a1,1,0,0,0-1-1,.9.9,0,0,0-.7.3Z />",ride:'<path d="m13.46 4.01c-2.28.11-4.71 1.19-6.62 3.16-3.4 3.5-3.8 8.52-1 11.22s7.88 1.91 11.28-1.59 3.9-8.52 1-11.22c-1.23-1.14-2.89-1.64-4.66-1.56zm-1.25 3.47c.71.05 1.38.32 1.91.81 1.4 1.1 1.1 3.49-.5 5.19s-4.01 2.01-5.41.81c-1.4-1.3-1.1-3.61.5-5.31 1-1.06 2.31-1.58 3.5-1.5zm-.81 1.12c-.64.09-1.28.42-1.78.97-1.1 1.1-1.18 2.7-.28 3.5s2.5.6 3.5-.5c1.1-1.1 1.18-2.7.28-3.5-.45-.4-1.08-.55-1.72-.47zm-.34 1.41c.21-.04.41 0 .56.16.3.3.3.82-.09 1.22-.4.3-.89.39-1.19.09-.3-.2-.21-.79.09-1.09.2-.2.41-.34.62-.38z"/>',"row-chart":"<path d=M19,10H6V8h9a.9.9,0,0,0,1-1V5a.9.9,0,0,0-1-1H6V3A.9.9,0,0,0,5,2,.9.9,0,0,0,4,3V21a.9.9,0,0,0,1,1,.9.9,0,0,0,1-1V20h5a.9.9,0,0,0,1-1V17a.9.9,0,0,0-1-1H6V14H19a.9.9,0,0,0,1-1V11A.9.9,0,0,0,19,10Z />",scatter:"<path d=M21,18H6V3.2a1,1,0,1,0-2,0V18H3a1,1,0,0,0,0,2H4v1.2a.9.9,0,0,0,1,1,.9.9,0,0,0,1-1V20H21a1,1,0,0,0,0-2Z /><circle cx=12 cy=6 r=2 /><circle cx=10 cy=12 r=2 /><circle cx=18 cy=14 r=2 />",settings:"<path d=M19.5,12v-.7l1.8-1.4a1.1,1.1,0,0,0,.3-1.3L19.7,5.4A.9.9,0,0,0,18.5,5l-2.2.9-1.2-.7-.2-2.3a1.1,1.1,0,0,0-1-.9H10.1a1.1,1.1,0,0,0-1,.9L8.9,5.2l-1.2.7L5.5,5a.9.9,0,0,0-1.2.4L2.4,8.6a1.1,1.1,0,0,0,.3,1.3l1.8,1.4v1.4L2.7,14.1a1.1,1.1,0,0,0-.3,1.3l1.9,3.2a.9.9,0,0,0,1.2.4l2.2-.9,1.2.7.2,2.3a1.1,1.1,0,0,0,1,.9h3.8a1.1,1.1,0,0,0,1-.9l.2-2.3,1.2-.7,2.2.9a.9.9,0,0,0,1.2-.4l1.9-3.2a1.1,1.1,0,0,0-.3-1.3l-1.8-1.4ZM12,15.5a3.5,3.5,0,0,1,0-7,3.5,3.5,0,0,1,0,7Z />",shaker:'<path d="m15.71 3c-.84 0-1.71.16-2.54.49.07.27.62 2.74 2.6 4.73 1.07 1.07 2.65 2.08 4.73 2.6.9-2.22.58-4.69-1.03-6.3-1.01-1.01-2.35-1.51-3.76-1.52zm-3.57 1.01c-.49.3-.96.66-1.39 1.09.24.94.74 3.35 2.77 5.38s4.35 2.51 5.38 2.77c.43-.43.79-.9 1.09-1.39-3.07-.78-4.97-2.79-5.01-2.83-.05-.05-2.05-1.94-2.83-5.01zm-2.28 2.15c-1.57 2.28-1.83 5.56.29 7.68 2.06 2.05 5.31 1.93 7.68.29-2.49-.63-4.2-1.95-5.11-2.86s-2.23-2.62-2.86-5.11zm-1.82 6.56c-.5 2.23-2.11 3.16-3.24 3.82-.4.24-.76.44-.99.67-.54.52-.81 1.08-.81 1.67 0 1.17.95 2.12 2.12 2.12.59 0 1.15-.27 1.67-.81.23-.24.44-.59.67-1 .66-1.13 1.6-2.75 3.82-3.24-.84-.37-1.49-.86-1.99-1.37-.65-.67-1.04-1.38-1.24-1.86z"/>',shapes:'<path d="m11.1 3.4-3.7 6.1a1 1 0 0 0 .9 1.5h7.4a1 1 0 0 0 .9-1.5l-3.7-6.1a1.1 1.1 0 0 0 -1.8 0z"/><circle cx=17.5 cy=17.5 r=4.5 /><path d="m4 21.5h6a1 1 0 0 0 1-1v-6a.9.9 0 0 0 -1-1h-6a1 1 0 0 0 -1 1v6a1.1 1.1 0 0 0 1 1z"/>',"snap-to-grid":"<path d=M15,12.9l2.1-2.1L15.7,9.4a1,1,0,0,0-1.4,0l-.7.7a1,1,0,0,0,0,1.4Z /><path d=M11.5,13.6a1,1,0,0,0-1.4,0l-.7.7a1,1,0,0,0,0,1.4l1.4,1.4L12.9,15Z /><path d=M20.7,14.3l-2.8-2.8-2.2,2.1,2.9,2.8a1.8,1.8,0,0,1,0,2.2,1.8,1.8,0,0,1-2.2,0l-2.8-2.9-2.1,2.2,2.8,2.8a4.7,4.7,0,0,0,6.4,0A4.7,4.7,0,0,0,20.7,14.3Z /><path d=M12,10V3a.9.9,0,0,0-1-1,.9.9,0,0,0-1,1V5H7V3A.9.9,0,0,0,6,2,.9.9,0,0,0,5,3V5H3A.9.9,0,0,0,2,6,.9.9,0,0,0,3,7H5v3H3a.9.9,0,0,0-1,1,.9.9,0,0,0,1,1h7A2,2,0,0,0,12,10ZM7,7h3v3H7Z />",snare:'<path d="m15.16 1.6c-.24.01-.45.13-.6.32l-2.88 3.7c-4.79.09-8.49 2.16-8.49 4.79v7.2c0 1.52 1.24 2.85 3.2 3.73v-6.13c0-.44.36-.8.8-.8s.8.36.8.8v6.69c1.2.33 2.55.51 4 .51s2.8-.19 4-.51v-6.69c0-.44.36-.8.8-.8s.8.36.8.8v6.13c1.96-.87 3.2-2.21 3.2-3.73v-7.2c0-.88-.42-1.7-1.16-2.41l-1.25 1c.52.45.81.94.81 1.41 0 1.51-2.96 3.2-7.2 3.2s-7.2-1.69-7.2-3.2c0-1.31 2.23-2.75 5.58-3.11l-1.42 1.82c-.28.34-.24.84.1 1.13s.84.24 1.13-.1c.01-.02.03-.03.04-.05l5.61-7.2c.28-.35.22-.85-.13-1.12-.15-.12-.35-.18-.54-.17zm4.83 2.4c-.18 0-.35.07-.49.18l-2.72 2.18c-.45-.16-.92-.29-1.42-.4l-1.1 1.42c.35.05.68.12 1 .2l-3.76 3c-.35.28-.4.78-.13 1.13s.78.4 1.13.13l8-6.4c.35-.27.41-.77.14-1.12-.15-.2-.39-.31-.65-.31z"/>',spades:'<path d="m12 2c-3 5-8 7-8 12a4.3 4.3 0 0 0 4 4 3.7 3.7 0 0 0 3-1s.3 2-2 5h6c-2-3-2-5-2-5a3.7 3.7 0 0 0 3 1 4.3 4.3 0 0 0 4-4c0-5-5-7-8-12z"/>',"split-dots":"<path d=M15.15,5.14,12.36,2.36a.51.51,0,0,0-.71,0L8.86,5.14A.49.49,0,0,0,9.21,6H11V8a1,1,0,0,0,2,0V6h1.79A.5.5,0,0,0,15.15,5.14Z /><path d=M8.85,18.86l2.79,2.78a.51.51,0,0,0,.71,0l2.79-2.78a.49.49,0,0,0-.35-.85H13V16a1,1,0,0,0-2,0v2H9.21A.5.5,0,0,0,8.85,18.86Z /><path d=M18.86,15.15l2.78-2.79a.51.51,0,0,0,0-.71L18.86,8.86a.49.49,0,0,0-.85.35V11H16a1,1,0,0,0,0,2h2v1.79A.5.5,0,0,0,18.86,15.15Z /><path d=M5.14,8.85,2.36,11.64a.51.51,0,0,0,0,.71l2.78,2.79A.49.49,0,0,0,6,14.79V13H8a1,1,0,0,0,0-2H6V9.21A.5.5,0,0,0,5.14,8.85Z /><circle cx=12 cy=12 r=2 />","split-h":'<path d="m22 4v16c0 1.1-.9 2-2 2h-5v-20h5c1.1 0 2 .9 2 2zm-20 0v16c0 1.1.9 2 2 2h5v-20h-5c-1.1 0-2 .9-2 2zm10-3c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1zm0 18c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1zm0-6c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1zm0-6c-.55 0-1 .45-1 1v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1z"/>',"split-v":'<path d="m22 15v5c0 1.1-.9 2-2 2h-16c-1.1 0-2-.9-2-2v-5zm0-6v-5c0-1.1-.9-2-2-2h-16c-1.1 0-2 .9-2 2v5zm0 2h-2c-.55 0-1 .45-1 1s.45 1 1 1h2c.55 0 1-.45 1-1s-.45-1-1-1zm-18 2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zm4-2c-.55 0-1 .45-1 1s.45 1 1 1h2c.55 0 1-.45 1-1s-.45-1-1-1zm6 0c-.55 0-1 .45-1 1s.45 1 1 1h2c.55 0 1-.45 1-1s-.45-1-1-1z"/>',sqrt:"<rect x=12 y=7 width=8 height=12 rx=1 opacity=.4 /><path d=M8,21a1,1,0,0,1-.9-.7L4.6,12.9l-.9.8a1,1,0,0,1-1.4,0,1,1,0,0,1,0-1.4l2-2a.8.8,0,0,1,.9-.3,1,1,0,0,1,.7.7l1.7,4.8L9,3.9A1.1,1.1,0,0,1,10,3H21a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1H10.9L9,20.1a1.1,1.1,0,0,1-.9.9Z />",synth:'<path d="m20 5.6h-16c-1.33 0-2.4 1.07-2.4 2.4v4c0 .44.36.8.8.8v4c0 .88.72 1.6 1.6 1.6h16c.88 0 1.6-.72 1.6-1.6v-4c.44 0 .8-.36.8-.8v-4c0-1.33-1.07-2.4-2.4-2.4zm0 11.2h-16v-5.6h1.6v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h.8v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h2.4v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h.8v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h.8v3.6c0 .22.18.4.4.4h.8c.22 0 .4-.18.4-.4v-3.6h1.6z"/>',text:"<path d=M22,5V3a.9.9,0,0,0-1-1H19a.9.9,0,0,0-1,1H6A.9.9,0,0,0,5,2H3A.9.9,0,0,0,2,3V5A.9.9,0,0,0,3,6V18a.9.9,0,0,0-1,1v2a.9.9,0,0,0,1,1H5a.9.9,0,0,0,1-1H18a.9.9,0,0,0,1,1h2a.9.9,0,0,0,1-1V19a.9.9,0,0,0-1-1V6A.9.9,0,0,0,22,5ZM19,18a.9.9,0,0,0-1,1H6a.9.9,0,0,0-1-1V6A.9.9,0,0,0,6,5H18a.9.9,0,0,0,1,1Z /><path d=M15,7H9A.9.9,0,0,0,8,8,.9.9,0,0,0,9,9h2v7a1,1,0,0,0,2,0V9h2a.9.9,0,0,0,1-1A.9.9,0,0,0,15,7Z />",tiles:"<path d=M4,8H8V4H4Zm6,12h4V16H10ZM4,20H8V16H4Zm0-6H8V10H4Zm6,0h4V10H10ZM16,4V8h4V4ZM10,8h4V4H10Zm6,6h4V10H16Zm0,6h4V16H16Z />","tom-high":'<path d="m6 12.51v.66c0 .22.1.42.27.54 1.11.73 3.02 1.22 5.23 1.29v3.26l-3.8 2.85c-.22.17-.27.48-.1.7.1.13.25.2.4.2.1 0 .21-.03.3-.1l3.7-2.78 3.7 2.78c.09.07.19.1.3.1.15 0 .3-.07.4-.2.17-.22.12-.53-.1-.7l-3.8-2.85v-3.26c2.21-.07 4.12-.56 5.23-1.29.17-.11.27-.32.27-.54v-.66c-1.12.89-3.38 1.49-6 1.49s-4.88-.61-6-1.49z"/><path d="m12 8c-2.55 0-4.78-.59-6-1.46v4.97c1.12.89 3.38 1.49 6 1.49s4.88-.61 6-1.49v-4.97c-1.22.87-3.45 1.46-6 1.46z"/><path d="m12 3c3.28 0 5 1.11 5 1.5s-1.72 1.5-5 1.5-5-1.11-5-1.5 1.72-1.5 5-1.5m0-1c-3.31 0-6 1.12-6 2.5s2.69 2.5 6 2.5 6-1.12 6-2.5-2.69-2.5-6-2.5z"/>',"tom-low":'<path d="m4 15.1v.56c0 .27.13.54.36.69.45.28 1.01.53 1.64.75v1.19l-.85.85c-.09.09-.15.22-.15.35v2c0 .28.22.5.5.5s.5-.22.5-.5v-1.79l.85-.85c.09-.09.15-.22.15-.35v-1.1c1.43.37 3.14.6 5 .6s3.57-.22 5-.6v1.1c0 .13.05.26.15.35l.85.85v1.79c0 .28.22.5.5.5s.5-.22.5-.5v-2c0-.13-.05-.26-.15-.35l-.85-.85v-1.19c.63-.22 1.19-.47 1.64-.75.23-.15.36-.41.36-.69v-.56c-1.49 1.13-4.51 1.9-8 1.9s-6.51-.77-8-1.9z"/><path d="m12 8c-3.49 0-6.51-.66-8-1.63v7.73c1.49 1.13 4.51 1.9 8 1.9s6.51-.77 8-1.9v-7.73c-1.49.97-4.51 1.63-8 1.63z"/><path d="m12 3c4.25 0 6.61 1.02 6.97 1.5-.37.48-2.73 1.5-6.97 1.5s-6.61-1.02-6.97-1.5c.37-.48 2.73-1.5 6.97-1.5m0-1c-4.42 0-8 1.12-8 2.5s3.58 2.5 8 2.5 8-1.12 8-2.5-3.58-2.5-8-2.5z"/>',underline:"<path d=M5,20H5a1,1,0,0,0,1,1H18a1.1,1.1,0,0,0,1-1h0a1.1,1.1,0,0,0-1-1H6A1,1,0,0,0,5,20Z /><path d=M17,3h-.7a1,1,0,0,0-1,1v8.5A3,3,0,0,1,12,15.7a3,3,0,0,1-3.3-3.2V4a1,1,0,0,0-1-1H7A.9.9,0,0,0,6,4v8.6c0,3.3,2.4,5.6,6,5.6s6-2.3,6-5.6V4A.9.9,0,0,0,17,3Z />",undo:"<path d=M12.5,8a10.4,10.4,0,0,0-6.9,2.6L3.7,8.7a1,1,0,0,0-1.4,0,.9.9,0,0,0-.3.7V15a.9.9,0,0,0,1,1H8.6a1,1,0,0,0,1-1,.9.9,0,0,0-.3-.7L7.4,12.4a8,8,0,0,1,11.3,1,8.6,8.6,0,0,1,1,1.6,1.2,1.2,0,0,0,1.5.6,1.1,1.1,0,0,0,.9-1.5v-.2A10.7,10.7,0,0,0,12.5,8Z />",ungroup:"<path d=M22,10V8a.9.9,0,0,0-1-1H19a.9.9,0,0,0-1,1H16V6a.9.9,0,0,0,1-1V3a.9.9,0,0,0-1-1H14a.9.9,0,0,0-1,1H6A.9.9,0,0,0,5,2H3A.9.9,0,0,0,2,3V5A.9.9,0,0,0,3,6v7a.9.9,0,0,0-1,1v2a.9.9,0,0,0,1,1H5a.9.9,0,0,0,1-1H8v2a.9.9,0,0,0-1,1v2a.9.9,0,0,0,1,1h2a.9.9,0,0,0,1-1h7a.9.9,0,0,0,1,1h2a.9.9,0,0,0,1-1V19a.9.9,0,0,0-1-1V11A.9.9,0,0,0,22,10ZM6,14a.9.9,0,0,0-1-1V6A.9.9,0,0,0,6,5h7a.9.9,0,0,0,1,1V8H11a.9.9,0,0,0-1-1H8A.9.9,0,0,0,7,8v2a.9.9,0,0,0,1,1v3Zm7,0H10V11a.9.9,0,0,0,1-1h3v3A.9.9,0,0,0,13,14Zm6,4a.9.9,0,0,0-1,1H11a.9.9,0,0,0-1-1V16h3a.9.9,0,0,0,1,1h2a.9.9,0,0,0,1-1V14a.9.9,0,0,0-1-1V10h2a.9.9,0,0,0,1,1Z />",unpin:"<path d=M20.5,19.1,4.9,3.5A1,1,0,0,0,3.5,4.9L8,9.4a3,3,0,0,1-2.2,2.5,1,1,0,0,0-.8,1H5a1.1,1.1,0,0,0,1,1h5v7a1.1,1.1,0,0,0,1,1,1.1,1.1,0,0,0,1-1V14.4l6.1,6.1a1,1,0,0,0,1.4-1.4Z /><path d=M19,13h0a1,1,0,0,0-.8-1A3,3,0,0,1,16,9V4h1a1.1,1.1,0,0,0,1-1,1.1,1.1,0,0,0-1-1H7l-.6.2L18.2,14A1.1,1.1,0,0,0,19,13Z />",violin:'<path d="m22.41 2.06-.47-.47c-.06-.06-.14-.09-.22-.09-.08 0-.17.04-.23.1-.36.36-.64.38-.91.39-.21.01-.45.03-.64.22s-.3.44-.3.71c0 .21.07.41.19.57l-.39.38-.48-.48c-.11-.11-.3-.11-.42 0-.11.11-.11.3 0 .42l.47.48-.34.33s0 0 0-.01l-.46-.46c-.11-.11-.3-.12-.41 0-.11.11-.11.3 0 .41l.46.46s0 0 0 0l-2.88 2.82c-1.31-1.1-3.09-1.51-4.36-.34-.69.55-.94 1.77-1.87 2.04-.06 0-.1.14-.15.21 1.62 1.38-2.24 4.09-3.17 2.38-.36.07-.31.66-.83.85-1.65.64-3.29 2.07-2.95 4 .51 3.04 4.95 6.84 7.71 4.04.85-.64.93-2.04 1.85-2.55.17-.02.26-.15.27-.28-1.71-.93 1-4.8 2.38-3.18.07-.05.2-.1.21-.15.26-.93 1.48-1.19 2.03-1.88 1.16-1.27.76-3.05-.33-4.36l2.83-2.87s0 .01 0 .01l.45.46c.06.06.13.09.21.09s.15-.03.21-.09c.11-.11.11-.3 0-.42l-.45-.46s-.01 0-.02 0l.34-.34.47.47c.06.06.13.09.21.09s.15-.03.21-.09c.11-.11.11-.3 0-.41l-.48-.48.38-.39c.16.11.35.19.56.19.27 0 .52-.11.71-.3s.21-.43.22-.64c.02-.28.04-.57.39-.91.06-.06.1-.14.1-.23s-.03-.17-.09-.23zm-17.41 17.8-.82-.83 2.95-3.37 1.24 1.24-3.36 2.96zm6.51-6.11-1.24-1.24 5.08-4.65.8.8z"/>',warning:"<path d=M12,20.4a2.6,2.6,0,0,1-2.6-2.6,2.7,2.7,0,0,1,.7-1.9L9.7,11V7.5h4.8v3.4l-.4,5a2.7,2.7,0,0,1,.7,1.9A2.6,2.6,0,0,1,12,20.4Z fill=#fff /><path d=M22.1,19.5l-9.2-16a1,1,0,0,0-1.8,0l-9.2,16A1,1,0,0,0,2.7,21H21.3A1,1,0,0,0,22.1,19.5Zm-8.7-11v2.4l-.4,4.4H11.1l-.4-4.4V8.5ZM12,19.4a1.6,1.6,0,0,1-1.6-1.6,1.6,1.6,0,1,1,3.2,0A1.6,1.6,0,0,1,12,19.4Z />",woodblock:'<path d="m21 12h-18c-.55 0-1 .45-1 1v6c0 .55.45 1 1 1h18c.55 0 1-.45 1-1v-6c0-.55-.45-1-1-1zm-2 4h-14c-.55 0-1-.45-1-1s.45-1 1-1h14c.55 0 1 .45 1 1s-.45 1-1 1z"/><path d="m9.18 10.43c.77 0 1.43-.55 1.57-1.31l9.9-3.53c.42-.13.65-.58.52-1.01s-.58-.65-1.01-.52c-.02 0-.03.01-.05.02l-9.9 3.53c-.29-.25-.66-.38-1.04-.38-.88 0-1.6.72-1.6 1.6s.72 1.6 1.6 1.6z"/>',"zoom-in":"<path d=M10.5,8.5V6a.9.9,0,0,0-1-1,.9.9,0,0,0-1,1V8.5H6a.9.9,0,0,0-1,1,.9.9,0,0,0,1,1H8.5V13a.9.9,0,0,0,1,1,.9.9,0,0,0,1-1V10.5H13a.9.9,0,0,0,1-1,.9.9,0,0,0-1-1Z /><path d=M21.6,19.4l-4-4a1.6,1.6,0,0,0-1.5-.3l-.8-.9A7,7,0,0,0,17,9.5,7.6,7.6,0,0,0,9.5,2,7.6,7.6,0,0,0,2,9.5,7.6,7.6,0,0,0,9.5,17a7,7,0,0,0,4.7-1.7l.9.8a1.6,1.6,0,0,0,.3,1.5l4,4a1.7,1.7,0,0,0,2.2,0A1.8,1.8,0,0,0,21.6,19.4ZM9.5,15A5.5,5.5,0,0,1,4,9.5,5.5,5.5,0,0,1,9.5,4,5.5,5.5,0,0,1,15,9.5,5.5,5.5,0,0,1,9.5,15Z />","zoom-out":"<path d=M6,8.5a.9.9,0,0,0-1,1,.9.9,0,0,0,1,1h7a.9.9,0,0,0,1-1,.9.9,0,0,0-1-1Z /><path d=M21.6,19.4l-4-4a1.6,1.6,0,0,0-1.5-.3l-.8-.9A7,7,0,0,0,17,9.5,7.6,7.6,0,0,0,9.5,2,7.6,7.6,0,0,0,2,9.5,7.6,7.6,0,0,0,9.5,17a7,7,0,0,0,4.7-1.7l.9.8a1.6,1.6,0,0,0,.3,1.5l4,4a1.7,1.7,0,0,0,2.2,0A1.8,1.8,0,0,0,21.6,19.4ZM9.5,15A5.5,5.5,0,0,1,4,9.5,5.5,5.5,0,0,1,9.5,4,5.5,5.5,0,0,1,15,9.5,5.5,5.5,0,0,1,9.5,15Z />"};function He(e=10){return Math.random().toString(36).substr(2,e)}function $t(e,...s){return s.includes(e)}var uf=(e,s)=>e.concat(s);function Oa(e,s,t=uf){for(let i of Object.keys(s))i in e&&Array.isArray(e[i])&&Array.isArray(s[i])?e[i]=t(e[i],s[i]):i in e&&e[i]instanceof Object&&s[i]instanceof Object?Oa(e[i],s[i]):e[i]=s[i]}function Bs(e,s=0){return s?+setTimeout(e,s):(e(),0)}function Cs(e){return new Promise(s=>setTimeout(s,e))}function To(){let e=()=>{},s=()=>{},t=new Promise((i,r)=>{e=i,s=r});return t.catch(i=>i),{promise:t,resolve:e,reject:s}}var Rc=class extends Error{constructor(e){super("[Cache Error]"),this.data=e}};function Zt(e){let s=new Map;return function(...t){let i=t.join("--");if(!s.has(i))try{s.set(i,e(...t))}catch(o){s.set(i,new Rc(o))}let r=s.get(i);if(r instanceof Rc)throw r.data;return r}}function Yi(e,s=0,t=!1){let i=!1,r=!1;return(...o)=>{i?r=!0:(t?r=!0:e(...o),i=!0,setTimeout(()=>{r&&e(...o),i=r=!1},s))}}function ff(e){return function(s,t){if(!s||Array.isArray(this)||e.includes(s))return t}}function Pt(e,s,t){if(!e)return s;try{return JSON.parse(e,t?ff(t):void 0)||s}catch(i){return s}}function le(e,s){return new Array(s).fill(e)}function Gc(e,s,t){let i=[];for(let r=0;r<s;++r)i.push(le(e,t));return i}function I(e,s){let t=[];for(let i=0;i<s;++i)t.push(e(i));return t}function So(e,s,t){let i=[];for(let r=0;r<s;++r){let o=[];for(let n=0;n<t;++n)o.push(e(r,n));i.push(o)}return i}function Se(e,s,t=1){let i=[];if(s===void 0&&e>=0)for(let r=0;r<e;r+=t)i.push(r);else if(s===void 0)for(let r=0;r>e;r-=t)i.push(r);else if(e<=s)for(let r=e;r<=s;r+=t)i.push(r);else for(let r=e;r>=s;r-=t)i.push(r);return i}function z(e,s=0){return e[e.length-1-s]}function _(e){return e.reduce((s,t)=>s+t,0)}function ko(e,s,t=!1){return e.slice(0).sort((i,r)=>{let o=s(i),n=s(r);return o<n?t?1:-1:o>n?t?-1:1:0})}function _c(e){let s=0;return()=>e[s++%e.length]}function re(e){return e.filter((s,t)=>e.indexOf(s)===t)}function Wt(e){return e.reduce((s,t)=>s.concat(Array.isArray(t)?Wt(t):t),[])}function ls(e){let s=0;return e.map(t=>s+=t)}function Ms(e,s){let t=[];for(let i=0;i<e.length;i+=s)t.push(e.slice(i,i+s));return t}function Hs(e,s=1){let t=e.length;s=(s%t+t)%t;let i=e.slice(0,s);return e.slice(s).concat(i)}function zc(...e){return e.reduce((s,t)=>s.concat(t),[])}var Bc=class{constructor(e){let s=e.length,t=e.map(i=>({val:i}));for(let[i,r]of t.entries())r.next=t[(i+1)%s],r.prev=t[(i-1+s)%s];this.root=t[0]}*traverse(){let e=this.root;for(;e;)if(yield e,e=e.next,e===this.root)return}get array(){return Array.from(this.traverse())}delete(e){if(e===this.root){if(e.next===e)return this.root=void 0;this.root=e.next}e.prev.next=e.next,e.next.prev=e.prev}},Ra=(e=>(e[e.first=0]="first",e[e.firstGreater=1]="firstGreater",e))(Ra||{});function Ia(e,s,t){let i=0,r=e.length-1,o=-1;for(;i<=r;){let n=Math.floor((i+r)/2),a=e[n].val;a<s?i=n+1:a>s?(t===1&&(o=n),r=n-1):t===0?(o=n,r=n-1):t===1&&(i=n+1)}return o}function Na(e,s,t){let i=Ia(e,t,0);if(i<0)return-1;for(;e[i].val===t;){if(e[i].item===s)return i;i+=1}return-1}function Lt(e,s=/\s+/){return e?e.trim().split(s):[]}function Hc(e){return e.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(s,t)=>t.toUpperCase())}var As=class{constructor(){this.events=new Map}on(e,s){for(let t of Lt(e))this.events.has(t)||this.events.set(t,[]),this.events.get(t).push(s)}one(e,s){let t=i=>{this.off(e,t),s(i)};this.on(e,t)}off(e,s){for(let t of Lt(e))this.events.has(t)&&this.events.set(t,this.events.get(t).filter(i=>i!==s))}trigger(e,s){for(let t of Lt(e))if(this.events.has(t))for(let i of this.events.get(t))i(s)}},mf=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,gf=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})?$/i,vf=/rgba?\(([0-9.]+), ?([0-9.]+), ?([0-9.]+)(, ?([0-9.]+))?\)/,yf=["#22ab24","#009ea6","#0f82f2","#6d3bbf","#cd0e66","#eb4726","#fd8c00"];function Ic(e){return e.length===1?`0${e}`:e}function Nc(e,s){if(s<=0)return G.from(e[0]);if(s>=1)return G.from(z(e));let t=Math.floor(s*(e.length-1)),i=s*(e.length-1)-t;return G.mix(e[t+1],e[t],i)}function La(e,s,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+(s-e)*6*t:t<1/2?s:t<2/3?e+(s-e)*(2/3-t)*6:e}var G=class{constructor(e,s,t,i=1){this.r=e,this.g=s,this.b=t,this.a=i}get hex(){let e=[this.r,this.g,this.b].map(t=>Ic(Math.round(t).toString(16))),s=this.a>=1?"":Ic(Math.round(this.a*255).toString(16));return`#${e.join("")}${s}`}get rgb(){return`rgba(${[this.r,this.g,this.b].map(s=>Math.round(s)).join(",")},${this.a})`}get brightness(){return(this.r*299+this.g*587+this.g*114)/1e3}get hsl(){let e=this.r/255,s=this.g/255,t=this.b/255,i=Math.max(e,s,t),r=Math.min(e,s,t),o=(r+i)/2,n=i-r;if(i===r)return[0,0,Math.round(o*100)];let a=e===i?(s-t)/n:s===i?2+(t-e)/n:4+(e-s)/n;a=Math.min(a*60,360),a<0&&(a+=360);let l=o<=.5?n/(i+r):n/(2-i-r);return[Math.round(a),Math.round(l*100),Math.round(o*100)]}get chroma(){return Math.max(this.r,this.g,this.b)-Math.min(this.r,this.g,this.b)}toString(){return this.rgb}copy(){return new G(this.r,this.g,this.b,this.a)}static from(e){return typeof e!="string"?e:e.startsWith("#")?G.fromHex(e):G.fromRgb(e)}static fromRgb(e){let s=e.match(vf);if(!s)return new G(0,0,0);let t=s[4]?+s[5]||0:1;return new G(+s[1],+s[2],+s[3],t)}static fromHex(e){e=e.replace(mf,(t,i,r,o)=>i+i+r+r+o+o);let s=gf.exec(e);return s?new G(parseInt(s[1],16),parseInt(s[2],16),parseInt(s[3],16),s[4]?parseInt(s[4],16)/255:1):new G(0,0,0)}static fromHsl(e,s,t){if(e/=360,s/=100,t/=100,s===0){let l=Math.round(t*255);return new G(l,l,l)}let i=t<.5?t*(1+s):t+s-t*s,r=2*t-i,o=La(r,i,e+1/3),n=La(r,i,e),a=La(r,i,e-1/3);return new G(Math.round(o*255),Math.round(n*255),Math.round(a*255))}static rainbow(e){return I(s=>Nc(yf,s/(e-1)),e)}static gradient(e,s){return I(t=>Nc(e,t/(s-1)),s)}static shades(e,s,t=.5){let i=G.mix("#fff",e,t),r=G.mix("#000",e,t);return G.gradient([i,e,r],s)}static mix(e,s,t=.5){return e=G.from(e),s=G.from(s),new G(t*e.r+(1-t)*s.r,t*e.g+(1-t)*s.g,t*e.b+(1-t)*s.b,t*e.a+(1-t)*s.a)}static mixMany(e,s){s||(s=e.map(()=>1));let t=_(s),i=e.map(g=>g.hsl),r=i.map(g=>g[0]),o=r.map(g=>g<180?g+360:g),n=s.map((g,b)=>g*Math.sqrt(e[b].chroma)),a=_(n),l=_(r.map((g,b)=>g*n[b]))/a,c=_(o.map((g,b)=>g*n[b]))/a,p=_(r.map((g,b)=>Math.abs(g-l)*n[b])),u=_(o.map((g,b)=>Math.abs(g-c)*n[b])),f=p<=u?l:c%360,v=_(i.map((g,b)=>s[b]*g[1]))/t,m=_(i.map((g,b)=>s[b]*g[2]))/t;return G.fromHsl(f,v,m)}};function Es(e){return e[Symbol.iterator]().next().value}function Co(e,s){for(let t of e)if(!s(t))return!1;return!0}function Xt(e,s){for(let t of e)if(s(t))return!0;return!1}function*Xi(e,s){for(let t of e)for(let i of s(t))yield i}function*Zr(e,s){for(let t of e)for(let i of s)yield[t,i]}function*Ga(e){let s=e.length;for(let t=0;t<s;++t)for(let i=t+1;i<s;++i)yield[e[t],e[i]]}function Vs(e,s,t=1/0,i){let r,o=t;for(let n of e){let a=s(n);if(a<o&&(r=n,o=a,i!==void 0&&o<i))return r}return r}var Po=class{constructor(...e){this.values=e}map(e){let s=this.values;return new Po(function*(){let t=0;for(let i of s)for(let r of i)yield e(r,t),t+=1}())}every(e){let s=0;for(let t of this.values)for(let i of t){if(!e(i,s))return!1;s+=1}return!0}some(e){let s=0;for(let t of this.values)for(let i of t){if(e(i,s))return!0;s+=1}return!1}slice(e,s){let t=this.values;return new Po(function*(){let i=0;for(let r of t)for(let o of r)i<e||s!==void 0&&i>e+s||(yield o,i+=1)}())}filter(e){let s=this.values;return new Po(function*(){let t=0;for(let i of s)for(let r of i)e(r,t)&&(yield r),t+=1}())}concat(e){this.values.push(e)}[Symbol.iterator](){let e=this.values;return function*(){for(let s of e)for(let t of s)yield t}()}static make(e,s){return new Po(function*(){let t=0;for(;s===void 0||t<s;)yield e(t),t+=1}())}};var bf=Object.defineProperty,za=(e,s)=>{for(var t in s)bf(e,t,{get:s[t],enumerable:!0})},Eo=1e-6;function E(e,s,t=Eo){return isNaN(e)||isNaN(s)?!1:Math.abs(e-s)<t}function ke(e,s=Eo){return E(e%1,0,s)}function Y(e,s,t,i=Eo){return s>t&&([s,t]=[t,s]),e>s+i&&e<t-i}function jc(e,s=Eo){return E(e,0,s)?0:e>0?1:-1}var Fc=/(\d+)(\d{3})/,wf=["","k","m","b","t","q"];function xf(e){let[s,t]=e.split(".");for(;Fc.test(s);)s=s.replace(Fc,"$1,$2");return s+(t?`.${t}`:"")}function $f(e,s=6){if(!s)return`${e}`;let t=`${Math.abs(Math.floor(e))}`.length,i=t+(e<0?1:0);if(i<=s)return`${Jt(e,s-i)}`;let r=Math.floor(Math.log10(Math.abs(e))/3),o=wf[r],n=s-(t%3||3)-(o?1:0)-(e<0?1:0);return Jt(e/Math.pow(10,3*r),n)+o}function mt(e,s=0,t=!0){let i=$f(e,s).replace("-","");return t?xf(i):i}var Pf=/^-?0,[0-9]+$/,Tf=/^-?([0-9]+(,[0-9]{3})*)?\.?[0-9]*$/,Sf=/^-?[0-9]+(\.[0-9]{3})*,?[0-9]*$/;function Ba(e){return e=e.replace(/^/,"-").trim(),!e||e.match(/[^0-9.,-]/)?NaN:Pf.test(e)?parseFloat(e.replace(/,/,".")):Tf.test(e)?parseFloat(e.replace(/,/g,"")):Sf.test(e)?parseFloat(e.replace(/\./g,"").replace(/,/,".")):NaN}var _a=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],qc=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"],kf=[""," thousand"," million"," billion"," trillion"," quadrillion"," quintillion"," sextillion"];function Cf(e){let[s,t,i]=e.split(""),r=s==="0"?"":` ${_a[+s]} hundred`;return t+i==="00"?r:+t<2?`${r} ${_a[+(t+i)]}`:i==="0"?`${r} ${qc[+t]}`:`${r} ${qc[+t]}-${_a[+i]}`}function Ha(e){if(e===0)return"zero";let s=Math.round(Math.abs(e)).toString(),t=Math.ceil(s.length/3),i=s.padStart(3*t,"0"),r="";for(let o=0;o<t;o+=1){let n=i.substr(o*3,3);n!=="000"&&(r+=Cf(n)+kf[t-1-o])}return r.trim()}function Wc(e){return`${Math.abs(e)}`.split("").reverse().map(t=>+t)}function Jt(e,s=0){let t=Math.pow(10,s);return Math.round(e*t)/t}function tt(e,s=1){return Math.round(e/s)*s}function M(e,s=-1/0,t=1/0){return Math.min(t,Math.max(s,e))}function rt(e,s,t=.5){return e+(s-e)*t}function de(e){return e*e}function K(e,s){return(e%s+s)%s}function Fa(e,s,t){if(E(e,0)&&E(s,0))return[];if(E(e,0))return[-t/s];let i=-s/2/e,r=Math.sqrt(s*s-4*e*t)/2/e;return[i+r,i-r]}function Kc(e,s=0){let t=e.slice(0),i=Yc(t);return s?i.filter(r=>r.length===s):i}function Yc(e){if(e.length===1)return[[],e];let s=e.pop(),t=Yc(e),i=[];for(let r of t)i.push(r,[...r,s]);return i}function Fe(...e){let[s,...t]=e;if(t.length>1)return Fe(s,Fe(...t));let i=Math.abs(s),r=Math.abs(t[0]);for(;r;)[i,r]=[r,i%r];return i}function Fs(...e){let[s,...t]=e;return t.length>1?Fs(s,Fs(...t)):Math.abs(s*t[0])/Fe(s,t[0])}function qa(e){if(e%1!==0||e<2)return!1;if(e%2===0)return e===2;if(e%3===0)return e===3;let s=Math.sqrt(e);for(let t=5;t<=s;t+=6)if(e%t===0||e%(t+2)===0)return!1;return!0}function cs(e){if(e===1)return[];if(qa(e))return[e];let s=Math.sqrt(e);for(let t=2;t<=s;++t)if(e%t===0)return cs(t).concat(cs(e/t));return[]}var Mf=/^([0-9\-.]*)([%kmbtq]?)(\/([0-9\-.]+))?([%]?)$/,j=class{constructor(e,s,t){this.unit=t,this.num=s!==void 0&&s<0?-e:e,s!==void 0&&Math.abs(s)!==1&&e!==0&&(this.den=Math.abs(s))}valueOf(){return this.value}toString(e=4){let s=mt(this.num,e),t=this.unit||"",i=this.den?`/${mt(this.den,e)}`:"";return s==="0"&&(t=""),t===""&&!this.den&&(s==="1"||s==="1")&&(s=s.replace("1","")),`${s}${i}${t}`}toMathML(){let e=`<mn>${this.num}</mn>`;return this.den!==void 0&&(e=`<mfrac>${e}<mn>${this.den}</mn></mfrac>`),this.unit&&(e+=this.unit===""?"<mi></mi>":"<mo>%</mo>"),e}get value(){let e=this.unit==="%"?.01:this.unit===""?Math.PI:1;return this.num*e/(this.den||1)}get sign(){return Math.sign(this.num)}get simplified(){if(!this.den)return this;let e=Fe(Math.abs(this.num),this.den);return new j(this.num/e,this.den/e,this.unit)}get inverse(){return this.den?new j(1/this.num,void 0,this.unit):new j(this.den,this.num)}get negative(){return new j(-this.num,this.den,this.unit)}static fromString(e){e=e.toLowerCase().replace(/[\s,]/g,"").replace("","-").replace("pi","");let s=e.match(Mf);if(!s)return;let t=s[2]||s[5]||void 0,i=s[1]?+s[1]:void 0,r=s[4]?+s[4]:void 0;if(t===""&&(!s[1]||s[1]==="-")&&(i=s[1]?-1:1),i===void 0||isNaN(i))return;let o=t?"kmbtq".indexOf(t):-1;if(o>=0&&(i*=1e3**(o+1),t=void 0),r===void 0)return new j(i,void 0,t);if(!(isNaN(r)||E(r,0)))return!ke(i)||!ke(r)?new j(i/r,void 0,t):new j(i,r,t)}static fractionFromDecimal(e,s=100){let t=Math.sign(e),i=Math.floor(Math.abs(e));e=Math.abs(e)-i;let r=0,o=1,n=1,a=1;for(;o<=s&&a<=s;){let l=(r+n)/(o+a);if(e===l)return o+a<=s?new j(t*(i*(o+a)+r+n),o+a):a>o?new j(t*(i*a+n),a):new j(t*(i*o+r),o);e>l?[r,o]=[r+n,o+a]:[n,a]=[r+n,o+a]}return o>s?new j(t*(i*a+n),a):new j(t*(i*o+r),o)}clamp(e,s){let t=this.value;return e!==void 0&&t<e?new j(e):s!==void 0&&t>s?new j(s):this}add(e){return j.sum(this,e)}subtract(e){return j.difference(this,e)}multiply(e){return j.product(this,e)}divide(e){return j.quotient(this,e)}static sum(e,s){return typeof s=="number"&&(s=new j(s)),e.num===0?s:e.unit!==s.unit?new j(e.value+s.value):!e.den&&!s.den?new j(e.num+s.num,void 0,e.unit):(e.den||([e,s]=[s,e]),ke(s.num)?new j(e.num*(s.den||1)+s.num*e.den,e.den*(s.den||1),e.unit).simplified:new j(e.value+s.value,void 0,e.unit))}static difference(e,s){return typeof s=="number"&&(s=new j(s)),j.sum(e,s.negative)}static product(e,s){if(typeof s=="number"&&(s=new j(s)),!e.unit&&!e.den&&ke(e.num))return new j(e.num*s.num,s.den,s.unit).simplified;if(!s.unit&&!s.den&&ke(s.num))return new j(e.num*s.num,e.den,e.unit).simplified;if(e.unit===""||s.unit===""||!ke(e.num)||!ke(s.num))return new j(e.value*s.value);let t=(e.unit==="%"?100:1)*(s.unit==="%"?100:1);return new j(e.num*s.num,(e.den||1)*(s.den||1)*t)}static quotient(e,s){return typeof s=="number"&&(s=new j(s)),j.product(e,s.inverse)}},Et={};za(Et,{determinant:()=>Lf,fill:()=>Xc,identity:()=>Jc,inverse:()=>eh,product:()=>Ao,reflection:()=>Vf,rotation:()=>Af,scalarProduct:()=>Df,shear:()=>Ef,sum:()=>Qc,transpose:()=>th});function Xc(e,s,t){return Gc(e,s,t)}function Jc(e=2){let s=Xc(0,e,e);for(let t=0;t<e;++t)s[t][t]=1;return s}function Af(e){let s=Math.sin(e),t=Math.cos(e);return[[t,-s],[s,t]]}function Ef(e){return[[1,e],[0,1]]}function Vf(e){let s=Math.sin(2*e),t=Math.cos(2*e);return[[t,s],[s,-t]]}function Qc(...e){let[s,...t]=e,i=t.length>1?Qc(...t):t[0];if(s.length!==i.length||s[0].length!==i[0].length)throw new Error("Matrix sizes dont match");let r=[];for(let o=0;o<s.length;++o){let n=[];for(let a=0;a<s[o].length;++a)n.push(s[o][a]+i[o][a]);r.push(n)}return r}function Df(e,s){return e.map(t=>t.map(i=>i*s))}function Ao(...e){let[s,...t]=e,i=t.length>1?Ao(...t):t[0];if(s[0].length!==i.length)throw new Error("Matrix sizes dont match.");let r=[];for(let o=0;o<s.length;++o){let n=[];for(let a=0;a<i[0].length;++a){let l=0;for(let c=0;c<i.length;++c)l+=s[o][c]*i[c][a];n.push(l)}r.push(n)}return r}function th(e){let s=[];for(let t=0;t<e[0].length;++t){let i=[];for(let r=0;r<e.length;++r)i.push(e[r][t]);s.push(i)}return s}function Lf(e){if(e.length!==e[0].length)throw new Error("Not a square matrix.");let s=e.length;if(s===1)return e[0][0];if(s===2)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let t=0;for(let i=0;i<s;++i){let r=e[0][i],o=e[0][i];for(let n=1;n<s;++n)o*=e[n][(i+n)%s],r*=e[n][(i-n+s)%s];t+=o-r}return t}function eh(e){let s=e.length;if(s!==e[0].length)throw new Error("Not a square matrix.");let t=Jc(s),i=So((r,o)=>e[r][o],s,s);for(let r=0;r<s;++r){let o=i[r][r];if(E(o,0)){for(let n=r+1;n<s;++n)if(i[n][r]!==0){for(let a=0;a<s;++a)[i[n][a],i[r][a]]=[i[r][a],i[n][a]],[t[n][a],t[r][a]]=[t[r][a],t[n][a]];break}if(o=i[r][r],E(o,0))throw new Error("Matrix not invertible.")}for(let n=0;n<s;++n)i[r][n]=i[r][n]/o,t[r][n]=t[r][n]/o;for(let n=0;n<s;++n){if(n===r)continue;let a=i[n][r];for(let l=0;l<s;++l)i[n][l]-=a*i[r][l],t[n][l]-=a*t[r][l]}}return t}var vt={};za(vt,{bernoulli:()=>ih,binomial:()=>Gf,cauchy:()=>qf,chiCDF:()=>Zf,exponential:()=>Hf,find:()=>If,geometric:()=>Ff,integer:()=>Rf,integrate:()=>oh,normal:()=>Bf,normalPDF:()=>Uf,poisson:()=>_f,shuffle:()=>Of,smart:()=>Nf,uniform:()=>zf,weighted:()=>sh});function Of(e){e=e.slice(0);for(let s=e.length-1;s>0;--s){let t=Math.floor(Math.random()*(s+1));[e[s],e[t]]=[e[t],e[s]]}return e}function Rf(e,s){let t=s===void 0?0:e,i=s===void 0?e:s-e+1;return t+Math.floor(i*Math.random())}function sh(e){let s=Math.random()*_(e),t=0;return e.findIndex(i=>(t+=i)>=s)}function If(e){return e[Math.floor(e.length*Math.random())]}var Mo=new Map;function Nf(e,s){s||(s=He()),Mo.has(s)||Mo.set(s,le(1,e));let t=Mo.get(s),i=sh(t.map(r=>r*r));return t[i]-=1,t[i]<=0&&Mo.set(s,t.map(r=>r+1)),i}function ih(e=.5){return Math.random()<e?1:0}function Gf(e=1,s=.5){let t=0;for(let i=0;i<e;++i)t+=ih(s);return t}function _f(e=1){if(e<=0)return 0;let s=Math.exp(-e),t=1,i=0;for(;t>s;++i)t*=Math.random();return i-1}function zf(e=0,s=1){return e+(s-e)*Math.random()}function Bf(e=0,s=1){let t=Math.random(),i=Math.random();return Math.sqrt(-2*Math.log(t))*Math.cos(2*Math.PI*i)*Math.sqrt(s)+e}function Hf(e=1){return e<=0?0:-Math.log(Math.random())/e}function Ff(e=.5){if(!(e<=0||e>1))return Math.floor(Math.log(Math.random())/Math.log(1-e))}function qf(){let e,s,t;do s=2*Math.random()-1,t=2*Math.random()-1,e=s*s+t*t;while(e>=1);return s/t}function Uf(e,s=1,t=0){return Math.exp(-((e-s)**2)/(2*t))/Math.sqrt(2*Math.PI*t)}var Uc=7,Zc=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function rh(e){if(e<.5)return Math.PI/(Math.sin(Math.PI*e)*rh(1-e));e-=1;let s=Zc[0];for(let i=1;i<Uc+2;i++)s+=Zc[i]/(e+i);let t=e+Uc+.5;return Math.sqrt(2*Math.PI)*Math.pow(t,e+.5)*Math.exp(-t)*s}function oh(e,s,t,i=1){let r=0;for(let o=s;o<t;o+=i)r+=e(o)*i||0;return r}function Zf(e,s){return 1-oh(i=>Math.pow(i,(s-2)/2)*Math.exp(-i/2),0,e)/Math.pow(2,s/2)/rh(s/2)}var jf={};za(jf,{bestPolynomial:()=>Qf,coefficient:()=>ah,exponential:()=>Yf,linear:()=>Kf,logarithmic:()=>Xf,polynomial:()=>nh,power:()=>Jf});function Wf(e,s){let t=1,i=e[0];for(let r=1;r<e.length;++r)t*=s,i+=t*e[r];return i}function Kf(e,s=!1){let t=0,i=0,r=0,o=0,n=e.length;for(let c=0;c<n;c++)t+=e[c][0],i+=e[c][1],r+=e[c][0]*e[c][0],o+=e[c][0]*e[c][1];if(s)return[0,o/r];let a=(n*o-t*i)/(n*r-t*t);return[i/n-a*t/n,a]}function Yf(e){let s=[0,0,0,0,0,0];for(let o of e)s[0]+=o[0],s[1]+=o[1],s[2]+=o[0]*o[0]*o[1],s[3]+=o[1]*Math.log(o[1]),s[4]+=o[0]*o[1]*Math.log(o[1]),s[5]+=o[0]*o[1];let t=s[1]*s[2]-s[5]*s[5],i=Math.exp((s[2]*s[3]-s[5]*s[4])/t),r=(s[1]*s[4]-s[5]*s[3])/t;return[i,r]}function Xf(e){let s=[0,0,0,0],t=e.length;for(let o of e)s[0]+=Math.log(o[0]),s[1]+=o[1]*Math.log(o[0]),s[2]+=o[1],s[3]+=Math.pow(Math.log(o[0]),2);let i=(t*s[1]-s[2]*s[0])/(t*s[3]-s[0]*s[0]);return[(s[2]-i*s[0])/t,i]}function Jf(e){let s=[0,0,0,0],t=e.length;for(let o of e)s[0]+=Math.log(o[0]),s[1]+=Math.log(o[1])*Math.log(o[0]),s[2]+=Math.log(o[1]),s[3]+=Math.pow(Math.log(o[0]),2);let i=(t*s[1]-s[2]*s[0])/(t*s[3]-s[0]*s[0]);return[Math.exp((s[2]-i*s[0])/t),i]}function nh(e,s=2){let t=e.map(l=>Se(s+1).map(c=>Math.pow(l[0],c))),i=th(t),r=e.map(l=>[l[1]]),o=Ao(i,t),n=eh(o);return Ao(n,i,r).map(l=>l[0])}function ah(e,s){let i=e.reduce((n,a)=>n+a[1],0)/e.length,r=e.reduce((n,a)=>n+(a[1]-i)**2,0);return 1-e.reduce((n,a)=>n+(a[1]-s(a[0]))**2,0)/r}function Qf(e,s=.85,t=8){if(!(e.length<=1))for(let i=1;i<t;++i){let r=nh(e,i),o=a=>Wf(r,a);if(ah(e,o)>=s)return{order:i,coefficients:r,fn:o}}}function Ji(e){return e.length?_(e)/e.length:0}function Qi(e,s){let t=e.length;if(!t)return 0;let i=e.slice(0).sort((n,a)=>n-a);if(s===0)return e[0];if(s===1)return e[t-1];let r=t*s-.5;if(Number.isInteger(r))return i[r];let o=Math.floor(r);return rt(i[o],i[o+1],r-o)}var B=2*Math.PI;function Us(e,s){let t=Math.atan2(e.y-(s?s.y:0),e.x-(s?s.x:0));return K(t,B)}function lh(e,s){let t,i=1/0,r=-1;for(let[o,n]of s.entries()){let a=n.project(e),l=d.distance(e,a);l<i&&(t=a,i=l,r=o)}return t?[t,r]:void 0}var d=class{constructor(e=0,s=0){this.x=e,this.y=s,this.type="point"}get unitVector(){return E(this.length,0)?new d(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new d(-this.x,-this.y)}get flip(){return new d(this.y,this.x)}get perpendicular(){return new d(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(e){return d.distance(this,e.project(this))}clamp(e,s=0){let t=M(this.x,e.xMin+s,e.xMax-s),i=M(this.y,e.yMin+s,e.yMax-s);return new d(t,i)}changeCoordinates(e,s){let t=s.xMin+(this.x-e.xMin)/e.dx*s.dx,i=s.yMin+(this.y-e.yMin)/e.dy*s.dy;return new d(t,i)}add(e){return d.sum(this,e)}subtract(e){return d.difference(this,e)}round(e=1){return new d(tt(this.x,e),tt(this.y,e))}floor(){return new d(Math.floor(this.x),Math.floor(this.y))}mod(e,s=e){return new d(this.x%e,this.y%s)}angle(e=P){return Us(this,e)}snap(e,s=5){return E(this.x,e.x,s)?new d(e.x,this.y):E(this.y,e.y,s)?new d(this.x,e.y):this}static average(...e){let s=_(e.map(i=>i.x))/e.length,t=_(e.map(i=>i.y))/e.length;return new d(s,t)}static dot(e,s){return e.x*s.x+e.y*s.y}static sum(e,s){return new d(e.x+s.x,e.y+s.y)}static difference(e,s){return new d(e.x-s.x,e.y-s.y)}static distance(e,s){return Math.sqrt(de(e.x-s.x)+de(e.y-s.y))}static manhattan(e,s){return Math.abs(e.x-s.x)+Math.abs(e.y-s.y)}static interpolate(e,s,t=.5){return new d(rt(e.x,s.x,t),rt(e.y,s.y,t))}static interpolateList(e,s=.5){let t=e.length-1,i=Math.floor(M(s,0,1)*t);return d.interpolate(e[i],e[i+1],t*s-i)}static fromPolar(e,s=1){return new d(s*Math.cos(e),s*Math.sin(e))}static random(e){let s=vt.uniform(e.xMin,e.xMax),t=vt.uniform(e.yMin,e.yMax);return new d(s,t)}static equals(e,s,t){return E(e.x,s.x,t)&&E(e.y,s.y,t)}static colinear(e,s,t,i){let r=e.x-s.x,o=e.y-s.y,n=s.x-t.x,a=s.y-t.y;return E(r*a,n*o,i)}transform(e){let s=e[0][0]*this.x+e[0][1]*this.y+e[0][2],t=e[1][0]*this.x+e[1][1]*this.y+e[1][2];return new d(s,t)}rotate(e,s=P){if(E(e,0))return this;let t=this.x-s.x,i=this.y-s.y,r=Math.cos(e),o=Math.sin(e),n=t*r-i*o+s.x,a=t*o+i*r+s.y;return new d(n,a)}reflect(e){let s=e.p2.x-e.p1.x,t=e.p2.y-e.p1.y,i=this.x-e.p1.x,r=this.y-e.p1.y,o=(s*r-t*i)/(s*s+t*t),n=this.x+2*o*t,a=this.y-2*o*s;return new d(n,a)}scale(e,s=e){return new d(this.x*e,this.y*s)}shift(e,s=e){return new d(this.x+e,this.y+s)}translate(e){return this.shift(e.x,e.y)}equals(e,s){return d.equals(this,e,s)}toString(){return`point(${this.x},${this.y})`}},P=new d(0,0);function fe(e){return["polygon","polyline","rectangle","triangle"].includes(e.type)}function er(e){return["polygon","triangle"].includes(e.type)}function Lo(e){return e.type==="polyline"}function jr(e){return e.type==="rectangle"}function Rt(e){return["line","ray","segment"].includes(e.type)}function Ka(e){return e.type==="line"}function Oo(e){return e.type==="ray"}function qe(e){return e.type==="segment"}function yt(e){return e.type==="circle"}function tm(e){return e.type==="ellipse"}function Oe(e){return e.type==="arc"}function Ds(e){return e.type==="sector"}function me(e){return e.type==="angle"}function Mt(e){return e.type==="point"}var It=class{constructor(e,s){this.p1=e,this.p2=s,this.type="line"}get length(){return d.distance(this.p1,this.p2)}get lengthSquared(){return(this.p1.x-this.p2.x)**2+(this.p1.y-this.p2.y)**2}get midpoint(){return d.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y-this.slope*this.p1.x}get angle(){return Us(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new d(this.p2.y-this.p1.y,this.p1.x-this.p2.x).unitVector}parallel(e){return new It(e,e.add(this.p2).subtract(this.p1))}perpendicular(e){let s=this.line.project(e);return d.equals(e,s)?new It(s,s.add(this.perpendicularVector.scale(this.length/2))):new It(s,e)}get perpendicularBisector(){return this.perpendicular(this.midpoint)}distanceSquared(e){let s=this.project(e);return(e.x-s.x)**2+(e.y-s.y)**2}get line(){return this.type==="line"?this:new It(this.p1,this.p2)}get ray(){return Oo(this)?this:new em(this.p1,this.p2)}get segment(){return qe(this)?this:new dt(this.p1,this.p2)}offset(e){let s=d.difference(this.p2,this.p1),t=d.difference(e,this.p1);return d.dot(s,t)/this.lengthSquared}project(e){return this.at(this.offset(e))}side(e,s){let t=d.difference(this.p2,this.p1),i=d.difference(e,this.p1),r=i.x*t.y-i.y*t.x;return E(r,0,s)?0:Math.sign(r)}contains(e,s){return this.side(e,s)===0}at(e){return d.interpolate(this.p1,this.p2,e)}transform(e){return new this.constructor(this.p1.transform(e),this.p2.transform(e))}rotate(e,s=P){return E(e,0)?this:new this.constructor(this.p1.rotate(e,s),this.p2.rotate(e,s))}reflect(e){return new this.constructor(this.p1.reflect(e),this.p2.reflect(e))}scale(e,s=e){return new this.constructor(this.p1.scale(e,s),this.p2.scale(e,s))}shift(e,s=e){return new this.constructor(this.p1.shift(e,s),this.p2.shift(e,s))}translate(e){return this.shift(e.x,e.y)}equals(e,s){return this.contains(e.p1,s)&&this.contains(e.p2,s)}toString(){return`line(${this.p1},${this.p2})`}},em=class extends It{constructor(){super(...arguments),this.type="ray"}equals(e,s){return e.type!=="ray"||!this.p1.equals(e.p1,s)?!1:this.p2.equals(e.p2,s)?!0:e.contains(this.p2,s)||this.contains(e.p2,s)}contains(e,s){if(!super.contains(e,s))return!1;let t=this.offset(e);return E(t,0,s)||t>0}toString(){return`ray(${this.p1},${this.p2})`}},dt=class extends It{constructor(){super(...arguments),this.type="segment"}contains(e,s){return super.contains(e,s)?this.p1.equals(e,s)||this.p2.equals(e,s)?!0:E(this.p1.x,this.p2.x,s)?Y(e.y,this.p1.y,this.p2.y):Y(e.x,this.p1.x,this.p2.x):!1}project(e){let s=d.difference(this.p2,this.p1),t=d.difference(e,this.p1),i=M(d.dot(s,t)/this.lengthSquared,0,1);return this.p1.add(s.scale(i))}contract(e){return new dt(this.at(e),this.at(1-e))}equals(e,s,t=!1){return e.type!=="segment"?!1:this.p1.equals(e.p1,s)&&this.p2.equals(e.p2,s)||!t&&this.p1.equals(e.p2,s)&&this.p2.equals(e.p1,s)}toString(){return`segment(${this.p1},${this.p2})`}},q=class{constructor(e=P,s=1){this.c=e,this.r=s,this.type="circle"}get circumference(){return B*this.r}get area(){return Math.PI*this.r**2}get arc(){let e=this.c.shift(this.r,0);return new ge(this.c,e,B)}tangentAt(e){let s=this.at(e),t=this.c.rotate(Math.PI/2,s);return new It(s,t)}collision(e){let s=this.c.x<e.p.x?e.p.x:this.c.x>e.p.x+e.w?e.p.x+e.w:this.c.x,t=this.c.y<e.p.y?e.p.y:this.c.y>e.p.y+e.h?e.p.y+e.h:this.c.y;return d.distance(this.c,new d(s,t))<=this.r}project(e){let s=e.subtract(this.c).unitVector.scale(this.r);return d.sum(this.c,s)}at(e){let s=B*e;return this.c.shift(this.r*Math.cos(s),this.r*Math.sin(s))}offset(e){return Us(e,this.c)/B}contains(e){return d.distance(e,this.c)<=this.r}transform(e){let s=Math.abs(e[0][0])+Math.abs(e[1][1]);return new q(this.c.transform(e),this.r*s/2)}rotate(e,s=P){return E(e,0)?this:new q(this.c.rotate(e,s),this.r)}reflect(e){return new q(this.c.reflect(e),this.r)}scale(e,s=e){return new q(this.c.scale(e,s),this.r*(e+s)/2)}shift(e,s=e){return new q(this.c.shift(e,s),this.r)}translate(e){return this.shift(e.x,e.y)}equals(e,s){return E(this.r,e.r,s)&&this.c.equals(e.c,s)}toString(){return`circle(${this.c},${this.r})`}},ge=class{constructor(e,s,t){this.c=e,this.start=s,this.angle=t,this.type="arc"}get circle(){return new q(this.c,this.radius)}get radius(){return d.distance(this.c,this.start)}get end(){return this.start.rotate(this.angle,this.c)}get startAngle(){return Us(this.start,this.c)}contract(e){return new this.constructor(this.c,this.at(e/2),this.angle*(1-e))}get minor(){return this.angle<=Math.PI?this:new this.constructor(this.c,this.end,B-this.angle)}get major(){return this.angle>=Math.PI?this:new this.constructor(this.c,this.end,B-this.angle)}get center(){return this.at(.5)}project(e){let s=this.startAngle,t=s+this.angle,i=Us(e,this.c);return t>B&&i<t-B&&(i+=B),i=M(i,s,t),this.c.shift(this.radius,0).rotate(i,this.c)}at(e){return this.start.rotate(this.angle*e,this.c)}offset(e){return new Ot(this.start,this.c,e).rad/this.angle}contains(e){return e.equals(this.project(e))}transform(e){return new this.constructor(this.c.transform(e),this.start.transform(e),this.angle)}rotate(e,s=P){return E(e,0)?this:new this.constructor(this.c.rotate(e,s),this.start.rotate(e,s),this.angle)}reflect(e){return new this.constructor(this.c.reflect(e),this.start.reflect(e),this.angle)}scale(e,s=e){return new this.constructor(this.c.scale(e,s),this.start.scale(e,s),this.angle)}shift(e,s=e){return new this.constructor(this.c.shift(e,s),this.start.shift(e,s),this.angle)}translate(e){return this.shift(e.x,e.y)}equals(){return!1}toString(){return`arc(${this.c},${this.start},${this.angle})`}},hs=class extends ge{constructor(){super(...arguments),this.type="sector"}contains(e){return d.distance(e,this.c)<=this.radius&&new Ot(this.start,this.c,e).rad<=this.angle}toString(){return`sector(${this.c},${this.start},${this.angle})`}},qs=1e-6;function ja(e,s,t){let i=(t.x-s.x)*(e.y-s.y),r=(t.y-s.y)*(e.x-s.x);return i-r>=-qs}function ch(e,s,t){let i=e.y-s.y,r=t.x-s.x,o=e.x-s.x,n=t.y-s.y,a=o*r+i*n;if(a<qs)return!1;let l=r*r+n*n;return a-l<=-qs}function fh(e,s){return E(e.x,s.x)?E(e.y,s.y)?0:e.y<s.y?-1:1:e.x<s.x?-1:1}function hh(e){return e<=-qs?-2:e<qs?-1:e-1<=-qs?0:e-1<qs?1:2}function sm(e,s,t,i){let r=s.x-e.x,o=s.y-e.y,n=i.x-t.x,a=i.y-t.y,l=r*a-o*n;if(E(l,0))return!1;let c=e.x-t.x,p=e.y-t.y,u=(n*p-a*c)/l,f=(r*p-o*c)/l,v=new d(e.x+u*r,e.y+u*o);return{alongA:hh(u),alongB:hh(f),pt:v}}var tr=class{constructor(){this.root={root:!0,next:void 0}}exists(e){return e!==void 0&&e!==this.root}get head(){return this.root.next}insertBefore(e,s){let t=this.root,i=this.root.next;for(;i;){if(s(i)){e.prev=i.prev,e.next=i,i.prev.next=e,i.prev=e;return}t=i,i=i.next}t.next=e,e.prev=t,e.next=void 0}findTransition(e){let s=this.root,t=this.root.next;for(;t&&!e(t);)s=t,t=t.next;return{before:s===this.root?void 0:s,after:t,insert:i=>(i.prev=s,i.next=t,s.next=i,t&&(t.prev=i),i)}}static node(e){let s=e;return s.remove=()=>{s.prev&&(s.prev.next=s.next),s.next&&(s.next.prev=s.prev),s.prev=s.next=void 0},s}};function Wa(e,s,t){let i={above:t.myFill.above,below:t.myFill.below};return{start:e,end:s,myFill:i}}function im(e,s,t,i,r,o){let n=fh(s,r);return n!==0?n:d.equals(t,o)?0:e!==i?e?1:-1:ja(t,i?r:o,i?o:r)?1:-1}function Ya(e,s,t){e.insertBefore(s,i=>im(!!s.isStart,s.pt,t,!!i.isStart,i.pt,i.other.pt)<0)}function rm(e,s,t){let i=tr.node({isStart:!0,pt:s.start,seg:s,primary:t});return Ya(e,i,s.end),i}function om(e,s,t,i){let r=tr.node({pt:t.end,seg:t,primary:i,other:s});s.other=r,Ya(e,r,s.pt)}function Vo(e,s,t){let i=rm(e,s,t);return om(e,i,s,t),i}function nm(e,s,t){s.other.remove(),s.seg.end=t,s.other.pt=t,Ya(e,s.other,s.pt)}function Le(e,s,t){let i=Wa(t,s.seg.end,s.seg);return nm(e,s,t),Vo(e,i,!!s.primary)}function am(e,s){let t=e.seg.start,i=e.seg.end,r=s.seg.start,o=s.seg.end;return d.colinear(t,r,o)?d.colinear(i,r,o)||ja(i,r,o)?1:-1:ja(t,r,o)?1:-1}function Ua(e,s,t){let i=s.seg,r=t.seg,o=i.start,n=i.end,a=r.start,l=r.end,c=sm(o,n,a,l);if(c===!1){if(!d.colinear(o,n,a)||d.equals(o,l)||d.equals(n,a))return!1;let p=d.equals(o,a),u=d.equals(n,l);if(p&&u)return t;let f=!p&&ch(o,a,l),v=!u&&ch(n,a,l);if(p)return v?Le(e,t,n):Le(e,s,l),t;f&&(u||(v?Le(e,t,n):Le(e,s,l)),Le(e,t,o))}else c.alongA===0&&(c.alongB===-1?Le(e,s,a):c.alongB===0?Le(e,s,c.pt):c.alongB===1&&Le(e,s,l)),c.alongB===0&&(c.alongA===-1?Le(e,t,o):c.alongA===0?Le(e,t,c.pt):c.alongA===1&&Le(e,t,n));return!1}function mh(e,s){var t,i;let r=new tr,o=[];for(;e.head;){let a=e.head;if(a.isStart){let l=function(){if(p){let v=Ua(e,a,p);if(v)return v}return u?Ua(e,a,u):!1};var n=l;let c=r.findTransition(v=>am(a,v.ev)>0),p=(t=c.before)==null?void 0:t.ev,u=(i=c.after)==null?void 0:i.ev,f=l();if(f&&(s?(!a.seg.myFill.below||a.seg.myFill.above!==a.seg.myFill.below)&&(f.seg.myFill.above=!f.seg.myFill.above):f.seg.otherFill=a.seg.myFill,a.other.remove(),a.remove()),e.head!==a)continue;if(s){let v=a.seg.myFill.below?a.seg.myFill.above!==a.seg.myFill.below:!0;a.seg.myFill.below=u?u.seg.myFill.above:!1,a.seg.myFill.above=v?!a.seg.myFill.below:a.seg.myFill.below}else if(a.seg.otherFill===void 0){let v=u?a.primary===u.primary?u.seg.otherFill.above:u.seg.myFill.above:!1;a.seg.otherFill={above:v,below:v}}a.other.status=c.insert(tr.node({ev:a}))}else{let l=a.status;if(l===void 0)throw new Error("[Euclid.js] Zero-length segment detected!");if(r.exists(l.prev)&&r.exists(l.next)&&Ua(e,l.prev.ev,l.next.ev),l.remove(),!a.primary){let c=a.seg.myFill;a.seg.myFill=a.seg.otherFill,a.seg.otherFill=c}o.push(a.seg)}e.head.remove()}return o}function lm(e){let s=[],t=[];return e.forEach(i=>{let r=i.start,o=i.end;if(d.equals(r,o))return;let n={index:0,matchesHead:!1,matchesPt1:!1},a={index:0,matchesHead:!1,matchesPt1:!1},l=n;function c(g,b,x){l.index=g,l.matchesHead=b,l.matchesPt1=x;let k=l===n;return l=k?a:void 0,!k}for(let g=0;g<s.length;g++){let b=s[g],x=b[0],k=z(b);if(d.equals(x,r)){if(c(g,!0,!0))break}else if(d.equals(x,o)){if(c(g,!0,!1))break}else if(d.equals(k,r)){if(c(g,!1,!0))break}else if(d.equals(k,o)&&c(g,!1,!1))break}if(l===n){s.push([r,o]);return}if(l===a){let g=n.index,b=n.matchesPt1?o:r,x=n.matchesHead,k=s[g],L=x?k[0]:k[k.length-1],A=x?k[1]:k[k.length-2],Z=x?k[k.length-1]:k[0],Q=x?k[k.length-2]:k[1];if(d.colinear(A,L,b)&&(x?k.shift():k.pop(),L=A),d.equals(Z,b)){s.splice(g,1),d.colinear(Q,Z,L)&&(x?k.pop():k.shift()),t.push(k);return}x?k.unshift(b):k.push(b);return}function p(g){s[g].reverse()}function u(g,b){let x=s[g],k=s[b],L=x[x.length-1],A=x[x.length-2],Z=k[0],Q=k[1];d.colinear(A,L,Z)&&(x.pop(),L=A),d.colinear(L,Z,Q)&&k.shift(),s[g]=x.concat(k),s.splice(b,1)}let f=n.index,v=a.index,m=s[f].length<s[v].length;n.matchesHead?a.matchesHead?m?(p(f),u(f,v)):(p(v),u(v,f)):u(v,f):a.matchesHead?u(f,v):m?(p(f),u(v,f)):(p(v),u(f,v))}),t}function cm(e,s){let t=[];for(let i of e){let r=(i.myFill.above?8:0)+(i.myFill.below?4:0)+(i.otherFill&&i.otherFill.above?2:0)+(i.otherFill&&i.otherFill.below?1:0);s[r]!==0&&t.push({start:i.start,end:i.end,myFill:{above:s[r]===1,below:s[r]===2}})}return t}function ph(e){let s=new tr;for(let t of e)for(let i=0;i<t.length;i++){let r=i?t[i-1]:z(t),o=t[i],n=fh(r,o);if(n===0)continue;let a=n<0?r:o,l=n<0?o:r;Vo(s,{start:a,end:l,myFill:{}},!0)}return mh(s,!0)}function Xa(e,s,t){let i=new tr;for(let o of ph(e))Vo(i,Wa(o.start,o.end,o),!0);for(let o of ph(s))Vo(i,Wa(o.start,o.end,o),!1);let r=cm(mh(i,!1),t);return lm(r)}var hm=[0,2,1,0,2,2,0,0,1,0,1,0,0,0,0,0],pm=[0,0,0,0,0,2,0,2,0,0,1,1,0,2,1,0],dm=[0,0,0,0,2,0,2,0,1,1,0,0,0,1,2,0];var um=(e,s)=>Xa(e,s,hm),fm=(e,s)=>Xa(e,s,pm),mm=(e,s)=>Xa(e,s,dm);function gm(e,s){return E(e.p1.x,e.p2.x)?Y(s.y,e.p1.y,e.p2.y):Y(s.x,e.p1.x,e.p2.x)}function vm(e,s){return E(e.p1.x,e.p2.x)?(s.y-e.p1.y)/(e.p2.y-e.p1.y)>0:(s.x-e.p1.x)/(e.p2.x-e.p1.x)>0}function ym(e,s){return Y(e.offset(s),0,1)}function bm(e,s){let t=e.p1.x-e.p2.x,i=e.p1.y-e.p2.y,r=s.p1.x-s.p2.x,o=s.p1.y-s.p2.y,n=t*o-i*r;if(E(n,0))return[];let a=e.p1.x*e.p2.y-e.p1.y*e.p2.x,l=s.p1.x*s.p2.y-s.p1.y*s.p2.x,c=a*r-t*l,p=a*o-i*l;return[new d(c/n,p/n)]}function wm(e,s){let t=d.distance(e.c,s.c);if(t>e.r+s.r)return[];if(t<Math.abs(e.r-s.r))return[];if(E(t,0)&&E(e.r,s.r))return[];if(E(t,e.r+s.r))return[new It(e.c,s.c).midpoint];let i=(de(e.r)-de(s.r)+de(t))/(2*t),r=Math.sqrt(de(e.r)-de(i)),o=(s.c.x-e.c.x)*i/t+(s.c.y-e.c.y)*r/t+e.c.x,n=(s.c.y-e.c.y)*i/t-(s.c.x-e.c.x)*r/t+e.c.y,a=(s.c.x-e.c.x)*i/t-(s.c.y-e.c.y)*r/t+e.c.x,l=(s.c.y-e.c.y)*i/t+(s.c.x-e.c.x)*r/t+e.c.y;return[new d(o,n),new d(a,l)]}function dh(e,s){let t=e.p2.x-e.p1.x,i=e.p2.y-e.p1.y,r=de(t)+de(i),o=s.c.x,n=s.c.y,a=(e.p1.x-o)*(e.p2.y-n)-(e.p2.x-o)*(e.p1.y-n),l=de(s.r)*r-de(a);if(l<0)return[];let c=a*i/r,p=-a*t/r;if(E(l,0))return[s.c.shift(c,p)];let u=t*(i<0?-1:1)*Math.sqrt(l)/r,f=Math.abs(i)*Math.sqrt(l)/r;return[s.c.shift(c+u,p+f),s.c.shift(c-u,p-f)]}function xm(e,s){let t=[],i=Oe(e)?e.circle:e,r=Oe(s)?s.circle:s;Rt(e)&&Rt(s)?t=bm(e,s):Rt(i)&&yt(r)?t=dh(i,r):yt(i)&&Rt(r)?t=dh(r,i):yt(i)&&yt(r)&&(t=wm(i,r));for(let o of[e,s])qe(o)&&(t=t.filter(n=>gm(o,n))),Oo(o)&&(t=t.filter(n=>vm(o,n))),Oe(o)&&(t=t.filter(n=>ym(o,n)));return t}function Ht(...e){if(e.length<2)return[];if(e.length>2)return Wt(Kc(e,2).map(i=>Ht(...i)));let[s,t]=e;if(me(s)&&(s=s.shape(!0)),me(t)&&(t=t.shape(!0)),fe(t)&&([s,t]=[t,s]),fe(s)){let i=Rt(t)?s.points.filter(r=>t.contains(r)):[];for(let r of s.edges)i.push(...Ht(r,t));return i}return xm(s,t)}var D=class{constructor(...e){this.type="polygon",this.points=e}get circumference(){if(this.points.length<=1)return 0;let e=d.distance(this.points[0],z(this.points));for(let s=1;s<this.points.length;++s)e+=d.distance(this.points[s-1],this.points[s]);return e}get signedArea(){let e=this.points,s=e.length,t=e[s-1].x*e[0].y-e[0].x*e[s-1].y;for(let i=1;i<s;++i)t+=e[i-1].x*e[i].y-e[i].x*e[i-1].y;return t/2}get area(){return Math.abs(this.signedArea)}get centroid(){let e=this.points,s=e.length,t=0;for(let r=0;r<s;++r)t+=e[r].x;let i=0;for(let r=0;r<s;++r)i+=e[r].y;return new d(t/s,i/s)}get edges(){let e=this.points.length,s=[];for(let t=0;t<e;++t)s.push(new dt(this.points[t],this.points[(t+1)%e]));return s}get radius(){let e=this.centroid,s=this.points.map(t=>d.distance(t,e));return Math.max(...s)}get oriented(){if(this.signedArea>=0)return this;let e=[...this.points].reverse();return new this.constructor(...e)}cut(e){let s=this.radius/e.length*10,t=e.at(-s),i=e.at(s),r=e.perpendicularVector.scale(e.length*s),o=[t,i,i.add(r),t.add(r)],n=fm([this.points],[o]),a=mm([this.points],[o]);return[...n,...a].map(l=>new D(...l))}static collision(e,s){if(e.points.some(t=>s.contains(t))||s.points.some(t=>e.contains(t)))return!0;for(let t of e.edges)for(let i of s.edges)if(Ht(t,i)[0])return!0;return!1}static union(...e){let[s,...t]=e;if(!t.length)return[s];let i=[s.points],r=t.length>1?D.union(...t).map(o=>o.points):[e[1].points];return um(i,r).map(o=>new D(...o))}static regular(e,s=1){let t=B/e,i=Math.PI/2-t/2,r=I(o=>d.fromPolar(i+t*o,s),e);return new D(...r)}static interpolate(e,s,t=.5){let i=e.points.map((r,o)=>d.interpolate(r,s.points[o],t));return new D(...i)}static convexHull(...e){if(e.length<=3)return new D(...e);let s=e.sort((o,n)=>o.x!==n.x?o.x-n.x:o.y-n.y),t=s.slice(0).reverse(),i=[],r=[];for(let[o,n]of[[s,i],[t,r]]){for(let a of o){for(;n.length>=2;){let l=n[n.length-1],c=n[n.length-2];if((l.x-c.x)*(a.y-c.y)>=(a.x-c.x)*(l.y-c.y))n.pop();else break}n.push(a)}n.pop()}return new D(...i.concat(r))}contains(e){let s=!1;for(let t of this.edges){if(t.p1.equals(e)||t.contains(e))return!1;if(t.p1.y>e.y==t.p2.y>e.y)continue;let i=(t.p2.x-t.p1.x)/(t.p2.y-t.p1.y);e.x<i*(e.y-t.p1.y)+t.p1.x&&(s=!s)}return s}at(e){e<0&&(e+=Math.floor(e));let s=e*this.circumference,t=0;for(let i of this.edges){let r=i.length;if(t+r>s)return i.at((s-t)/r);t+=r}return this.points[0]}offset(e){let s=this.edges,t=lh(e,this.edges)||[this.points[0],0],i=0;for(let r=0;r<t[1];++r)i+=s[r].length;return i+=s[t[1]].offset(e)*s[t[1]].length,i/this.circumference}project(e){let s=lh(e,this.edges);return s?s[0]:this.points[0]}centerAt(e=P){return this.translate(e.subtract(this.centroid))}transform(e){return new this.constructor(...this.points.map(s=>s.transform(e)))}rotate(e,s=P){if(E(e,0))return this;let t=this.points.map(i=>i.rotate(e,s));return new this.constructor(...t)}reflect(e){let s=this.points.map(t=>t.reflect(e));return new this.constructor(...s)}scale(e,s=e){let t=this.points.map(i=>i.scale(e,s));return new this.constructor(...t)}shift(e,s=e){let t=this.points.map(i=>i.shift(e,s));return new this.constructor(...t)}translate(e){return this.shift(e.x,e.y)}equals(e,s,t){let i=this.points.length;if(i!==e.points.length)return!1;let r=t?this:this.oriented,o=t?e:e.oriented;for(let n=0;n<i;++n)if(r.points.every((a,l)=>a.equals(o.points[(l+n)%i],s)))return!0;return!1}toString(){return`polygon(${this.points.join(",")})`}},ve=class extends D{constructor(){super(...arguments),this.type="polyline"}get circumference(){return this.length}get length(){let e=0;for(let s=1;s<this.points.length;++s)e+=d.distance(this.points[s-1],this.points[s]);return e}get edges(){let e=[];for(let s=0;s<this.points.length-1;++s)e.push(new dt(this.points[s],this.points[s+1]));return e}toString(){return`polyline(${this.points.join(",")})`}},Ja=class extends D{constructor(){super(...arguments),this.type="triangle"}get circumcircle(){let[e,s,t]=this.points,i=2*(e.x*(s.y-t.y)+s.x*(t.y-e.y)+t.x*(e.y-s.y)),r=(e.x**2+e.y**2)*(s.y-t.y)+(s.x**2+s.y**2)*(t.y-e.y)+(t.x**2+t.y**2)*(e.y-s.y),o=(e.x**2+e.y**2)*(t.x-s.x)+(s.x**2+s.y**2)*(e.x-t.x)+(t.x**2+t.y**2)*(s.x-e.x),n=new d(r/i,o/i),a=d.distance(n,this.points[0]);if(!(isNaN(a)||a>Number.MAX_SAFE_INTEGER))return new q(n,a)}get incircle(){let e=this.edges,s=e.map(p=>p.length),t=s[0]+s[1]+s[2],[i,r,o]=this.points,n=s[1]*i.x+s[2]*r.x+s[0]*o.x,a=s[1]*i.y+s[2]*r.y+s[0]*o.y,l=new d(n/t,a/t),c=l.distanceFromLine(e[0]);return isNaN(c)?void 0:new q(l,c)}get orthocenter(){let[e,s,t]=this.points,i=new It(e,s).perpendicular(t),r=new It(e,t).perpendicular(s);return Ht(i,r)[0]}},$m=180/Math.PI,Pm=Math.PI/180;function Vt(e){return e*$m}function W(e){return e*Pm}var Ot=class{constructor(e,s,t){this.a=e,this.b=s,this.c=t,this.type="angle"}static fromDegrees(e){return Ot.fromRadians(e*(Math.PI/180))}static fromRadians(e){let s=new d(1,0),t=s.rotate(e);return new Ot(s,P,t)}static equals(e,s,t=Math.PI/360){return E(e.rad,s.rad,t)}get rad(){let e=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),t=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x)-e;return t<0&&(t+=B),t}get deg(){return this.rad*180/Math.PI}get isRight(){return E(this.rad,Math.PI/2,Math.PI/360)}get bisector(){if(this.b.equals(this.a)||this.b.equals(this.c))return;let e=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),s=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x),t=(e+s)/2;e>s&&(t+=Math.PI);let i=Math.cos(t)+this.b.x,r=Math.sin(t)+this.b.y;return new It(this.b,new d(i,r))}get sup(){return this.rad<Math.PI?this:new Ot(this.c,this.b,this.a)}get arc(){return new ge(this.b,this.a,this.rad)}get radius(){return 24+20*(1-M(this.rad,0,Math.PI)/Math.PI)}shape(e=!0,s,t){if(this.a.equals(this.b)||this.c.equals(this.b))return new D(P);let i=this.isRight&&!t;s||(s=i?20:this.radius);let r=new dt(this.b,this.a),o=r.at(s/r.length);if(i){let n=d.difference(this.c,this.b).unitVector.scale(s);return e?new D(this.b,o,o.add(n),this.b.add(n)):new ve(o,o.add(n),this.b.add(n))}return e?new hs(this.b,o,this.rad):new ge(this.b,o,this.rad)}project(e){return this.contains(e)?e:this.shape(!0).project(e)}at(){return this.c}offset(){return 0}contains(e){return this.shape(!0).contains(e)}transform(e){return new Ot(this.a.transform(e),this.b.transform(e),this.c.transform(e))}rotate(e,s){return E(e,0)?this:new Ot(this.a.rotate(e,s),this.b.rotate(e,s),this.c.rotate(e,s))}reflect(e){return new Ot(this.a.reflect(e),this.b.reflect(e),this.c.reflect(e))}scale(e,s=e){return new Ot(this.a.scale(e,s),this.b.scale(e,s),this.c.scale(e,s))}shift(e,s=e){return new Ot(this.a.shift(e,s),this.b.shift(e,s),this.c.shift(e,s))}translate(e){return new Ot(this.a.translate(e),this.b.translate(e),this.c.translate(e))}equals(e,s){return Ot.equals(e,this,s)}toString(){return`angle(${this.a},${this.b},${this.c})`}},S=class{constructor(e,s=1,t=s){this.p=e,this.w=s,this.h=t,this.type="rectangle"}static aroundPoints(e){let s=1/0,t=-1/0,i=1/0,r=-1/0;for(let o of e)s=s<o.x?s:o.x,t=t>o.x?t:o.x,i=i<o.y?i:o.y,r=r>o.y?r:o.y;return new S(new d(s,i),t-s,r-i)}get center(){return new d(this.p.x+this.w/2,this.p.y+this.h/2)}get centroid(){return this.center}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.w*this.h)}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){let e=new d(this.p.x+this.w,this.p.y),s=new d(this.p.x+this.w,this.p.y+this.h),t=new d(this.p.x,this.p.y+this.h);return new D(this.p,e,s,t)}get bounds(){return new bt(this.p.x,this.p.x+this.w,this.p.y,this.p.y+this.h)}collision(e){return this.p.x<e.p.x+e.w&&this.p.x+this.w>e.p.x&&this.p.y<e.p.y+e.h&&this.p.y+this.h>e.p.y}padding(e,s,t,i){return new S(this.p.shift(-i,-e),this.w+i+s,this.h+e+t)}contains(e,s){return Y(e.x,this.p.x,this.p.x+this.w,s)&&Y(e.y,this.p.y,this.p.y+this.h,s)}project(e){let s;for(let t of this.edges){let i=t.project(e);(!s||d.distance(e,i)<d.distance(e,s))&&(s=i)}return s}at(e){return this.polygon.at(e)}offset(e){return this.polygon.offset(e)}transform(e){return this.polygon.transform(e)}rotate(e,s=P){return E(e,0)?this:this.polygon.rotate(e,s)}reflect(e){return this.polygon.reflect(e)}scale(e,s=e){return new S(this.p.scale(e,s),this.w*e,this.h*s)}shift(e,s=e){return new S(this.p.shift(e,s),this.w,this.h)}translate(e){return this.shift(e.x,e.y)}equals(e){return!1}toString(){return`rectangle(${this.p},${this.w},${this.h})`}},bt=class{constructor(e,s,t,i,r){this.xMin=e,this.xMax=s,this.yMin=t,this.yMax=i,r==="swap"?(this.dx<0&&([this.xMin,this.xMax]=[s,e]),this.dy<0&&([this.yMin,this.yMax]=[i,t])):r==="center"&&(this.dx<0&&(this.xMin=this.xMax=(e+s)/2),this.dy<0&&(this.yMin=this.yMax=(t+i)/2))}contains(e){return this.containsX(e)&&this.containsY(e)}containsX(e){return Y(e.x,this.xMin,this.xMax)}containsY(e){return Y(e.y,this.yMin,this.yMax)}resize(e,s){return new bt(this.xMin,this.xMax+e,this.yMin,this.yMax+s)}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}get xRange(){return[this.xMin,this.xMax]}get yRange(){return[this.yMin,this.yMax]}extend(e,s=e,t=e,i=s){return new bt(this.xMin-i,this.xMax+s,this.yMin-e,this.yMax+t)}get rect(){return new S(new d(this.xMin,this.yMin),this.dx,this.dy)}get center(){return new d(this.xMin+this.dx/2,this.yMin+this.dy/2)}get flip(){return new bt(this.yMin,this.yMax,this.xMin,this.xMax)}};function Qa(e,s,t={}){if(me(s))return Qa(e,s.shape(!!t.fill),t);if(t.fill&&(e.fillStyle=t.fill),t.opacity&&(e.globalAlpha=t.opacity),t.stroke&&(e.strokeStyle=t.stroke,e.lineWidth=t.strokeWidth||1,t.lineCap&&(e.lineCap=t.lineCap),t.lineJoin&&(e.lineJoin=t.lineJoin)),e.beginPath(),qe(s))e.moveTo(s.p1.x,s.p1.y),e.lineTo(s.p2.x,s.p2.y);else if(Rt(s)){if(!t.box)return;let[i,r]=Ht(s,t.box);if(Oo(s)&&(r=s.p1),!i||!r)return;e.moveTo(i.x,i.y),e.lineTo(r.x,r.y)}else if(yt(s))e.arc(s.c.x,s.c.y,s.r,0,B);else if(fe(s)){let i=s.points;e.moveTo(i[0].x,i[0].y);for(let r of i.slice(1))e.lineTo(r.x,r.y);e.closePath()}else if(Lo(s)){e.moveTo(s.points[0].x,s.points[0].y);for(let i of s.points.slice(1))e.lineTo(i.x,i.y)}else tm(s)&&e.ellipse(s.c.x,s.c.y,s.a,s.b,s.angle,0,B);t.fill&&e.fill(),t.stroke&&e.stroke()}function uh(e,s,t){let r=s.x*(t.y-e.y)+e.x*(s.y-t.y)+t.x*(e.y-s.y)>0?1:0,o=d.distance(s,e);return[e.x,`${e.y}A${o}`,o,0,r,1,t.x,t.y].join(",")}function ue(...e){return`M${e.map(s=>`${s.x},${s.y}`).join("L")}`}function Za(e,s){let t=e.perpendicularVector.scale(6),i=e.unitVector.scale(3),r=e.midpoint;switch(s){case"bar":return ue(r.add(t),r.add(t.inverse));case"bar2":return ue(r.add(i).add(t),r.add(i).add(t.inverse))+ue(r.add(i.inverse).add(t),r.add(i.inverse).add(t.inverse));case"arrow":return ue(r.add(i.inverse).add(t),r.add(i),r.add(i.inverse).add(t.inverse));case"arrow2":return ue(r.add(i.scale(-2)).add(t),r,r.add(i.scale(-2)).add(t.inverse))+ue(r.add(t),r.add(i.scale(2)),r.add(t.inverse));default:return""}}function Do(e,s){if(!e||!s)return"";let t=s.perpendicular,i=e.add(s.scale(9)).add(t.scale(9)),r=e.add(s.scale(9)).add(t.scale(-9));return ue(i,e,r)}function Tm(e,s){let t="";return $t(s,"start","both")&&(t+=Do(e.p1,e.unitVector)),$t(s,"end","both")&&(t+=Do(e.p2,e.unitVector.inverse)),t}function Sm(e,s){let t="";if($t(s,"start","both")){let i=new It(e.c,e.start).perpendicularVector.inverse;t+=Do(e.start,i)}if($t(s,"end","both")){let i=new It(e.c,e.end).perpendicularVector;t+=Do(e.end,i)}return t}function Gt(e,s={}){if(me(e)){let t=e.shape(!!s.fill,s.size,s.round);return Gt(t,s)}if(qe(e)){if(e.p1.equals(e.p2))return"";let t=ue(e.p1,e.p2);return s.mark&&(t+=Za(e,s.mark)),s.arrows&&(t+=Tm(e,s.arrows)),t}if(Oo(e)){if(!s.box)return"";let t=Ht(e,s.box)[0];if(!t)return"";let i=ue(e.p1,t);return s.mark&&(i+=Za(e,s.mark)),i}if(Ka(e)){if(!s.box)return"";let t=Ht(e,s.box);if(t.length<2)return"";let i=ue(t[0],t[1]);return s.mark&&(i+=Za(e,s.mark)),i}if(yt(e))return`M ${e.c.x-e.r} ${e.c.y} a ${e.r},${e.r} 0 1 0 ${2*e.r} 0 a ${e.r} ${e.r} 0 1 0 ${-2*e.r} 0`;if(Oe(e)){let t=`M${uh(e.start,e.c,e.end)}`;return s.arrows&&(t+=Sm(e,s.arrows)),t}return Ds(e)?`M ${e.c.x} ${e.c.y} L ${uh(e.start,e.c,e.end)} Z`:Lo(e)?ue(...e.points):er(e)?`${ue(...e.points)}Z`:jr(e)?`${ue(...e.polygon.points)}Z`:""}var Me=(e,s,t)=>new Promise((i,r)=>{var o=l=>{try{a(t.next(l))}catch(c){r(c)}},n=l=>{try{a(t.throw(l))}catch(c){r(c)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(o,n);a((t=t.apply(e,s)).next())}),Ro="_M",sr=window.navigator.userAgent.toLowerCase(),km=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i,gh=/iphone|ipad|ipod/i,Cm=/^((?!chrome|android).)*safari/i,vh,Mm=class{constructor(){this.isMobile=km.test(sr),this.isRetina=(window.devicePixelRatio||1)>1,this.isTouch=!!window.Touch||"ontouchstart"in window,this.isChrome=!!window.chrome,this.isFirefox=sr.indexOf("firefox")>=0,this.isAndroid=sr.indexOf("android")>=0,this.isIOS=gh.test(sr),this.isSafari=gh.test(sr)||Cm.test(sr),this.loadQueue=[],this.loaded=!1,this.width=window.innerWidth,this.height=window.innerHeight,this.resizeCallbacks=[],this.theme={name:"light",isDark:!1},this.themeChangedCallbacks=[],this.themeOverride="",this.darkQuery=(vh=window.matchMedia)==null?void 0:vh.call(window,"(prefers-color-scheme: dark)");var e,s;window.onload=()=>this.afterLoad(),document.addEventListener("DOMContentLoaded",()=>this.afterLoad());let t=Yi(()=>this.applyResize());window.addEventListener("resize",t);try{(e=this.darkQuery)==null||e.addEventListener("change",()=>this.applyThemeChange())}catch(r){(s=this.darkQuery)==null||s.addListener(()=>this.applyThemeChange())}let i=this.getCookie("theme");i&&this.setTheme(i);try{this.localStorage=window.localStorage}catch(r){console.warn("Unable to access Local Storage in this context.")}}afterLoad(){if(!this.loaded){this.loaded=!0;for(let e of this.loadQueue)e();setTimeout(()=>this.resize())}}ready(e){this.loaded?e():this.loadQueue.push(e)}redraw(){document.body.offsetHeight}applyResize(){let e=window.innerWidth,s=window.innerHeight;if(!(this.width===e&&this.height===s)){this.width=e,this.height=s;for(let t of this.resizeCallbacks)t({width:this.width,height:this.height});at.trigger("scroll",{top:at.scrollTop})}}onResize(e){e({width:this.width,height:this.height}),this.resizeCallbacks.push(e)}offResize(e){let s=this.resizeCallbacks.indexOf(e);s>=0&&this.resizeCallbacks.splice(s,1)}resize(){this.applyResize()}applyThemeChange(){let e=this.theme.name,s=e==="dark"||e==="auto"&&this.darkQuery.matches;if(s!==this.theme.isDark){this.theme.isDark=s;for(let t of this.themeChangedCallbacks)t(this.theme);setTimeout(()=>ps.setAttr("theme",this.themeOverride||(s?"dark":"light")))}}setTheme(e){e!==this.theme.name&&(this.theme.name=e,this.setCookie("theme",e),this.applyThemeChange())}onThemeChange(e){this.themeChangedCallbacks.push(e)}getHash(){return window.location.hash.slice(1)}setHash(e){let s=document.body.scrollTop;window.location.hash=e,document.body.scrollTop=s}setURL(e,s=""){window.history.replaceState({},s,e),s&&(window.document.title=s)}getCookies(){let e=document.cookie.split(";"),s={};for(let t=0,i=e.length;t<i;++t){let r=e[t].split("=");s[decodeURIComponent(r[0]).trim()]=decodeURIComponent(r[1])}return s}getCookie(e){let s=document.cookie.match(new RegExp(`(^|;) ?${e}=([^;]*)(;|$)`));return s?s[2]:void 0}setCookie(e,s,t=60*60*24*365){let i=window.location.hostname.replace(/^[a-z]{2}\./,"");document.cookie=`${e}=${s};path=/;max-age=${t};domain=${i}`}deleteCookie(e){this.setCookie(e,"",-1)}setStorage(e,s){var t,i;let r=(e||"").split("."),o=Pt(((t=this.localStorage)==null?void 0:t.getItem(Ro))||void 0,{}),n=o;for(let a=0;a<r.length-1;++a)n[r[a]]===void 0&&(n[r[a]]={}),n=n[r[a]];n[r[r.length-1]]=s,(i=this.localStorage)==null||i.setItem(Ro,JSON.stringify(o))}getStorage(e){var s;let t=Pt((s=this.localStorage)==null?void 0:s.getItem(Ro),{});if(!e)return t;let i=(e||"").split("."),r=i.pop();for(let o of i){if(!(o in t))return;t=t[o]}return t[r]}deleteStorage(e){var s;e?this.setStorage(e,void 0):(s=this.localStorage)==null||s.setItem(Ro,"")}getActiveInput(){let e=document.activeElement;return e!=null&&e.shadowRoot&&(e=e.shadowRoot.activeElement),e===document.body?void 0:ot(e)}get formIsActive(){var e;return!!((e=this.getActiveInput())!=null&&e.is("input, select, textarea, [contenteditable]"))}},R=window.BoostBrowser||new Mm;window.BoostBrowser=R;var Am=/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/,Em=/\bAppleWebKit\/(\d+)\b/,Vm=/\bEdge\/12\.(\d+)\b/,Dm=Am.test(navigator.userAgent)||+(navigator.userAgent.match(Vm)||[])[1]<10547||+(navigator.userAgent.match(Em)||[])[1]<537,tl={};function Lm(){if(!Dm)return;Array.from(document.querySelectorAll("svg > use")).forEach(function(s){let t=s.getAttribute("xlink:href"),[i,r]=t.split("#");if(!i.length||!r)return;let o=s.parentNode;o.removeChild(s),i in tl||(tl[i]=fetch(i).then(a=>a.text())),tl[i].then(a=>{let l=document.implementation.createHTMLDocument("");l.documentElement.innerHTML=a;let p=l.getElementById(r).cloneNode(!0),u=document.createDocumentFragment();for(;p.childNodes.length;)u.appendChild(p.firstChild);o.appendChild(u)})})}var Om=new Map(Object.entries({" ":"Space",Spacebar:"Space",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Down:"ArrowDown",Up:"ArrowUp"}));function Yr(e){return Om.get(e.key)||e.key}function Sh(e){let s=new Set(["Enter","Space"]),t=!1;document.addEventListener("keyup",i=>{s.has(Yr(i))&&(t=!1)}),(e||document).addEventListener("keydown",i=>{if(!t&&s.has(Yr(i))){t=!0;let r=R.getActiveInput();r&&r.hasAttr("tabindex")&&r.tagName!=="TEXTAREA"&&(i.preventDefault(),r.trigger("pointerdown",i),r.trigger("pointerstop",i),at.trigger("pointerstop",i),r.trigger("click",i))}})}var Bo=!1;setTimeout(()=>Bo=!0);var Rm="cubic-bezier(0.175, 0.885, 0.32, 1.275)",Im="cubic-bezier(0.68, -0.275, 0.825, 0.115)",js={cancel:()=>{},promise:Promise.resolve()};function et(e,s){if(s===0)return e(1,0,()=>{}),js;let t=Date.now(),i=To(),r=0,o=!0,n=()=>{o=!1,i.reject()};function a(){o&&(!s||r<=s)&&window.requestAnimationFrame(a);let l=Date.now()-t;e(s?Math.min(1,l/s):l,l-r,n),s&&l>=s&&i.resolve(),r=l}return a(),{cancel:n,promise:i.promise}}function Io(e,s=0,t=0){switch(e){case"quad":return s**2;case"cubic":return s**3;case"quart":return s**4;case"quint":return s**5;case"circ":return 1-Math.sqrt(1-s**2);case"sine":return 1-Math.cos(s*Math.PI/2);case"exp":return s<=0?0:Math.pow(2,10*(s-1));case"back":return t||(t=1.70158),s*s*((t+1)*s-t);case"elastic":return t||(t=.3),-Math.pow(2,10*(s-1))*Math.sin(((s-1)*2/t-.5)*Math.PI);case"swing":return .5-Math.cos(s*Math.PI)/2;case"spring":return 1-Math.cos(s*4.5*Math.PI)*Math.exp(-s*6);case"bounce":return s<1/11?1/64-7.5625*(.5/11-s)*(.5/11-s):s<3/11?1/16-7.5625*(2/11-s)*(2/11-s):s<7/11?1/4-7.5625*(5/11-s)*(5/11-s):1-7.5625*(1-s)*(1-s);default:return s}}function wt(e,s=0,t=0){if(s===0)return 0;if(s===1)return 1;let[i,r]=e.split("-");return r==="in"?Io(i,s,t):r==="out"?1-Io(i,1-s,t):s<=.5?Io(i,2*s,t)/2:1-Io(i,2*(1-s),t)/2}function oe(e,s,t=400,i=0,r="ease-in-out"){if(!Bo)return Object.keys(s).forEach(g=>{let b=s[g];e.css(g,Array.isArray(b)?b[1]:b)}),js;r==="bounce-in"&&(r=Rm),r==="bounce-out"&&(r=Im);let o="";R.isSafari&&(o=e._el.style.transition,e.css("transition","none"),R.redraw());let n=e._data.animation;n&&n.cancel();let a={},l={},c=To(),p=window.getComputedStyle(e._el);Object.keys(s).forEach(g=>{let b=s[g],x=Hc(g);l[x]=Array.isArray(b)?b[0]:p.getPropertyValue(g),a[x]=Array.isArray(b)?b[1]:b,i&&e.css(g,l[x])});let u=a.height;if(a.height==="auto"){let g=e.children.filter(b=>b.css("position")!=="absolute");a.height=`${_(g.map(b=>b.outerHeight))}px`}let f,v=!1;Bs(()=>{v||(f=e._el.animate([l,a],{duration:t,easing:r,fill:"forwards"}),f.onfinish=()=>{e._el&&Object.keys(s).forEach(g=>e.css(g,g==="height"?u:a[g])),R.isSafari&&e.css("transition",o),c.resolve(),f.cancel(),e._data.animation=void 0})},i);let m={cancel(){v||(v=!0,e._el&&Object.keys(s).forEach(g=>e.css(g,e.css(g))),f&&f.cancel(),e._data.animation=void 0)},promise:c.promise};return setTimeout(()=>e._data.animation=m),m}var Nm=/matrix\([0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,([0-9.\-\s]+),([0-9.\-\s]+)\)/;function Gm(e,s="fade",t=500,i=0){if(e.show(),!Bo)return js;let r=e._data.animation?1:+e.css("opacity")||1;if(s==="fade")return oe(e,{opacity:[0,r]},t,i);if(s==="pop"){let o=e.transform.replace(/scale\([0-9.]*\)/,"").replace(Nm,"translate($1px,$2px)");return oe(e,{opacity:[0,r]},t,i),oe(e,{transform:[`${o} scale(0.5)`,`${o} scale(1)`]},t,i,"bounce-in")}else{if(s==="descend")return oe(e,{opacity:[0,1],transform:["translateY(-50%)","none"]},t,i);if(s.startsWith("draw")){let o=e.strokeLength;e.css("stroke-dasharray",`${o}px`),e.css("opacity")||e.css("opacity",1);let n=s==="draw-reverse"?`${2*o}px`:0,a={"stroke-dashoffset":[`${o}px`,n]},l=oe(e,a,t,i,"linear");return l.promise.then(()=>e.css("stroke-dasharray","")),l}else if(s.startsWith("slide")){let o={opacity:[0,r],transform:["translateY(50px)","none"]};return s.includes("down")&&(o.transform[0]="translateY(-50px)"),s.includes("right")&&(o.transform[0]="translateX(-50px)"),s.includes("left")&&(o.transform[0]="translateX(50px)"),oe(e,o,t,i)}else if(s.startsWith("reveal")){let o={opacity:[0,r],height:[0,"auto"]};return s.includes("left")&&(o.transform=["translateX(-50%)","none"]),s.includes("right")&&(o.transform=["translateX(50%)","none"]),oe(e,o,t,i)}}return js}function _m(e,s="fade",t=400,i=0,r=!1){if(!e._el)return js;if(!Bo)return e.hide(),js;if(e.css("display")==="none")return js;let o;if(s==="fade")o=oe(e,{opacity:[1,0]},t,i);else if(s==="pop"){let n=e.transform.replace(/scale\([0-9.]*\)/,"");oe(e,{opacity:[1,0]},t,i),o=oe(e,{transform:[`${n} scale(1)`,`${n} scale(0.5)`]},t,i,"bounce-out")}else if(s==="ascend")o=oe(e,{opacity:[1,0],transform:["none","translateY(-50%)"]},t,i);else if(s.startsWith("draw")){let n=e.strokeLength;e.css("stroke-dasharray",n);let l={"stroke-dashoffset":[s==="draw-reverse"?`${2*n}px`:0,`${n}px`]};o=oe(e,l,t,i,"linear")}else if(s.startsWith("slide")){let n={opacity:0,transform:"translateY(50px)"};s.includes("up")&&(n.transform="translateY(-50px)"),o=oe(e,n,t,i)}else if(s.startsWith("reveal")){let n={opacity:0,height:0};s.includes("left")&&(n.transform="translateX(-50%)"),s.includes("right")&&(n.transform="translateX(50%)"),o=oe(e,n,t,i)}return o.promise.then(()=>r?e.remove():e.hide()),o}var kh={"===":(e,s)=>e===s,"!==":(e,s)=>e!==s,"||":(e,s)=>e||s,"&&":(e,s)=>e&&s,"==":(e,s)=>e==s,"!=":(e,s)=>e!=s,"<=":(e,s)=>e<=s,">=":(e,s)=>e>=s,"**":(e,s)=>e**s,"<":(e,s)=>e<s,">":(e,s)=>e>s,"+":(e,s)=>e+s,"-":(e,s)=>e-s,"*":(e,s)=>e*s,"/":(e,s)=>e/s,"%":(e,s)=>e%s},Ch={"-":e=>-e,"+":e=>+e,"!":e=>!e},yh={"||":1,"&&":2,"==":3,"!=":3,"===":3,"!==":3,"<":4,">":4,"<=":4,">=":4,"+":5,"-":5,"*":6,"/":6,"%":6,"**":7},bh={true:!0,false:!1,undefined:void 0},zm=/\s/,el=/[0-9]/,sl=/[a-zA-Z--$_]/,Bm=/[0-9a-zA-Z--$_]/;function Hm(e){let s=e.length,t=0;function i(g){throw new Error(`${g} at character ${t} of "${e}"`)}function r(){for(;zm.test(e[t]);)t+=1}function o(){let g="";for(;el.test(e[t]);)g+=e[t++];if(e[t]===".")for(g+=e[t++];el.test(e[t]);)g+=e[t++];let b=e[t];if(b&&sl.test(b)){let x=g+e[t];i(`Variable names cannot start with a number (${x})`)}else b==="."&&i("Unexpected period");return{type:5,value:parseFloat(g)}}function n(){let g=e[t];t+=1;let b=!1,x="";for(;t<s;){let k=e[t++];if(k===g){b=!0;break}x+=k}return b||i(`Unclosed quote after "${x}"`),{type:5,value:x}}function a(){let g=e[t];for(sl.test(e[t])||i(`Unexpected ${g}`),t+=1;t<s&&Bm.test(e[t]);)g+=e[t++];return g in bh?{type:5,value:bh[g]}:{type:4,name:g}}function l(g){let b=[],x=!1,k;for(;t<s;)if(e[t]===g){k&&b.push(k),x=!0,t+=1;break}else e[t]===","?(b.push(k||{type:5,value:void 0}),t+=1):k=v();return x||i(`Expected ${g}`),b}function c(){let g;if(e[t]==="("){if(t+=1,g=v(),r(),e[t]===")")return t+=1,g;i("Unclosed (")}else g=a();for(r();".[(".includes(e[t]);)e[t]==="."?(t++,r(),g={type:6,object:g,computed:!1,property:a()}):e[t]==="["?(t++,g={type:6,object:g,computed:!0,property:v()},r(),e[t]!=="]"&&i("Unclosed ["),t++):e[t]==="("&&(t++,g={type:2,args:l(")"),callee:g}),r();return g}function p(){r();for(let g of[3,2,1]){let b=e.substr(t,g);if(b in kh)return t+=g,b}}function u(){r();let g=e[t];if(el.test(g)||g===".")return o();if(g==="'"||g==='"')return n();if(g==="[")return t+=1,{type:0,elements:l("]")};if(g in Ch)return t+=1,{type:7,operator:g,argument:u()};if(sl.test(g)||g==="(")return c();i("Expression parsing error")}function f(){let g=u(),b=p();if(!b)return g;let x=u();x||i(`Expected expression after ${b}`);let k,L=[g,b,x];for(;b=p();){let Z=yh[b],Q=b;for(;L.length>2&&Z<=yh[L[L.length-2]];)x=L.pop(),b=L.pop(),g=L.pop(),k={type:1,operator:b,left:g,right:x},L.push(k);k=u(),k||i(`Expected expression after ${Q}`),L.push(Q,k)}let A=L.length-1;for(k=L[A];A>1;)k={type:1,operator:L[A-1],left:L[A-2],right:k},A-=2;return k}function v(){let g=f();if(r(),g&&e[t]==="?"){t+=1;let b=v();if(b||i("Expected expression"),r(),e[t]===":"){t++;let x=v();return x||i("Expected expression"),{type:3,test:g,consequent:b,alternate:x}}else i("Expected :")}else return g}let m=v();return t<e.length&&i(`Unexpected "${e[t]}"`),m}var No=[void 0,void 0];function Ce(e,s,t){switch(e.type){case 0:let i=e.elements.map(m=>Ce(m,s,t)[0]);return i.some(m=>m===void 0)?No:[i,void 0];case 1:let r=Ce(e.left,s,t)[0],o=Ce(e.right,s,t)[0];return"+-**/%".includes(e.operator)&&(r===void 0||o===void 0)?No:[kh[e.operator](r,o),void 0];case 2:let[n,a]=Ce(e.callee,s,t),l=e.args.map(m=>Ce(m,s,t)[0]);return l.some(m=>m===void 0)||typeof n!="function"?No:[n.apply(a,l),void 0];case 3:let c=Ce(e.consequent,s,t),p=Ce(e.alternate,s,t);return Ce(e.test,s,t)[0]?c:p;case 4:return[t[e.name]||s[e.name],void 0];case 5:return[e.value,void 0];case 6:let u=Ce(e.object,s,t)[0],f=e.computed?Ce(e.property,s,t)[0]:e.property.name;return u?[u[f],u]:[void 0,void 0];case 7:let v=Ce(e.argument,s,t)[0];return v===void 0&&e.operator!=="!"?No:[Ch[e.operator](v),void 0]}}function ye(e){let s=Hm(e);return s?(t={},i={})=>Ce(s,t,i)[0]:(t={})=>{}}var Fm=/\${([^}]+)}/g;function wh(e,s=!1){let t=e.split(Fm),i=t.map((r,o)=>o%2?ye(r.replace(//g,"*")):void 0);return r=>t.map((o,n)=>{if(!(n%2))return o;let a=i[n](r);return!s&&typeof a=="number"&&a<0?`${-a}`:a}).join("")}var Wr="ontouchstart"in window,ir="onpointerdown"in window;function ce(e){if(e.touches){let s=e.targetTouches.length?e.targetTouches:e.changedTouches;return new d(s[0].clientX,s[0].clientY)}else return new d(e.clientX||0,e.clientY||0)}function qm(e){return e.touches||[]}function Ue(e,s){return ce(e).transform(s.inverseTransformMatrix)}function Um(e,s){let t=ce(e),i=s.bounds,r=(t.x-i.left)*s.canvasWidth/i.width,o=(t.y-i.top)*s.canvasHeight/i.height;return new d(r,o)}function Zm(e){if(e instanceof PointerEvent&&e.pointerType==="mouse")return ot(e.target);let s=ce(e);return ot(document.elementFromPoint(s.x,s.y)||void 0)}function jm(e){if(e._data.tapEvent)return;e._data.tapEvent=!0;let s;e.on("pointerdown",t=>s=ce(t)),e.on("pointerup",t=>{if(!s)return;let i=ce(t);d.distance(s,i)<6&&e.trigger("tap",t),s=void 0}),e.on("pointercancel",()=>s=void 0)}function Wm(e){e._data.clickOutsideEvent||(e._data.clickOutsideEvent=!0,at.on("pointerdown",s=>{var t,i;let r=s.target,o=(i=(t=e._el).getRootNode)==null?void 0:i.call(t),n=ce(s);o!=null&&o.host&&(r=o.elementFromPoint(n.x,n.y)),!(!r||e._el===r||e._el.contains(r))&&e.trigger("clickOutside",s)}))}function Km(e,s){let t=s.$box||e,i=ce;t.type==="svg"?i=f=>Ue(f,t.$ownerSVG):t.type==="canvas"&&(i=f=>Um(f,t));let r=s.justInside?e:at,o,n,a=!1,l=0;e.css("touch-action")==="auto"&&e.css("touch-action","none"),e.addClass("noselect");function c(f){f.handled||qm(f).length>1||(f.preventDefault(),a=!1,l=f.pointerId||0,r.on("pointermove",p),r.on("pointerstop",u),o=n=i(f),s.down&&s.down(o))}function p(f){if(!o||l&&f.pointerId!==l)return;f.preventDefault();let v=i(f);d.distance(v,n)<.5||(!a&&s.start&&s.start(o),s.move&&s.move(v,o,n),n=v,a=!0)}function u(f,v=!1){o&&(l&&f.pointerId!==l||(f.preventDefault(),r.off("pointermove",p),r.off("pointerstop",u),s.up&&s.up(n,o),a&&s.end&&s.end(n,o),!a&&s.click&&!v&&s.click(o),o=void 0))}at.onKey("Escape",()=>{if(!o)return;a&&s.move&&s.move(o,o,n),n=o;let f=document.createEvent("MouseEvent");f.pointerId=l,u(f,!0)}),e.on("pointerdown",c),s.justInside&&e.on("mouseleave",u),s.accessible&&(e.setAttr("tabindex","0"),document.addEventListener("keydown",f=>{if(![37,38,39,40].includes(f.keyCode)||e!==R.getActiveInput())return;let v=e.boxCenter,m=i({clientX:v.x,clientY:v.y}),g=f.keyCode===37?-25:f.keyCode===39?25:0,b=f.keyCode===38?-25:f.keyCode===40?25:0,x=m.shift(g,b);s.down&&s.down(m),s.start&&s.start(m),s.move&&s.move(x,m,m),s.end&&s.end(x,m)}))}function Ym(e){if(e._data.scrollEvents)return;e._data.scrollEvents=!0;let s=!1,t;function i(){let l=e.scrollTop;if(l===t){s=!1;return}t=l,e.trigger("scroll",{top:t}),window.requestAnimationFrame(i)}function r(){s||window.requestAnimationFrame(i),s=!0}(e.type==="window"?window:e._el).addEventListener("scroll",r);function n(){window.addEventListener("touchmove",r),window.addEventListener("touchend",a)}function a(){window.removeEventListener("touchmove",r),window.removeEventListener("touchend",a)}e._el.addEventListener("touchstart",function(l){l.handled||n()})}var il;function Xm(e){for(let s of e){let t=s.isIntersecting?"enterViewport":"exitViewport";setTimeout(()=>ot(s.target).trigger(t))}}function xh(e){if(!e._data.intersectionEvents){if(e._data.intersectionEvents=!0,!window.IntersectionObserver){let s=!1;at.on("scroll",()=>{let t=e.isInViewport;s&&!t?(e.trigger("exitViewport"),s=!1):t&&!s&&(e.trigger("enterViewport"),s=!0)});return}il||(il=new IntersectionObserver(Xm)),il.observe(e._el)}}function Jm(e,s=!1){if(s&&(e._data.resizeObserver&&e._data.resizeObserver.disconnect(),e._data.resizeObserver=void 0),!e._data.resizeObserver){if(window.ResizeObserver){let t=new window.ResizeObserver(()=>e.trigger("resize"));t.observe(e._el),e._data.resizeObserver=t}else if(window.MutationObserver){let t=new MutationObserver(()=>e.trigger("resize"));t.observe(e._el,{attributes:!0,childList:!0,characterData:!0,subtree:!0}),e._data.resizeObserver=t}}}function $h(e){if(e._data.pointerPositionEvents)return;e._data.pointerPositionEvents=!0;let s=e.parent,t;s.on("pointerend",()=>t=void 0),s.on("pointermove",i=>{let r=t,o=Zm(i);t=o.equals(e)||o.hasParent(e),r!==void 0&&t&&!r&&e.trigger("pointerenter",i),!t&&r&&e.trigger("pointerleave",i)})}function rl(e,s){s._data[`_${e}`]||(s._data[`_${e}`]=!0,ir?s.on(e.replace("mouse","pointer"),t=>{t.pointerType==="mouse"&&s.trigger(e,t)}):Wr||s._el.addEventListener(e,t=>s.trigger(e,t)))}function Qm(e){e.on("keydown",s=>{if(s.metaKey||s.ctrlKey||R.isAndroid&&s.keyCode===229)return;let t=s.key||String.fromCharCode(s.which),i=!!s.shiftKey;e.trigger("key",{code:s.keyCode,key:t,char:t,shift:i})}),R.isAndroid&&e.type==="input"&&e.on("input",s=>{let t=s.key||s.data[s.data.length-1];e.trigger("key",{code:void 0,key:t,char:t}),e.value=""})}var _o={scrollwheel:"DOMMouseScroll mousewheel",pointerdown:ir?"pointerdown":Wr?"touchstart":"mousedown",pointermove:ir?"pointermove":Wr?"touchmove":"mousemove",pointerup:ir?"pointerup":Wr?"touchend":"mouseup",pointercancel:ir?"pointercancel":"touchcancel",pointerstop:ir?"pointerup pointercancel":Wr?"touchend touchcancel":"mouseup"},zo={scroll:Ym,tap:jm,clickOutside:Wm,key:Qm,mousedown:rl.bind(void 0,"mousedown"),mousemove:rl.bind(void 0,"mousemove"),mouseup:rl.bind(void 0,"mouseup"),pointerenter:$h,pointerleave:$h,enterViewport:xh,exitViewport:xh,resize:Jm};function t0(e,s,t,i){if(s in zo)zo[s](e,!1);else if(s in _o){let r=Lt(_o[s]);for(let o of r)e._el.addEventListener(o,t,i)}else e._el.addEventListener(s,t,i)}function e0(e,s,t){if(s in zo)(!e._events[s]||!e._events[s].length)&&zo[s](e,!0);else if(t&&s in _o){let i=Lt(_o[s]);for(let r of i)e._el.removeEventListener(r,t)}else t&&e._el.removeEventListener(s,t)}var Go=0,ol=new Map;function Ph(e,s){ol.set(e,s)}function s0(e){if(Go++,e(),Go--,Go===0){for(let[s,t]of ol.entries())s(t);ol.clear()}}function Ze(e,s){let t=new Map,i=new Map,r=new Set,o,n=0;function a(L){o=L;let A=L(k,!0);return o=void 0,A}function l(L){for(let A of t.values())A.has(L)&&A.delete(L);r.delete(L)}function c(L,A){return r.add(L),A?void 0:L(k,!0)}function p(L,A){i.has(L)&&l(i.get(L));let Z=()=>{e[L]=A(k),o===Z&&(o=void 0),u(L)};i.set(L,Z),a(Z)}function u(L){if(Go>0){for(let A of t.get(L)||[])Ph(A,e);for(let A of r)Ph(A,e)}else{for(let A of t.get(L)||[])A(e);for(let A of r)A(e)}}function f(){for(let L of t.values())for(let A of L)A(e);for(let L of r)L(e)}function v(L,A){A&&(e={}),s0(()=>{for(let[Z,Q]of Object.entries(L))k[Z]=Q})}function m(){for(n+=1;`_x${n}`in e;)n+=1;return`_x${n}`}function g(){e={},t.clear(),i.clear(),n=0}function b(){return Object.assign({},e)}function x(L){s&&s.watch(()=>k[L]=s[L])}let k=new Proxy(e,{get(L,A){return A==="watch"?a:A==="unwatch"?l:A==="watchAll"?c:A==="setComputed"?p:A==="forceUpdate"?f:A==="assign"?v:A==="getKey"?m:A==="clear"?g:A==="copy"?b:A==="_internal"?[e,t]:(o&&(t.has(A)||t.set(A,new Set),t.get(A).add(o)),A in e||x(A),e[A])},set(L,A,Z){return e[A]===Z||(e[A]=Z,i.has(A)&&(l(i.get(A)),i.delete(A)),u(A)),!0},deleteProperty(L,A){return delete e[A],t.delete(A),i.delete(A),!0}});return k}var i0={A:7,C:6,H:1,L:2,M:2,Q:4,S:4,T:2,V:1,Z:0},r0=/[astvzqmhlc]([^astvzqmhlc]*)/ig,o0=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function Ho(e){let s=[],t;for(let i of e.match(r0)||[]){let r=i[0].toUpperCase();if(r==="Z"){s.push({type:"Z",points:[]});continue}let o=(i.slice(1).match(o0)||[]).map(a=>+a),n=r===i[0];for(let[a,l]of Ms(o,i0[r]).entries()){let c=[],p=r==="M"&&a>0?"L":r,u;r==="H"?(p="L",c=[new d(l[0],n&&(t==null?void 0:t.y)||0)]):r==="V"?(p="L",c=[new d(n&&(t==null?void 0:t.x)||0,l[0])]):r==="A"?(p="A",c=[new d(l[5],l[6])],u=l.slice(0,5)):"MLCSQT".includes(r)&&(c=Ms(l,2).map(f=>new d(f[0],f[1]))),!n&&t&&(c=c.map(f=>f.translate(t))),t=z(c),s.push({type:p,points:c,options:u})}}return s}function Ws(e){return e?Ho(e).map(t=>z(t.points)).filter(t=>!!t):[]}var n0=["font-family","font-size","font-style","font-weight","letter-spacing","text-decoration","color","display","visibility","alignment-baseline","baseline-shift","opacity","text-anchor","clip","clip-path","clip-rule","mask","filter","transform","transform-origin","white-space","line-height"],a0=["fill","fill-rule","marker","marker-start","marker-mid","marker-end","stroke","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-width","text-rendering","dominant-baseline","transform-box","paint-order"],l0=["padding","min-width","max-width","height","border-width","border-style","border-color","box-sizing","background","width","grid-template-columns","text-align"],c0=["class","tabindex","contenteditable"],h0=new Set(["opacity","transform-box","transform-origin","border-width","border-style","border-color"]),p0={"font-style":"normal","font-weight":"400","letter-spacing":"normal","text-decoration":"none",display:"block",visibility:"visible","alignment-baseline":"auto","baseline-shift":"0px","text-anchor":"start",clip:"auto","clip-path":"none","clip-rule":"nonzero",mask:"none",opacity:"1",filter:"none",fill:"rgb(0, 0, 0)","fill-rule":"nonzero",marker:"none",stroke:"none","stroke-dasharray":"none","stroke-dashoffset":"0px","stroke-linecap":"butt","stroke-linejoin":"miter","stroke-width":"1px","text-rendering":"auto",transform:"none","dominant-baseline":"auto","transform-origin":"0px 0px","transform-box":"view-box","paint-order":"normal"};function Mh(e){var s,t;if(e.getAttribute("hidden")||e.style.opacity==="0"||e.style.display==="none")(s=e.parentNode)==null||s.removeChild(e);else{for(let i of Array.from(e.children))Mh(i);if(e.tagName==="g"&&e.childElementCount===0)(t=e.parentNode)==null||t.removeChild(e);else for(let i of c0)e.hasAttribute(i)&&e.removeAttribute(i)}}function d0(e,s){let t=e.parentElement;for(;t;){let i=t.style.getPropertyValue(s);if(i)return i;t=t.parentElement}}function Ah(e,s,t=!1){let i=window.getComputedStyle(e);s.removeAttribute("style");let r=t||e.tagName==="foreignObject",o=[...n0,...r?l0:a0];for(let l of o){let c=i.getPropertyValue(l),p=d0(s,l);c===p0[l]&&!p||!h0.has(l)&&c===p||s.style.setProperty(l,c)}let n=e.children,a=s.children;for(let l=0;l<a.length;++l)Ah(n[l],a[l],r)}var Eh=class{constructor(e){this._el=e,this._data={},this._events={},this.type="default",e._view=this}get id(){return this._el.id}get data(){return this._el.dataset}get tagName(){return this._el.tagName.toUpperCase()}equals(e){return this._el===e._el}addClass(e){for(let s of Lt(e))this._el.classList.add(s)}removeClass(e){for(let s of Lt(e))this._el.classList.remove(s)}hasClass(e){return this._el.classList.contains(e)}toggleClass(e){return this._el.classList.toggle(e)}setClass(e,s){s?this.addClass(e):this.removeClass(e)}attr(e){return this._el.getAttribute(e)||""}hasAttr(e){return this._el.hasAttribute(e)}setAttr(e,s){s===void 0?this.removeAttr(e):this._el.setAttribute(e,s.toString())}removeAttr(e){this._el.removeAttribute(e)}get attributes(){return Array.from(this._el.attributes||[])}get html(){return this._el.innerHTML||""}set html(e){this._el.innerHTML=e}get text(){return this._el.textContent||""}set text(e){this._el.textContent=e}set textStr(e){this._el.textContent=`${e}`}blur(){this._el.blur()}focus(){this._el.focus()}getParentModel(){let e=this.parent;return e?e.model||e.getParentModel():void 0}bindModel(e,s=!0){var t;if(!this.model){if(this.model=e,this.hasAttr(":for"))return this.makeDynamicList(e);for(let{name:i,value:r}of this.attributes)this.makeDynamicAttribute(i,r,e);for(let i of this.childNodes)if(i instanceof Text){if((t=i.textContent)!=null&&t.includes("${")){let r=wh(i.textContent);e.watch(()=>i.textContent=r(e)||"")}}else s&&i.bindModel(e)}}bindVariable(e,s){}toggleDOM(e=!0){e!==!!this._el.parentNode&&(this.$placeholder||(this.$placeholder=ot(document.createComment("")),this.insertBefore(this.$placeholder)),e?this.$placeholder.insertBefore(this):this.detach())}makeDynamicAttribute(e,s,t){if(e.startsWith("@")){let i=e.slice(1),r=ye(s);this.on(i,o=>r(t,{$event:o}))}else if(e===":show"){let i=ye(s);t.watch(()=>this.toggle(!!i(t)))}else if(e===":if"){let i=ye(s);t.watch(()=>this.toggleDOM(!!i(t)))}else if(e===":html"){let i=ye(s);t.watch(()=>this.html=i(t)||"")}else if(e===":draw"){let i=ye(s);t.watch(()=>this.draw(i(t)))}else if(e===":class"){let i=ye(s),r=`${this.attr("class")} `;t.watch(()=>this.setAttr("class",r+i(t)))}else if(e===":bind")this.bindVariable(t,s);else if(e.startsWith(":")){let i=ye(s),r=e.slice(1);t.watch(()=>this.setAttr(r,i(t)))}else if(s.includes("${")){let i=wh(s,!0);t.watch(()=>this.setAttr(e,i(t)||""))}(e.startsWith("@")||e.startsWith(":"))&&this.removeAttr(e)}makeDynamicList(e){let[s,t]=this.attr(":for").split(" in ");this.removeAttr(":for");let i=ye(t),r=ot(document.createComment(""));this.insertBefore(r),this.detach();let o=[],n=0;e.watch(()=>{let a=i(e);Array.isArray(a)||(a=[]);for(let l=a.length;l<n;++l)o[l].detach();for(let l=n;l<o.length;++l)r.insertBefore(o[l]);for(let l=o.length;l<a.length;++l){let c=this.copy(!0);c.bindModel(Ze({[s]:void 0},e)),r.insertBefore(c),o.push(c)}n=a.length;for(let l=0;l<n;++l)o[l].model[s]=a[l]})}get bounds(){return this._el.getBoundingClientRect()}get boundsRect(){let e=this.bounds;return new S(new d(e.x,e.y),e.width,e.height)}contains(e){return this.boundsRect.contains(e)}get isInViewport(){if(this.height===0)return!1;let e=this.bounds;return Y(e.top,-e.height,R.height)}get topLeftPosition(){let e=this.bounds;return new d(e.left,e.top)}get boxCenter(){let e=this.bounds;return new d(e.left+e.width/2,e.top+e.height/2)}get scrollWidth(){return this._el.scrollWidth}get scrollHeight(){return this._el.scrollHeight}get scrollTop(){return this._el.scrollTop}set scrollTop(e){this._el.scrollTop=e,this.trigger("scroll",{top:e,left:this.scrollLeft})}get scrollLeft(){return this._el.scrollLeft}set scrollLeft(e){this._el.scrollLeft=e,this.trigger("scroll",{top:this.scrollTop,left:e})}scrollTo(e,s=1e3,t="cubic"){e<0&&(e=0);let i=this.scrollTop,r=e-i;this._data.scrollAnimation&&this._data.scrollAnimation.cancel(),this._data.scrollAnimation=et(o=>{let n=i+r*wt(t,o);this.scrollTop=n,this.trigger("scroll",{top:n})},s)}scrollBy(e,s=1e3,t="cubic"){e&&this.scrollTo(this.scrollTop+e,s,t)}css(e,s){if(s===void 0){if(typeof e=="string")return window.getComputedStyle(this._el).getPropertyValue(e);{let t=Object.keys(e);for(let i of t)this._el.style.setProperty(i,`${e[i]}`)}}else typeof e=="string"&&this._el.style.setProperty(e,`${s}`)}get transform(){return this.css("transform").replace("none","")}get transformMatrix(){let e=this.transform;if(!e)return[[1,0,0],[0,1,0]];let s=e.match(/matrix\(([0-9,.\s-]*)\)/);if(!s||!s[1])return[[1,0,0],[0,1,0]];let t=s[1].split(",");return[[+t[0],+t[2],+t[4]],[+t[1],+t[3],+t[5]]]}get scale(){let e=this.transformMatrix;return[e[0][0],e[1][1]]}setTransform(e,s=0,t=1){let i="";e&&(i+=`translate(${tt(e.x,.1)}px,${tt(e.y,.1)}px)`),s&&(i+=` rotate(${s}rad)`),t&&(i+=` scale(${t})`),this._el.style.transform=i}translate(e,s){this.setTransform(new d(e,s))}show(){this.hasAttr("hidden")&&this.removeAttr("hidden"),this.data.display==="visibility"?this._el.style.visibility="visible":this._el.style.display=this.data.display||"block"}hide(){this.data.display==="visibility"?this._el.style.visibility="hidden":this._el.style.display="none"}toggle(e){e?this.show():this.hide()}is(e){return this._el.matches?this._el.matches(e):Array.from(document.querySelectorAll(e)).includes(this._el)}index(){let e=0,s=this._el;for(;(s=s.previousSibling||void 0)!==void 0;)++e;return e}prepend(e){let s=this._el.childNodes;s.length?this._el.insertBefore(e._el,s[0]):this._el.appendChild(e._el)}append(e){this._el.appendChild(e instanceof Text?e:e._el)}insertBefore(e){this.parent._el.insertBefore(e._el,this._el)}insertAfter(e){let s=this._el.nextSibling;s?this.parent._el.insertBefore(e._el,s):this.parent._el.appendChild(e._el)}get next(){return ot(this._el.nextSibling)}get prev(){return ot(this._el.previousSibling)}$(e){return ot(e,this)}$$(e){return nl(e,this)}get parent(){return ot(this._el.parentElement||void 0)}parents(e){let s=[],t=this.parent;for(;t;)(!e||t.is(e))&&s.push(t),t=t.parent;return s}hasParent(...e){let s=e.map(i=>i._el),t=this._el.parentNode;for(;t;){if($t(t,...s))return!0;t=t.parentNode}return!1}get children(){return Array.from(this._el.children||[],e=>ot(e))}get childNodes(){return Array.from(this._el.childNodes,e=>{if(!(e instanceof Comment))return e instanceof Text?e:ot(e)}).filter(e=>e)}restartAnimation(){let e=this.next,s=this.parent;this.detach(),e?e.insertBefore(this):s.append(this)}detach(){this._el&&this._el.parentNode&&this._el.parentNode.removeChild(this._el)}remove(){this.detach()}removeChildren(){for(;this._el.firstChild;)this._el.removeChild(this._el.firstChild)}copy(e=!0){return ot(this._el.cloneNode(e))}on(e,s,t){for(let i of Lt(e))i in this._events?this._events[i].includes(s)||this._events[i].push(s):this._events[i]=[s],t0(this,i,s,t)}one(e,s,t){let i=r=>{this.off(e,i),s(r)};this.on(e,i,t)}off(e,s){for(let t of Lt(e))t in this._events&&(this._events[t]=s?this._events[t].filter(i=>i!==s):[]),e0(this,t,s)}trigger(e,s={}){for(let t of Lt(e)){if(!this._events[t])return;for(let i of this._events[t])i.call(this,s)}}onKey(e,s,t){e=e.replace("AllArrows","ArrowUp ArrowDown ArrowLeft ArrowRight");let i=new Set(Lt(e)),r=t!=null&&t.up?"keyup":"keydown";(this._el===document.body?document:this._el).addEventListener(r,n=>{var a,l;let c=Yr(n);(t!=null&&t.meta?!n.ctrlKey&&!n.metaKey:n.ctrlKey||n.metaKey)||!c||!i.has(c)||document.activeElement!==this._el&&((l=(a=document.activeElement)==null?void 0:a.shadowRoot)==null?void 0:l.activeElement)!==this._el&&R.formIsActive||s(n,c)})}onAttr(e,s){new MutationObserver(i=>{for(let r of i)r.type==="attributes"&&r.attributeName===e&&s(this.attr(e))}).observe(this._el,{attributes:!0}),s(this.attr(e),!0)}onPromise(e,s=!1){return s?Promise.resolve():new Promise(t=>this.one("solve",()=>t()))}animate(e,s=400,t=0,i="ease-in-out"){return oe(this,e,s,t,i)}enter(e="fade",s=500,t=0){return Gm(this,e,s,t)}exit(e="fade",s=500,t=0,i=!1){return _m(this,e,s,t,i)}effect(e){this.one("animationend",()=>this.removeClass(`effects-${e}`)),this.addClass(`effects-${e}`)}},Ks=class extends Eh{get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get offsetParent(){return ot(this._el.offsetParent||void 0)}get width(){return this._el.offsetWidth}get height(){return this._el.offsetHeight}get innerWidth(){let e=parseFloat(this.css("padding-left")),s=parseFloat(this.css("padding-right"));return this._el.clientWidth-e-s}get innerHeight(){let e=parseFloat(this.css("padding-bottom")),s=parseFloat(this.css("padding-top"));return this._el.clientHeight-e-s}get outerWidth(){let e=parseFloat(this.css("margin-left")),s=parseFloat(this.css("margin-right"));return this.width+e+s||0}get outerHeight(){let e=parseFloat(this.css("margin-bottom")),s=parseFloat(this.css("margin-top"));return this.height+e+s||0}get positionTop(){let e=this._el,s=0;for(;e;)s+=e.offsetTop,e=e.offsetParent;return s}get positionLeft(){let e=this._el,s=0;for(;e;)s+=e.offsetLeft,e=e.offsetParent;return s}offset(e){if(e._el===this._el.offsetParent){let s=this.offsetTop+e._el.clientTop,t=this.offsetLeft+e._el.clientLeft,i=s+this.height,r=t+this.width;return{top:s,left:t,bottom:i,right:r}}else{let s=e._el.getBoundingClientRect(),t=this._el.getBoundingClientRect();return{top:t.top-s.top,left:t.left-s.left,bottom:t.bottom-s.top,right:t.right-s.left}}}},Vh=class extends Eh{constructor(){super(...arguments),this.type="svg"}get $ownerSVG(){return ot(this._el.ownerSVGElement||void 0)}get width(){return this.bounds.width}get height(){return this.bounds.height}get positionLeft(){let e=this._el.getBBox().x+this._el.getCTM().e;return this.$ownerSVG.positionLeft+e}get positionTop(){let e=this._el.getBBox().y+this._el.getCTM().f;return this.$ownerSVG.positionTop+e}get inverseTransformMatrix(){let e=this._el.getScreenCTM().inverse(),s=[[e.a,e.c,e.e],[e.b,e.d,e.f]];if(R.isFirefox){let t=this.transformMatrix;s[0][2]-=t[0][2],s[1][2]-=t[1][2]}return s}setTransform(e,s=0,t=1){let i=e?`translate(${tt(e.x,.1)} ${tt(e.y,.1)})`:"",r=E(s,0)?"":`rotate(${s*180/Math.PI})`,o=E(t,1)?"":`scale(${t})`;this.setAttr("transform",[i,r,o].join(" "))}get strokeLength(){if(this._el instanceof SVGGeometryElement)return this._el.getTotalLength();{let e=this.bounds;return 2*e.height+2*e.width}}getPointAtLength(e){if(this._el instanceof SVGGeometryElement){let s=this._el.getPointAtLength(e);return new d(s.x,s.y)}else return new d(0,0)}getPointAt(e){return this.getPointAtLength(e*this.strokeLength)}get points(){return Ws(this.attr("d"))}set points(e){let s=e.length?`M${e.map(t=>`${t.x},${t.y}`).join("L")}`:"";this.setAttr("d",s)}addPoint(e){let s=`${this.attr("d")} L ${e.x},${e.y}`;this.setAttr("d",s)}get center(){let e=+this.attr(this.tagName==="TEXT"?"x":"cx"),s=+this.attr(this.tagName==="TEXT"?"y":"cy");return new d(e,s)}setCenter(e){this.setAttr(this.tagName==="TEXT"?"x":"cx",e.x),this.setAttr(this.tagName==="TEXT"?"y":"cy",e.y)}setLine(e,s){this.setAttr("x1",e.x),this.setAttr("y1",e.y),this.setAttr("x2",s.x),this.setAttr("y2",s.y)}setRect(e){this.setAttr("x",e.p.x),this.setAttr("y",e.p.y),this.setAttr("width",e.w),this.setAttr("height",e.h)}draw(e,s={}){if(!e)return this.setAttr("d","");let t={};for(let i of["mark","arrows","round"])this.hasAttr(i)&&(t[i]=this.attr(i));this.hasClass("fill")&&(t.fill="fill"),this.hasAttr("size")&&(t.size=+this.attr("size")||void 0),this.setAttr("d",Gt(e,Object.assign(s,t)))}},u0=class extends Vh{get viewBox(){return this._el.viewBox.baseVal||{width:0,height:0}}get $ownerSVG(){return this}get positionLeft(){return parseInt(this.css("margin-left"))+this.parent.positionLeft}get positionTop(){return parseInt(this.css("margin-top"))+this.parent.positionTop}get svgWidth(){return this.viewBox.width||this.width}get svgHeight(){return this.viewBox.height||this.height}drawPath(e,s={},t={}){let i=h("path",s,this);return i.draw(e,t),i}image(e,s,t,i){return Me(this,null,function*(){let r=this.copy(!0);Ah(this._el,r._el),e==="svg"&&Mh(r._el),t||(t=s||this.svgHeight),s||(s=this.svgWidth),r.setAttr("width",s),r.setAttr("height",t),r.setAttr("viewBox",i||this.attr("viewBox")||`0 0 ${this.svgWidth} ${this.svgHeight}`),r.setAttr("xmlns","http://www.w3.org/2000/svg");let o=r.$$("image");if(e==="svg")for(let p of o)p.setAttr("href",new URL(p.attr("href"),location.href));else yield Promise.all(o.map(p=>Me(this,null,function*(){p.setAttr("href",yield w0(p.attr("href")))})));let n=new XMLSerializer().serializeToString(r._el),a=`data:image/svg+xml;utf8,${encodeURIComponent(n)}`;if(e==="svg")return a;let l=h("canvas",{width:s,height:t});e==="jpg"&&(l.ctx.fillStyle="white",l.ctx.fillRect(0,0,s,t));let c=yield Fo(a);return l.ctx.drawImage(c,0,0,s,t),l.image(e)})}downloadImage(e,s,t,i){let r=R.isIOS?window.open("","_blank"):void 0,o=R.theme.isDark;o&&R.setTheme("light");let n=e.endsWith(".jpg")?"jpg":e.endsWith(".svg")?"svg":"png",a=this.image(n,s,t,i);o&&R.setTheme("dark"),a.then(l=>{if(r)return r.location.href=l;h("a",{download:e,href:l,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))})}},Dh=class extends Ks{constructor(){super(...arguments),this.type="window"}get width(){return window.innerWidth}get height(){return window.innerHeight}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get outerWidth(){return window.outerWidth}get outerHeight(){return window.outerHeight}get scrollWidth(){return document.body.scrollWidth}get scrollHeight(){return document.body.scrollHeight}get scrollTop(){return window.pageYOffset}set scrollTop(e){document.body.scrollTop=document.documentElement.scrollTop=e,this.trigger("scroll",{top:e,left:this.scrollLeft})}get scrollLeft(){return window.pageXOffset}set scrollLeft(e){document.body.scrollLeft=document.documentElement.scrollLeft=e,this.trigger("scroll",{top:this.scrollTop,left:e})}},f0=class extends Ks{constructor(){super(...arguments),this.type="form"}get action(){return this._el.action}get formData(){let e={};for(let s of Array.from(this._el.elements)){let t=s.name||s.id;t&&(e[t]=s.value)}return e}get isValid(){return this._el.checkValidity()}},m0=class extends Ks{constructor(){super(...arguments),this.type="input"}get checked(){return this._el.checked||!1}set checked(e){this._el.checked=e}get value(){return this._el.value}set value(e){this._el.value=e}bindVariable(e,s){if(this._el.type==="checkbox"){let t=s.startsWith("!"),i=r=>t?!r:r;t&&(s=s.slice(1)),e[s]!==void 0?this.checked=i(e[s]):this.hasAttr("checked")&&(e[s]=i(this.checked)),this.on("change",()=>e[s]=i(this.checked)),e.watch(()=>this.checked=i(e[s]));return}if(this._el.type==="number"){let t=this.hasAttr("min")?+this.attr("min"):-1/0,i=this.hasAttr("max")?+this.attr("max"):1/0;this.change(r=>{r&&(e[s]=M(+r,t,i))})}else this.change(t=>e[s]=t);e[s]!==void 0?this.value=e[s]:this.value&&(e[s]=this.value),this.on("blur",()=>this.value=e[s]),e.watch(()=>{document.activeElement!==this._el&&(this.value=e[s])})}setInputPattern(e){if(isNaN(+e))return;let s=e.match(/^[0-9]+$/);this.setAttr("inputmode",s?"numeric":"decimal"),s&&this.setAttr("pattern","[0-9]*")}change(e){let s=this.value||"";this.on("focus",()=>s=this.value),this.on("change keyup input paste",t=>{this.value!==s&&(s=this.value,e(s))})}validate(e){this.change(s=>this.setValidity(e(s)))}setValidity(e){this._el.setCustomValidity(e)}get isValid(){return this._el.checkValidity()}},g0=class extends Ks{constructor(){super(...arguments),this.type="canvas"}getContext(e="2d",s={}){return this._el.getContext(e,s)}image(e="png"){return this._el.toDataURL(e==="png"?"image/png":"image/jpeg")}get canvasWidth(){return this._el.width}get canvasHeight(){return this._el.height}get ctx(){return this._ctx||(this._ctx=this.getContext()),this._ctx}draw(e,s={}){this.ctx.save(),Qa(this.ctx,e,s),this.ctx.restore()}clear(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight)}fill(e){this.ctx.save(),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvasWidth,this.canvasHeight),this.ctx.restore()}clearCircle(e,s){this.ctx.save(),this.ctx.globalCompositeOperation="destination-out",this.ctx.beginPath(),this.ctx.arc(e.x,e.y,s,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.restore()}downloadImage(e){let s=this.image(e.endsWith(".jpg")?"jpg":"png");h("a",{download:e,href:s,target:"_blank"})._el.dispatchEvent(new MouseEvent("click",{view:window,bubbles:!1,cancelable:!0}))}},v0=class extends Ks{play(){return this._el.play()||Promise.resolve()}pause(){return this._el.pause()}},Lh=["path","rect","circle","ellipse","polygon","polyline","g","defs","marker","line","text","tspan","pattern","mask","svg","foreignObject","image","use","clipPath"];function ot(e,s){if(!e)return;let t=s?s._el:document.documentElement,i=typeof e=="string"?t.querySelector(e):e;if(!i)return;if(i._view)return i._view;let r=(i.tagName||"").toLowerCase();return r==="svg"?new u0(i):r==="canvas"?new g0(i):r==="form"?new f0(i):r==="input"||r==="select"||r==="textarea"?new m0(i):r==="video"||r==="audio"?new v0(i):Lh.includes(r)?new Vh(i):new Ks(i)}function nl(e,s){let t=s?s._el:document.documentElement,i=e?t.querySelectorAll(e):[];return Array.from(i,r=>ot(r))}function h(e,s={},t){let i=Lh.includes(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);for(let[o,n]of Object.entries(s))n!==void 0&&(o==="id"?i.id=n:o==="html"?i.innerHTML=n:o==="text"?i.textContent=n:o==="path"?i.setAttribute("d",Gt(n)):i.setAttribute(o,n));let r=ot(i);return t&&t.append(r),r}var at=new Dh(document.body),ps=new Dh(document.documentElement);function y0(e){let s=[];for(let t of Object.keys(e)){let i=e[t];if(t=encodeURIComponent(t),i==null){s.push(t);continue}i=Array.isArray(i)?i.join(","):`${i}`,i=i.replace(/(\r)?\n/g,`\r
`),i=encodeURIComponent(i),i=i.replace(/%20/g,"+"),s.push(`${t}=${i}`)}return s.join("&")}function b0(e,s){return Me(this,null,function*(){let t=s instanceof FormData,i={method:"POST",body:t?s:s?y0(s):void 0,headers:{"X-CSRF-Token":window.csrfToken||""}};t||(i.headers["Content-Type"]="application/x-www-form-urlencoded");let r=e.includes("?")?"&xhr=1":"?xhr=1",o=yield fetch(e+r,i);if(!o.ok)throw new Error(`Fetch error ${o.status}: ${e}`);return o.text()})}function Fo(e,s=!1){return new Promise(t=>{let i=new Image;s||(i.crossOrigin="Anonymous"),i.onload=()=>t(i),i.src=e})}var w0=Zt(e=>Me(void 0,null,function*(){let s=yield Fo(e),t=h("canvas",{width:s.width,height:s.height});return t.ctx.drawImage(s,0,0,s.width,s.height),t.image("png")})),Kr=new Map;function x0(e,s){Kr.has(e)?Oa(Kr.get(e),s,(t,i)=>re(t.concat(i))):Kr.set(e,s)}function Oh(){if(window.navigator.onLine)for(let[e,s]of Kr)Kr.delete(e),b0(e,{data:JSON.stringify(s)}).catch(t=>{console.error("Failed to send POST request:",t),x0(e,s)})}var $0=Yi(Oh,5e3);window.addEventListener("online",$0);window.onbeforeunload=Oh;var be=class{constructor(e,s=1,t=!0){this.src=e,this.defaultVolume=s,this.player=new Audio,this.player.src=e,t&&(this.player.preload="auto")}play(e){this.player.currentTime=0,this.player.volume=e||this.defaultVolume,this.player.play()}},P0=_c(["#cd0e66","#0f82f2","#22ab24","#fd8c00"]),T0=class{constructor(e){this.index=e,this.color=P0(),this.tilt=Math.floor(Math.random()*10)-10,this.tiltAngleIncrement=Math.random()*.07+.05,this.tiltAngle=0,this.x=Math.random()*R.width,this.y=(Math.random()-1)*R.height,this.r=vt.uniform(10,30)}draw(e){e.beginPath(),e.lineWidth=this.r/2,e.strokeStyle=this.color,e.moveTo(this.x+this.tilt+this.r/4,this.y),e.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),e.stroke()}update(e,s){this.tiltAngle+=this.tiltAngleIncrement,this.y+=(Math.cos(e)+3+this.r/2)/2,this.x+=Math.sin(e),this.tilt=Math.sin(this.tiltAngle-this.index/3)*15,this.x<-20?(this.x=-20,this.y=Math.random()*R.height,this.tilt=Math.floor(Math.random()*10)-20):this.x>R.width+20?(this.x=R.width+20,this.y=Math.random()*R.height,this.tilt=Math.floor(Math.random()*10)-20):s&&this.y>R.height&&(this.x=Math.random()*R.width,this.y=-10,this.tilt=Math.floor(Math.random()*10)-20)}},S0="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999",Zs=void 0;function Rh(e=2e3,s=150){Zs||(Zs=h("canvas",{style:S0},at)),Zs.setAttr("width",R.width),Zs.setAttr("height",R.height),Zs.show();let t=Zs.ctx,i=I(o=>new T0(o),s),r=et(o=>{t.clearRect(0,0,R.width,R.height);let n=o<e,a=0;for(let l of i)l.draw(t),l.update(o,n),l.y<R.height&&(a+=1);a||(r.cancel(),Zs.hide())})}var qo=class extends As{constructor(e,s={}){super(),this.$el=e,this.startPos=new d(0,0),this.position=new d(0,0),this.disabled=!1,this.options=Object.assign({moveX:!0,moveY:!0,withinBounds:!0},s),R.onResize(()=>this.updateBounds()),Km(e,{start:()=>{this.disabled||(this.startPos=this.position,this.trigger("start"),ps.addClass("grabbing"))},move:(t,i)=>{this.disabled||(this.setPosition(this.startPos.x+t.x-i.x,this.startPos.y+t.y-i.y),this.trigger("drag",{posn:this.position,pointerPosn:t}),this.checkTarget(t))},end:(t,i)=>{this.disabled||(this.trigger(t.equals(i)?"click":"end",{$target:this.$over}),this.options.$targets&&!this.$over&&this.options.resetOnMiss&&this.resetPosition(),this.$over=void 0,ps.removeClass("grabbing"))},click:()=>this.trigger("click"),accessible:!0})}addTarget(e){var s;this.options.$targets||(this.options.$targets=[]),(s=this.options.$targets)==null||s.push(e)}removeTarget(e){var s,t;this.options.$targets=(s=this.options.$targets)==null?void 0:s.filter(i=>i!==e),(t=this.options.$targets)!=null&&t.length||(this.options.$targets=void 0)}checkTarget(e){if(!this.options.$targets)return;let s=this.options.$targets.find(t=>t.boundsRect.contains(e));s!==this.$over&&(this.$over&&this.trigger("exit-target",{$target:this.$over}),s&&this.trigger("enter-target",{$target:s}),this.$over=s)}updateBounds(){if(!this.options.withinBounds)return this.bounds=void 0;if(this.options.bounds)return this.bounds=this.options.bounds;let e=this.bounds,s=this.options.$parent||this.$el.parent,t=s.type==="svg"?s.svgWidth:s.width,i=s.type==="svg"?s.svgHeight:s.height;this.bounds=new bt(0,t,0,i),!t&&!i&&setTimeout(()=>this.updateBounds()),e&&this.setPosition(this.position.x*this.bounds.dx/e.dx||0,this.position.y*this.bounds.dy/e.dy||0)}setPosition(e,s){var t;let i=new d(this.options.moveX?e:0,this.options.moveY?s:0);this.bounds&&(i=i.clamp(this.bounds,(t=this.options.margin)!=null?t:0)),i=i.round(this.options.snap||1),this.options.round&&(i=this.options.round(i)),!i.equals(this.position)&&(this.position=i,this.options.useTransform?this.$el.translate(i.x,i.y):(this.options.moveX&&this.$el.css("left",`${i.x}px`),this.options.moveY&&this.$el.css("top",`${i.y}px`)),this.trigger("move",{posn:i}))}resetPosition(e=250){return Me(this,null,function*(){let s=this.position;this.$el.css({"pointer-events":"none"}),yield et(t=>{let i=d.interpolate(s,this.startPos,t);this.setPosition(i.x,i.y)},e).promise,this.$el.css({"pointer-events":"initial"})})}},k0="position: fixed; top: 0; left: 0; width: 100%; height: 4px; background: #0f82f2; pointer-events: none; z-index: 9999; will-change: transform;";function Th(e,s){let t=s.regex.exec(e);if(t){t.shift();let i={};for(let[r,o]of s.params.entries())i[o]=t[r];return i}else return}function C0(e,s,t){return Me(this,null,function*(){return e.template?typeof e.template=="string"?e.template:e.template(s):(yield fetch(t+(t.indexOf("?")>=0?"&xhr=1":"?xhr=1"))).text()})}var Ih=document.readyState==="complete";window.addEventListener("load",()=>setTimeout(()=>Ih=!0));"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");var M0=class extends As{constructor(){super(...arguments),this.$viewport=at,this.views=[],this.active={path:"",hash:""},this.preloaded=!1,this.transition=!1,this.noLoad=!1,this.initialise=()=>{}}setup(e={}){e.$viewport&&(this.$viewport=e.$viewport),e.initialise&&(this.initialise=e.initialise),e.preloaded&&(this.preloaded=e.preloaded),e.transition&&(this.transition=e.transition),e.noLoad&&(this.noLoad=e.noLoad),e.click&&at.on("click",s=>this.onLinkClick(s)),e.history&&window.addEventListener("popstate",s=>Me(this,null,function*(){var t;if(!Ih||!((t=s.state)!=null&&t.path))return;(yield this.load(s.state.path,s.state.hash))||window.history.pushState(this.active,"",this.active.path+this.active.hash)}))}view(e,{enter:s,exit:t,template:i}={}){let r=(e.match(/:\w+/g)||[]).map(u=>u.substr(1)),o=`${e.replace(/:\w+/g,"([\\w-]+)").replace("/","\\/")}\\/?`,n=e.includes("?")?"":"(\\?.*)?",l={regex:new RegExp(`^${o}${n}$`,"i"),params:r,enter:s,exit:t,template:i};this.views.push(l);let c=window.location.pathname+window.location.search,p=Th(c,l);p&&(this.active={path:c,hash:window.location.hash},window.history.replaceState(this.active,"",this.active.path+this.active.hash),R.ready(()=>{setTimeout(()=>{this.preloaded?(this.initialise(this.$viewport,p),l.enter&&l.enter(this.$viewport,p)):this.loadView(l,p)})}))}paths(...e){for(let s of e)this.view(s)}getView(e){for(let s of this.views){let t=Th(e,s);if(t)return{view:s,params:t}}}load(e,s){return Me(this,null,function*(){if(e===this.active.path&&s!==this.active.hash)return this.trigger("hashChange",s.slice(1)),this.trigger("change",e+s),this.active={path:e,hash:s},!0;let t=this.getView(e);return!t||this.beforeChange&&!(yield this.beforeChange())?!1:(this.active={path:e,hash:s},this.trigger("change",e+s),window.ga&&window.ga("send","pageview",e+s),this.noLoad?t.view.enter&&t.view.enter(this.$viewport,t.params):this.loadView(t.view,t.params),!0)})}loadView(e){return Me(this,arguments,function*(s,t={}){this.showLoadingBar();let i=this.active.path,r=yield C0(s,t,i);if(this.active.path!==i)return;yield this.$viewport.animate({opacity:0},200).promise,this.$viewport.removeChildren(),at.scrollTop=0,this.$viewport.html=r,R.resize(),Lm(),this.$viewport.animate({opacity:1},200),this.hideLoadingBar();let o=this.$viewport.$("title");o&&(document.title=o.text),this.initialise(this.$viewport,t),s.enter&&s.enter(this.$viewport,t),this.trigger("afterChange",{$viewport:this.$viewport})})}onLinkClick(e){if(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)return;let s=e.target;for(;s&&s.nodeName!=="A";)s=s.parentNode;if(!s||s.nodeName!=="A")return;let t=s;if(t.target||t.origin!==window.location.origin||t.hasAttribute("download")||t.getAttribute("rel")==="external")return;let i=t.getAttribute("href");i&&i.indexOf("mailto:")>-1||this.getView(t.pathname+t.search)&&(e.preventDefault(),this.goTo(t.pathname+t.search,t.hash))}goTo(e,s=""){return Me(this,null,function*(){let t=this.active.path+this.active.hash;(yield this.load(e,s))&&t!==this.active.path+this.active.hash&&window.history.pushState(this.active,"",e+s)})}replace(e,s=""){this.active={path:e,hash:s},window.history.replaceState(this.active,"",e+s)}back(){window.history.back()}forward(){window.history.forward()}showLoadingBar(){this.$loadingBar||(this.$loadingBar=h("div",{style:k0},at)),this.$loadingBar.css({transform:"translateX(-100%)",opacity:1}),this.$loadingBar.show(),this.animation=et(e=>{this.$loadingBar.css("transform",`translateX(-${10+90*Math.exp(-4*e)}%)`)},3e3)}hideLoadingBar(){return Me(this,null,function*(){var e,s,t;(e=this.animation)==null||e.cancel(),yield(s=this.$loadingBar)==null?void 0:s.animate({transform:"none",opacity:0}).promise,(t=this.$loadingBar)==null||t.hide()})}},al=new M0;function A0(e,s){let t=Array.from(e.childNodes);e.innerHTML=s;let i={};for(let r of Array.from(e.querySelectorAll("slot")))i[r.getAttribute("name")||""]=r;for(let r of t){let o=r.getAttribute&&r.getAttribute("slot")||"",n=i[o]||i[""];n&&n.parentNode.insertBefore(r,n)}for(let r of Object.values(i))r.parentNode.removeChild(r)}function Nh(e){let s=[];for(let t of Array.from(e.children))t.tagName.startsWith("X-")?s.push(t):s.push(...Nh(t));return s}var Gh=new Map,E0=class extends HTMLElement{constructor(){super(...arguments),this.wasConnected=!1,this.isReady=!1}connectedCallback(){return Me(this,null,function*(){if(this.wasConnected){this._view.trigger("connected");return}this.wasConnected=!0,this.isReady=!1,this._view.created();let e=Gh.get(this._view.tagName)||{};e.template&&A0(this,e.template);let s=Nh(this).filter(t=>!t.isReady).map(t=>new Promise(i=>t.addEventListener("ready",i)));yield Promise.all(s),this._view.ready(),this.dispatchEvent(new CustomEvent("ready")),this.isReady=!0})}disconnectedCallback(){this._view.trigger("disconnected")}},lt=class extends Ks{created(){}ready(){}},ll=new Map;function ct(e,s={}){return function(t){if(window.customElements.get(e)){console.warn(`Trying to declare the custom element ${e} twice!`);return}class i extends E0{constructor(){super(),this._view=new t(this)}}ll.set(e,t),Gh.set(e.toUpperCase(),s),window.customElements.define(e,i)}}var Tt=new AudioContext,Uo,ds,us=.05,Hh="https://mathigon.org/polypad/assets/audio/instruments/",cl=new Map,Fh=new Map,_h=!1;function V0(){return H(this,null,function*(){if(_h)return;_h=!0,ds=Tt.createDynamicsCompressor(),ds.threshold.setValueAtTime(-5,0),ds.knee.setValueAtTime(.4,0),ds.ratio.setValueAtTime(10,0),ds.attack.setValueAtTime(.1,0),ds.release.setValueAtTime(.25,0),Uo=Tt.createConvolver();let s=yield(yield fetch(`${Hh}IR13.mp3`)).arrayBuffer();Uo.buffer=yield Tt.decodeAudioData(s)})}function jo(e){if(!e||e==="synth"||cl.has(e))return;let s=fetch(`${Hh}${e}.mp3`).then(t=>t.arrayBuffer()).then(t=>Tt.decodeAudioData(t)).then(t=>Fh.set(e,t)).catch(()=>console.error("Unable to load sample for",e));cl.set(e,s)}var rr=()=>Tt.currentTime,qh=[{key:"piano",label:""},{key:"marimba",label:""},{key:"bass",label:""},{key:"synth",label:""},{key:"aguitar",label:""},{key:"eguitar",label:""},{key:"violin",label:""},{key:"cello",label:""},{key:"kick",label:""},{key:"tom-high",label:""},{key:"tom-low",label:""},{key:"snare",label:""},{key:"hihat-open",label:""},{key:"hihat-closed",label:""},{key:"ride",label:""},{key:"crash",label:""},{key:"cowbell",label:""},{key:"clap",label:""},{key:"shaker",label:""},{key:"woodblock",label:""},{key:"cow",label:""},{key:"bark",label:""},{key:"duck",label:""},{key:"honk",label:""},{key:"boing",label:""}],D0=new Set(["kick","tom-high","floor-tom","snare","cowbell","woodblock","clap","shaker"]),L0=440*2**(-9/12),pl=["C","Db","D","Eb","E","F","Gb","G","Ab","A","Bb","B"],O0=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],zh=[0,1,0,1,0,1,1,0,1,0,1,1],Xr={major:[0,2,4,5,7,9,11],minor:[0,2,3,5,7,8,10],blues:[0,3,5,6,7,10],pentatonic:[0,2,4,7,9],chromatic:Se(12)};function Wo(e,s){let t=Xr[e],i=K(s,t.length);return Math.round((s-i)/t.length)*12+t[i]}function Ko(e,s,t=0){return((e==="major"?!zh[K(t,12)]:e==="minor"?!zh[K(t+3,12)]:!1)?O0:pl)[K(s,12)]}function Yo(e=0){let s=pl[K(e,12)],t=Math.floor(e/12);return t?`${s}${t+4}`:s}function Xo(e=""){if(!Number.isNaN(+e))return+e;let s=/^([a-g])([#b]?)\s*(\d)?$/.exec(e.toLowerCase().trim());if(!s)return 0;let t=pl.indexOf(s[1].toUpperCase())+(s[2]==="b"?-1:s[2]==="#"?1:0),i=s[3]?+s[3]-4:0;return t+12*i}function Uh(e,s,t){let i=Tt.createGain();i.connect(ds),i.connect(Uo).connect(ds).connect(Tt.destination);let r=e+1e-5;return i.gain.setValueAtTime(1e-5,r),i.gain.linearRampToValueAtTime(s,r+=t[0]),i.gain.linearRampToValueAtTime(s*.8,r+=t[1]),i.gain.setValueAtTime(s*.8,r+=t[2]),i.gain.linearRampToValueAtTime(1e-5,r+t[3]),i}function Zo(e,s="piano"){if(e===void 0)return 0;if(s==="synth")return L0*2**(e/12);let t=s==="piano"?-1:s==="bass"?1:0;return 2**((e+1)/12+t)||0}function R0(e,s,t,i,r){let o=Fh.get(e);if(!o)throw new Error(`Missing audio sample: ${e}`);let n=Uh(t,i,r),a=Tt.createBufferSource(),l=Zo(s,e);a.playbackRate.value=l,a.buffer=o,a.connect(n),a.start(t);let c=[a],p=a.buffer.duration/l,u=p*.5>1.5?.8:p*.5,f=r[2]/.6,v=f/u;if(f>1.1&&!D0.has(e))for(let m=1;m<v;++m){let g=Tt.createBufferSource();g.playbackRate.value=l,g.buffer=o;let b=Tt.createGain(),x=t+u*m+1e-5;b.gain.setValueAtTime(1e-5,x),b.gain.setValueAtTime(1e-5,x+.05*p);let k=e==="violin"||e==="cello"?1:2;b.gain.linearRampToValueAtTime(i+k,x+.4*p),g.connect(b).connect(n).connect(Uo).connect(ds).connect(Tt.destination),g.start(t+m*u),c.push(g)}for(let m of c)m.stop(t+f+1);return c}function I0(e,s,t,i,r,o){let n=Uh(s,t,i),a=Tt.createGain(),l=_(i)+.01,c=Tt.createOscillator();c.type="triangle",c.connect(n),c.frequency.setValueAtTime(Zo(e,"synth"),s),c.start(s),c.stop(s+l);let p=s+1e-5;a.gain.setValueAtTime(1e-5,p),a.gain.linearRampToValueAtTime(t/2,p+=i[0]),a.gain.linearRampToValueAtTime(t/2*.8,p+=i[1]),a.gain.setValueAtTime(t/2*.8,p+=i[2]),a.gain.linearRampToValueAtTime(1e-5,p+i[3]);let u=Tt.createGain();u.connect(c.frequency),u.gain.setValueAtTime(r,Tt.currentTime);let f=Tt.createOscillator();return f.type="sawtooth",f.connect(u),f.frequency.setValueAtTime(o,Tt.currentTime),f.start(Tt.currentTime),f.stop(s+l),c}function Zh(e=0,s="piano",t=1,i=.8,r=Tt.currentTime+us,o=2,n=8){V0();let a=Math.min(1,i),l=[.02,a*.1,i-a*.4,a*.3];return s!=="synth"?R0(s,e,r,t/6,l):I0(e,r,t/6,l,o||2,n||8)}function Jo(e=0,s="piano",t=1,i=.8){return H(this,null,function*(){s!=="synth"&&(yield cl.get(s)),Zh(e,s,t,i)})}var Qt=class{constructor(s,t){this.tile=s;this.setup=t;this.isPlaying=!1;this.start=0;this.duration=1;this.lastBeat=-1;this.tempo=1;this.stopCont=new Set;s.props.watch("sound arpeggio note modGain modFreq",()=>this.stop())}play(s=Tt.currentTime+us,t=1){if(!this.setup)return 0;this.isPlaying&&this.stop(),this.isPlaying=!0,this.tempo=(this.tile.props.tempo||1)*t;let i=this.tile.props.note||0;if(this.currentData=this.setup(i,this.tempo),!this.currentData.beats.length)return this.isPlaying=!1,this.currentData=void 0,0;let r=z(this.currentData.beats);return this.duration=(r.time+r.duration)/this.tempo,this.start=s,this.lastBeat=-1,Bh.add(this),this.duration}stop(){var s,t;if(this.isPlaying){Bh.remove(this),window.clearInterval(this.timeout),this.isPlaying=!1,(t=(s=this.currentData).end)==null||t.call(s);for(let i of this.stopCont)i.stop();this.stopCont.clear(),this.currentData=void 0,this.tile.$parent.selection.update()}}tick(){var n,a;let s=Tt.currentTime,t=this.currentData.beats,i=(s-this.start)*this.tempo,r=t.findIndex(l=>l.time>=i);r<0&&(r=t.length-1);for(let l=this.lastBeat+1;l<=r;++l)this.processStep(l);(a=(n=this.currentData).tick)==null||a.call(n,i<0?0:i);let o=this.start+this.duration-s;this.lastBeat>=t.length-1&&o<=0&&this.stop()}processStep(s){var l,c;let t=this.currentData.beats[s],i=this.start+t.time/this.tempo;if(i>Tt.currentTime+us)return;let r=((l=this.tile.props.volume)!=null?l:1)+((c=t.volume)!=null?c:0),o=t.duration/this.tempo,n=t.sound||this.tile.props.sound||"piano";if(t.note instanceof Function)this.playContinuous(t.note,n,i,o,r);else{let p=Array.isArray(t.note)?t.note:[t.note];for(let u of p)this.playNote(u,n,i,o,r)}let a=i-Tt.currentTime;this.timeout=Bs(()=>{var p,u;return(u=(p=this.currentData).step)==null?void 0:u.call(p,s)},a*1e3),this.lastBeat=s}playNote(s,t=this.tile.props.sound||"piano",i=Tt.currentTime+us,r=.8,o=this.tile.props.volume||1){return Zh(s,t,o,r,i,this.tile.props.modGain,this.tile.props.modFreq)}playContinuous(s,t,i,r,o){let n=this.playNote(Zo(s(0)),t,i,r,o),a=n instanceof OscillatorNode,l=1/60;for(let c=0;c<=r;c+=l){let p=i+c*this.tempo,u=Zo(s(c),t);if(a)n.frequency.setValueAtTime(u,p);else for(let f of n)f.playbackRate.setValueAtTime(u,p)}if(a)this.stopCont.add(n);else for(let c of n)this.stopCont.add(c)}},hl=class{constructor(){this.running=!1;this.tracks=new Set}add(s){this.tracks.add(s),this.running||(Tt.state!=="running"&&Tt.resume(),this.running=!0,this.tick(),requestAnimationFrame(()=>this.tick()))}remove(s){this.tracks.delete(s),this.tracks.size||(this.running=!1)}tick(){for(let s of this.tracks)s.tick();this.running&&requestAnimationFrame(()=>this.tick())}},Bh=new hl;var ht=Math.PI/2;function Qo(e){if(Mt(e))return[e];if(fe(e))return e.points;if(Rt(e))return[e.p1,e.p2];if(me(e))return Qo(e.shape(!0));if(yt(e))return[e.c.shift(e.r,0),e.c.shift(-e.r,0),e.c.shift(0,e.r),e.c.shift(0,-e.r)];if(Ds(e)||Oe(e)){let s=[e.start,e.end];Ds(e)&&s.push(e.c);let t=e.radius;for(let[i,r]of[[t,0],[0,t],[-t,0],[0,-t]]){let o=e.c.shift(i,r);ge.prototype.contains.call(e,o)&&s.push(o)}return s}return[]}function ut(...e){return S.aroundPoints(function*(){for(let s of e)for(let t of Qo(s))yield t}())}function en(e,s){let t=ut(...Array.from(e,r=>r.transformed.rotate(-s))),i=t.p.shift(t.w/2,t.h/2).rotate(s).shift(-t.w/2,-t.h/2);return new S(i,t.w,t.h)}function sn(e,s){return!e.size&&!s.size?new bt(0,100,0,100):S.aroundPoints(function*(){for(let t of e.values())if(t.transformed&&t.props.status!=="hidden")for(let i of Qo(t.transformed))yield i;for(let t of s.values())if(t.path)for(let i of Qo(t.path))yield i}()).bounds}function or(e,s,t){if(Mt(s))return e.contains(s);if(er(s))return D.collision(e.polygon,s);if(jr(s))return s.collision(e);if(Rt(s))return Ht(s,e).length>0||e.contains(s.p1);if(me(s))return or(e,s.shape(!0),t);if(yt(s))return t==="geo"?Ht(s,e).length>0||e.contains(s.at(0)):s.collision(e);if(Ds(s)){let i=new D(s.c,s.start,s.at(.25),s.at(.5),s.at(.75),s.end);return D.collision(e.polygon,i)}return!1}var tn=class{constructor(s){this.$parent=s;this.visible=!1;this.$el=h("div",{class:"tile-error",hidden:!0},s.$html),this.$text=h("span",{},this.$el),this.$button=h("button",{text:"Select Errors"},this.$el),this.$button.on("click",()=>{s.selection.clear(),this.error&&s.selection.select(this.error.locations),this.hide()})}show(s,t){this.visible&&this.error===t||(this.visible=!0,this.$el.setTransform(s),this.$text.html=t.message,this.$button.toggle(!!(t!=null&&t.locations.length)),this.$el.enter("pop",200),this.error=t)}hide(){this.visible&&(this.visible=!1,this.$el.exit("pop",200),this.error=void 0)}},dl=new Map;function te(e,s=!0){if(!e||!s||!R.theme.isDark)return e;if(dl.has(e))return dl.get(e);let t=G.fromHex(e),i=t.hsl;Y(i[2],30,70)||(i[2]=100-i[2]);let r=G.fromHsl(...i);r.a=t.a;let o=r.hex;return dl.set(e,o),o}var ul=new Map;function je(e){if(ul.has(e))return ul.get(e);let s=G.fromHex(e),[t,i,r]=["r","g","b"].map(n=>s[n]<=128?0:2*s[n]-255),o=new G(t,i,r).hex;return ul.set(e,o),o}function jh(e){let s=e==null?void 0:e.items;if(s!=null&&s.length)for(let t=0;t<s.length;++t){if(!s[t].type.startsWith("image/"))continue;let i=s[t].getAsFile();if(i)return i}}var N0=80,G0=[5,2,1];function Jr(e,s,t,i=.01){let r=e?e.split(","):[];if(r.length===3)return r.map(f=>+f);let o=r.length>0?+r[0]:t?t[0]:0,n=r.length>1?+r[1]:t?t[1]:s;if(E(o,n))return[o-1,n+1,1];i&&(n+=.01*(n-o));let a=Math.floor(Math.abs(s)/N0),l=(n-o)/a,c=Math.floor(Math.log10(l)),p=Math.pow(10,c),u=G0.find(f=>p*f<=l)*p;return n=u*Math.ceil(n/u),o=u*Math.floor(o/u),[o,n,u]}function rn(e,s=4e3){let t=ot(`x-alert[key=${e}]`);return t==null?void 0:t.open(s)}function Wh(e){var s;if(!["span","div","br","a"].includes(e.tagName.toLowerCase()))(s=e.parentElement)==null||s.removeChild(e);else{for(let t of Array.from(e.attributes))t.name==="style"?t.value=(t.value||"").replace(/[^\s\w%().:;-]/g,""):e.removeAttributeNode(t);for(let t of Array.from(e.children))Wh(t)}}function Kh(e){let t=new DOMParser().parseFromString(e,"text/html").body;for(let i of Array.from(t.children))Wh(i);return t.innerHTML}function on(e,s){let t=new d(-e/2,-s/2);return new S(t,e,s)}function fl(e,s,t){if(!e)return;let i={},r=0;for(let o of e){let n=s(o);if(n&&(i[o.id]=n,r+=1),t&&r>t)break}return r?i:void 0}var ml=C;function Qr(e,s,t,i,r){{let o=`translate(${(i==null?void 0:i.x)||0} ${(i==null?void 0:i.y)||0}) scale(${t/24})`;return h("g",{html:ml[e],fill:s,transform:o,style:"transform-origin: 0 0"},r)}}var _0=new Set(["watch","assign","updateTheme","raw"]);function Yh(e,s){let t=new Map,i=(a,l)=>{for(let c of Lt(a))t.has(c)||t.set(c,[]),t.get(c).push(l);l(n)},r=a=>{Object.assign(e,a);let l=re(Object.keys(a).flatMap(c=>{var p;return(p=t.get(c))!=null?p:[]}));for(let c of l)c(n)},o=()=>{var a;for(let l of(a=t.get("color"))!=null?a:[])l(n)},n=new Proxy(e,{get(a,l){switch(l){case"watch":return i;case"assign":return r;case"updateTheme":return o;case"raw":return e;case"copy":return()=>Object.assign({},e);case"zIndex":return e.zIndex||0;case"layer":return e.layer||"normal";case"color":return te(e.color,s.flipTheme);default:return e[l]}},set(a,l,c){var p;if(_0.has(l))return!1;if(e[l]===c)return!0;e[l]=c;for(let u of(p=t.get(l))!=null?p:[])u(n);return!0}});return n}function gl(e,s){let t={},i={},r=!1;for(let o of Object.keys(s))s[o]!==e[o]&&(r=!0,t[o]=s[o],i[o]=e[o]);return r?[i,t]:void 0}function Xh(e){let s=e.signedArea<0,t=0;for(let[r,o]of e.points.entries())o.y<e.points[t].y-1||o.x>e.points[t].x||(t=r);let i=Hs(e.points,t+(s?1:0));return s&&(i=i.reverse()),new D(...i)}function vl(e,s,t=0){let i=e.centroid.x,r=Math.max(...e.points.map(o=>o.y))+42+t;return h("text",{x:i,y:r,style:"font-size:25px"},s)}function z0(e,s,t,i){s.removeChildren();let r=e.is("polyomino"),o=Xh(e.path),n=o.edges,a=ls(n.map(A=>A.length)),l=z(a),c=je(e.props.color),p=I(A=>{let Z=e.props.arpeggio===!1?0:Wo("major",A),Q=(a[A-1]||0)*.01;return{note:t+Z,time:Q,duration:n[A].length*.01}},n.length),u=h("g",{filter:"url(#outline)"},s),f=h("g",{class:"axis-labels",fill:c},s),v=e.props.animation==="vertices"?9:6,m=h("path",{path:o,fill:"none",stroke:c,"stroke-width":5,opacity:1,hidden:!0},u),g=o.points.map(A=>h("circle",{cx:A.x,cy:A.y,r:v,fill:c,hidden:!0},u)),b,x,k;return e.props.animation==="vertices"?k=o.points.map((A,Z)=>h("text",{text:Z+1,x:A.x,y:A.y+5,fill:"white",hidden:!0},u)):e.props.labels==="number"&&(b=vl(o,f),x=n.map(A=>{let Z=A.perpendicularBisector,Q=Z.at(r?0:15/Z.length),V=A.length<45?12:15;return h("text",{text:Jt(A.length/50,1),x:Q.x,y:Q.y+5,hidden:!0,style:`font-size:${V}px`},f)})),{beats:p,step:A=>{A===0&&(m==null||m.enter("draw",10*l/i)),g==null||g[A].show(),k==null||k[A].show(),x==null||x[A].show(),b&&(b.textStr=Jt(a[A]/50,1))}}}function B0(e,s,t,i){s.removeChildren();let r=e.path.area/2500,o=t-12,n=r,a=je(e.props.color),l=h("clipPath",{id:`clip-${e.id}`},s),c=h("path",{path:S.aroundPoints(e.path.points)},l);e.$path.setAttr("id",`shape-${e.id}`),h("path",{path:e.path,"clip-path":`url(#clip-${e.id})`,fill:a,opacity:1},s);let p=h("g",{class:"axis-labels",fill:a},s),u=vl(e.path,p,-15);return{beats:[{note:m=>rt(o-r,o,m/n*i),duration:n,time:0}],tick:m=>{if(e.props.labels){let b=m/n,x=Jt(rt(0,r,b>.95?1:b),1);u.text=x>0?x+" units\xB2":""}let g=S.aroundPoints(e.path.points).h;c.css("transform",`translateY(${g*(1-m/n)}px)`)}}}function H0(e,s,t,i){s.removeChildren();let r=Xh(e.path),o=r.points.length,n=r.points.map((b,x)=>new Ot(r.points[K(x+1,o)],b,r.points[K(x-1,o)])),a=n.map(b=>b.deg),l=[0,...ls(a)],c=.42*Math.min(...r.edges.map(b=>b.length)),p=e.is("polyomino"),u=je(e.props.color),f=h("g",{class:"axis-labels",fill:u},s),v=vl(r,f);return{beats:a.map((b,x)=>({note:(e.props.arpeggio===!1?0:x)+t,duration:a[x]/90,time:l[x]/90})),step:b=>{let x=n[b],k=h("path",{fill:u});if(s.prepend(k),e.props.labels){let L=x.bisector,A=L.at(-12/L.length),Z=`font-size:${p?12:15}px`;h("text",{text:Jt(a[b])+"\xB0",x:A.x,y:A.y+5,style:Z},f)}et(L=>{let A=new Ot(x.arc.at(1-L),x.b,x.c);k.draw(A.shape(!0,c,!0)),e.props.labels&&(v.text=Math.round(rt(l[b],l[b+1],L))+"\xB0")},a[b]/90*1e3/i)}}}function Jh(e,s){let t=()=>{e.props.labels!=="number"&&s.removeChildren()};return new Qt(e,(i,r)=>{switch(e.props.animation){case"area":return it(U({},B0(e,s,i,r)),{end:t});case"angles":return it(U({},H0(e,s,i,r)),{end:t});default:return it(U({},z0(e,s,i,r)),{end:t})}})}var Qh=6,F0="M8.1-1.7l-14-8.8c-0.6-0.4-1.4-0.4-2-0.1c-0.6,0.4-1,1-1,1.7V8.8c0,0.7,0.4,1.4,1,1.7c0.3,0.2,0.6,0.3,1,0.3c0.4,0,0.7-0.1,1.1-0.3l14-8.8C8.6,1.3,9,0.7,9,0S8.6-1.3,8.1-1.7z",to=!1;function tp(e){if(!Array.isArray(e))return tp([e,0]);let[s,t]=e;if(s instanceof d)return[[s,t]];if(yt(s)&&(s=new S(s.c.shift(-s.r),2*s.r,2*s.r)),!(s instanceof D)&&!(s instanceof S))return[[P,0]];let i=s.edges.map(r=>[r.midpoint,r.perpendicularBisector.angle]).filter(r=>!E(r[1],1.5*Math.PI));return Hs(i,t)}var nn=class{constructor(s,t,i){this.tile=s;this.name=t;this.options={};this.cables=new Set;i&&this.setOptions(i)}get location(){let s=this.options.location;return Array.isArray(s)?s[0]:s}get type(){return(this.location||this.tile.path)instanceof d?"POINT":"REGION"}get points(){let s=this.options.location||this.tile.path||P;return tp(s).map(t=>[this.tile.worldPosn(t[0]),t[1]])}setOptions(s,t=!0){Object.assign(this.options,s),t&&this.redraw()}redraw(){for(let s of this.cables)s.redraw()}},an=class extends nn{sendMessage(s){this.cables.size===0&&this.redraw();for(let t of this.cables.values())t.enqueueMessage(s,!1);ep()}addCable(s,t=!1){this.cables.add(s),!s.to&&!s.dragging&&this.cables.size>1&&this.removeCable(s,!1),t&&(this.tile.updateCableProps(),this.tile.$parent.change({changed:[this.tile]})),this.redraw()}removeCable(s,t=!0){this.cables.delete(s),s.delete(),t&&this.redraw(),this.tile.updateCableProps()}redraw(){if(Xt(this.cables,s=>s.to))for(let s of this.cables)!s.to&&!s.dragging&&this.removeCable(s);this.cables.size||this.addCable(new he(this)),super.redraw()}delete(){for(let s of this.cables)s.delete()}},ln=class extends nn{setOptions(t,i=!0){Object.assign(this.options,t);let r=Array.isArray(t.location)?t.location[0]:t.location;r instanceof d?this.$dot=h("circle",{class:"link-dot persist",r:Qh,cx:r.x,cy:r.y},this.tile.$el):this.$dot&&this.$dot.remove(),i&&this.redraw()}addCable(t,i){i&&this.tile.highlight(!0),this.cables.add(t),this.options.connect&&this.options.connect(t)}removeCable(t,i){var r,o;i&&this.tile.highlight(!1),(o=(r=this.options).disconnect)==null||o.call(r,t),this.cables.delete(t)}delete(){for(let t of this.cables)t.from.removeCable(t)}validateConnection(t){return wl(t,this)}},bl=[],yl=!1;function ep(){var s,t;if(yl)return;yl=!0;let e=0;for(;bl.length;){if(e>=1e4)throw new Error("Queue overflow!");let[i,r]=bl.shift();(s=i.to)!=null&&s.options.message&&((t=i.to)==null||t.options.message(r,i)),e++}yl=!1}function wl(e,s){if(e.tile===s.tile||s.options.max&&[...s.cables].filter(o=>o.from!==e||o.to!==s).length>=s.options.max)return!1;let t=s.options.tileTypes;if(t){let r=e.tile.props.name;if(!t.includes(r))return!1}let i=e.options.tileTypes;if(i){let r=s.tile.props.name;if(!i.includes(r))return!1}return!0}var he=class{constructor(s,t){this.from=s;this.dragging=!1;let i=this.from.tile.$parent,r=s.options.persistent?"":"dashed";this.$group=h("g",{class:"link-bar",style:"display:none"},s.tile.$el),this.$line=h("path",{style:"pointer-events: none",class:r},this.$group),this.$originDot=h("circle",{class:"link-dot",r:Qh},this.$group),this.$handle=h("path",{class:"link-handle",d:F0},this.$group),this.connectTo(t),i.events.listen(this.$handle,{start:()=>{i.selection.add(s.tile,!0),to=this.dragging=!0},move:({posn:n})=>{this.connectTo(i.getInputAt(n,this.from),n)},end:()=>{to=this.dragging=!1,this.to&&this.to.tile.highlight(!1),this.redraw(),s.addCable(this,!0)},click:()=>{this.connectTo(),s.addCable(this,!0)}});let o;i.events.listen(this.$originDot,{start:()=>{i.selection.add(s.tile,!0),o=new he(this.from),to=o.dragging=!0,this.from.addCable(o)},move:({posn:n})=>{o.connectTo(i.getInputAt(n,this.from),n)},end:()=>{o.to&&o.to.tile.highlight(!1),o.redraw(),to=o.dragging=!1,s.addCable(o,!0),o=void 0}})}connectTo(s,t){this.to&&this.to!==s&&this.to.removeCable(this,!0),s?this.to!==s&&wl(this.from,s)&&(this.to=s,s.addCable(this,t!==void 0),this.from.options.connect&&this.from.options.connect(this)):this.to=void 0,this.redraw(t)}redraw(s){var m;if(!(this.from.options.persistent||this.from.tile.isActive||((m=this.to)==null?void 0:m.tile.isActive)))return this.$group.hide();if(this.from.tile.$el.append(this.$group),this.$group.show(),!this.to&&!s){let[g,b]=this.from.points[0],x=new q(P,20).at(b/(Math.PI*2));this.$handle.setTransform(this.from.tile.relativePosn(g).add(x),b),this.$line.setAttr("d",""),this.$originDot.hide();return}let i=this.to?this.to.points:[[s,0]],r=Zr(this.from.points,i),[o,n]=Vs(r,([g,b])=>d.distance(g[0],b[0])),a=this.from.tile.relativePosn(o[0]),l=n[1]+W((this.to?this.to.tile.rot:180)-this.from.tile.rot),c=this.to?new q(P,14).at(l/(Math.PI*2)):P,p=this.from.tile.relativePosn(n[0]).add(c),u=d.distance(a,p),f=a.add(d.fromPolar(o[1],u*.7)),v=p.add(d.fromPolar(l,Math.max(u*.7,40)));this.$line.setAttr("d",`M${p.x} ${p.y}C${v.x} ${v.y},${f.x} ${f.y},${a.x} ${a.y}`),this.$handle.setTransform(p,l+Math.PI,this.to?.8:1),this.$originDot.setTransform(a),this.$originDot.show()}delete(){this.connectTo(),this.$group.remove()}enqueueMessage(s,t=!0){if(bl.push([this,s]),t&&ep(),!this.from.options.highlights)return;let r=s.type==="number"&&s.value===1?y.yellow:y.blue;this.$line.setAttr("style",`stroke: ${r}`),this.$handle.setAttr("style",`fill: ${r}`)}serialize(){return this.to?{fromPort:this.from.name,toTileId:this.to.tile.id,toPort:this.to.name}:void 0}static unSerialize(s,t,i){var n,a;let r=i.tiles.get(s),o=i.tiles.get(t.toTileId);if(r&&o){let l=(n=r.outPorts)==null?void 0:n.get(t.fromPort||"main"),c=(a=o.inPorts)==null?void 0:a.get(t.toPort||"main");l&&c&&wl(l,c)&&l.addCable(new he(l,c))}}static get isMoving(){return to}};var y={grey:"#cccccc",darkGrey:"#242436",red:"#cd0e66",orange:"#eb4726",yellow:"#fd8c00",lime:"#bfc212",green:"#22ab24",teal:"#009ea6",blue:"#0f82f2",purple:"#6d3bbf",fg:"var(--canvas-fg)",bg:"var(--canvas-bg)"},q0="M12.5,0H0V25H12.5a12.5,12.5,0,0,0,0-25Z",U0="M0,0V12.5a12.5,12.5,0,0,0,25,0V0Z",cn=new Map,hn=new Map,xl=[],ne=e=>e.props.status==="fixed"||e.props.status==="generator"||e.cannotEdit,$l=e=>e.props.status==="fixed"||e.props.status==="generator"||e.cannotRotate;function T(e){cn.set(e.type,e)}function O(e){xl.push(...e)}var $=class{constructor(s,t,i,r){this.$parent=s;this.rot=0;this.snapPoints=[];this.snapLines=[];this.snapAngles=[0,90];this.id=i||He(10),t.name||(t.name=this.constructor.type),this.props=Yh(t,this.$parent),this.posn=new d(this.props.x||0,this.props.y||0),this.rot=t.rot||0,this.$el=r||h("g",{class:"tile"}),s.tiles.set(this.id,this),hn.set(this.$el._el,this),this.props.watch("status",({status:o})=>{this.$el.setClass("locked-tile",o==="locked"),this.$el.setClass("hidden-tile",o==="hidden"),this.canSelect||this.$parent.selection.remove(this)}),this.props.watch("sound",o=>jo(o.sound||"piano")),this.props.watch("zIndex layer",()=>this.updateZIndex(!0)),this.props.watch("hideHandles",({hideHandles:o})=>this.$el.setClass("no-handles",!!o))}static create(s,t,i){let r=cn.get(t.name);if(!r)throw new Error(`Unknown tile type: ${t.name}`);let o=Object.assign({},r.defaultProps||{},t),n=new r(s,o,i);return n.setTransform(),n.serialize(),n}static thumbnail(s,t,i){var n,a;let r=cn.get(t);if(!r)throw new Error(`Unknown tile type: ${t}`);let o=Pt(i.attr("props"),{});return i.setAttr("aria-label",((n=r.altText)==null?void 0:n.call(r,o))||o.name),(a=r.makeThumbnail)==null?void 0:a.call(r,i,o,s)}delete(){var s,t,i;this.isDeleting=!0,(s=this.track)==null||s.stop(),this.collision&&this.collision.setCollision();for(let r of this.polypadOptionCallbacks||[])this.$parent.options.unwatch(r);this.$parent.selection.remove(this);for(let r of((t=this.inPorts)==null?void 0:t.values())||[])r.delete();for(let r of((i=this.outPorts)==null?void 0:i.values())||[])r.delete();this.$parent.tiles.delete(this.id),this.$parent.zIndex.remove(this),this.$parent.mathContext.removeSource(this),hn.delete(this.$el._el),this.$el.remove()}applyChange(s){this.props.assign(s),Object.assign(this.lastSavedData||{},s),("x"in s||"y"in s||"rot"in s)&&this.setTransform(new d(this.props.x,this.props.y),this.props.rot)}recreate(s){let t=Object.assign({},this.props.raw,s),i=[...t.cables||[],...this.getCableData("in")];this.delete();let r=$.create(this.$parent,t,this.id);for(let o of i)he.unSerialize(this.id,o,this.$parent);r.serialize()}serialize(){return this.lastSavedData=this.props.copy()}setupAudioTrack(){}makeHandle(s,t,i,r,o){let a=h(s==="c"?"circle":"path",{class:"handle"},this.$el);return s==="h"&&a.setAttr("d",q0),s==="v"&&a.setAttr("d",U0),s==="c"&&a.setAttr("r",10),this.$parent.events.listen(a,{down:()=>{var l;return(l=this.track)==null?void 0:l.stop()},start:()=>{this.$parent.selection.add(this.root,!0),r==null||r()},move:l=>t(this.relativePosn(l.posn),l.posn,l.event),click:()=>i==null?void 0:i(),end:()=>{o==null||o(),this.$parent.change({changed:[this]})}}),a}is(s){return this.props.name===s}get $container(){return this.$parent.$tiles[this.props.layer==="back"?0:this.props.layer==="front"?2:1]}updateZIndex(s){s&&this.$parent.zIndex.addOrUpdate(this);let t=this.$parent.zIndex.getTileAbove(this);if(!t)return this.$container.append(this.$el);t.$el.insertBefore(this.$el)}get canSelect(){return this.$parent.state.setupMode||this.props.status!=="hidden"&&this.props.status!=="locked"}get altText(){var t;if(this.props.altText)return this.props.altText;let s=cn.get(this.props.name);return((t=s==null?void 0:s.altText)==null?void 0:t.call(s,this.props))||this.props.name}watchPolypadOptions(s){this.polypadOptionCallbacks||(this.polypadOptionCallbacks=[]),this.polypadOptionCallbacks.push(s),this.$parent.options.watch(s)}showErrorIcon(s){var t;if(this.currentError=s,!s)return(t=this.$errorIcon)==null?void 0:t.detach();this.$errorIcon||(this.$errorIcon=h("g",{style:"cursor: pointer"}),h("circle",{cx:12,cy:12,r:12,fill:"transparent"},this.$errorIcon),Qr("warning",y.yellow,24,void 0,this.$errorIcon),this.transform(),this.$parent.events.listen(this.$errorIcon,{click:()=>{let i=this.$errorIcon.transformMatrix,r=this.posn.shift(i[0][2],i[1][2]);this.$parent.warningBanner.show(r,this.currentError)}})),this.$el.append(this.$errorIcon)}setCollision(s){var t;ne(this)||s&&ne(s)||s&&s===this.collision||((t=this.collision)==null||t.highlight(!1),this.collision=s,s==null||s.highlight(!0))}collide(s){}get root(){var s;return((s=this.group)==null?void 0:s.root)||this}flipColor(s){let{color:t,backColor:i}=this.props;this.props.color=i||s,this.props.backColor=t}click(s){}doubleClick(s){}down(s){}up(s){}format(s,t){}focus(){this.$parent.focussedTile=this,this.$parent.selection.clear(),this.isFocussed=!0,this.$parent.trigger("change-focus",{tiles:[this]})}blur(){this.isFocussed=!1,this.$parent.focussedTile=void 0,this.$parent.trigger("change-focus",{tiles:[]})}highlight(s=!0){}select(){this.isActive=!0,this.$el.addClass("active"),this.noAutoLayering||this.updateZIndex(),this.redrawCables()}deselect(){this.isDeleting||(this.isActive=!1,this.$el.removeClass("active"),this.noAutoLayering||this.updateZIndex(),this.redrawCables())}moveStart(s=!1){this.startPosn=this.posn}move(s,t){s&&(this.posn=this.startPosn.add(s),this.transform(!0))}moveEnd(){this.collision&&this.collide(this.collision),this.setTransform()}rotate(s,t=P){this.posn=this.posn.rotate(W(s),t),this.rot=K(this.rot+s,360),this.transform(!0)}transform(s){var i,r;let t=W(this.rot);this.$el.setTransform(this.posn,t),this.redrawCables(),!s&&this.path&&(this.transformed=this.path.rotate(t).translate(this.posn),this.padding&&(this.transformedPadded=ut(this.path).padding(...this.padding).rotate(t).translate(this.posn)),this.snapPoints=this.getSnapPoints().map(o=>o.rotate(t).translate(this.posn)),this.snapLines=this.getSnapLines().map(o=>o.rotate(t).translate(this.posn)),(i=this.$errorIcon)==null||i.setTransform(ut(this.path).p.shift(-28,5)),(r=this.group)==null||r.transform())}setTransform(s=this.posn,t=this.rot){this.posn=s,this.props.x=s.x,this.props.y=s.y,this.rot=this.props.rot=K(t,360),this.transform()}getSnapPoints(){return this.path?Mt(this.path)?[this.path]:fe(this.path)?this.path.points:Rt(this.path)?[this.path.p1,this.path.p2]:yt(this.path)?[this.path.c,this.path.c.shift(0,this.path.r),this.path.c.shift(0,-this.path.r),this.path.c.shift(this.path.r,0),this.path.c.shift(-this.path.r,0)]:Ds(this.path)?[this.path.c,this.path.start,this.path.end]:Oe(this.path)?[this.path.start,this.path.end]:me(this.path)?[]:[]:[]}getSnapLines(){return[]}relativePosn(s){return s.subtract(this.posn).rotate(-W(this.rot))}worldPosn(s){return s.rotate(W(this.rot)).add(this.posn)}get center(){return this.path?yt(this.path)?this.path.c:ut(this.path).center:P}contains(s){let t=this.transformed;return!t||!fe(t)&&!yt(t)&&!Ds(t)?!1:t.contains(s)}findNearby(s,t,i){let r=i||this.worldPosn(this.center);for(let o of this.$parent.getTilesOfType(s))if(o!==this&&d.distance(r,o.worldPosn(o.center))<t)return o}animateTo(s,t=this.posn,i=400,r=this.rot){let o=this.rot;return this.setTransform(s,r),et(n=>{n=wt("sine",n),this.$el.setTransform(d.interpolate(t,s,n),W(rt(o,r,n)))},i).promise}delayedSetup(){var t;for(let i of((t=this.outPorts)==null?void 0:t.values())||[])for(let r of i.cables)r.delete();let s=this.props.cables||[];for(let i of s)he.unSerialize(this.id,i,this.$parent)}redrawCables(){var s,t;for(let i of((s=this.inPorts)==null?void 0:s.values())||[])i.redraw();for(let i of((t=this.outPorts)==null?void 0:t.values())||[])i.redraw()}makeInPort(s,t){this.inPorts||(this.inPorts=new Map),this.inPorts.has(s)||this.inPorts.set(s,new ln(this,s));let i=this.inPorts.get(s);return i.setOptions(t,!1),i}makeOutPort(s,t){this.outPorts||(this.outPorts=new Map),this.outPorts.has(s)||this.outPorts.set(s,new an(this,s));let i=this.outPorts.get(s);return i.setOptions(t,!1),i}emitMessage(s,t){var i;typeof s=="string"&&(s=(i=this.outPorts)==null?void 0:i.get(s)),s==null||s.sendMessage(t)}*getCableData(s="out"){let t=s==="in"?this.inPorts:this.outPorts;if(t)for(let i of t.values())for(let r of i.cables)(s==="in"||r.to)&&(yield r.serialize())}updateCableProps(){let s=Array.from(this.getCableData());this.props.cables=s.length?s:void 0}getClosestPort(s,t,i=10){if(!this.inPorts)return;let r=this.relativePosn(s);for(let a of this.inPorts.values())if(a.location&&Mt(a.location)&&d.distance(a.location,r)<=i&&(!t||a.validateConnection(t)))return a;if(!this.contains(s))return;let o=Array.from(this.inPorts.values()).filter(a=>!t||a.validateConnection(t));for(let a of o.filter(l=>l.type==="REGION"))if((a.location||this.path).contains(r))return a;let n=o.filter(a=>a.type==="POINT");return Vs(n,a=>d.distance(r,a.location))}},Pl=new It(P,new d(0,1)),Z0=new S(P,50,50).shift(-25,-25).polygon,st=class extends ${constructor(t,i,r){super(t,i,r);this.$path=h("path",{class:"polygon-tile"},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.props.watch("color",({color:o})=>this.$path.setAttr("fill",o))}setPath(t=Z0,i){i&&!this.symmetric&&(t=t.reflect(Pl)),this.path=t,this.snapAngles=re(t.edges.map(n=>K(Math.round(Vt(n.angle)),180))),this.$path.draw(t),this.$outline.draw(t),this.transform();let r=S.aroundPoints(t.points),o=new d(r.center.x,r.p.y);this.showSelectionOutline=d.distance(o,t.project(o))>5}select(){var t,i;(t=this.track)==null||t.stop(),(i=this.$audio)==null||i.removeChildren(),super.select()}setupAudioTrack(){this.$audio=h("g",{style:"font-size:15px;font-weight:600",fill:"white"}),this.$outline.insertBefore(this.$audio),this.track=Jh(this,this.$audio),this.props.watch("labels",()=>this.track.stop())}flip(t){this.props.isFlipped=!this.props.isFlipped||void 0;let i=new d(2*t.x-this.posn.x,this.posn.y);this.setTransform(i,-this.rot)}};var pn={point:(e,s)=>e!==void 0&&s!==void 0?new d(e,s):void 0,angle:(e,s,t)=>e&&s&&t?new Ot(e,s,t):void 0,line:(e,s)=>e&&s&&!e.equals(s)?new It(e,s):void 0,segment:(e,s)=>e&&s&&!e.equals(s)?new dt(e,s):void 0,circle:(e,s)=>e&&s?new q(e,s):void 0,arc:(e,s,t)=>e&&s&&t?new ge(e,s,t):void 0,polygon:(...e)=>e.every(Boolean)?new D(...e):void 0,polyline:(...e)=>e.every(Boolean)?new ve(...e):void 0,triangle:(e,s,t)=>e&&s&&t?new Ja(e,s,t):void 0,rectangle:(e,s,t)=>e?new S(e,s,t):void 0,distance:d.distance,intersections:Ht},j0=/^_x\d+\.at\([\d.e-]+\)$/,W0=/^intersections\(|\.midpoint$|\.centroid$/,dn=class{constructor(){this.model=Ze({});this.tiles=new Map;this.dependencies=new Map;this.model.assign(pn),this.queueLabelPositioning=Yi(()=>{for(let s of this.tiles.values())op(s)},0,!0)}reset(){this.model.clear(),this.model.assign(pn)}redrawLines(s){for(let t of this.tiles.values())t.path&&Ka(t.path)&&(t.$el.draw(t.path,{box:s}),t.$shadow.setAttr("d",t.$el.attr("d")))}},ae=class extends ${constructor(t,i,r){super(t,i,r,h("path",{class:"geo-path"},t.$geoPaths));this.$parent=t;this.hideSelectionOutline=!0;this.noAutoLayering=!0;this.isProjection=!1;this.parentKeys=[];this.deleted=!1;this.onDraw=()=>this.draw();this.$shadow=h("path",{class:"geo-shadow"},t.$geoShadows),this.props.key||(this.props.key=t.geoData.model.getKey()),t.geoData.tiles.set(this.props.key,this),this.snapPoints=this.snapLines=this.snapAngles=[],this.props.expr&&this.setExpr(this.props.expr),t.geoData.model.watch(this.onDraw),this.props.color||(this.props.color=t.state.penColor),this.props.watch("color",({color:o})=>{var n,a,l;(n=this.$el)==null||n.css("color",o),(a=this.$shadow)==null||a.css("color",o),(l=this.$label)==null||l.setAttr("fill",o)}),this.props.watch("arrows marks",()=>this.draw(!0)),this.props.watch("label",({label:o})=>{if(!o&&this.$label)return this.$label.detach();this.$label||(this.$label=h("text",{fill:this.props.color,class:"geo-label"})),this.$parent.$geoPoints.append(this.$label),op(this)})}applyChange(t){super.applyChange(t),"expr"in t&&this.setExpr(this.props.expr)}setExpr(t,i=!1){let r=ye(t);this.$parent.geoData.model.setComputed(this.props.key,r),!i&&(this.props.expr=t,this.setParentKeys(t.match(/_x\d+/g)||[]),this.isProjection=j0.test(t),this.computed=W0.test(t),this.$el.setClass("intersection",this.computed))}draw(t=!1){let i=this.$parent.geoData.model[this.props.key];if(!t&&i===this.path)return;this.path=i,this.$el.setAttr("hidden",i?void 0:!0),this.isActive&&!i&&this.$shadow.hide();let r=i==null?void 0:i.type;if(r!==this.geoType&&(this.$el.setClass("geo-point",r==="point"),this.$el.setClass("geo-path",r!=="point"),this.geoType=r,this.$container.append(this.$el)),!i)return;r==="point"&&(i=new q(i,this.computed?3.5:6)),this.$el.setClass("fill",this.geoType==="angle");let o=this.$parent.canvasBounds||this.$parent.viewportBounds;this.$el.draw(i,{box:o.rect,arrows:this.props.arrows,mark:this.props.marks}),this.$shadow.setAttr("d",this.$el.attr("d")),this.transform()}setParentKeys(t){var r;let i=this.$parent.geoData.dependencies;for(let o of this.parentKeys)(r=i.get(o))==null||r.delete(this.props.key);this.parentKeys=t;for(let o of t)i.has(o)||i.set(o,new Set),i.get(o).add(this.props.key)}get parents(){let t=this.$parent.geoData.tiles;return this.parentKeys.map(i=>t.get(i)).filter(Boolean)}get children(){let t=this.$parent.geoData.dependencies.get(this.props.key);return t?Array.from(t).map(i=>this.$parent.geoData.tiles.get(i)).filter(Boolean):[]}get ariaDescription(){var t;return`${(t=this.path)==null?void 0:t.type} ${this.props.key}: ${this.props.expr}`}get $container(){return this.geoType==="point"?this.$parent.$geoPoints:this.$parent.$geoPaths}select(){var t;this.isActive=!0,this.path&&(this.geoType==="angle"?this.$el.addClass("hover"):(this.$shadow.show(),(t=this.$el.parent)==null||t.append(this.$el)))}deselect(){this.isActive=!1,this.$shadow.hide(),this.$el.removeClass("hover")}hover(t=!0){this.isActive||!this.path||(this.geoType==="angle"?this.$el.setClass("hover",t):t?this.$shadow.show():this.$shadow.hide())}transform(){this.transformed=this.path,this.snapPoints=this.pending?[]:this.getSnapPoints(),this.snapLines=this.pending||!this.path||Mt(this.path)||me(this.path)?[]:[this.path],this.$parent.geoData.queueLabelPositioning()}setTransform(){this.transform()}shift(t){/^point\([\d.-]+,[\d.-]+\)$/.test(this.props.expr)&&this.setExpr(this.path.translate(t).toString())}delete(){var t;this.deleted=!0,super.delete(),this.$parent.geoData.model.unwatch(this.onDraw),this.$parent.geoData.model[this.props.key]=void 0,this.$parent.geoData.tiles.delete(this.props.key),this.$shadow.remove(),(t=this.$label)==null||t.remove();for(let i of this.children)i.delete()}setPending(t=!0){this.pending=t,t||this.transform();for(let i of this.children)i.setPending(t)}moveStart(){if(!(this.computed||!this.path)){if(this.isProjection){if(this.$parent.selection.size>1)return;this.setParentKeys([])}this.setPending(!0);for(let t of this.parents)t.moveStart();this.moveStartValue=this.transformed}}move(t,i){if(!(!t||!this.path||!this.moveStartValue))if(Mt(this.path))this.snapTarget=i,this.$el.setClass("intersection",this.computed||!!(i!=null&&i.intersection)),this.$parent.geoData.model[this.props.key]=this.moveStartValue.translate(t);else for(let r of this.parents)r.move(t)}moveEnd(){var t,i,r,o;if(this.moveStartValue){for(let n of this.parents)n.moveEnd();if(this.setPending(!1),(t=this.snapTarget)!=null&&t.intersection)this.setExpr(this.snapTarget.intersection);else if(((r=(i=this.snapTarget)==null?void 0:i.tile)==null?void 0:r.props.name)==="geo"){let n=(o=this.snapTarget)==null?void 0:o.tile;if(n.path&&Mt(n.path)){let a=this.children;for(let l of a)l.setExpr(l.props.expr.replaceAll(this.props.key,n.props.key));this.delete(),this.$parent.change({deleted:[this],changed:a})}else if(n.path){let a=n.path.offset(this.$parent.geoData.model[this.props.key]);this.setExpr(`${n.props.key}.at(${a})`)}}else this.path&&Mt(this.path)&&(this.props.expr=`point(${this.path.x},${this.path.y})`,this.isActive||this.$parent.selection.implicitChanges.add(this))}}static getInferredShape(t){if(t=t.filter(l=>l.path),!t.length)return;if(t.length===1)return{type:t[0].path.type,expr:t[0].props.key,value:t[0].path};t=t.filter(l=>l.geoType!=="angle");let i=t.filter(l=>Mt(l.path)),r=t.filter(l=>Rt(l.path)||yt(l.path));if(r.length===1&&i.length===t.length-1){let l=r[0].path;if(i.every(c=>l.contains(c.path)))return{type:l.type,expr:r[0].props.key,value:l}}let o=r.filter(l=>Rt(l.path));if(i.length+o.length!==t.length)return;for(let l of o)if(qe(l.path)){let c=l.parentKeys.map(p=>l.$parent.geoData.tiles.get(p));for(let p of c)i.includes(p)||i.push(p)}else if(i.filter(c=>l.path.contains(c.path)).length<2)return;let n=i.map(l=>l.props.key).join(","),a=i.map(l=>l.path);if(i.length===2){let l=new dt(a[0],a[1]);return{type:"segment",expr:`segment(${n})`,value:l}}return i.length===3?{type:"triangle",expr:`triangle(${n})`,value:new Ja(...a)}:{type:"polygon",expr:`polygon(${n})`,value:new D(...a)}}static copy(t,i,r){let o=l=>{let c=t.get(l)||r.model.getKey();return t.set(l,c),c},n=o(i.key),a=i.expr.replace(/\b_x\d+\b/g,o);return{key:n,expr:a}}};ae.type="geo",ae=w([T],ae);var sp=new WeakMap,ip=e=>{let s=sp.get(e);if(s)return s;let t=ae.getInferredShape(e);return sp.set(e,t),t};O([["","geo-midpoint","$0.midpoint","segment"],["","geo-perp-bisector","$0.perpendicularBisector","segment"],["","geo-parallel","$0.parallel($1)","line","segment"],["","geo-perpendicular","$0.perpendicular($1)","line","segment"],["","geo-tangent","line($0.c,$1).perpendicular($1)","circle"],["","geo-centroid","$0.centroid","polygon","triangle"],["","geo-circumcircle","$0.circumcircle","triangle"],["","geo-incircle","$0.incircle","triangle"],["","geo-angle-bisector","$0.bisector","angle"]].map(([e,s,t,...i])=>({id:s,type:"button",tileTypes:["geo"],label:e,icon:s,show:r=>{var o;return i.includes(((o=ip(r))==null?void 0:o.type)||"")},click:(r,o)=>{var l;let n=(l=ip(r))==null?void 0:l.expr,a=t.replace(/\$0/g,n||"");if(a.includes("$1"))o.tools.geoPending.enable(a);else{let c=$.create(o,{name:"geo",expr:a});o.selection.add(c,!0);let p=Mt(c.path)?"pop":"draw",u=c.$el.enter(p,400);c.$shadow.enter(p,400),o.snapping.updateIntersections(),o.change({added:[c]}),u.promise.then(()=>c.$el.css("display",""))}}})));O([{id:"line-style",type:"select",tileTypes:["geo"],label:"",location:"more",show:e=>e.every(s=>s.path&&Rt(s.path)),options:[{key:"line",label:""},{key:"ray",label:""},{key:"segment",label:""}],get:e=>e.geoType,set:(e,s)=>s.setExpr(s.props.expr.replace(/\.(line|ray|segment)$/,"")+`.${e}`)},{id:"arrows",type:"select",tileTypes:["geo"],label:"",location:"more",show:e=>e.every(s=>s.geoType==="segment"),options:[{key:"",label:""},{key:"start",label:""},{key:"end",label:""},{key:"both",label:""}],get:e=>e.props.arrows||"",set:(e,s)=>s.props.arrows=e||void 0},{id:"marks",type:"select",tileTypes:["geo"],label:"",location:"more",show:e=>e.every(s=>s.path&&Rt(s.path)),options:[{key:"",label:""},{key:"bar",label:""},{key:"bar2",label:""},{key:"arrow",label:""},{key:"arrow2",label:""}],get:e=>e.props.marks||"",set:(e,s)=>s.props.marks=e||void 0}]);O([{id:"label",type:"input",tileTypes:["geo"],label:"",location:"more",get:e=>e.props.label||"",set:(e,s)=>s.props.label=e}]);var rp=Math.PI/12;function K0(e){return ke(e/rp,.03)?new j(Math.round(e/rp),12,"").simplified.toString():mt(e,4)}function Y0(e,s){return qe(s)?e.replace(/\$l/g,mt(s.length/50,4)):fe(s)||yt(s)?e.replace(/\$[cp]/g,mt(s.circumference/50,4)).replace(/\$a/g,mt(s.area/2500,4)):me(s)?e.replace(/\$r/g,K0(s.rad)).replace(/\$d/g,mt(s.deg,4)+"\xB0"):e}function op(e){if(!e.props.label||!e.path)return;e.$label.text=Y0(e.props.label,e.path);let[s,t]=X0(e);e.$label.css("transform",`translate(${s.x}px,${s.y}px) rotate(${t}rad)`)}function X0(e){let s,t=e.$label.width,i=12,r=new S(new d(-t/2-3,-i-3),t+6,i+6);for(let o of J0(e.path,e,t,i)){s||(s=o);let n=r.rotate(o[1]).translate(o[0]);if(!Xt(e.$parent.geoData.tiles.values(),a=>{if(!a.path||a.props.status==="hidden"||a===e)return!1;let l=Mt(a.path)?new q(a.path,10):a.path;if(Ht(l,n).length)return!0}))return o}return s||[P,0]}function*J0(e,s,t,i){var r;if(Mt(e)){let o=s.computed?8:10;yield[e.shift(o+t/2,-o),0],yield[e.shift(-o-t/2,-o),0],yield[e.shift(o+t/2,o+i),0],yield[e.shift(-o-t/2,o+i),0]}else if(Rt(e)){let o=e.perpendicularVector,n=e.angle;o.y>=0&&(o=o.scale(-1),n+=Math.PI);let a=qe(e)?[.5,.3,.7]:[0,150,-150];for(let l of a)for(let c of[8,-8-i])yield[e.at(l).add(o.scale(c)),n]}else if(fe(e))for(let o of e.edges){let n=o.perpendicularVector.scale(8),a=o.angle;n.y>=0&&(n=n.scale(1+i/8),a+=Math.PI),yield[o.midpoint.add(n),a]}else if(yt(e))yield[e.at(7/8).shift(5+t/2,-5),0],yield[e.at(5/8).shift(-5-t/2,-5),0],yield[e.at(1/8).shift(5+t/2,5+i),0],yield[e.at(3/8).shift(-5-t/2,5+i),0];else if(me(e)){let o=e.isRight?20*Math.sqrt(2):e.radius,n=((r=e.bisector)==null?void 0:r.unitVector.scale(o+6))||P,a=n.angle();yield[e.b.add(n).shift(t/2*Math.cos(a),i/2*(1+Math.sin(a))),0]}}var np=1,Q0=.05,tg=5;function eg([e,s],t,i){if(!i)return[Math.min(e,t),Math.max(s,t)];let r=s<e?s+1:s;if(E(r-e,1,.001))return[0,1];if(Y(t<e?t+1:t,e,r))return[e,s];let o=Math.abs(e-t),n=Math.abs(s-t);return Math.min(o,1-o)<Math.min(n,1-n)?[t,s]:[e,t]}function sg(e,s,t){if(E(s,0)&&E(t,1))return e;if(Rt(e))return new dt(e.at(s),e.at(t));if(Oe(e)){let i=e.angle*Math.abs(t-s);return new ge(e.c,e.at(Math.min(s,t)),i)}else if(yt(e)){let i=(t-s+(t<s?1:0))*B;return new ge(e.c,e.at(s),i)}else if(er(e)){let i=ls(e.edges.map(l=>l.length)),r=z(i),o=i.findIndex(l=>l/r>s)+1,n=i.findIndex(l=>l/r>t)+1,a=s<=t?e.points.slice(o,n):[...e.points.slice(o),...e.points.slice(0,n)];return new ve(e.at(s),...a,e.at(t))}return e}function Tl(e,s,t,i){let r=np,o=-1;for(let n=s+1;n<t;n++){let a=new It(e[s],e[t]).distanceSquared(e[n]);a>r&&(o=n,r=a)}r>np&&(o-s>1&&Tl(e,s,o,i),i.push(e[o]),t-o>1&&Tl(e,o,t,i))}function ig(e){if(e.length<=2)return e;let s=[e[0]];return Tl(e,0,e.length-1,s),s.push(z(e)),s}function ap(e,s,t,i=!1){let r=s||e,o=t||e,n=Math.atan2(o.y-r.y,o.x-r.x)+(i?Math.PI:0),a=d.distance(r,o)*Q0;return e.shift(Math.cos(n)*a,Math.sin(n)*a)}function rg(e){return e.length<=2?Gt(new ve(...e)):e.map((s,t)=>{if(t===0)return`M${s.x.toFixed(2)} ${s.y.toFixed(2)}`;if(d.distance(e[t-1],s)<4)return`L${s.x.toFixed(2)},${s.y.toFixed(2)}`;let i=ap(e[t-1],e[t-2],s),r=ap(s,e[t-1],e[t+1],!0);return`C${i.x.toFixed(2)},${i.y.toFixed(2)} ${r.x.toFixed(2)},${r.y.toFixed(2)} ${s.x.toFixed(2)},${s.y.toFixed(2)}`}).join("")}var we=class{constructor(s,t,i,r,o){this.$parent=s;this.brush=r;this.options="";this.$el=h("path",{class:`stroke ${r}`},s.$strokes),this.id=o||He(10),this.setColor(i),t&&this.parse(t),s.strokes.set(this.id,this)}setColor(s){this.color=s,this.$el.setAttr("stroke",te(s,this.$parent.flipTheme))}parse(s){if(this.options=s,s.startsWith("M")){let t=Ws(s);this.path=new ve(...t),this.$el.setAttr("d",s)}else this.path=ye(s)(pn),this.path&&(this.snap=!0),this.$el.setAttr("d",this.path?Gt(this.path):"")}start(s,t){var i;if(this.brush==="ruler"&&(s=((i=this.$parent.snapping.snap([s]))==null?void 0:i.posn)||s),this.startPoint=s,this.path=new ve(s,s.shift(.01)),t&&this.brush!=="ruler"){this.utensil=t;let r=t.offset(s);this.utensilRange=[r,r+.01]}this.$el.draw(this.path)}addPoint(s){if(this.brush==="ruler"){let t=this.$parent.snapping.snap([s]),i=(t==null?void 0:t.posn)||s.snap(this.startPoint,tg);this.path=new dt(this.startPoint,i),this.$el.draw(this.path)}else if(this.utensil){let t=M(this.utensil.offset(s),0,1),i=yt(this.utensil)||er(this.utensil);this.utensilRange=eg(this.utensilRange,t,i),this.path=sg(this.utensil,...this.utensilRange),this.$el.draw(this.path)}else this.path.points.push(s),this.$el.setAttr("d",this.$el.attr("d")+`L${s.x},${s.y}`)}end(){if(this.utensil||this.brush==="ruler")return this.snap=!0,this.options=this.path.toString().replace(/\.(\d{3})\d+/g,(s,t)=>`.${t}`),this.$parent.snapping.addStroke(this);{let s=ig(this.path.points);this.path=new ve(...s),this.options=rg(s),this.$el.setAttr("d",this.options)}this.startPoint=this.utensil=this.utensilRange=void 0}get snapPoints(){if(this.snap){if(qe(this.path))return[this.path.p1,this.path.p2];if(Oe(this.path))return[this.path.start,this.path.end]}}hitTest(s,t){if(!this.path)return!1;let i=this.path.project(s);return(s.x-i.x)**2+(s.y-i.y)**2<t**2}delete(){this.$parent.strokes.delete(this.id),this.$el.remove()}serialize(s=1/0){return{points:this.options.slice(0,s),color:this.color,brush:this.brush}}get lastSavedData(){return this.serialize()}static create(s,t,i){return new we(s,t.points,t.color||"#000",t.brush||"",i)}};var og={v:["tool","move"],p:["tool","pen"],g:["tool","geo"],t:["tool","text"],q:["tool","equation"],e:["tool","eraser"],s:["focus","sidebar"],d:["focus","toolbar"],f:["focus","canvas"],a:["focus","actionbar"]};function ng(e){for(let s of e.$$("button, input, select, textarea, [tabindex]"))if(s.width)return s.focus()}function lp(e=og,s,t,i){let r=Object.keys(e).join(" ");(i||at).onKey(r,(o,n)=>{if(o.ctrlKey||o.metaKey)return;let a=e[n];if(a[0]==="tool"){let l=a[1]==="equation"?"text":a[1],c=a[1]==="text"||a[1]==="equation"?a[1]:void 0,p=s.state.setupMode?"":s.options.toolbar;if(p&&!p.includes(l))return;s.setActiveTool(l,c)}else{let l=t[a[1]];l&&ng(l)}})}var ag=Object.defineProperty,lg=Object.getOwnPropertyDescriptor,eo=(e,s,t,i)=>{for(var r=i>1?void 0:i?lg(s,t):s,o=e.length-1,n;o>=0;o--)(n=e[o])&&(r=(i?n(s,t,r):n(r))||r);return i&&r&&ag(s,t,r),r},cp=(e,s,t)=>new Promise((i,r)=>{var o=l=>{try{a(t.next(l))}catch(c){r(c)}},n=l=>{try{a(t.throw(l))}catch(c){r(c)}},a=l=>l.done?i(l.value):Promise.resolve(l.value).then(o,n);a((t=t.apply(e,s)).next())}),nr,cg=h("div",{class:"snackbar"},at),hp=class extends lt{ready(){var e;cg.append(this),(e=this.$("button"))==null||e.on("click",()=>this.close())}open(e=2e3){return cp(this,null,function*(){nr!==this&&(nr&&(yield nr.close()),nr=this,yield this.enter("pop",300).promise,this.setAttr("role","alert"),e&&setTimeout(()=>this.close(),e))})}close(){return cp(this,null,function*(){nr===this&&(nr=void 0,this.removeAttr("role"),yield this.exit("pop",300).promise)})}};hp=eo([ct("x-alert")],hp);var pp=class extends lt{ready(){if(this.children.length)return;let e=h("svg",{viewBox:"0 0 24 24",alt:""},this),s=h("use",{},e),t=+this.attr("size")||24;for(let i of[this,e])i.css({width:`${t}px`,height:`${t}px`});this.onAttr("name",i=>s.setAttr("href",`/icons.svg#${i}`))}};pp=eo([ct("x-icon")],pp);var Ys=h("div",{class:"modal-background"},at),Sl,We=void 0,kl=void 0;function Cl(){We&&We.canClose&&We.close()}Ys.on("click",Cl);at.onKey("Escape",Cl);al.on("change",Cl);Ys.on("scrollwheel touchmove",e=>{e.preventDefault(),e.stopPropagation()});at.onKey("Space ArrowUp ArrowDown PageDown PageUp",e=>{We&&(e.preventDefault(),e.stopPropagation())});var dp=class extends lt{constructor(){super(...arguments),this.isOpen=!1,this.canClose=!0}ready(){this.canClose=!this.hasAttr("no-close"),this.$iframe=this.$("iframe[data-src]"),this.$video=this.$("video");let e=nl(`[data-modal=${this.id}]`);for(let t of e)t.on("click",()=>this.open());al.on("afterChange",({$viewport:t})=>{let i=t.$$(`[data-modal=${this.id}]`);for(let r of i)r.on("click",()=>this.open())}),(this.hasClass("open")||R.getHash()===this.id)&&!We&&this.open(!0),this.$("input")&&this.addClass("interactive");let s=this.$(".close");s&&s.on("click",()=>this.close());for(let t of this.$$(".btn"))t.on("click",()=>this.trigger("btn-click",t))}open(e=!1){var s,t;if(this.isOpen)return;Ys.setClass("light",this.hasClass("light")),We?We.close(!0):e?Ys.show():Ys.css("display")==="block"?Sl==null||Sl.cancel():Ys.enter("fade",250),this.isOpen=!0,We=this,this.$iframe&&this.$iframe.setAttr("src",this.$iframe.data.src),this.$video&&this.$video.play(),e?this.show():this.enter("pop",250).promise.then(()=>this.css("transform","")),this.setAttr("role","dialog"),this.trigger("open"),kl=document.activeElement;let i=this.$('input, a, button, textarea, [tabindex="0"]');i&&i.focus(),(s=window.ga)==null||s.call(window,"send","event","Modal",this.id),(t=window.gtag)==null||t.call(window,"event","modal",{action:this.id})}close(e=!1,s=!1){this.isOpen&&(this.isOpen=!1,this.removeAttr("role"),We=void 0,this.$iframe&&this.$iframe.setAttr("src",""),this.$video&&this.$video.pause(),e||(Sl=Ys.exit("fade",250)),this.exit("pop",250).promise.then(()=>this.css("transform","")),s||this.trigger("close"),kl&&kl.focus())}getOpenModal(){return We}};dp=eo([ct("x-modal")],dp);var up=class extends lt{constructor(){super(...arguments),this.isOpen=!1}ready(){this.animation=this.attr("animation")||"pop",this.$bubble=this.$(".popup-body"),this.$bubble.hide(),this.$(".popup-target").on("click",()=>this.toggle()),this.on("clickOutside",()=>this.close());for(let s of this.$bubble.$$("a"))s.on("click",()=>this.close());at.onKey("Escape",()=>this.close())}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.addClass("active"),this.$bubble.enter(this.animation,150),this.$bubble.setAttr("role","dialog"),this.$bubble.focus())}close(){this.isOpen&&(this.isOpen=!1,this.removeClass("active"),this.$bubble.exit(this.animation,150),this.$bubble.removeAttr("role"))}};up=eo([ct("x-popup")],up);var fp=class extends lt{constructor(){super(...arguments),this.$options={}}ready(){let e=this.children;this.$active=this.$(".active")||e[0],this.$active.addClass("active");for(let[s,t]of e.entries())!$t(t.tagName,"A","BUTTON")&&!t.hasAttr("tabindex")&&t.setAttr("tabindex",0),t.on("click",()=>this.makeActive(t)),this.$options[t.attr("value")||s]=t;this.trigger("change",this.$active)}makeActive(e){e!==this.$active&&(this.$active.removeClass("active"),this.$active=e,e.addClass("active"),this.trigger("change",e))}bindVariable(e,s){e[s]===void 0&&(e[s]=this.$active.attr("value")),this.on("change",t=>e[s]=t.attr("value")),e.watch(()=>{let t=this.$options[e[s]];t&&this.makeActive(t)})}};fp=eo([ct("x-select")],fp);var un=class{constructor(s,t){this.$canvas=s;this.defaultCallbacks=t;this.callbacks=new WeakMap;this.global=[];this.isMoving=!1;this.shiftKey=!1;this.altKey=!1;this.cancelled=!1;document.addEventListener("keydown",i=>this.checkKeys(i)),document.addEventListener("keyup",i=>this.checkKeys(i)),document.addEventListener("visibilitychange",()=>{this.shiftKey=this.altKey=!1}),s.css("touch-action","none"),s.on("pointerdown",i=>this.startEvent(i)),at.onKey("Escape",()=>this.cancel()),t.hover&&s.on("pointermove",i=>{this.isMoving||t.hover({posn:Ue(i,s),event:i})})}checkKeys(s){this.shiftKey=s.shiftKey,this.altKey=s.altKey}listen(s,t){this.callbacks.set(s._el,t),s.hasParent(this.$canvas)||(s.css("touch-action","none"),s.on("pointerdown",i=>this.startEvent(i)))}listenAll(s){this.global.push(s)}startEvent(s){var u,f,v;if(s.handled||s.button)return;this.isMoving=!0,this.cancelled=!1,s.preventDefault(),this.checkKeys(s);let t=s.pointerId,i=this.getCallbacks(s.target);"shiftKey"in s&&(this.shiftKey=s.shiftKey),i.blurInput!==!1&&((u=R.getActiveInput())==null||u.blur());let r=Ue(s,this.$canvas),o=r,n=!1,a;if(this.constrainInBox){let m=this.$canvas.boundsRect;a=new bt(m.p.x,m.p.x+m.w,m.p.y,m.p.y+m.h)}let l=m=>{var x,k,L,A;if(m.pointerId&&m.pointerId!==t)return;if(m.preventDefault(),this.checkKeys(m),this.cancelled)return c(m);let g=ce(m);if(a&&(g=g.clamp(a)),g=g.transform(this.$canvas.inverseTransformMatrix),d.distance(g,o)<.5)return;if(!n){let Z={posn:r,event:m};(x=i.start)==null||x.call(i,Z);for(let Q of this.global)(k=Q.start)==null||k.call(Q,Z)}let b={posn:g,startPosn:r,lastPosn:o,event:m};(L=i.move)==null||L.call(i,b);for(let Z of this.global)(A=Z.move)==null||A.call(Z,b);!n&&i.cursor!==!1&&ps.addClass("grabbing"),o=g,n=!0},c=m=>{var b,x,k,L,A,Z;if(m.pointerId&&m.pointerId!==t)return;m.preventDefault(),this.checkKeys(m),at.off("pointermove",l),at.off("pointerstop",c);let g={posn:r,event:m};(b=i.up)==null||b.call(i,g);for(let Q of this.global)(x=Q.up)==null||x.call(Q,g);if(n){let Q={posn:o,lastPosn:o,startPosn:r,event:m,cancelled:this.cancelled};(k=i.end)==null||k.call(i,Q);for(let V of this.global)(L=V.end)==null||L.call(V,Q)}else if(!this.cancelled){let Q={posn:r,event:m};(A=i.click)==null||A.call(i,Q);for(let V of this.global)(Z=V.click)==null||Z.call(V,Q)}ps.removeClass("grabbing"),this.isMoving=this.cancelled=!1},p={posn:r,event:s};(f=i.down)==null||f.call(i,p);for(let m of this.global)(v=m.down)==null||v.call(m,p);at.on("pointermove",l),at.on("pointerstop",c)}getCallbacks(s){for(;s;){let t=this.callbacks.get(s);if(t&&(!t.checkIfActive||t.checkIfActive()))return t;s=s.parentNode||void 0}return this.defaultCallbacks}cancel(){this.cancelled=!0}};var nt=class extends Error{constructor(e,s){super(s),this.name=e}static undefinedVariable(e){return new nt("EvalError",`Undefined variable ${e}.`)}static undefinedFunction(e){return new nt("EvalError",`Undefined function ${e}.`)}static uncallableExpression(e){return new nt("EvalError",`Cannot call ${e}.`)}static evalLoop(e){return new nt("EvalError",`Loop in nested evaluation ${e}.`)}static invalidCharacter(e){return new nt("SyntaxError",`Unknown symbol ${e}.`)}static conflictingBrackets(e){return new nt("SyntaxError",`Conflicting brackets ${e}.`)}static unclosedBracket(e){return new nt("SyntaxError",`Unclosed bracket ${e}.`)}static startOperator(e){return new nt("SyntaxError",`A term cannot start with a ${e}.`)}static endOperator(e){return new nt("SyntaxError",`A term cannot end with a ${e}.`)}static consecutiveOperators(e,s){return new nt("SyntaxError",`A ${e} cannot be followed by a ${s}.`)}static invalidExpression(){return new nt("SyntaxError","This expression is invalid.")}},Rl={pi:Math.PI,:Math.PI,e:Math.E},Vl={"(":")","[":"]","{":"}"},cr={"*":"\xB7","**":"","//":"//","+-":"\xB1","":"","-":"",xx:"\xD7",sum:"",prod:"",int:"",del:"",grad:"",aleph:"",not:"\xAC",AA:"",EE:"","'":"","!=":"","<=":"",">=":"",in:"","!in":"","==":"","~=":"","~~":"",sub:"",sube:"",prop:"",oo:"",cap:"",cup:"","<-":"","->":"","=>":"","<=>":"","|->":"",uarr:"",darr:"",lArr:""},Os={Gamma:"",Delta:"",Theta:"",Lambda:"",Xi:"",Pi:"",Sigma:"",Phi:"",Psi:"",Omega:"",alpha:"",beta:"",gamma:"",delta:"",epsilon:"",zeta:"",eta:"",theta:"",iota:"",kappa:"",lambda:"",mu:"",nu:"",xi:"",pi:"",rho:"",sigma:"",tau:"",upsilon:"",phi:"",chi:"",psi:"",omega:"",CC:"",NN:"",QQ:"",RR:"",ZZ:""},Pp="abcdefghijklmnopqrstuvwxyz",hg=Pp.split(""),pg=Pp.toUpperCase().split(""),dg=Object.values(Os),ug=[...hg,...pg,...dg,"$"],fg="|()[]{}\xF7,!<>=*/+-~^_\xB0':%",mg=Object.values(cr),gg=[...fg,...mg],vg={_:"sub","^":"sup","//":"/","\xF7":"/"},mp={"<":"&lt;",">":"&gt;"};function Tp(e){return e in mp?mp[e]:e}var yg=["abs","round","floor","ceil","max","min","mod","lcm","gcd","gcf","log","exp","ln","sqrt","root","sin","cos","tan","sec","csc","cot","cosec","cotan","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","cosech"];function Qs(e){return yg.includes(e)}var hr={"+":"plus","":"minus","\xB7":"times","\xD7":"times","/":"over","//":"divided by","%":"percent","!":"factorial","\xB1":"plus-minus","=":"equals","":"does not equal","<":"is less than",">":"is greater than","":"is less than or equal to","":"is greater than or equal to",:"pi","":"is congruent to","":"is parallel to","":"is perpendicular to"};for(let e of Object.keys(Os))hr[Os[e]]=e;var Sp=e=>typeof e=="number"?e:e[0],kp=e=>typeof e=="number"?[e,e]:e,Rs=class{evaluate(e={},s){return NaN}interval(e={},s){return kp(this.evaluate(e))}substitute(e={}){return this}recursiveSubstitute(e){let s=Object.keys(e);return this.unknowns.filter(t=>s.includes(t)).length?this.substitute(e).recursiveSubstitute(e):this}get simplified(){return this}get unknowns(){return this.variables.filter(e=>!Object.prototype.hasOwnProperty.call(Rl,e))}get variables(){return[]}get functions(){return[]}collapse(){return this}toString(){return""}toVoice(e={}){return""}toMathML(e={}){return""}},Ml=new Set;function Dl(e,s,t=!1){var i;let r=(i=s[e])!=null?i:Rl[e];if(r===void 0)throw nt.undefinedVariable(e);if(typeof r=="string"||r instanceof Rs){if(t||Ml.clear(),Ml.has(e))throw nt.evalLoop(e);return Ml.add(e),typeof r=="string"&&(r=Je.parse(r)),r.evaluate(s,!0)}else return typeof r=="function"?r():r}var Xe=class extends Rs{constructor(e){super(),this.n=e}evaluate(){return this.n}toString(){return`${this.n}`}toVoice(){return`${this.n}`}toMathML(){return`<mn>${this.n}</mn>`}},pr=class extends Rs{constructor(e){super(),this.i=e}evaluate(e={},s){return Sp(Dl(this.i,e,s))}interval(e={},s){return kp(Dl(this.i,e,s))}toMathML(){return`<mi${Qs(this.i)?' mathvariant="normal"':""}>${this.i}</mi>`}substitute(e={}){return e[this.i]||this}get variables(){return[this.i]}toString(){return this.i}toVoice(){return this.i in hr?hr[this.i]:this.i.length===1?`_${this.i}_`:this.i}},bg=class extends Rs{constructor(e){super(),this.s=e}evaluate(e={},s){return Sp(Dl(this.s,e,s))}toString(){return`"${this.s}"`}toVoice(){return this.s}toMathML(){return`<mtext>${this.s}</mtext>`}},Cp=class extends Rs{toString(){return" "}toMathML(){return"<mspace></mspace>"}},Ye=class extends Rs{constructor(e){super(),this.o=e}toString(){return this.o.replace("//","/")}toVoice(){return hr[this.o]||this.o}get functions(){return[this.o]}toMathML(){let e=Tp(this.toString());return`<mo value="${e}">${e}</mo>`}},gp=[-1/0,1/0],lr=[NaN,NaN],Xs=Math.PI/2,Ll=Math.PI*2,Ct=(e,s)=>[e-Number.EPSILON,s+Number.EPSILON],Js=(...e)=>Ct(Math.min(...e),Math.max(...e)),wg=e=>Math.abs(e[1]-e[0]);var ar=e=>isNaN(e[0])||isNaN(e[1]),vp=e=>!isFinite(e[0])&&e[0]===e[1],xg=(e,s)=>Y(s,e[0]-Number.EPSILON,e[1]+Number.EPSILON),gn=e=>xg(e,0),Ke={add:(...e)=>e.reduce((s,t)=>s+t,0),sub:(...e)=>e.length>1?e[0]-e[1]:-e[0],mul:(...e)=>e.reduce((s,t)=>s*t,1),div:(e,s)=>e/s,abs:e=>Math.abs(e),round:e=>Math.round(e),floor:e=>Math.floor(e),ceil:e=>Math.ceil(e),max:(...e)=>Math.max(...e),min:(...e)=>Math.min(...e),mod:(e,s)=>e%s,lcm:(...e)=>Fs(...e),gcd:(...e)=>Fe(...e),gcf:(...e)=>Fe(...e),sup:(e,s)=>Math.pow(e,s),log:(e,s)=>Math.log(e)/(s===void 0?1:Math.log(s)),exp:e=>Math.exp(e),ln:e=>Math.log(e),sqrt:e=>Math.sqrt(e),root:(e,s)=>Math.pow(e,1/s),sin:e=>Math.sin(e),cos:e=>Math.cos(e),tan:e=>Math.tan(e),sec:e=>1/Math.cos(e),csc:e=>1/Math.sin(e),cot:e=>1/Math.tan(e),cosec:e=>Ke.csc(e),cotan:e=>Ke.cot(e),arcsin:e=>Math.asin(e),arccos:e=>Math.acos(e),arctan:e=>Math.atan(e),sinh:e=>Math.sinh(e),cosh:e=>Math.cosh(e),tanh:e=>Math.tanh(e),sech:e=>1/Math.cosh(e),csch:e=>1/Math.sinh(e),coth:e=>1/Math.tanh(e),cosech:e=>Ke.csch(e)};function fn(e,s){if(e[0]>0)return s[0]>=0?Ct(e[0]**s[0],e[1]**s[1]):Js(e[0]**s[0],e[0]**s[1],e[1]**s[0],e[1]**s[1]);let t=s[0];return Number.isInteger(t)&&t===s[1]?t===0?[gn(e)?0:1,1]:t%2?Ct(e[0]**t,e[1]**t):gn(e)?[0,Math.max(e[0]**t,e[1]**t)]:Js(e[1]**t,e[0]**t):lr}function yp(e,s=Ll){let t=Math.floor(e[0]/s)*s;return[e[0]-t,e[1]-t]}var X={add:(...e)=>Ct(_(e.map(s=>s[0])),_(e.map(s=>s[1]))),sub:(e,s)=>s!==void 0?Ct(e[0]-s[1],e[1]-s[0]):Ct(-e[1],-e[0]),mul:(e,...s)=>(s.length>1&&(s=[X.mul(...s)]),Js(e[0]*s[0][0],e[0]*s[0][1],e[1]*s[0][0],e[1]*s[0][1])),div:(e,s)=>gn(s)?gp:Js(e[0]/s[0],e[0]/s[1],e[1]/s[0],e[1]/s[1]),abs:e=>gn(e)?Ct(0,Math.max(-e[0],e[1])):Js(Math.abs(e[0]),Math.abs(e[1])),round:e=>Ct(Math.round(e[0]),Math.round(e[1])),floor:e=>Ct(Math.floor(e[0]),Math.floor(e[1])),ceil:e=>Ct(Math.ceil(e[0]),Math.ceil(e[1])),max:(...e)=>Ct(Math.max(...e.map(s=>s[0])),Math.max(...e.map(s=>s[1]))),min:(...e)=>Ct(Math.min(...e.map(s=>s[0])),Math.min(...e.map(s=>s[1]))),mod:(e,s)=>{if(ar(e)||ar(s))return lr;let t=e[0]/(e[0]<0?s[0]:s[1]);return t=t<0?Math.ceil(t):Math.floor(t),X.sub(e,X.mul(s,[t,t]))},lcm:(...e)=>Js(Fs(...e.map(s=>s[0]))),gcd:(...e)=>Js(Fe(...e.map(s=>s[0]))),gcf:(...e)=>X.gcd(...e),sup:(e,s)=>fn(e,s),log:(e,s)=>(s!==void 0&&X.div(X.log(e),X.log(s)),Ct(e[0]<=0?-1/0:Math.log(e[0]),Math.log(e[1]))),exp:e=>fn([Math.E,Math.E],e),ln:e=>X.log(e),sqrt:e=>fn(e,[.5,.5]),root:(e,s)=>fn(e,X.div([1,1],s)),sin:e=>X.cos(X.sub(e,[Xs,Xs])),cos:e=>ar(e)||vp(e)?lr:wg(e)>=Ll-Number.EPSILON?[-1,1]:(e=yp(e),e[0]>Math.PI+Number.EPSILON?X.sub(X.cos(X.sub(e,[Math.PI,Math.PI]))):e[1]<Math.PI-Number.EPSILON?Ct(Math.cos(e[1]),Math.cos(e[0])):e[1]<Ll-Number.EPSILON?Ct(-1,Math.max(Math.cos(e[1]),Math.cos(e[0]))):Ct(-1,1)),tan:e=>ar(e)||vp(e)?lr:(e=yp(e,Math.PI),e[0]>Xs+Number.EPSILON&&(e=X.sub(e,[Math.PI,Math.PI])),e[0]<-Xs+Number.EPSILON||e[1]>Xs-Number.EPSILON?gp:Ct(Math.tan(e[0]),Math.tan(e[1]))),sec:e=>X.div([1,1],X.cos(e)),csc:e=>X.div([1,1],X.sin(e)),cot:e=>X.div([1,1],X.tan(e)),cosec:e=>X.csc(e),cotan:e=>X.cot(e),arcsin:e=>ar(e)||e[1]<-1||e[0]>1?lr:Ct(e[0]<=-1?-Xs:Math.asin(e[0]),e[1]>=1?Xs:Math.asin(e[1])),arccos:e=>ar(e)||e[1]<-1||e[0]>1?lr:Ct(e[1]>=1?0:Math.acos(e[1]),e[0]<=-1?Math.PI:Math.acos(e[0])),arctan:e=>Ct(Math.atan(e[0]),Math.atan(e[1])),sinh:e=>Ct(Math.sinh(e[0]),Math.sinh(e[1])),cosh:e=>e[1]<0?Ct(Math.cosh(e[1]),Math.cosh(e[0])):e[0]>0?Ct(Math.cosh(e[0]),Math.cosh(e[1])):Ct(1,Math.cosh(Math.max(-e[0],e[1]))),tanh:e=>Ct(Math.tanh(e[0]),Math.tanh(e[1])),sech:e=>X.div([1,1],X.cosh(e)),csch:e=>X.div([1,1],X.sinh(e)),coth:e=>X.div([1,1],X.tanh(e)),cosech:e=>X.csch(e)},mn=Lt("+  * \xD7 \xB7 / \xF7 // sup sub subsup"),bp=Lt("sub sup subsup"),Al='<mo value="," lspace="0">,</mo>';function Mp(e,s){return mn.includes(s)?e instanceof vn?!0:!(e instanceof Ft)||!mn.includes(e.fn)?!1:bp.includes(e.fn)&&bp.includes(s)?!0:mn.indexOf(s)>mn.indexOf(e.fn):!1}function $g(e,s,t){return Mp(e,s)?`<mfenced>${t}</mfenced>`:t}function Ls(e,s){return e instanceof vn||e instanceof Ft?`<mrow>${s}</mrow>`:s}function wp(e){return e==="2"?"squared":e==="3"?"cubed":`to the power of ${e}`}var Ft=class extends Rs{constructor(e,s=[]){super(),this.fn=e,this.args=s}evaluate(e={}){let s=this.args.map(t=>t.evaluate(e));if(this.fn in e){let t=e[this.fn];if(typeof t=="function")return t(...s);if(typeof t=="number"&&s.length===1)return Ke.mul(t,s[0]);throw nt.uncallableExpression(this.fn)}if(this.fn==="+")return Ke.add(...s);if(this.fn==="")return Ke.sub(...s);if(["*","\xB7","\xD7"].includes(this.fn))return Ke.mul(...s);if(this.fn==="/")return Ke.div(...s);if(this.fn==="sup")return Ke.sup(...s);if(Qs(this.fn))return Ke[this.fn](...s);if(this.fn==="(")return s[0];throw nt.undefinedFunction(this.fn)}interval(e={}){let s=this.args.map(t=>t.interval(e));if(this.fn in e){let t=e[this.fn];if(typeof t=="function")return le(t(...s.map(i=>i[0])),2);if(typeof t=="number"&&s.length===1)return X.mul([t,t],s[0]);if(Array.isArray(t)&&s.length===1)return X.mul(t,s[0]);throw nt.uncallableExpression(this.fn)}if(this.fn==="+")return X.add(...s);if(this.fn==="")return X.sub(...s);if(["*","\xB7","\xD7"].includes(this.fn))return X.mul(...s);if(this.fn==="/")return X.div(...s);if(this.fn==="sup")return X.sup(...s);if(Qs(this.fn))return X[this.fn](...s);if(this.fn==="(")return s[0];throw nt.undefinedFunction(this.fn)}substitute(e={}){return new Ft(this.fn,this.args.map(s=>s.substitute(e)))}collapse(){return this.fn==="("?this.args[0].collapse():new Ft(this.fn,this.args.map(e=>e.collapse()))}get simplified(){return this}get variables(){return re(Wt(this.args.map(e=>e.variables)))}get functions(){return re([this.fn,...Wt(this.args.map(e=>e.functions))])}toString(){let e=this.args.map(s=>Mp(s,this.fn)?`(${s.toString()})`:s.toString());return this.fn===""?e.length>1?e.join("  "):`${e[0]}`:this.fn==="sup"?e.join("^"):this.fn==="sub"?e.join("_"):this.fn==="subsup"?`${e[0]}_${e[1]}^${e[2]}`:Lt("+ * \xD7 \xB7 / = < >   ").includes(this.fn)?e.join(` ${this.fn} `):$t(this.fn,"(","[","{")?this.fn+this.args.join(", ")+Vl[this.fn]:$t(this.fn,"!","%")?e[0]+this.fn:`${this.fn}(${e.join(", ")})`}toMathML(e={}){let s=this.args.map(r=>r.toMathML(e)),t=this.args.map((r,o)=>$g(r,this.fn,s[o]));if(this.fn in e){let r=s.map((o,n)=>({toString:()=>o,val:this.args[n]}));return e[this.fn](...r)}if(this.fn==="")return t.length>1?t.join('<mo value=""></mo>'):`<mo rspace="0" value=""></mo>${t[0]}`;if($t(this.fn,"+","=","<",">","","","")){let r=Tp(this.fn);return t.join(`<mo value="${r}">${r}</mo>`)}if($t(this.fn,"*","\xD7","\xB7")){let r=t[0];for(let o=1;o<t.length-1;++o){let n=this.args[0]instanceof Xe&&this.args[1]instanceof Xe;r+=(n?'<mo value="\xD7">\xD7</mo>':"")+t[1]}return r}if(this.fn==="//")return t.join('<mo value="/">/</mo>');if(this.fn==="sqrt")return`<msqrt>${t[0]}</msqrt>`;if($t(this.fn,"/","root")){let r=this.fn==="/"?"mfrac":"mroot",o=this.args.map((n,a)=>Ls(n,s[a]));return`<${r}>${o.join("")}</${r}>`}if($t(this.fn,"sup","sub")){let r=[Ls(this.args[0],t[0]),Ls(this.args[1],s[1])];return`<m${this.fn}>${r.join("")}</m${this.fn}>`}return this.fn==="subsup"?`<msubsup>${[Ls(this.args[0],t[0]),Ls(this.args[1],s[1]),Ls(this.args[2],s[2])].join("")}</msubsup>`:$t(this.fn,"(","[","{")?`<mfenced open="${this.fn}" close="${Vl[this.fn]}">${t.join(Al)}</mfenced>`:$t(this.fn,"!","%")?`${t[0]}<mo value="${this.fn}" lspace="0">${this.fn}</mo>`:this.fn==="abs"?`<mfenced open="|" close="|">${t.join(Al)}</mfenced>`:this.fn==="bar"?`<mover>${Ls(this.args[0],t[0])}<mo value=""></mo></mover>`:this.fn==="vec"?`<mover>${Ls(this.args[0],t[0])}<mo value=""></mo></mover>`:`<mi${Qs(this.fn)?' mathvariant="normal"':""}>${this.fn}</mi><mfenced>${t.join(Al)}</mfenced>`}toVoice(e={}){let s=this.args.map(i=>i.toVoice(e)),t=s.join(" ");if(this.fn in e){let i=s.map((r,o)=>({toString:()=>r,val:this.args[o]}));return e[this.fn](...i)}return $t(this.fn,"(","[","{")?t:this.fn==="sqrt"?`square root of ${t}`:this.fn==="%"?`${t} percent`:this.fn==="!"?`${t} factorial`:this.fn==="/"?`${s[0]} over ${s[1]}`:this.fn==="//"?`${s[0]} divided by ${s[1]}`:this.fn==="sub"?t:this.fn==="subsup"?`${s[0]} ${s[1]} ${wp(s[2])}`:this.fn==="sup"?`${s[0]} ${wp(s[1])}`:hr[this.fn]?s.join(` ${hr[this.fn]} `):Qs(this.fn)?`${this.fn} ${t}`:`${this.fn} of ${t}`}},vn=class extends Rs{constructor(e){super(),this.items=e}evaluate(e={}){return this.collapse().evaluate(e)}interval(e={}){return this.collapse().interval(e)}substitute(e={}){return this.collapse().substitute(e)}get simplified(){return this.collapse().simplified}get variables(){return re(zc(...this.items.map(e=>e.variables)))}get functions(){return this.collapse().functions}toString(){return this.items.map(e=>e.toString()).join(" ")}toMathML(e={}){return this.items.map(s=>s.toMathML(e)).join("")}toVoice(e={}){return this.items.map(s=>s.toVoice(e)).join(" ")}collapse(){return Ol(this.items).collapse()}};function El(e,s){if(s===2)return new bg(e);if(!(!e||!s)){if(s===1&&e.length>1)return new Cp;if(s===3){if(isNaN(+e))throw nt.invalidExpression();return new Xe(+e)}if(s===4)return e in Os?new pr(Os[e]):e in cr?new Ye(cr[e]):new pr(e);if(s===5)return e in cr?new Ye(cr[e]):new Ye(e)}}function Pg(e){let s=[],t="",i=0;for(let o of e){if(o==='"'){let a=i===2?0:2,l=El(t,i);l&&s.push(l),t="",i=a;continue}else if(i===2){t+=o;continue}let n=o.match(/[0-9.]/)?3:ug.includes(o)?4:gg.includes(o)?5:o.match(/\s/)?1:0;if(!n)throw nt.invalidCharacter(o);if(!i||i===3&&n!==3||i===4&&n!==4&&n!==3||i===5&&!(t+o in cr)||i===1&&n!==1){let a=El(t,i);a&&s.push(a),t="",i=n}t+=o}let r=El(t,i);return r&&s.push(r),s}function Tg(e){return e.length>1?new vn(e):e[0]instanceof Ye?new vn(e):e[0]}function Sg(e,s){let t=[[]];for(let i of e)s(i)?t.push([]):z(t).push(i);return t}function ee(e,s){return e instanceof Ye&&Lt(s).includes(e.o)}function so(e){return e instanceof Ft&&e.fn==="("?e.args[0]:e}function yn(e,s){if(ee(e[0],s))throw nt.startOperator(e[0]);if(ee(z(e),s))throw nt.endOperator(z(e));for(let t=1;t<e.length-1;++t){if(!ee(e[t],s))continue;let i=e[t],r=e[t-1],o=e[t+1];if(r instanceof Ye)throw nt.consecutiveOperators(r.o,i.o);if(o instanceof Ye)throw nt.consecutiveOperators(i.o,o.o);let n=e[t+2];if(s==="^ _"&&ee(i,"_ ^")&&ee(n,"_ ^")&&i.o!==n.o){let a=e[t+3];if(a instanceof Ye)throw nt.consecutiveOperators(n.o,a.o);let l=[so(r),so(o),so(a)];i.o==="^"&&([l[1],l[2]]=[l[2],l[1]]),e.splice(t-1,5,new Ft("subsup",l)),t-=4}else{let a=vg[i.o]||i.o,l=[so(r),so(o)];e.splice(t-1,3,new Ft(a,l)),t-=2}}}function xp(e){return yn(e,"^ _"),yn(e,"/"),Tg(e)}function kg(e,s){let t=[[]],i=["",...(s==null?void 0:s.variables)||[]];for(let r of e){let o=z(t).length?z(t)[0].o:void 0;if(ee(r,") ] }")){if(!ee(r,Vl[o]))throw nt.conflictingBrackets(r.o);let n=t.pop(),a=z(t),l=z(a),p=ee(r,")")&&l instanceof pr&&!i.includes(l.i)?a.pop().i:n[0].o,u=Sg(n.slice(1),f=>ee(f,","));a.push(new Ft(p,u.map(xp)))}else ee(r,"( [ {")?t.push([r]):z(t).push(r)}if(t.length>1)throw nt.unclosedBracket(z(t)[0].o);return xp(t[0])}function $p(e,s,t=!1){let i=[],r=[],o=!1;function n(){if(o)throw nt.invalidExpression();r.length&&(i.push(r.length>1?new Ft(s[0],r):r[0]),r=[])}for(let a of e)if(ee(a,s)){if(o||!r.length)throw nt.invalidExpression();o=!0}else if(a instanceof Ye)n(),i.push(a),o=!1;else{let l=!t||a instanceof Xe;if(r.length&&!o&&l)throw nt.invalidExpression();r.push(a),o=!1}return n(),i}function Ol(e){if(e=e.filter(t=>!(t instanceof Cp)),!e.length)throw nt.invalidExpression();let s=e.findIndex(t=>ee(t,"= < >  "));if(s===0)throw nt.startOperator(e[0]);if(s===e.length-1)throw nt.endOperator(e[0]);if(s>0){let t=Ol(e.slice(0,s)),i=Ol(e.slice(s+1));return new Ft(e[s].o,[t,i])}if(ee(e[0],"%!"))throw nt.startOperator(e[0]);for(let t=0;t<e.length;++t)ee(e[t],"%!")&&(e.splice(t-1,2,new Ft(e[t].o,[e[t-1]])),t-=1);yn(e,"// \xF7");for(let t=1;t<e.length;++t){let i=e[t];if(i instanceof Ft&&i.fn==="/"){let r=e[t-1];if(r instanceof Xe)e.splice(t-1,2,new Ft("+",[r,i])),t-=1;else if(!(r instanceof Ye))throw nt.consecutiveOperators(r.toString(),i.toString())}}if(e=$p(e,"\xD7 * \xB7",!0),ee(e[0]," \xB1")&&e.splice(0,2,new Ft(e[0].o,[e[1]])),yn(e," \xB1"),ee(e[0],"+")&&(e=e.slice(1)),e=$p(e,"+"),e.length>1)throw nt.invalidExpression();return e[0]}function Cg(e,s=!1,t){let i=kg(Pg(e),t);return s?i.collapse():i}function Mg(e,s){try{let t=re([...e.variables,...s.variables]),i=e.collapse(),r=s.collapse(),o=0;for(let n=0;n<5;++n){let a={};for(let p of t)a[p]=Rl[p]||Math.random()*5;let l=i.evaluate(a),c=r.evaluate(a);if(!(isNaN(l)||isNaN(c))){if(!E(l,c))return!1;o+=1}}return!!o}catch(t){return!1}}var Je={numEquals:Mg,parse:Zt(Cg)};var bn=class{constructor(){this.callbacks=[]}add(s){this.callbacks.push(s)}start(s=1e3){return et(i=>{for(let r of this.callbacks)r(i)},s).promise}};function Ap(e,s){return e.every((t,i)=>E(t,s[i]))}function Ep(e,s){e.scale*=s.scale,e.x=e.x*s.scale+s.x,e.y=e.y*s.scale+s.y}function Vp(e,s){return E(e.x,s.x)&&E(e.y,s.y)&&E(e.scale,s.scale)}function wn(e,s,t){if(t==="adding"){let i=e.strokeLength,r=s<.5?0:wt("cubic-in",s*2-1);e.css({"stroke-dasharray":i+"px","stroke-dashoffset":i*(1-r)+"px"})}else if(t==="deleting"){let i=e.strokeLength,r=s<.5?wt("cubic-in",2*s):1;e.css({"stroke-dasharray":i+"px","stroke-dashoffset":i*(2-r)+"px"})}}function Dp(e,s){let t=[e],i=e.expr;for(;s.startsWith(i);){if(s===i)return t;let r=z(t).next;if(!r)return;t.push(r),i+=r.expr}}function Lp(e,s,t=1){let i=t*Math.abs(s.x-e.x)/3,r=d.average(e,s).shift(0,i);return function(o){let n=(1-o)**2*e.x+2*o*(1-o)*r.x+o*o*s.x,a=(1-o)**2*e.y+2*o*(1-o)*r.y+o*o*s.y;return{x:n,y:a}}}function Il(e,s){return Math.max(s*e,.4)/e}function fs(e){return e instanceof Qe&&e.children.length>1||e instanceof ti?`(${e.expr})`:e.expr}function ts(e,s){return s.length===1&&s[0].type==="mrow"?s[0]:new Qe(s,e)}var qt=class{constructor(s,t,i,r){this.type=s;this.equation=i;this.$element=r;this.children=[];this.status="";this.value="";this.customColor="";this.roundedMotion=!1;this.width=0;this.height=0;this.baseline=0;this.transform={x:0,y:0,scale:1};this.currentDimensions=[0,0,0];this.currentWorldTransform={x:0,y:0,scale:1};this.addChildren(t),r&&i.$row.append(r)}get expr(){return""}get log(){let s=this.children.map(t=>t.log);return`<${this.type}>${s.join("")}</${this.type}>`}get color(){return this.customColor||(this.parent?this.parent.color:"")}static create(s,t){let i=s.nodeName.toLowerCase();if($t(i,"mn","mi","mo","mtext")){if(s.textContent==="placeholder")return new ro(t);let o=s.getAttribute("mathvariant")||void 0;return new Is(i,s.textContent||"",t,o)}if(!$t(i,"mrow","mfrac","mfenced","msqrt","mroot","msub","msup","msubsup","munder","mover","munderover","mspace"))return new zl(s,t);if(i==="mfenced"&&s.getAttribute("open")==="["){let o=s.children.length,n=Wt(Array.from(s.children,l=>Array.from(l.children,c=>qt.create(c,t)))),a=new _l(n,t,o);return new ur([a],t)}let r=Array.from(s.children,o=>qt.create(o,t));switch(i){case"mrow":return new Qe(r,t);case"mfrac":return r=r.map(o=>ts(t,[o])),new oo(r,t);case"mfenced":return r=[ts(t,r)],new ur(r,t);case"msqrt":return r=[ts(t,r)],new si(i,r,t);case"mroot":return r=r.map(o=>ts(t,[o])),new si(i,r,t);case"msub":case"msup":case"msubsup":return r=r.map(o=>ts(t,[o])),new ti(i,r,t);case"munder":case"mover":case"munderover":return r=r.map(o=>ts(t,[o])),new Gl(i,r,t);case"mspace":return new io(t)}throw new Error(`Unknown element type tag ${s.nodeName}`)}get marginLeft(){return .1}get marginRight(){return .1}setTransform(s=0,t=0,i=1){this.transform.x=s,this.transform.y=t,this.transform.scale=i}get worldTransform(){let s=this,t=Object.assign({},this.transform);for(;s=s.parent;)Ep(t,s.transform);return t}get index(){return this.parent?this.parent.children.indexOf(this):-1}get next(){if(!this.parent)return;let s=this.parent.children.indexOf(this);return this.parent.children[s+1]}get prev(){if(!this.parent)return;let s=this.parent.children.indexOf(this);return this.parent.children[s-1]}addChildren(s,t=this.children.length){for(let i of this.children)i.type==="placeholder"&&i.deleteFromDom();for(let i of s)i.detach(),i.parent=this;this.children.splice(t,0,...s)}insertAfter(s){let t=this.parent.children.indexOf(this);this.parent.addChildren(s,t+1)}insertBefore(s){let t=this.parent.children.indexOf(this);this.parent.addChildren(s,t)}detach(){if(this.parent){let s=this.parent.children.indexOf(this);s>=0&&this.parent.children.splice(s,1),this.parent=void 0}}deleteFromDom(){this.parent&&this.detach(),this.$element&&this.$element.remove(),this.$element=void 0;for(let s of this.children.slice(0))s.deleteFromDom()}*parents(s=!1){let t=s?this:this.parent;for(;t;)yield t,t=t.parent}hasParent(s,t=!1){return Xt(this.parents(t),s)}hitTest(s){let{x:t,scale:i}=this.worldTransform,r=this.marginLeft*i*this.equation.fontSize,o=this.marginRight*i*this.equation.fontSize;if(Y(s.x,t-r,t+this.width*i+r+o))return this.hitTestChildren(s)||this}hitTestChildren(s){for(let t of this.children){let i=t.hitTest(s);if(i)return i}}measure(s=1){for(let t of this.children)t.measure(s)}clean(){for(let s of this.children)s.clean()}setStatus(s){this.status=s;for(let t of this.children)t.setStatus(s)}render(s){for(let l of this.children)l.render(s);if(!this.$element)return;let t=this.currentWorldTransform,i=this.currentWorldTransform=this.worldTransform,r=this.currentDimensions,o=this.currentDimensions=[this.width,this.height,this.baseline];if(Vp(t,i)&&Ap(r,o)&&!this.status)return;if(!s){this.positionElement(i),this.drawElement(1,o[0],o[1],o[2],i.scale);return}this.status==="adding"&&this.positionElement(i);let n=i.y+this.baseline<this.equation.root.baseline?-1:1,a=this.roundedMotion?Lp(t,i,n):void 0;this.roundedMotion=!1,s.add(l=>{if(!this.$element)return;let c=wt("cubic",l),p=$t(this.status,"adding","deleting"),u=p?o[0]:rt(r[0],o[0],c),f=p?o[1]:rt(r[1],o[1],c),v=p?o[2]:rt(r[2],o[2],c),m=p?i.scale:rt(t.scale,i.scale,c);if(this.drawElement(l,u,f,v,m),!this.status){let g=a?a(c):d.interpolate(t,i,c);this.positionElement({x:g.x,y:g.y,scale:m})}})}positionElement(s){this.$element.setTransform(s,0,s.scale)}drawElement(s,t,i,r,o){}},Ag="acegmnopqrsuvwxyz",ei=1.1,dr=.2,Nl=new Set(["=","","<",">","",""]),Eg=document.createElement("canvas"),Op=Eg.getContext("2d"),Vg=Zt((e,s)=>(Op.font=`${s}px "Source Sans Pro", sans-serif`,Op.measureText(e).width)),Is=class extends qt{constructor(t,i,r,o){super(t,[],r,h("text",{}));this.variant=o;this.setValue(i)}setValue(t){this.$element.text=this.value=t;let i=this.value.split("").every(o=>Ag.includes(o));this.width=Vg(t,this.equation.fontSize),this.height=(ei-(i?.1:0))*this.equation.fontSize,this.baseline=this.height-dr*this.equation.fontSize;let r=this.type==="mtext"||this.variant==="normal";this.$element.setClass("font-normal",r||Qs(this.value))}get expr(){return this.value==="xx"?'"xx"':this.type==="mtext"?`"${this.value}"`:this.value}get log(){return`<${this.type}>${this.value}</${this.type}>`}get marginLeft(){if(this.type==="mo")return Nl.has(this.value)?this.equation.isDisplay?.5:.35:$t(this.value,"","","!","%","")||$t(this.value,"","\xB0")&&this.prev&&this.prev.type==="mn"?0:.25;if(this.type==="mi"){if(this.prev&&this.prev.type==="mn")return .1;if(this.prev&&this.prev.type==="mi")return .05;if(this.prev&&this.prev.type==="mfrac")return .15}return 0}get marginRight(){return this.type==="mo"?this.equation.isDisplay&&Nl.has(this.value)?.5:$t(this.value,"","")?0:this.value===""&&(!this.prev||Nl.has(this.prev.value))?.1:.25:0}positionElement(t){if(!this.$element)return;let i=(this.equation.fontSize-this.baseline)*t.scale;this.$element.setTransform({x:t.x,y:t.y-i},0,t.scale)}drawElement(t,i,r,o,n){this.status==="adding"?this.$element.setAttr("opacity",t<.5?0:wt("cubic-in",t*2-1)):this.status==="deleting"&&this.$element.setAttr("opacity",t<.5?1-wt("cubic-in",2*t):0),this.$element.css("stroke-width",(1-n)*1.5+"px"),this.$element.css("color",this.color||"currentColor")}},io=class extends qt{constructor(s){super("mspace",[],s),this.height=(ei-.1)*s.fontSize,this.baseline=this.height-dr*this.equation.fontSize,this.width=s.fontSize*.2}get expr(){return" "}},Qe=class extends qt{constructor(t,i,r,o=0){super("mrow",t,i);this.align=r;this.dx=o}addChildren(t,i=this.children.length){let r=[];for(let o of t)o.type==="mrow"?(r.push(...o.children),o.detach()):r.push(o);super.addChildren(r,i)}get expr(){return this.children.map(t=>t.expr).join(" ").replace(/ /,"")||"placeholder"}measure(t=1){if(super.measure(t),!this.children.length){this.height=this.width=this.baseline=0;return}this.baseline=Math.max(...this.children.map(r=>r.baseline)),this.height=this.baseline+Math.max(...this.children.map(r=>r.height-r.baseline));let i=0;for(let[r,o]of this.children.entries())o.setTransform(i,this.baseline-o.baseline),i+=o.width,r<this.children.length-1&&(i+=Math.max(o.marginRight,this.children[r+1].marginLeft)*this.equation.fontSize);if(this.align){let r=this.children.find(o=>o.expr===this.align);r&&(this.transform.x=this.dx-r.transform.x-r.width/2)}this.width=i}},ro=class extends qt{constructor(s){let t=s.fontSize,i=`M${.1*t} ${.3*t}h${t/2}v${t/2}h-${t/2}Z`,r=h("path",{class:"placeholder",d:i});super("placeholder",[],s,r),this.width=.7*t,this.height=ei*t,this.baseline=this.height-dr*t}get expr(){return"placeholder"}get marginLeft(){return 0}get marginRight(){return 0}},oo=class extends qt{constructor(s,t){super("mfrac",s,t,h("line"))}get expr(){return this.children.map(s=>fs(s)).join("/")}measure(s){let t=this.hasParent(a=>a.type==="mfrac"||a.type==="matrix"),i=Il(s,!this.equation.isDisplay||t?.66:1),r=.1*this.equation.fontSize,[o,n]=this.children;super.measure(s*i),this.width=(Math.max(o.width,n.width)+2*r)*i,this.height=(o.height+n.height)*i,this.baseline=o.height*i+this.equation.fontSize*(ei/2-dr),o.setTransform((this.width-o.width*i)/2,0,i),n.setTransform((this.width-n.width*i)/2,o.height*i,i)}drawElement(s,t,i,r){let o=r-this.equation.fontSize*(ei/2-dr);this.$element.setLine({x:0,y:o},{x:t,y:o}),this.$element.setAttr("stroke",this.color||"currentColor"),wn(this.$element,s,this.status)}hitTestChildren(s){let{scale:t,y:i}=this.worldTransform,r=this.baseline-this.equation.fontSize*(ei/2-dr),o=s.y<=i+r*t,n=this.children[o?0:1];return n.hitTestChildren(s)||n}},ti=class extends qt{get expr(){let s=fs(this.children[0]);return this.type!=="msup"&&(s+="_"+fs(this.children[1])),this.type==="msup"&&(s+="^"+fs(this.children[1])),this.type==="msubsup"&&(s+="^"+fs(this.children[2])),s}measure(s){let[t,i,r]=this.children,o=this.type==="msup"?void 0:i,n=this.type==="msubsup"?r:this.type==="msup"?i:void 0,a=.05*this.equation.fontSize,l=Il(s,.65);t.measure(s),o&&o.measure(s*l),n&&n.measure(s*l);let c=n?n.height*l-.4*this.equation.fontSize:0,p=o?o.height*l-.5*this.equation.fontSize:0,u=n?n.width:0,f=o?o.width:0;this.width=t.width+a+Math.max(u,f)*l,this.height=t.height+c+p,this.baseline=t.baseline+c,t.setTransform(0,this.baseline-t.baseline),n&&n.setTransform(t.width+a,0,l),o&&o.setTransform(t.width+a,this.height-o.height*l,l)}clean(){if(super.clean(),this.children=this.children.filter(s=>s.type!=="mrow"||s.children.length),this.children.length===0)return this.detach();this.children.length===1&&(this.insertAfter(this.children),this.detach())}},Gl=class extends qt{get expr(){let s=this.children[0].expr;return this.type!=="munder"&&(s+="_"+fs(this.children[1])),this.type==="mover"&&(s+="^"+fs(this.children[1])),this.type==="munderover"&&(s+="^"+fs(this.children[2])),s}measure(s){super.measure(s)}},ur=class extends qt{constructor(s,t){super("mfenced",s,t,h("path"))}get expr(){return`(${this.children.map(s=>s.expr).join(",")})`}get marginLeft(){return .2}get marginRight(){return .2}measure(s){super.measure(s);let t=this.children[0];this.height=t.height+2,this.baseline=t.baseline+1;let i=1+this.height/this.equation.fontSize,r=.1*this.equation.fontSize;this.width=t.width+2*(i+r),t.setTransform(i+r,1)}drawElement(s,t,i){let r=Math.min(2+i/this.equation.fontSize,5),o=i-4,n=t-r,a=`M${r},2c${-2*r/3},${.15*o},${-r},${.32*o},${-r},${o/2}s${r/3},${.35*o},${r},${o/2}M${n},2c${2*r/3},${.15*o},${r},${.32*o},${r},${o/2}s${-r/3},${.35*o},${-r},${o/2}`;this.$element.setAttr("d",a),this.$element.css("stroke",this.color||"currentColor"),wn(this.$element,s,this.status)}clean(){super.clean(),this.children.length||this.detach()}},si=class extends qt{constructor(s,t,i){super(s,t,i,h("path"))}get expr(){return`sqrt(${this.children.map(s=>s.expr).join(", ")})`}get marginLeft(){return .2}get marginRight(){return .2}measure(s){super.measure(s);let t=this.children[0];this.height=t.height+2,this.baseline=t.baseline+2;let i=Math.min(16,3+5*this.height/this.equation.fontSize),r=.05*this.equation.fontSize;this.width=t.width+i+2*r,t.setTransform(i+r,2)}drawElement(s,t,i){let r=Math.min(16,3+5*i/this.equation.fontSize),o=i-2,n=`M0,${.55*o}L${.18*r},${.51*o}L${.45*r},${o}L${r},2L${t},2`;this.$element.setAttr("d",n),this.$element.css("stroke",this.color||"currentColor"),wn(this.$element,s,this.status)}clean(){super.clean(),this.children.length||this.detach()}},_l=class extends qt{constructor(t,i,r){super("matrix",t,i,h("g"));this.rows=r;this.cols=Math.floor(t.length/r)}get expr(){return`${this.children.map(t=>t.expr).join(", ")}`}measure(t){super.measure(t);let i=.6*this.equation.fontSize,r=I(a=>Math.max(...I(l=>this.children[a*this.cols+l].height,this.cols)),this.rows),o=I(a=>Math.max(...I(l=>this.children[l*this.cols+a].width,this.rows)),this.cols);this.height=_(r)+(this.rows-1)*i/2,this.width=_(o)+this.cols*i,this.baseline=(this.height+ei*this.equation.fontSize)/2;let n=0;for(let a=0;a<this.rows;++a){let l=i/2;for(let c=0;c<this.cols;++c){let p=this.children[a*this.cols+c],u=l+(o[c]-p.width)/2,f=n+(r[a]-p.height)/2;p.setTransform(u,f),l+=o[c]+i}n+=r[a]+i/2}}},zl=class extends qt{constructor(t,i){var r;super("foreign",[],i,h("g"));this.$body=h("div",{},i.$overlay),this.$body._el.append(t),this.$measure=h("span",{text:".",style:"font-size: 0"},this.$body),this.checkForResize(),this.$body.on("resize",()=>{this.checkForResize()&&this.equation.resize()}),(r=this.$body.$("x-blank, x-blank-mc"))==null||r.on("solve",o=>{Bs(()=>this.replace(o.solution,"#0f82f2"),o.restore?0:200)})}deleteFromDom(){var t;super.deleteFromDom(),(t=this.$body)==null||t.remove(),this.$body=void 0,this.$measure=void 0}replace(t,i){var n;let r=Number.isNaN(+t)?"mtext":"mn",o=new Is(r,t,this.equation);o.customColor=i,this.insertAfter([o]),(n=this.$body)==null||n.off("resize"),this.deleteFromDom(),this.equation.resize()}checkForResize(){var o,n;let t=this.height,i=this.width,r=this.baseline;return this.height=((o=this.$body)==null?void 0:o.height)||0,this.width=((n=this.$body)==null?void 0:n.width)||0,this.baseline=this.$measure.bounds.top-this.$body.bounds.top,!(E(t,this.height)&&E(i,this.width)&&E(r,this.baseline))}positionElement(t){var i,r;(i=this.$body)==null||i.css({left:t.x+"px",top:t.y+"px"}),E(t.scale,1)||(r=this.$body)==null||r.css("transform",`scale(${t.scale})`)}get expr(){var t;return`"${(t=this.$body)==null?void 0:t.text}"`}get log(){return`<foreign>${this.expr}</foreign>`}};var Re=class extends As{constructor(t,i,r=0,o="=",n=18,a=!0){super();this.$row=t;this.$overlay=i;this.fontSize=n;this.isDisplay=a;this.isReady=!0;this.deletedNodes=new Set;this.root=new Qe([],this,o,r)}setValue(t){let i=Array.isArray(t)?t.map(r=>qt.create(r,this)):this.parse(t);for(;this.root.children.length;)this.root.children[0].deleteFromDom();this.root.addChildren(i),this.updateDescription(),this.resize()}updateDescription(){try{let t=Je.parse(this.root.expr).toVoice();this.$row.setAttr("aria-label",t)}catch(t){this.$row.setAttr("aria-label","Invalid expression: "+this.root.expr)}}resize(){this.root.measure(),this.root.render()}parse(t){var a;let i=new DOMParser,r=Je.parse(t).toMathML(),o=i.parseFromString(`<math>${r}</math>`,"text/xml");if(((a=o.firstChild)==null?void 0:a.nodeName)==="parsererror")throw new Error(o.firstChild.textContent);let n=o.firstChild.childNodes;return Array.from(n,l=>qt.create(l,this))}find(t){let[i,r]=t.split("`");i=i.replace(/[-]/g,"");let o=+r||1,n=this.root.children.slice(0),a=0;for(;n.length;){let l=n.shift(),c=l instanceof Qe?void 0:Dp(l,i);if(c&&(a+=1,a===o))return c;n.unshift(...l.children)}throw new Error(`Can't find element ${i}.`)}animate(t=1200){return H(this,null,function*(){this.isReady=!1,this.root.clean(),this.root.measure();let i=new bn;this.root.render(i),this.trigger("resize",{height:this.root.height});for(let r of this.deletedNodes)r.render(i);yield i.start(t);for(let r of this.deletedNodes)r.deleteFromDom();this.root.setStatus(""),this.deletedNodes.clear(),this.isReady=!0})}addTermAfter(t,i){let r=z(i?this.find(i):this.root.children),o=this.parse(t);r.insertAfter(o);for(let n of o)n.setStatus("adding");this.updateDescription()}addTermBefore(t,i){let r=i?this.find(i)[0]:this.root.children[0],o=this.parse(t);r.insertBefore(o);for(let n of o)n.setStatus("adding");this.updateDescription()}deleteTerm(t){for(let i of this.find(t))i.setStatus("deleting"),i.detach(),this.deletedNodes.add(i);this.updateDescription()}replaceTerm(t,i){let r=this.find(t),o=this.parse(i);r[0].insertBefore(o);for(let n of o)n.setStatus("adding");for(let n of r)n.setStatus("deleting"),n.detach(),this.deletedNodes.add(n);this.updateDescription()}moveTermAfter(t,i){let r=this.find(t);for(let n of r)n.roundedMotion=!0;z(i?this.find(i):this.root.children).insertAfter(r),this.updateDescription()}moveTermBefore(t,i){let r=this.find(t);for(let n of r)n.roundedMotion=!0;(i?this.find(i)[0]:this.root.children[0]).insertBefore(r),this.updateDescription()}moveTermToStart(t){let i=this.find(t);for(let r of i)r.roundedMotion=!0;this.root.children[0].insertBefore(i),this.updateDescription()}wrapTerms(t,...i){let r=i.map(n=>this.find(n));for(let n of r)for(let a of n)a.roundedMotion=!0;let o=this.parse(t);for(let n of o)n.setStatus("adding");r[0][0].insertBefore(o);for(let[n,a]of r.entries()){let l=this.find("$"+(n+1))[0];l.insertAfter(a),l.deleteFromDom()}this.updateDescription()}unwrapTerm(t,i=1){let r=this.find(t),o=r[0],n=1;for(;n<=i;)o=o.parent,o instanceof Qe&&(o=o.parent),n+=1;o.insertAfter(r),o.setStatus("deleting"),o.detach(),this.deletedNodes.add(o),this.updateDescription()}get leftSide(){let t=this.root.children.findIndex(i=>i.expr==="=");return this.root.children.slice(0,t-1)}get rightSide(){let t=this.root.children.findIndex(i=>i.expr==="=");return this.root.children.slice(t+1)}};var ms=25,Np=5.4,Gp=4.7;var Dg="#ddd",Lg={1:y.yellow,x:y.green,x2:y.blue,y:y.teal,y2:"#8d2ca1",xy:"#4e53d0"},Bl=e=>e[0]==="-"?y.red:Lg[e],Rp=e=>e[0]==="-"?e.slice(1):"-"+e;function Hl({splitH:e,splitV:s,expr:t},i=!1){let r=e*s;return t.replace(/2$/,"^2")+(r>1?`${i?"//":"/"}${r}`:"")}function xn(e,s,t,i){switch(e.startsWith("-")?e.slice(1):e){case"x2":return[t,t];case"y2":return[i,i];case"xy":return[t,i];case"x":return[s,t];case"y":return[s,i];default:return[s,s]}}function _p(e){let[s,t]=e.reduce(([r,o],{props:n})=>{let a=n.splitH*n.splitV;return[r*a+o,o*a]},[0,1]),i=Fe(s,t);return[s/i,t/i]}function*Og(e){let s=e,t=[];for(let i=1;i<s;++i)e%i||(s=e/i,t.push(s),yield i);for(let i of t.reverse())yield i}var Ns=class extends st{constructor(t,i,r){super(t,i,r);this.props.color||(this.props.color=Bl(this.props.expr)),this.$label=h("g",{},this.$el);let o=h("g",{style:"font-size:18px;color:white;text-anchor:start",class:"equation"},this.$label);this.labelEqn=new Re(o,void 0,0,""),this.props.watch("color",()=>this.updateFill()),this.props.watch("labels expr",()=>this.updateLabel()),this.resize(),this.move()}applyChange(t){super.applyChange(t),this.move()}get isRotated(){return Y(this.rot,45,135)||Y(this.rot,225,315)}get denominator(){return this.props.splitV*this.props.splitH}isInverseOf(t){return this.denominator===t.denominator&&Rp(this.props.expr)===t.props.expr}get size(){let{algebraXSize:t,algebraYSize:i}=this.$parent.options,{expr:r,splitV:o,splitH:n}=this.props,[a,l]=xn(r,1,t,i);return[a*ms/n,l*ms/o]}resize(){let[t,i]=this.size;this.setPath(on(t,i).polygon)}updateLabel(){let[t,i]=this.size;this.isRotated&&([t,i]=[i,t]);let r=this.props.labels!=="hidden"&&t>=12&&i>=12;if(this.$label.toggle(r),!r)return;this.labelEqn.setValue(this.collision?"0":Hl(this.props,i<25));let o=this.labelEqn.root,n=Math.min((t-2)/o.width*.8,i/o.height*.8,1);this.labelEqn.$row.css("transform",`translate(${-o.width/2}px,${-o.height/2}px)`),this.$label.css("transform",`scale(${n}) rotate(${-this.rot}deg)`)}updateFill(){this.$path.setAttr("fill",this.collision?te(Dg,this.$parent.flipTheme):this.props.color)}transform(t){this.updateLabel(),super.transform(t)}getSideLength(t){this.isRotated&&(t=t==="h"?"v":"h");let{expr:i,splitV:r,splitH:o}=this.props,[n,a]=xn(i,"1","x","y");return t==="h"?[n,1/o]:[a,1/r]}getEdge(t){let i=K(t-Math.round(this.rot/90),4);return this.transformed.edges[i]}setCollision(t){this.collision=t,this.updateFill(),this.updateLabel()}move(t){super.move(t);let i=this.collision;if(i){if(d.distance(this.posn,i.posn)<.95*ms&&this.isInverseOf(i))return;i.setCollision(),this.setCollision()}for(let r of this.$parent.getTilesOfType("algebra"))if(!(r.collision||!this.isInverseOf(r))&&!(d.distance(this.posn,r.posn)>=.95*ms)){this.setCollision(r),r.setCollision(this);return}}split(t,i=2){this.isRotated&&(t=t==="h"?"v":"h");let[r,o]=this.size,n=t==="h"?new dt(new d(-r/2,0),new d(r/2,0)):new dt(new d(0,-o/2),new d(0,o/2)),a=it(U({},this.props.raw),{splitH:t==="h"?this.props.splitH*i:this.props.splitH,splitV:t==="v"?this.props.splitV*i:this.props.splitV});return this.delete(),I(l=>{let c=this.worldPosn(n.at((l+.5)/i));return $.create(this.$parent,Object.assign({},a,{x:c.x,y:c.y}))},i)}static merge(t){let i=ut(...t.map(g=>g.transformed)),{x:r,y:o}=i.center,n=t.every(g=>g.isRotated)?90:0,a=t[0].props.expr,{algebraXSize:l,algebraYSize:c}=t[0].$parent.options,p=xn(a,ms,l*ms,c*ms)[0],u=_p(t)[1],f=[...Og(u)].find(g=>g>=Math.round(p/(n?i.h:i.w)))||1,v=u/f,m=$.create(t[0].$parent,{name:"algebra",expr:a,splitH:f,splitV:v,x:r,y:o,rot:n});for(let g of t)g.delete();return m}static makeThumbnail(t,i){let r=i.expr,[o,n]=xn(r,20,78,64),a=r[0]==="-"?r.slice(1):r,l=a==="y2"?112:["x2","xy"].includes(a)?28:2,c=a==="1"?2:["x","x2"].includes(a)?28:112;i.rot&&([l,c,o,n]=[c,l,n,o]),t.setRect(new S(new d(l,c),o,n)),t.setAttr("fill",Bl(r));let p=h("g",{style:"font-size:15px;color:white;text-anchor:start",class:"equation"}),u=new Re(p,void 0,0,"",15,!0);u.setValue(Hl(i)),u.$row.css("transform",`translate(${l+o/2-u.root.width/2}px, ${c+n/2-u.root.height/2}px)`),t.insertAfter(p)}static altText(t){return Hl(t)+" "}negate(){this.props.expr=Rp(this.props.expr),this.flipColor(Bl(this.props.expr)),this.move()}};Ns.type="algebra",Ns.defaultProps={splitH:1,splitV:1},Ns=w([T],Ns);O([{id:"negate",type:"button",tileTypes:["algebra","dot","number-card"],label:"",click:(e,s)=>{for(let t of e)t.negate();s.change({changed:e})}}]);O([{id:"merge-algebra",type:"button",tileTypes:["algebra"],label:"",show:e=>e.length<2||!e.every(s=>s.props.expr===e[0].props.expr)?!1:_p(e)[0]===1,click:(e,s)=>{let t=Ns.merge(e);s.selection.add(t,!0),s.change({deleted:e,added:[t]})}},{id:"splitV",type:"button",tileTypes:["algebra"],label:"",icon:"split-v",show:e=>e.every(s=>s.props.splitV<8),click:(e,s)=>{let t=e.flatMap(i=>i.split("v",2));s.selection.select(t),s.change({deleted:e,added:t})}},{id:"splitH",type:"button",tileTypes:["algebra"],label:"",icon:"split-h",show:e=>e.every(s=>s.props.splitH<8),click:(e,s)=>{let t=e.flatMap(i=>i.split("h",2));s.selection.select(t),s.change({deleted:e,added:t})}}]);function zp(e,s){let t=Array.from(e.getTilesOfType("algebra"));if(!t.length)return;let i=t.filter(c=>!K(c.rot,90)),r=Ip(i,"h"),o=Ip(i,"v"),n={x:e.options.algebraXSize,y:e.options.algebraYSize},a=()=>{let c={x:e.options.algebraXSize,y:e.options.algebraYSize},p=c.x-n.x,u=c.y-n.y;for(let f of t){let v=r.get(f),m=o.get(f),g=v?ms*(v[1]*(v[0]==="x"?p:v[0]==="y"?u:0)/2+v[2]*p+v[3]*u):0,b=m?ms*(m[1]*(m[0]==="x"?p:m[0]==="y"?u:0)/2+m[2]*p+m[3]*u):0;f.posn=f.posn.shift(g,b),f.resize()}e.selection.update(),n=c},l=()=>{for(let c of i)c.setTransform();i.length&&e.change({changed:i}),s.off("move",a),s.off("end",l)};s.on("move",a),s.on("end",l)}function Rg(e,s,t){let i=e.getEdge(t==="h"?1:2),r=s.getEdge(t==="h"?3:0);return i.contains(r.p1)||i.contains(r.p2)||r.contains(i.p1)||r.contains(i.p2)}function Ip(e,s){let t=s==="h"?"x":"y",i=e.sort((o,n)=>o.posn[t]-n.posn[t]),r=new Map;for(let o of i){let n=[...o.getSideLength(s),0,0],a=i.find(c=>c===o||Rg(c,o,s)),l=a?r.get(a):void 0;l&&(n[2]=l[2]+(l[0]==="x"?l[1]:0),n[3]=l[3]+(l[0]==="y"?l[1]:0)),r.set(o,n)}return r}var J=class{constructor(s=0,t=0,i=0){this.x=s;this.y=t;this.z=i}transform(s){if(s instanceof no&&(s=s.matrix),s.length!==4||s[0].length!==4)throw new Error("Must use a 4x4 matrix for 3D transforms!");let[[t],[i],[r],[o]]=Et.product(s,[[this.x],[this.y],[this.z],[1]]);return new J(t/o,i/o,r/o)}equals(s){return E(this.x,s.x)&&E(this.y,s.y)&&E(this.z,s.z)}fixFloat(){return new J(E(this.x,0)?0:this.x,E(this.y,0)?0:this.y,E(this.z,0)?0:this.z)}add(s){return this.x+=s.x||0,this.y+=s.y||0,this.z+=s.z||0,this}multiply(s){return this.x*=s.x,this.y*=s.y,this.z*=s.z,this}lerp(s,t){return new J(rt(this.x,s.x||0,t),rt(this.y,s.y||0,t),rt(this.z,s.z||0,t))}scale(s){return new J(this.x*s,this.y*s,this.z*s)}get magnitude(){return Math.hypot(this.x,this.y,this.z)}get normalize(){return this.scale(1/this.magnitude)}get asArray(){return[this.x,this.y,this.z]}get inverse(){return new J(-this.x,-this.y,-this.z)}get xy(){return new d(this.x,this.y)}[Symbol.iterator](){return this.asArray.values()}static get zero(){return new J(0,0,0)}static get oneZ(){return new J(0,0,1)}static get one(){return new J(1,1,1)}static all(s){return new J(s,s,s)}static from2D(s){return new J(s.x,s.y,0)}static average(s){return new J(Ji(s.map(t=>t.x)),Ji(s.map(t=>t.y)),Ji(s.map(t=>t.z)))}static dot(s,t){return s.x*t.x+s.y*t.y+s.z*t.z}static cross(s,t){let i=s.y*t.z-s.z*t.y,r=s.z*t.x-s.x*t.z,o=s.x*t.y-s.y*t.x;return new J(i,r,o)}};var ft={translate({x:e,y:s,z:t}){return[[1,0,0,e],[0,1,0,s],[0,0,1,t],[0,0,0,1]]},rotateX(e){let s=Math.cos(e),t=Math.sin(e);return[[1,0,0,0],[0,s,-t,0],[0,t,s,0],[0,0,0,1]]},rotateY(e){let s=Math.cos(e),t=Math.sin(e);return[[s,0,t,0],[0,1,0,0],[-t,0,s,0],[0,0,0,1]]},rotateZ(e){let s=Math.cos(e),t=Math.sin(e);return[[s,-t,0,0],[t,s,0,0],[0,0,1,0],[0,0,0,1]]},rotateAxis({x:e,y:s,z:t},i){let r=Math.hypot(e,s,t);r=1/r,e*=r,s*=r,t*=r;let o=Math.sin(i),n=Math.cos(i),a=1-n;return[[e*e*a+n,e*s*a-t*o,e*t*a+s*o,0],[s*e*a+t*o,s*s*a+n,s*t*a-e*o,0],[t*e*a-s*o,t*s*a+e*o,t*t*a+n,0],[0,0,0,1]]},fromEulerAngles(e,s,t){return Et.product(ft.rotateX(e),ft.rotateY(s),ft.rotateZ(t))},scale({x:e,y:s,z:t}){return[[e,0,0,0],[0,s,0,0],[0,0,t,0],[0,0,0,1]]},scaleAll(e){return[[e,0,0,0],[0,e,0,0],[0,0,e,0],[0,0,0,1]]},perspective(e,s,t,i){let r=t*Math.tan(W(e)/2),o=-r,n=r*s,a=-n;return[[2*t/(n-a),0,(n+a)/(n-a),0],[0,2*t/(r-o),(r+o)/(r-o),0],[0,0,-((i+t)/(i-t)),-(2*i*t/(i-t))],[0,0,-1,0]]},transformPoint(e,s){return s instanceof J?s.transform(e):new J(s.x,s.y).transform(e)}},no=class{constructor(){this.matrix=Et.identity(4)}clear(){return this.matrix=Et.identity(4),this}translate(s=0,t=0,i=0){return this.matrix=Et.product(this.matrix,ft.translate({x:s,y:t,z:i})),this}rotate(s=0,t=0,i=0){return this.matrix=Et.product(this.matrix,ft.rotateZ(i),ft.rotateY(t),ft.rotateX(s)),this}scale(s){return this.matrix=Et.product(this.matrix,ft.scale(s)),this}dragToRotate(s,t,i=100){let r=new J(s.x,s.y,i**3/(i**2+s.length**2)).normalize,o=new J(t.x,t.y,i**3/(i**2+t.length**2)).normalize,n=M(J.dot(r,o),-1,1),a=J.cross(r,o),l=ft.rotateAxis(a,2*Math.acos(n));return this.matrix=Et.product(l,this.matrix),this}isRotationMatrix(){if(!E(Et.determinant(this.matrix),1))return!1;let s=Et.transpose(this.matrix);return Et.product(this.matrix,s).every((i,r)=>i.every((o,n)=>E(o,r===n?1:0)))}toEulerAngles(){let s=this.matrix,t=Math.sqrt(s[0][0]*s[0][0]+s[1][0]*s[1][0]);if(E(t,0)){let a=Math.atan2(-s[1][2],s[1][1]),l=Math.atan2(-s[2][0],t);return[a,l,0]}let r=Math.atan2(s[2][1],s[2][2]),o=Math.atan2(-s[2][0],t),n=Math.atan2(s[1][0],s[0][0]);return[r,o,n]}};var Ig=new G(0,0,0);function Ng(e){let s=e.r,t=e.c.x,i=e.c.y,r=.5523*s;return`M${t} ${i-s}C${t+r} ${i-s} ${t+s} ${i-r} ${t+s} ${i}C${t+s} ${i+r} ${t+r} ${i+s} ${t} ${i+s}C${t-r} ${i+s} ${t-s} ${i+r} ${t-s} ${i}C${t-s} ${i-r} ${t-r} ${i-s} ${t} ${i-s}`}var $n=class{constructor(){this.transform=new no;this.visible=!0}getTransformed(s){let t=this;do s=s.transform(t.transform);while(t=t.parent);return s}get normal(){return this.getTransformed(J.oneZ).add(this.getTransformed(J.zero).inverse).normalize}project(s,t={fov:120}){if(t.fov===!1)return new d(s.x,s.y);let i=Math.exp(s.z/t.fov);return new d(s.x*i,s.y*i)}*getProjectedVertices(s){for(let t of this.getVertices())yield this.project(t,s)}},xe=class extends $n{constructor(t,i={},r){super();this.children=[];this.sorting=!1;this.$el=h("g",i,r);for(let o of t)this.addChild(o)}addChild(t){return t.parent&&t.parent.removeChild(t),this.children.push(t),this.$el&&t.$el&&this.$el.append(t.$el),t.parent=this,t}removeChild(t){let i=this.children.indexOf(t);i>=0&&this.children.splice(i,1),t.$el&&t.$el.remove(),t.parent=void 0}render(t){if(this.visible){if(this.sorting)for(let i of ko(this.children,r=>r.zIndex))this.$el.append(i.$el);for(let i of this.children)i.render(t)}}*getFaces(){for(let t of this.children)for(let i of t.getFaces())yield i}*getVertices(){for(let t of this.children)for(let i of t.getVertices())yield i}get zIndex(){return Ji(this.children.map(t=>t.zIndex))}},pe=class extends $n{constructor(t,i={},r){super();this.shape=t;if(!t)this.commands=[];else if(typeof t=="string")this.commands=Ho(t);else{let n=yt(t)?Ng(t):Gt(t);this.commands=Ho(n)}let o=d.average(...this.commands.filter(n=>n.points.length).map(n=>d.average(...n.points)));this.centroid=new J(o.x,o.y,0),r&&(this.color=r),this.$el=h("path",i)}render(t){if(!this.visible)return;let i=this.normal.z;if(t!=null&&t.hideBackface){let o=i>-.01;if(this.$el.toggle(o),!o)return}if(this.color){let o=G.mix(this.color,Ig,(Math.abs(i)+1)/2);this.$el.setAttr("fill",o),this.$el.setAttr("stroke",o)}let r=this.commands.map(o=>{let n=o.points.map(a=>{let l=this.project(this.getTransformed(new J(a.x,a.y)),t);return`${l.x},${l.y}`});return o.type+n.join(",")}).join("");this.$el.setAttr("d",r)}get zIndex(){return this.getTransformed(this.centroid).z}*getFaces(){yield this}*getVertices(){if(!(!this.shape||typeof this.shape=="string"||!fe(this.shape)))for(let t of this.commands)for(let i of t.points)yield this.getTransformed(new J(i.x,i.y))}};var Bp=new Set,es=50,Gg=["chart","pie-chart","box-whisker","axes"],Kt=class extends ${constructor(t,i,r){var o;super(t,i,r);this.padding=[0,25,25,0];this.$handles=[];this.$cells=[];this.columnWidths=[];this.selection={startRow:0,startCol:0,endRow:0,endCol:0};this.$foreignObject=h("foreignObject",{width:1,height:1,overflow:"visible"},this.$el),this.$table=h("div",{xmlns:"http://www.w3.org/1999/xhtml",class:"table-tile"},this.$foreignObject),this.$outline=h("path",{class:"outline"},this.$el),this.$selectionOutline=h("rect",{class:"table-selection",hidden:!0,rx:2},this.$el),this.parseData(this.props.data),this.linkedTiles=(o=this.props.links)!=null&&o.length?this.props.links.split(","):void 0,t.events.listen(this.$el,{down:n=>{this.findSelection(this.relativePosn(n.posn)),this.$hidden.focus()},move:n=>{let a=this.relativePosn(n.startPosn),l=this.relativePosn(n.posn);this.findSelection(a,l)},click:n=>this.focusCell(this.findCellAt(this.relativePosn(n.posn))),blurInput:!1,checkIfActive:()=>!!this.isFocussed}),this.$hidden=h("textarea",{class:"table-hidden"},this.$parent),this.$hidden.on("blur",n=>{var a;(a=ot(n.relatedTarget))!=null&&a.hasClass("table-cell")||this.blur()}),this.$hidden.on("paste",n=>{var a;n.preventDefault(),this.paste(((a=n.clipboardData)==null?void 0:a.getData("text").trim())||"")}),this.$hidden.on("cut copy",n=>{var l;let a=this.getSelectionContents();a&&((l=window.navigator.clipboard)==null||l.writeText(a)),n.type==="cut"&&this.removeSelectionContents()}),this.$hidden.onKey("Escape",n=>{n.stopPropagation(),this.$hidden.blur(),this.$parent.selection.add(this)}),this.$hidden.onKey("Enter",n=>{n.preventDefault(),this.moveDown(!0)}),this.$hidden.onKey("Tab",n=>{n.preventDefault(),this.moveRight()}),this.$hidden.onKey("Backspace Clear Delete",n=>{n.stopPropagation(),this.removeSelectionContents()}),this.props.aggregation&&Bp.add(this),this.$handles[0]=this.makeHandle("h",n=>this.updateCols(n.x)),this.$handles[1]=this.makeHandle("v",n=>this.updateRows(n.y)),this.$handles[1].css("cursor","ns-resize"),this.props.watch("color",({color:n})=>this.setColor(n)),this.buildTable()}parseData(t){this.data=Pt(t,[["x","y"],["",""],["",""]]),this.rows=this.data.length,this.cols=this.data[0].length}applyChange(t){super.applyChange(t),"data"in t&&(this.parseData(this.props.data),this.buildTable(),this.emitMessage("main",{type:"table",table:this.rawData}))}setColor(t){this.$table.css("--border",t),this.$table.css("--header",G.from(t).hex+"99"),this.emitMessage("main",{type:"table",table:this.rawData})}hasData(t=1){if(this.cols<t)return!1;let i=Se(t);return this.data.some((r,o)=>o>0&&i.every(n=>r[n]))}transpose(){for(let t=0;t<this.data.length;t++)for(let i=0;i<t;i++)[this.data[t][i],this.data[i][t]]=[this.data[i][t],this.data[t][i]];[this.rows,this.cols]=[this.cols,this.rows],this.updateData(),this.buildTable()}updateOutline(){let t=z(this.columnWidths),i=this.rows*es;this.$foreignObject.setAttr("width",t||1),this.$foreignObject.setAttr("height",i||1);let r=new S(P,t,i);this.$outline.draw(r),this.path=r.shift(.5),this.$handles[0].setTransform({x:t,y:0}),this.$handles[1].setTransform({x:0,y:i})}updateCols(t){let i=z(this.columnWidths),r=this.columnWidths[this.columnWidths.length-2]||0;t>i+es?(this.cols+=1,this.buildTable()):this.cols>1&&t<r+es&&(this.cols-=1,this.buildTable())}updateRows(t){let i=M(Math.round(t/es),1,100);i!==this.rows&&(this.rows=i,this.buildTable())}resizeColumns(){this.columnWidths=ls(I(t=>this.$cells[t].width,this.cols)),this.drawSelection()}makeCell(){let t=this.$cells.length,i=h("div",{class:"table-cell",contenteditable:!0,"cell-index":t},this.$table);i.css("border-color",this.props.color),this.$cells.push(i);let r=!1;i.on("focus",()=>r=!0),i.on("pointerdown",n=>{r&&n.stopPropagation()}),i.on("blur",n=>{r=!1,this.data[this.cellPosn(i)[0]][this.cellPosn(i)[1]]=i.text,this.updateData();let a=ot(n.relatedTarget);!(a!=null&&a.hasClass("table-cell"))&&!(a!=null&&a.hasClass("table-hidden"))&&this.blur()});let o=i.width;i.on("change keyup input",()=>{let n=o;o=i.width,n!==o&&this.resizeColumns()}),i.on("paste",n=>{var l;let a=((l=n.clipboardData)==null?void 0:l.getData("text").trim())||"";(a.includes(`
`)||a.includes("	"))&&(n.preventDefault(),this.paste(a))}),i.onKey("Escape",n=>{n.stopPropagation(),i.blur(),this.$parent.selection.add(this)}),i.onKey("Enter",n=>{n.preventDefault(),this.$parent.events.shiftKey?this.moveUp():this.moveDown(!0)}),i.onKey("Tab",n=>{n.preventDefault(),this[this.$parent.events.shiftKey?"moveLeft":"moveRight"]()})}cellPosn(t){let i=Number.parseInt(t.attr("cell-index"));return[Math.floor(i/this.cols),i%this.cols]}buildTable(){this.$table.css("grid-template-columns",`repeat(${this.cols}, max-content)`);let t=this.cols*this.rows;for(let i=this.$cells.length;i<t;++i)this.makeCell();for(let i=t;i<this.$cells.length;++i)this.$cells[i].hide();for(let i=0;i<this.rows;++i)for(let r=0;r<this.cols;++r){this.data[i]||(this.data[i]=[]),this.data[i][r]||(this.data[i][r]="");let o=this.$cells[i*this.cols+r];o.show();let n=this.data[i][r];n.startsWith("#")?o.html=`<span class="table-color" style="background:${n}"></span>`:o.text=n,o.setClass("header",!i)}this.resizeColumns(),this.updateOutline(),this.makeOutPort("main",{tileTypes:Gg,location:new d(z(this.columnWidths),this.rows*es/2),connect:i=>i.enqueueMessage({type:"table",table:this.rawData})}),this.updateData(),this.transform(),this.$parent.selection.update()}paste(t){let[i,r]=[this.selection.startRow,this.selection.startCol],o=t.trim().split(`
`).map(n=>n.split("	"));this.rows=Math.max(this.rows,i+o.length),this.cols=Math.max(this.cols,r+Math.max(...o.map(n=>n.length)));for(let n=0;n<o.length;++n)for(let a=0;a<o[n].length;++a)this.data[i+n]||(this.data[i+n]=[]),this.data[i+n][r+a]=o[n][a];this.updateSelection(r,i,r+o[0].length-1,i+o.length-1),this.buildTable()}moveLeft(){let[t,i]=[this.selection.startRow,this.selection.startCol];this.focusCell(this.$cells[t*this.cols+i-1]||this.$cells[this.$cells.length-1])}moveRight(){let[t,i]=[this.selection.startRow,this.selection.startCol];this.focusCell(this.$cells[t*this.cols+i+1]||this.$cells[0])}moveUp(){let[t,i]=[this.selection.startRow,this.selection.startCol],r=t===0?this.rows:t;this.focusCell(this.$cells[(r-1)*this.cols+i])}moveDown(t=!0){let[i,r]=[this.selection.startRow,this.selection.startCol];t&&this.rows<=i+1&&(this.data[i][r]=this.$cells[i*this.cols+r].text,this.rows+=1,this.buildTable()),this.focusCell(this.$cells[(i+1)*this.cols+r])}doubleClick(t){this.focus(),this.focusCell(this.findCellAt(this.relativePosn(t.posn)))}focus(){this.isFocussed||(super.focus(),this.initialData=this.props.data,this.$table.addClass("active"),this.$selectionOutline.show())}findCellAt(t){let i=this.columnWidths.findIndex(o=>o>t.x),r=Math.floor(t.y/es);return this.$cells[this.cols*r+i]}focusCell(t){var n,a;let[i,r]=this.cellPosn(t);if(this.data[i][r].startsWith("#"))return;this.updateSelection(r,i),t.focus();let o=document.createRange();o.selectNodeContents(t._el),(n=document.getSelection())==null||n.removeAllRanges(),(a=document.getSelection())==null||a.addRange(o)}blur(){this.isFocussed&&(super.blur(),this.updateData(),this.updateOutline(),this.transform(),this.$table.removeClass("active"),this.$selectionOutline.hide(),this.$parent.selection.add(this),this.initialData!==this.props.data&&this.$parent.change({changed:[this]}))}get rawData(){return this.data.slice(0,this.rows).map(t=>t.slice(0,this.cols))}updateData(){let t=this.rawData;this.props.data=JSON.stringify(t),this.initialData!==this.props.data&&this.emitMessage("main",{type:"table",table:t})}findSelection(t,i=t){let r=Math.floor(Math.min(t.y,i.y)/es),o=Math.ceil(Math.max(t.y,i.y)/es)-1,n=this.columnWidths.findIndex(l=>l>Math.min(t.x,i.x)),a=this.columnWidths.findIndex(l=>l>Math.max(t.x,i.x));a<0&&(a=this.cols),this.updateSelection(n,r,a,o)}updateSelection(t,i,r=t,o=i){var n,a,l,c;t=M(t,0,this.cols-1),r=M(r,t,this.cols-1),i=M(i,0,this.rows-1),o=M(o,i,this.rows-1),!(((n=this.selection)==null?void 0:n.startRow)===i&&((a=this.selection)==null?void 0:a.endRow)===o&&((l=this.selection)==null?void 0:l.startCol)===t&&((c=this.selection)==null?void 0:c.endCol)===r)&&(this.selection={startCol:t,startRow:i,endCol:r,endRow:o},this.drawSelection())}drawSelection(){if(!this.selection)return;let t=this.columnWidths[this.selection.startCol-1]||0,i=new d(t,this.selection.startRow*es),r=this.columnWidths[this.selection.endCol]-t||0,o=(this.selection.endRow+1-this.selection.startRow)*es;this.$selectionOutline.setRect(new S(i,r+1,o+1))}getSelectionContents(){let t="",i=this.selection;if(!i)return t;for(let r=i.startRow;r<=i.endRow;++r){for(let o=i.startCol;o<=i.endCol;++o)o>i.startCol&&(t+="	"),t+=this.data[r][o];t+=`
`}return t}removeSelectionContents(){let t=this.selection;if(t)for(let i=t.startRow;i<=t.endRow;++i)for(let r=t.startCol;r<=t.endCol;++r)this.data[i][r]="",this.$cells[i*this.cols+r].text=""}linkToChart(t){let i=t.inPorts.get("main"),r=this.outPorts.get("main"),o=new he(r,i);r.addCable(o),this.updateCableProps()}static*updateAggregations(t){for(let i of Bp){let r=t.filter(o=>{var n;return(n=i.linkedTiles)==null?void 0:n.includes(o)});r.length&&(i.updateAggregation(r),yield i)}}static getAggregationData(t,i){let r=t.map(n=>i.tiles.get(n)).filter(Boolean),o=new Map;for(let n of r){let a=n.aggregationCategories.map(c=>c.toString());for(let c of a)o.has(c)||o.set(c,0);let l=n.aggregationCategory.toString();o.set(l,(o.get(l)||0)+1)}return o}static aggregateReplace(t,i){let r=Kt.getAggregationData(t,i),o=[["",""]];for(let[n,a]of r.entries())o.push([n,a.toString()]);return o}aggregateCumulative(t){let i=t||this.linkedTiles,r=Kt.getAggregationData(i,this.$parent),o=this.data.length?this.data:[["",""]],n=o.map(a=>a[0]);for(let[a,l]of r.entries()){let c=n.indexOf(a);c>0?o[c][1]=(+o[c][1]+l).toString():o.push([a,l.toString()])}return o}aggregateTimeSeries(){let t=Kt.getAggregationData(this.linkedTiles,this.$parent),i=this.data.length?this.data:[[""]],r=i[0].map((o,n)=>n?"0":i.length.toString());for(let[o,n]of t.entries()){let a=i[0].indexOf(o);a>0?r[a]=(+r[a]+n).toString():(i[0].push(o),r.push(n.toString()))}return i.push(r),i}updateAggregation(t){this.data=this.props.aggregation==="replace"?Kt.aggregateReplace(this.linkedTiles,this.$parent):this.props.aggregation==="cumulative"?this.aggregateCumulative(t):this.aggregateTimeSeries(),this.rows=this.data.length,this.cols=this.data[0].length,this.buildTable()}static makeThumbnail(t){let i=h("svg",{width:110,height:85},t),r=(o,n,a,l,c,p="")=>{h("rect",{x:5+o,y:5+n,width:a,height:l,fill:y.bg,"fill-opacity":c,class:"polygon-tile"},i),p&&h("text",{x:30+o,y:22+n,text:p,fill:y.bg},i)};for(let o=0;o<2;++o)for(let n=0;n<3;++n)r(50*o,25*n,50,25,n?.1:.3,n?"":o?"y":"x")}static altText(){return""}};Kt.type="table",Kt.defaultProps={color:"#bbb"},Kt=w([T],Kt);function Pn(e,s){for(let r of e)r.linkToChart(s);let t=ut(...e.map(r=>r.transformed)),i=jr(s.path)?s.path.p:s.path.c.shift(-s.path.r);s.setTransform(t.p.subtract(i).shift(t.w+100,0)),s.$parent.change({added:[s],changed:e})}O([{id:"scatter-plot",type:"button",tileTypes:["table"],label:"",icon:"scatter",show:e=>e.some(s=>s.hasData(2)),click:(e,s)=>{let t=Math.min(...e.map(l=>Math.min(...l.data.map((c,p)=>p&&+c[0]||0)))),i=Math.max(...e.map(l=>Math.max(...l.data.map((c,p)=>p&&+c[0]||0)))),r=Math.min(...e.map(l=>Math.min(...l.data.map((c,p)=>p&&+c[1]||0)))),o=Math.max(...e.map(l=>Math.max(...l.data.map((c,p)=>p&&+c[1]||0)))),n=""+Math.ceil((Math.max(-t,i)+1)/5),a=""+Math.ceil((Math.max(-r,o)+1)/5);Pn(e,$.create(s,{name:"axes",xMin:t<0?-5:0,xStep:n,xMax:5,yMin:r<0?-5:0,yStep:a,yMax:5}))}},{id:"column-chart",type:"button",tileTypes:["table"],label:"",icon:"column-chart",show:e=>e.some(s=>s.hasData()),click:(e,s)=>Pn(e,$.create(s,{name:"chart"}))},{id:"area-chart",type:"button",tileTypes:["table"],label:"",icon:"area-chart",show:e=>e.some(s=>s.hasData()),click:(e,s)=>Pn(e,$.create(s,{name:"chart",kind:"area"}))},{id:"pie-chart",type:"button",tileTypes:["table"],label:"",icon:"pie-chart",show:e=>e.length===1&&e[0].hasData(),click:(e,s)=>Pn(e,$.create(s,{name:"pie-chart"}))},{id:"transpose",type:"button",tileTypes:["table"],label:"",click:(e,s)=>{for(let t of e)t.transpose();s.change({changed:e})}},{id:"aggregation",type:"select",tileTypes:["table"],label:"",location:"more",show:e=>e.every(s=>s.props.aggregation),options:[{label:"",key:"cumulative"},{label:"",key:"replace"},{label:"",key:"timeseries"}],get:e=>e.props.aggregation,set:(e,s)=>{s.props.aggregation=e,s.data=[],s.updateAggregation(),s.$parent.change({changed:[s]})}}]);var Sn=["dice","coin","spinner","custom-spinner","random","polyhedral-dice","group"],$e=19,ao=[[],[[0,0]],[[-.9,-.9],[.9,.9]],[[-1,-1],[0,0],[1,1]],[[-.9,-.9],[.9,-.9],[.9,.9],[-.9,.9]],[[-1,-1],[1,-1],[1,1],[-1,1],[0,0]],[[-.9,-1.1],[-.9,0],[-.9,1.1],[.9,-1.1],[.9,0],[.9,1.1]],[[0,-1.2],[0,0],[0,1.2],[1,-.6],[1,.6],[-1,-.6],[-1,.6]],[[0,-1.1],[0,1.1],[-1.1,-1.1],[-1.1,0],[-1.1,1.1],[1.1,-1.1],[1.1,0],[1.1,1.1]],[[0,-1.1],[0,0],[0,1.1],[-1.1,-1.1],[-1.1,0],[-1.1,1.1],[1.1,-1.1],[1.1,0],[1.1,1.1]]],_g=new S(new d(-$e,-$e),2*$e,2*$e),Tn=[[0,0],[0,ht],[ht,0],[-ht,0],[0,-ht],[Math.PI,0]],Fl=["#656073",y.teal,y.blue,y.purple,y.red,y.orange,y.yellow,y.lime,y.green,y.teal],Ut=class extends ${constructor(t,i,r){super(t,i,r);this.isAnimating=!1;this.faces=(this.props.faces||"1,2,3,4,5,6").split(",").map(n=>+n);let o=this.faces.map(n=>{let a=new pe(_g,{class:"dice-face",fill:Fl[n],stroke:Fl[n]}),l=ao[+n].map(c=>new pe(new q(new d(c[0]*$e/2,c[1]*$e/2),4),{class:"dice-dot"}));for(let c of l)c.transform.translate(0,0,2);return new xe([a,...l])});o[0].transform.translate(0,0,$e),o[1].transform.translate(-$e,0,0).rotate(0,-ht),o[2].transform.translate(0,$e,0).rotate(-ht,0),o[3].transform.translate(0,-$e,0).rotate(ht,0),o[4].transform.translate($e,0,0).rotate(0,ht),o[5].transform.translate(0,0,-$e).rotate(0,Math.PI),this.die=new xe(o,{},this.$el),this.die.sorting=!0,this.setValue(this.props.value||vt.integer(1,6)),this.path=new S(new d(-25,-25),50,50),this.$outline=h("path",{class:"outline",path:this.path},this.$el),this.props.watch("color",({color:n})=>{for(let a of this.die.children)a.children[0].color=n;this.die.render()})}applyChange(t){super.applyChange(t),"value"in t&&this.setValue(t.value)}get aggregationCategory(){return this.value}get aggregationCategories(){return this.faces}setValue(t){this.props.value=t,this.value=this.faces[t-1],this.die.transform.clear().rotate(...Tn[t-1]),this.die.render()}roll(t=2e3){return H(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0,this.$parent.playSound("roll");let i=vt.integer(1,6),r=Tn[this.props.value-1],o=4*Math.PI+Tn[i-1][0]-r[0],n=4*Math.PI+Tn[i-1][1]-r[1];yield et(a=>{let l=wt("sine",a);this.die.transform.clear().translate(0,0,4*l*(1-l)*$e/2).rotate(r[0]+l*o,r[1]+l*n),this.die.render()},t).promise,this.setValue(i),this.isAnimating=!1})}static makeThumbnail(t,i){if(i.faces){let r=h("svg",{width:58,height:76},t),o=i.faces.split(",").map(a=>+a),n=[new d(20,2),new d(20,20),new d(20,38),new d(20,56),new d(2,20),new d(38,20)];for(let[a,l]of n.entries()){let c=i.color||Fl[o[a]];h("path",{path:new S(l,18,18),class:"polygon-tile",fill:c},r);for(let p of ao[o[a]])h("circle",{cx:l.x+9+p[0]*4.5,cy:l.y+9+p[1]*4.5,r:1.8,class:"dice-dot"},r)}}else{let r=h("svg",{width:60,height:60},t);h("rect",{x:6,y:6,width:48,height:48,rx:6,class:"polygon-tile",fill:y.orange},r);for(let o of ao[5])h("circle",{cx:30+o[0]*12,cy:30+o[1]*12,r:5,class:"dice-dot"},r)}}static altText(t){return t.faces?` ${t.faces}`:""}doubleClick(){Ut.roll([this],this.$parent)}static roll(t,i){return H(this,null,function*(){i.selection.clear(),yield Promise.all(t.map(o=>o.roll())),i.selection.tiles.size||i.selection.select(t);let r=Kt.updateAggregations(t.map(o=>o.id));i.change({changed:[...Ae(t),...r]})})}};Ut.type="dice",Ut=w([T],Ut);O([{id:"randomise",type:"button",tileTypes:Sn,label:"",show:e=>e.every(s=>!s.is("group")||s.canRandomise),labelFn:(e,s)=>Co(s,t=>t==="coin")?"":Co(s,t=>t.endsWith("dice"))?"":Co(s,t=>t.endsWith("spinner"))?"":"",click:(e,s)=>Ut.roll(e,s)}]);O([{id:"tabulate",type:"button",tileTypes:Sn,label:"",show:e=>e.every(s=>!s.is("group")||s.canRandomise),click:(e,s)=>{let t=e.map(l=>l.id),i=Kt.aggregateReplace(t,s),r=ut(...e.map(l=>l.transformed)),{x:o,y:n}=r.p.shift(r.w+50,0),a=$.create(s,{name:"table",data:JSON.stringify(i),links:t.join(","),aggregation:"cumulative",x:o,y:n});s.change({added:[a]}),s.selection.add(a,!0)}}]);function Hp(e){if(e===1)return["H","T"];let s=Hp(e-1);return[...s.map(t=>"H"+t),...s.map(t=>"T"+t)]}function*Ae(e,s=!1){for(let t of e){let i=t.is("group");(!i||s)&&(yield t),i&&(yield*Ae(t.children,s))}}var fr=class extends ${constructor(t,i,r){super(t,i,r,h("g"));this.showSelectionOutline=!0;this.canRandomise=!1;this.children=[];this.props.watch("status",({status:o})=>{for(let n of this.children)n.props.status=o}),this.props.watch("color",({color:o})=>{if(o)for(let n of this.children)n.props.color=o})}delayedSetup(){for(let i of this.children)i.group=void 0;let t=this.props.children?this.props.children.split(","):[];this.children=t.map(i=>this.$parent.tiles.get(i)).filter(Boolean);for(let i of this.children)i.group=this;this.canRandomise=this.children.every(i=>Sn.includes(i.props.name)&&(!i.is("group")||i.canRandomise)),this.cannotRotate=this.children.some(i=>i.cannotRotate),this.transform()}delete(){for(let t of this.children)t.group=void 0;super.delete()}applyChange(t){"children"in t&&this.delayedSetup(),super.applyChange(t)}get canSelect(){var t;return(t=this.children)==null?void 0:t.every(i=>i.canSelect)}select(){super.select();for(let t of this.children)t.select()}deselect(){super.deselect();for(let t of this.children)t.deselect()}moveStart(){for(let t of this.children)t.moveStart()}move(t,i){for(let r of this.children)r.move(t,i)}moveEnd(){for(let t of this.children)t.moveEnd()}down(t){for(let i of this.children)i.down(t)}up(t){for(let i of this.children)i.up(t)}click(t){for(let i of this.children)i.click(t)}doubleClick(t){if(this.canRandomise)return Ut.roll([this],this.$parent)}rotate(t,i){this.rot=K(this.rot+t,360);for(let r of this.children)r.rotate(t,i)}transform(t){var i;t||!this.children.length||(this.path=en(Ae(this.children),W(this.rot)),this.transformed=this.path.rotate(W(this.rot),this.path.center),this.snapPoints=this.children.flatMap(r=>r.snapPoints||[]),this.snapLines=this.children.flatMap(r=>r.snapLines||[]),this.snapAngles=this.children.flatMap(r=>{var o;return((o=r.snapAngles)==null?void 0:o.map(n=>n+r.rot-this.rot))||[]}),(i=this.group)==null||i.transform())}setTransform(t,i=this.rot){this.rot=this.props.rot=K(i,360);for(let r of this.children)r.setTransform()}contains(t){return this.children.some(i=>i.contains(t))}get altText(){if(this.props.altText)return this.props.altText;let t=this.children;return`Group of ${t.length} tiles (${t.map(i=>i.altText).join(", ")})`}roll(){return H(this,null,function*(){this.canRandomise&&(yield Promise.all(this.children.map(t=>t.roll())))})}get aggregationCategory(){let t=[...Ae(this.children)];if(t.every(r=>r.is("dice")||r.is("polyhedral-dice")))return _(this.children.map(r=>r.value||0));let i=t.sort((r,o)=>r.posn.x-o.posn.x);return t.every(r=>r.is("coin"))?i.map(r=>r.aggregationCategory[0]).join(""):i.map(r=>r.aggregationCategory).join(", ")}get aggregationCategories(){if(!this.canRandomise)return[];let t=[...Ae(this.children)];return t.length>6?[]:t.every(i=>i.is("dice"))?Se(t.length,t.length*6):t.every(i=>i.is("coin"))?Hp(t.length):[]}};fr.type="group",fr=w([T],fr);O([{id:"ungroup",tileTypes:["group"],type:"button",label:"",icon:"ungroup",show:e=>e.every(s=>!ne(s)),click:(e,s)=>{let t=e.filter(r=>r.is("group")),i=t.flatMap(r=>r.children);for(let r of t)r.delete();s.change({deleted:t}),s.selection.select(i)}},{id:"group",type:"button",tileTypes:["all"],label:"",icon:"group",show:e=>e.length>1&&e.every(s=>!ne(s)),click:(e,s)=>{for(let o of e)o.props.status=void 0;let t=e.map(o=>o.id).join(","),i=s.selection.getTileProperty(o=>o.props.raw.color),r=$.create(s,{name:"group",children:t,color:i});r.delayedSetup(),s.change({added:[r],changed:e}),s.selection.add(r,!0)}}]);var Fp,qp,kn=new Set,ql=new Set;function zg(e,s,t){let i=K(e-s,t);return i>t/2?i-t:i}var Cn=class{constructor(s){this.$parent=s;this.angle=0;this.startAngle=0;this.hasChanged=!1;this.showTools=!1;this.isMoving=!1;this.tiles=new Set;this.implicitChanges=new Set;this.$tools=s.$(".transform-tools"),this.$shadow=s.$(".group-shadow"),this.$rect=this.$tools.$(".group-outline"),this.$rotateBar=this.$tools.$(".rotate-bar"),this.$rotateCircle=this.$tools.$(".rotate-circle");let t=s.$(".rotate-label");t.hide(),s.events.listen(this.$rotateCircle,{start:()=>{this.startAngle=this.angle,this.rotateStart(),t.show()},move:({startPosn:i,posn:r,event:o})=>{this.rotate(this.startAngle-new Ot(r,this.center,i).deg);let n=ce(o).subtract(s.topLeftPosition);t.setTransform(n.shift(R.isMobile?-15:5,R.isMobile?-100:-40)),t.text=K(Jt(this.angle,1),360)+"\xB0"},end:()=>{this.rotateEnd(),t.hide()}})}bindKeyboardEvents(s){s.onKey("AllArrows r R",(t,i)=>{if(this.tiles.size){if(i==="r"||i==="R"){if(Array.from(this.tiles).some(r=>$l(r)))return;this.rotateStart(),this.rotate(this.angle+(i==="R"?-15:15)),this.rotateEnd()}else{let r=P,o=t.shiftKey?5:25,n=i==="ArrowLeft"?-o:i==="ArrowRight"?o:0,a=i==="ArrowUp"?-o:i==="ArrowDown"?o:0,l=r.shift(n,a);this.moveStart(),this.move({posn:l,startPosn:r}),this.moveEnd()}this.$parent.trigger("shift-selection")}}),s.onKey("Escape",()=>this.clear())}get flatTiles(){return[...Ae(this.tiles,!0)]}get size(){return this.tiles.size}add(s,t=!1,i=!1){t&&this.clear(),!s.isActive&&this.$parent.tiles.has(s.id)&&this.select([s],i)}select(s,t=!1){var i;(i=this.$parent.focussedTile)==null||i.blur(),this.$parent.zIndex.bringToFront(Ae(s),!1,!0);for(let r of s)r.isActive||!this.$parent.tiles.has(r.id)||r.group||(this.tiles.add(r),r.select(),this.hasChanged=!0);t||this.update(!0)}remove(s,t=!1){s.group||!s.isActive||(s.deselect(),this.hasChanged=!0,this.tiles.delete(s),t||this.update(!0))}clear(){if(!this.isMoving){for(let s of this.tiles)s.deselect();this.tiles.size&&(this.hasChanged=!0),this.tiles.clear(),this.update(!0)}}getTileProperty(s){if(!this.size)return;let t=s(Es(this.tiles.values()));for(let i of this.tiles)if(s(i)!==t)return;return t}update(s=!1){if(s&&!this.hasChanged)return;if(this.hasChanged=!1,this.implicitChanges.clear(),!this.size){for(let n of[this.$shadow,this.$tools])n.hide();this.$parent.trigger("change-selection",{tiles:[],color:void 0});return}let t=Array.from(this.tiles).filter(n=>n.transformed);this.angle=this.getTileProperty(n=>n.rot)||0,this.rect=en(t,W(this.angle)),this.center=this.rect.center;let i=!this.$parent.options.noRotating&&t.every(n=>!$l(n));if(t.length===1&&yt(t[0].transformed)&&(i=!1),i&&this.getTileProperty(n=>n.rotateAroundOrigin)){let n=t[0].posn;t.slice(1).every(a=>a.posn.equals(n))&&(this.center=n,this.angle&&t.length===1&&(this.rect=ut(t[0].transformed.rotate(-W(this.angle),n))))}this.$rotateBar.toggle(i),this.$rotateCircle.toggle(i);let r=this.size>1||t[0].showSelectionOutline;this.$rect.toggle(r),this.showTools=!this.getTileProperty(n=>n.hideSelectionOutline),this.$tools.toggle(this.showTools),this.$shadow.toggle(r&&this.showTools),(!i||!this.showTools)&&(this.rotateHandle=void 0),(this.size===1?t[0].$container:this.$parent.$svg).append(this.$tools),this.positionTools();let o=this.getTileProperty(n=>n.props.color);this.$parent.trigger("change-selection",{tiles:t,color:o})}positionTools(){if(!this.showTools)return;let s=this.bounds;for(let r of[this.$shadow,this.$rect])r.draw(s);let t=new d(this.center.x,this.rect.p.y),i=new dt(t,t.shift(0,-28)).rotate(W(this.angle),this.center);this.$rotateBar.setLine(i.p1,i.p2),this.$rotateCircle.setCenter(i.p2),this.rotateHandle=i.p2}get bounds(){return this.rect.rotate(W(this.angle),this.center)}getDragBounds(){let{canvas:s,canvasX:t,canvasY:i}=this.$parent.options;if(s==="infinite")return;let r=s==="notebook"?1/0:i!=null?i:0,o=ut(...Array.from(this.tiles,n=>n.transformed));if(Number.isFinite(o.w))return new bt(-o.p.x,(t!=null?t:0)-o.p.x-o.w,-o.p.y,r-o.p.y-o.h,"swap")}moveStart(s=!1){for(let t of this.tiles)if(ne(t))return;this.isMoving=!0;for(let t of this.tiles)t.moveStart(s);this.startSnapPoints=[];for(let t of this.tiles)for(let i of t.snapPoints)this.startSnapPoints.some(r=>i.equals(r))||this.startSnapPoints.push(i);qp=this.rect,Fp=this.center,this.dragBounds=this.getDragBounds(),this.$parent.newTileShift=0,this.$parent.trigger("move-start")}move({posn:s,startPosn:t},i=!1){if(!this.isMoving)return;let r=s.subtract(t);this.dragBounds&&!i&&(r=r.clamp(this.dragBounds));let o=this.startSnapPoints.map(l=>l.add(r)),n=this.$parent.snapping.snap(o);n&&(r=r.add(n.shift));let a=this.tiles.size===1?n:void 0;for(let l of this.tiles)l.move(r,a);this.rect=qp.translate(r),this.center=Fp.add(r),this.positionTools(),this.$parent.trigger("move-selection")}moveEnd(s,t=!1){if(!this.isMoving)return;t&&this.$parent.options.canvas!=="infinite"&&this.move(s);for(let r of this.tiles)r.moveEnd();if(Xt(this.tiles,r=>r.props.name==="geo")&&this.$parent.snapping.updateIntersections(),this.$parent.trigger("move-end"),this.isMoving=!1,!this.tiles.size)return;let i=[...this.flatTiles,...this.implicitChanges];this.$parent.change({[t?"added":"changed"]:i}),this.implicitChanges.clear()}rotateStart(){ql.clear();for(let s of this.tiles)for(let t of s.snapAngles)ql.add(K(t+s.rot,180));kn.clear(),kn.add(0);for(let s of this.$parent.tiles.values())if(!s.isActive&&Xt(this.tiles,t=>d.distance(t.posn,s.posn)<140))for(let t of s.snapAngles)kn.add(K(t+s.rot,180));this.$parent.newTileShift=0,this.$parent.trigger("rotate-start")}rotate(s){if(s=tt(s,3),s===this.angle)return;let t=1/0;for(let r of ql)for(let o of kn){let n=zg(o,r+s-this.startAngle,180);Math.abs(n)<Math.abs(t)&&(t=n)}if(Math.abs(t)<8&&(s+=t),s===this.angle)return;let i=s-this.angle;this.angle=s;for(let r of this.tiles)r.rotate(i,this.center);this.positionTools(),this.$parent.trigger("rotate-selection")}rotateEnd(){for(let s of this.tiles)s.setTransform();this.$parent.change({changed:this.flatTiles}),this.$parent.trigger("rotate-end")}copy(){if(this.$parent.options.noCopyPaste)return{};if(this.isMoving||!this.tiles.size||he.isMoving)return{};if(Xt(this.tiles,i=>i.cannotEdit))return{};let s={},t=this.flatTiles;for(let i of t)s[i.id]=i.props.copy();for(let i of t)if(i.is("geo")){for(let r of i.parents)if(!t.includes(r)&&!(r.id in s)&&r.geoType==="point"){let o=`point(${r.path.x},${r.path.y})`;s[r.id]=Object.assign(r.props.copy(),{expr:o})}}return s}delete(){var i;if(this.isMoving||this.$parent.options.noDeleting||he.isMoving)return;let s=[...Ae([...this.tiles].filter(r=>!ne(r)),!0)];if(!s.length)return;this.tiles.clear();let t=new Set;for(let r of s){for(let o of Xi(((i=r.inPorts)==null?void 0:i.values())||[],n=>n.cables))t.add(o.from.tile);r.delete()}s.some(r=>r.props.name==="geo")&&this.$parent.snapping.updateIntersections(),this.$parent.change({deleted:s,changed:Array.from(t).filter(r=>!s.includes(r))}),this.$parent.newTileShift=0}};var pt=D.regular(3),mr=D.regular(4),Ee=D.regular(5),Mn={shape:pt,children:[{shape:pt,dihedral:70.53,rot:180},{shape:pt,dihedral:70.53,parentEdge:1,rot:300},{shape:pt,dihedral:70.53,parentEdge:2,rot:60}]},An={shape:mr,children:[{shape:mr,dihedral:90,myEdge:2,children:[{shape:mr,dihedral:90,myEdge:2}]},{shape:mr,dihedral:90,parentEdge:1,rot:270},{shape:mr,dihedral:90,parentEdge:2},{shape:mr,dihedral:90,parentEdge:3,rot:90}]},En={shape:pt,children:[{shape:pt,dihedral:109.47,rot:180},{shape:pt,dihedral:109.47,parentEdge:1,rot:300,children:[{shape:pt,dihedral:109.47,parentEdge:1,rot:300}]},{shape:pt,dihedral:109.47,parentEdge:2,rot:60,children:[{shape:pt,dihedral:109.47,parentEdge:1,rot:300},{shape:pt,dihedral:109.47,parentEdge:2,rot:60,children:[{shape:pt,dihedral:109.47,parentEdge:1,rot:300}]}]}]},Vn={shape:Ee,children:[{shape:Ee,dihedral:116.57,rot:180},{shape:Ee,dihedral:116.57,parentEdge:1,rot:252},{shape:Ee,dihedral:116.57,parentEdge:2,rot:324},{shape:Ee,dihedral:116.57,parentEdge:3,rot:36},{shape:Ee,dihedral:116.57,parentEdge:4,rot:108,children:[{shape:Ee,dihedral:116.57,parentEdge:2,rot:324,children:[{shape:Ee,dihedral:116.57,parentEdge:3,rot:36,children:[{shape:Ee,dihedral:116.57,parentEdge:1,rot:252},{shape:Ee,dihedral:116.57,parentEdge:2,rot:324},{shape:Ee,dihedral:116.57,parentEdge:3,rot:36},{shape:Ee,dihedral:116.57,parentEdge:4,rot:108}]}]}]}]},Dn={shape:pt,children:[{shape:pt,dihedral:138.19,rot:180},{shape:pt,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:pt,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:pt,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:pt,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:pt,dihedral:138.19,parentEdge:1,rot:300}]},{shape:pt,dihedral:138.19,parentEdge:2,rot:60}]},{shape:pt,dihedral:138.19,parentEdge:1,rot:300}]},{shape:pt,dihedral:138.19,parentEdge:2,rot:60}]},{shape:pt,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:pt,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:pt,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:pt,dihedral:138.19,parentEdge:2,rot:60,children:[{shape:pt,dihedral:138.19,parentEdge:1,rot:300,children:[{shape:pt,dihedral:138.19,parentEdge:1,rot:300}]},{shape:pt,dihedral:138.19,parentEdge:2,rot:60}]},{shape:pt,dihedral:138.19,parentEdge:1,rot:300}]},{shape:pt,dihedral:138.19,parentEdge:2,rot:60}]},{shape:pt,dihedral:138.19,parentEdge:1,rot:300}]}]},Up=new D(new d(.587785,.466639),new d(0,.750495),new d(-.587785,.466639),new d(0,-.73981)),gs={shape:Up,dihedral:89.7451,rot:180},Zp={shape:Up,children:[it(U({},gs),{parentEdge:1,myEdge:1,children:[it(U({},gs),{children:[it(U({},gs),{parentEdge:1,myEdge:1,children:[it(U({},gs),{children:[it(U({},gs),{parentEdge:1,myEdge:1,children:[it(U({},gs),{children:[it(U({},gs),{parentEdge:1,myEdge:1,children:[it(U({},gs),{children:[it(U({},gs),{parentEdge:1,myEdge:1})]})]})]})]})]})]})]})]})]};function jp(e,s,t){let i=D.regular(e).scale(s*jt(e)),r=new S(P,s,t).polygon,o=[{shape:i,rot:180,parentEdge:2}],n=I(a=>({shape:r,parentEdge:a,rot:360/e*a,children:a?void 0:o}),e);return{shape:i,children:n}}function Wp(e,s,t){let i=D.regular(e).scale(s*jt(e)),r=new D(new d(-s/2,0),new d(s/2,0),new d(0,-t)),o=Vt(Math.acos(s/t/2/Math.tan(Math.PI/e))),n=I(a=>({shape:r,dihedral:o,parentEdge:a,rot:180+360/e*a}),e);return{shape:i,children:n}}var Bg=Et.identity(4);function Kp(e,s,t,i){var v;let r=s.shape.edges[e.parentEdge||0],o=e.shape.edges[e.myEdge||0],n=W(e.dihedral||90),a=i(e);t.addChild(a);let l=J.from2D(r.midpoint),c=J.from2D(o.midpoint),p=J.from2D(r.unitVector),u=e.rot?W(e.rot):0,f=((v=e.children)==null?void 0:v.map(m=>Kp(m,e,t,i)))||[];return[a,l,c,p,u,n,f]}function lo(e,s,t=1){var n;let i=s(e),r=new xe([i]);r.sorting=!0;let o=((n=e.children)==null?void 0:n.map(a=>Kp(a,e,r,s)))||[];return Ul(o,r,t),{group:new xe([r]),foldTree:o}}function Yp(e,s,t=Bg){let[i,r,o,n,a,l,c]=e,p=rt(Math.PI,l,s),u=ft.rotateAxis(n,Math.PI-p);a&&(u=Et.product(u,ft.rotateZ(a)));let f=o.transform(u),v=ft.translate(f.inverse.add(r));i.transform.matrix=Et.product(t,v,u);for(let m of c||[])Yp(m,s,i.transform.matrix)}function Ul(e,s,t){s.transform.clear();for(let o of e)Yp(o,t);let i=Array.from(s.getFaces()).map(o=>o.getTransformed(o.centroid)),r=J.average(i).inverse;s.transform.translate(r.x,r.y,r.z)}function Hg(e,s,t){let i=Math.cos(e),r=Math.cos(s),o=Math.cos(t),n=Math.sin(s),a=Math.acos((o-i*r)/(Math.sin(e)*n)),l=Math.acos((i-r*o)/(n*Math.sin(t)));return[a,l]}function Xp(e,s){return Math.asin(Math.cos(e*s)/Math.cos(e/2))}var Fg=new Set([60,90,108]),qg=[{internal:[60,90,90,90],dihedral:[144.74,135,135,135]},{internal:[60,60,60,60,90],dihedral:[153.23,153.23,153.23,142.98,142.98]},{internal:[60,90,108,90],dihedral:[159.09,148.28,148.28,159.09]},{internal:[60,60,60,60,108],dihedral:[164.18,164.18,152.93,152.93,152.93]}];function Ug(...e){let s=e.length;if(s===3)return Hg(e[0],e[1],e[2]);let t=e.map(r=>Math.round(Vt(r)));if((s===4||s===5)&&t.includes(60)&&t.every(r=>Fg.has(r))){for(let r of qg)if(r.internal.length===s){for(let o=0;o<e.length;++o)if(t.every((n,a)=>n===r.internal[(a+o)%s]))return Hs(r.dihedral,o).slice(0,s-1).map(n=>W(n))}}if(s===4&&t.filter(r=>r===60).length===3){let r=t.findIndex(c=>c!==60),o=(Math.PI-e[r])/4,n=Math.acos(-1/Math.sqrt(3)*Math.tan(o)),a=Math.acos(1-2/3*((3-Math.tan(o)**2)/4+(Math.sin(3*o)/Math.sin(2*o))**2));return Hs([n,a,a,n],4-r).slice(0,s-1)}let i=Math.PI/_(e);return I(r=>{let o=Xp(e[r],i),n=Xp(e[r+1],i);return o+n},e.length-1)}var Zl=(e,s)=>K(e+1,s.size),jl=(e,s)=>K(e-1,s.size);function Zg(e,s){let t=e.polygon.points[jl(s,e)],i=e.polygon.points[s],r=e.polygon.points[Zl(s,e)];return new Ot(r,i,t).sup.rad}function jg(e){let s=e.find(a=>a.neighbours.filter(Boolean).length===1),t=jl(s.neighbours.findIndex(Boolean),s),i=[],r=s,o=t;do{let a=[];for(;a.push({face:r,vertex:o}),!!r.neighbours[o];){let l=r;r=r.neighbours[o],o=Zl(r.neighbours.indexOf(l),r)}o=Zl(o,r),i.push(a)}while(r!==s||o!==t);let n=new Bc(i);for(;;){let a=Math.max(3,...n.array.map(p=>p.val.length)),l=n.array.filter(p=>p.val.length>=a);if(!l.length)break;let c=new Set;for(let p of l){if(c.has(p))continue;let u=p.val.map(v=>Zg(v.face,v.vertex)),f=Ug(...u);for(let[v,m]of f.entries()){let g=p.val[v],b=p.val[v+1],x=g.vertex,k=jl(b.vertex,b.face);g.face.dihedral[x]=b.face.dihedral[k]=Math.max(m,g.face.dihedral[x]||0,b.face.dihedral[k]||0)}p.prev.val.push(...p.next.val),c.add(p.next),n.delete(p.next),n.delete(p)}}}function Jp(e,s){return Math.max(...e.neighbours.map(t=>!t||t===s?0:Jp(t,e)))+1}function Qp(e,s){return e.visited?!0:(e.visited=!0,e.neighbours.filter(t=>t&&t!==s).some(t=>Qp(t,e)))}function td(e,s,t,i){let r=e.neighbours.map((o,n)=>{if(!(!o||o===t))return td(o,s,e,e.dihedral[n])}).filter(Boolean);return{shape:e.polygon.translate(s.inverse),color:e.tile.props.color,children:r.length?r:void 0,dihedral:i?+Vt(i).toFixed(2):void 0,parentEdge:t?t.neighbours.indexOf(e):void 0,myEdge:t?e.neighbours.indexOf(t):void 0}}function Wg(e){let s=e.map(t=>{let i=t.transformed.oriented,r=i.points.length;return{tile:t,polygon:i,size:r,neighbours:le(void 0,r),dihedral:le(void 0,r),edges:i.edges,center:i.centroid,radius:i.radius}});if(!s.some(t=>t.size<3)){for(let[t,i]of s.entries())for(let[r,o]of s.entries())if(!(t>=r)&&!(i.radius+o.radius<d.distance(i.center,o.center)-2)){for(let[n,a]of i.edges.entries())for(let[l,c]of o.edges.entries())if(a.equals(c,2)){if(i.neighbours[n]||o.neighbours[l])return;i.joined=o.joined=!0,i.neighbours[n]=o,o.neighbours[l]=i}}if(!s.some(t=>!t.joined)&&!Qp(s[0]))return s}}function ed(e){let s=Wg(e);if(!s)return;jg(s);let t=Vs(s,r=>Jp(r)),i=t.polygon.centroid;return[i,td(t,i)]}var Wl=e=>co[e%co.length]||y.yellow;function rd(e){var t;let s=((t=e.c||e.children)==null?void 0:t.map(i=>rd(i)))||[];return{shape:Ln(e.shape||e.s),color:e.color||e.a,children:s,dihedral:e.dihedral||e.d,parentEdge:e.parentEdge||e.p,myEdge:e.myEdge||e.m,rot:e.rot||e.r}}function od(e){var t;let s=(t=e.children)==null?void 0:t.map(i=>od(i));return s!=null&&s.length||(s=void 0),{s:ys(e.shape),a:e.color,c:s,d:e.dihedral,p:e.parentEdge,m:e.myEdge,r:e.rot}}function Kg(e){return rd(Pt(e.replace(/([a-z]):/g,'"$1":'),{}))}function Yg(e){return JSON.stringify(od(e)).replace(/"([a-z])":/g,"$1:")}function gr(e,s=1){var i;let t=(i=e.children)==null?void 0:i.map(r=>gr(r,s));return Object.assign({},e,{children:t,shape:e.shape.scale(s)})}var sd=e=>e.split(",").map(s=>+s),Kl=e=>e.map(s=>s.toFixed(4)).join(","),Yl={Tetrahedron:{net:gr(Mn,jt(3)*50),scale:1.1,name:""},Cube:{net:gr(An,jt(4)*50),scale:.8,name:""},Octahedron:{net:gr(En,jt(3)*50),scale:.95,name:""},Dodecahedron:{net:gr(Vn,jt(5)*50),scale:.42,name:""},Icosahedron:{net:gr(Dn,jt(3)*50),scale:.67,name:""},Pyramid:{net:Wp(6,50,100),scale:.57,name:""},Prism:{net:jp(6,50,100),scale:.45,name:""}},Xl={fov:400},id=[1.066,.243,-.088],vs=class extends ${constructor(t,i,r){var n;super(t,i,r);this.cannotRotate=!0;this.net=((n=Yl[this.props.net])==null?void 0:n.net)||Kg(this.props.net),this.rotation=sd(this.props.rotation);let o=lo(this.net,a=>new pe(a.shape,{class:"polygon-tile"},a.color||Wl(a.shape.points.length)));this.solid=o.group,this.foldTree=o.foldTree,this.$el.append(this.solid.$el),this.$outline=h("path",{class:"outline"},this.$el),this.$moveBar=h("path",{d:"M0 0h30",class:"handle"},this.$el),this.$moveHandle=h("path",{d:"M0 0h14v14h-14Z",class:"handle",style:"cursor: grab"},this.$el),this.solid.$el.css("cursor","move"),this.props.watch("color",({color:a})=>{if(a){for(let l of this.solid.getFaces())l.color=a;this.render(!1)}}),this.render(),this.updateOutline(),t.events.listen(this.solid.$el,{start:()=>{t.selection.add(this,!0),this.$el.removeClass("active")},move:({posn:a,lastPosn:l})=>{this.solid.transform.dragToRotate(l.subtract(this.posn),a.subtract(this.posn),100),this.render(!1)},end:()=>{this.rotation=this.solid.transform.toEulerAngles(),this.props.rotation=Kl(this.rotation),this.updateOutline(),t.change({changed:[this]}),this.$el.addClass("active")},click:a=>t.tools.move.down(a),checkIfActive:()=>this.props.hinge>0})}applyChange(t){super.applyChange(t),this.rotation=sd(this.props.rotation),this.render(),this.updateOutline()}render(t=!0){t&&(this.solid.transform.clear(),Ul(this.foldTree,this.solid.children[0],-this.props.hinge),this.solid.transform.rotate(...this.rotation)),this.solid.render(Xl)}updateOutline(){let t=this.solid.getProjectedVertices(Xl);this.path=D.convexHull(...t),this.$outline.draw(this.path),this.transform(),this.$moveBar.translate(this.path.points[0].x-30,this.path.points[0].y),this.$moveHandle.translate(this.path.points[0].x-45,this.path.points[0].y-7)}animateHinges(t,i=!1,r=800){return H(this,null,function*(){let o=i?this.rotation:[0,0,0],n=this.props.hinge;yield et(a=>{this.props.hinge=rt(n,t,a),i&&(this.rotation=o.map(l=>l*(1-a))),this.render()},r).promise,this.props.rotation=Kl(this.rotation),this.updateOutline()})}hingeStart(){this.startRotation=this.rotation,this.startAngle=this.props.hinge,this.$el.removeClass("active")}hingeMove(t){if(!E(t,this.props.hinge)){if(this.props.hinge=M(t,0,1),this.startRotation&&this.startAngle){let i=M(t/this.startAngle,0,1);this.rotation=this.startRotation.map(r=>i*r)}this.render()}}hingeEnd(){this.updateOutline(),this.props.rotation=Kl(this.rotation),this.$el.addClass("active")}static fold(t){let i=ed(t);if(!i){rn("polyhedron-error");return}let r={name:"polyhedron",net:Yg(i[1]),hinge:0,rotation:"0,0,0"},o=$.create(t[0].$parent,r),n=o.solid.children[0].transform.matrix;o.setTransform(i[0].shift(-n[0][3],-n[1][3])),o.props.hinge=1,setTimeout(()=>{o.props.hinge=0,o.animateHinges(1)},10);for(let a of t)a.delete();return o}unfold(){return H(this,null,function*(){this.$parent.selection.remove(this),this.props.hinge>0&&(yield this.animateHinges(0,!0));let t=Array.from(this.solid.getFaces()).map(i=>{let r=new D(...Array.from(i.getProjectedVertices())),o=this.props.color||i.color||Wl(r.points.length);return $.create(this.$parent,{name:"polygon",shape:ys(r),color:o,x:this.posn.x,y:this.posn.y})});return this.delete(),t})}static makeThumbnail(t,i){let r=h("svg",{width:70,height:70},t),o=h("g",{transform:"translate(35, 35)"},r),{net:n,scale:a}=Yl[i.net],l=lo(n,c=>new pe(c.shape,{class:"polygon-tile"},Wl(c.shape.points.length)),-1).group;l.transform.clear().rotate(...id).scale({x:a,y:a,z:a}),o.append(l.$el),l.render(Xl)}static altText(t){var i;return((i=Yl[t.net])==null?void 0:i.name)||""}};vs.type="polyhedron",vs.defaultProps={hinge:1,rotation:id.join(",")},vs=w([T],vs);O([{id:"unfold",type:"button",tileTypes:["polyhedron"],label:"",click:(e,s)=>H(void 0,null,function*(){let t=Wt(yield Promise.all(e.map(i=>i.unfold())));s.change({added:t,deleted:e})})},{id:"hinges",type:"slider",tileTypes:["polyhedron"],label:"",start:e=>e.hingeStart(),move:(e,s)=>e.hingeMove(s),end:e=>e.hingeEnd(),get:e=>e.props.hinge}]);var F=50,St=Math.sqrt(3)/4*F;function jt(e){let s=Math.cos(B/e);return 1/Math.sqrt(2-2*s)}var ho={"equ-triangle":new D(new d(-F/2,St),new d(F/2,St),new d(0,-St)),square:D.regular(4,F*jt(4)),"reg-pentagon":D.regular(5,F*jt(5)),"reg-hexagon":D.regular(6,F*jt(6)),"reg-heptagon":D.regular(7,F*jt(7)),"reg-octagon":D.regular(8,F*jt(8)),"reg-decagon":D.regular(10,F*jt(10)),"reg-dodecagon":D.regular(12,F*jt(12)),rectangle:new S(new d(-F,-F/2),2*F,F).polygon,trapezium:new D(new d(-F,St),new d(F,St),new d(F/2,-St),new d(-F/2,-St)),rhombus:new D(new d(-F*3/4,St),new d(F/4,St),new d(F*3/4,-St),new d(-F/4,-St)),"right-triangle":new D(new d(-F/2,-F/2),new d(F/2,-F/2),new d(-F/2,F/2)),"rhombus-2":new D(new d(F/2-St,F/4),new d(-St-F/2,F/4),new d(St-F/2,-F/4),new d(St+F/2,-F/4)),chevron:new D(new d(-.75*F,2*St),new d(.25*F,2*St),new d(.75*F,0),new d(.25*F,-2*St),new d(-.75*F,-2*St),new d(-.25*F,0)),"right-triangle-2":new D(new d(-2*St,-F/2),new d(-2*St,F/2),new d(2*St,-F/2)),kite:new D(new d(0,-F),new d(2*St,-F/2),new d(0,F),new d(-2*St,-F/2)),dart:new D(new d(2*St,.75*F),new d(0,-.75*F),new d(-2*St,.75*F),new d(0,.25*F))},Xg={"equ-triangle":"",square:"","reg-pentagon":"","reg-hexagon":"","reg-heptagon":"","reg-octagon":"","reg-decagon":"","reg-dodecagon":"",rectangle:"",trapezium:"",rhombus:"","right-triangle":"","rhombus-2":"",chevron:"V","right-triangle-2":"",kite:"",dart:""},Jg=[[[-15.7728,63.1105],[-65.2725,56.0545],[-61.7426,-21.037],[-34.7275,-63.1105],[65.2725,-63.1105]],[[60.6056,14.8729],[-53.4909,57.394],[-80.668,-12.5086],[-20.582,-57.394],[80.668,-57.394]],[[0,-73.612],[50,12.9905],[15,73.612],[-50,12.9905],[-30,-73.612]],[[67.056,-58.248],[67.056,1.752],[-10.5597,58.248],[-67.056,-19.3675],[7.056,-58.248]],[[-74.4415,-47.6314],[35.5585,-47.6314],[74.4415,-8.733],[60.1965,44.3902],[-19.4415,47.6314]],[[47.6215,-81.108],[43.731,-26.2458],[-24.012,81.108],[-47.6215,-43.6179],[-7.3786,-81.108]],[[94.9659,43.7299],[-5.0343,43.7299],[-94.9659,0],[-5.0343,-43.7299],[42.1151,-41.1631]],[[-13.1927,57.1955],[76.8074,57.1955],[76.8257,-32.8045],[-9.8062,-57.1955],[-76.8257,-6.4506]],[[-3.2764,58.8874],[86.2804,29.1016],[26.2804,-43.7514],[-26.2804,-58.8874],[-86.2804,13.9666]],[[51.5265,-55],[58.4735,-14.7198],[9.6458,43.251],[-58.4735,55],[-58.4735,-55]],[[-95.733,-40.991],[53.87,-40.991],[95.733,-15.7718],[1.5099,40.991],[-95.733,-10.4271]],[[-85.642,-51.4515],[12.4961,-51.4515],[85.642,-13.2965],[-38.4855,51.4515],[-85.642,18.5485]],[[-69.99,67.0025],[84.488,2.9975],[84.488,-67.0025],[14.488,-67.0025],[-84.488,32.0117]],[[-15.6401,96.696],[46.9202,6.219],[8.0799,-96.696],[-46.9202,-96.696],[-46.9202,51.458]],[[-46.6683,85],[-46.6683,22.7758],[15.5561,-85],[46.6683,-31.1122],[15.5561,85]],[[0,-46.65],[-43.301,-21.65],[-43.301,46.65],[43.301,46.65],[43.301,-21.65]],[[-25,46.65],[25,46.65],[59.15,-12.5],[0,-46.65],[-59.15,-12.5]],[[0,-64.951],[-50,21.65],[-25,64.951],[25,64.951],[50,21.65]]].map(e=>new D(...e.map(s=>new d(...s)))),co=["","","",y.yellow,y.blue,y.green,y.red,y.teal,y.purple],Qg={trapezium:y.orange,"right-triangle":y.green,"rhombus-2":y.lime,chevron:y.orange,kite:y.purple,dart:y.teal},t1={"equ-triangle":y.green,square:y.yellow,"reg-pentagon":y.blue,"reg-hexagon":"#ffd615",rectangle:y.yellow,trapezium:"#cc1030",rhombus:y.blue,"rhombus-2":"#e6e2c6",chevron:"#cc1030","right-triangle-2":"#ffd615",kite:"#134791",dart:y.purple},e1=[...G.rainbow(15).map(e=>e.hex),y.red,y.blue,y.yellow],s1=new Set(["trapezium","rhombus","rhombus-2","rectangle","right-triangle","right-triangle-2"]),i1=new Set(["equ-triangle","square","reg-pentagon","reg-hexagon","reg-heptagon","reg-octagon","reg-decagon","reg-dodecagon","rectangle","trapezium","kite","dart"]),ys=e=>e.points.map(s=>`${s.x.toFixed(2)} ${s.y.toFixed(2)}`).join(","),Jl=e=>new D(...e.split(",").map(s=>{let[t,i]=s.split(" ");return new d(+t||0,+i||0)}));function Ln(e){return e.startsWith("pentagon-")?Jg[+e.slice(9)-1]:/^[\d.-]/.test(e)?Jl(e):ho[e]||ho.square}function nd(e,s,t=!1){return e.startsWith("pentagon-")?e1[+e.slice(9)-1]:(t?t1:Qg)[e]||co[s%co.length]||y.yellow}var Ie=class extends st{constructor(s,t,i){super(s,t,i);let r=Ln(this.props.shape);this.props.watch("scale isFlipped",({isFlipped:o,scale:n})=>this.setPath(r.scale(n||1),o)),this.symmetric=i1.has(this.props.shape),this.props.color||(this.props.color=nd(this.props.shape,this.path.points.length,s.options.altColors))}static makeThumbnail(s,t,i){let r=s1.has(t.shape)?60:80,o=Ln(t.shape);o=o.scale((t.shape.startsWith("pentagon-")?41:36)/o.radius).shift(40,r/2);let n=h("svg",{width:80,height:r},s),a=h("path",{class:"polygon-tile",path:o},n);i.options.watch(l=>a.setAttr("fill",nd(t.shape,o.points.length,l.altColors)))}static altText(s){if(s.shape.startsWith("pentagon-")){let t=+s.shape.slice(9);return t<16?` ${t}`:t===16?"":t===17?"":""}return Xg[s.shape]||""}};Ie.type="polygon",Ie=w([T],Ie);var ss=["polygon","tangram","polyomino","custom-polygon","rectangle","reg-polygon","fractal","penrose"];O([{id:"flip",type:"button",label:"",tileTypes:[...ss,"egg","garden","number-frame"],show:e=>e.length>1||!!e[0].rot||!e[0].symmetric,click:(e,s)=>{let t=s.selection.center;for(let i of e)i.flip(t);s.change({changed:e})}},{id:"cut",type:"button",tileTypes:ss,label:"",show:e=>e.every(s=>!ne(s)),click:(e,s)=>s.tools.cutPolygon.enable()},{id:"join",type:"button",label:"",tileTypes:ss,show:e=>e.length>1,click:(e,s)=>{let t=e.map(n=>n.transformed),i=D.union(...t),r=e[0].props.color,o=i.map(n=>new Ie(e[0].$parent,{shape:ys(n),color:r}));for(let n of e)n.delete();s.selection.select(o,!0),s.change({added:o,deleted:e})}},{id:"fold-net",type:"button",label:"",tileTypes:ss,show:e=>e.length>2,click:(e,s)=>{let t=vs.fold(e);t&&s.change({added:[t],deleted:e})}},{id:"animation",type:"select",tileTypes:ss,label:"",location:"music",flattenGroups:!0,show:e=>!e[0].$parent.options.noMusic,options:[{key:"vertices",label:""},{key:"perimeter",label:""},{key:"area",label:""},{key:"angles",label:""}],get:e=>{var s;return((s=e.props.animation)==null?void 0:s.replace("hidden","perimeter"))||"perimeter"},set:(e,s)=>s.props.animation=e},{id:"audio-labels",type:"checkbox",tileTypes:ss,label:"",location:"music",flattenGroups:!0,icon:"numbers",show:e=>!e[0].$parent.options.noMusic&&e.every(s=>!["vertices"].includes(s.props.animation)),get:e=>e.props.labels==="number",set:(e,s)=>s.props.labels=e?"number":void 0}]);O([{id:"scale",type:"input",label:"",location:"more",value:"number",range:[.1,10],icon:"geo-scale",tileTypes:["polygon","reg-polygon","rectangle","custom-polygon"],show:e=>e.every(s=>!ne(s)),get:e=>e.props.scale||1,set:(e,s)=>{let t=s.path.centroid.scale(1-+e/(s.props.scale||1));s.setTransform(s.posn.add(t)),s.props.scale=+e,s.$parent.selection.update()}}]);var ad='<g class=leg-pin style="transform-origin:bottom right"><polygon points="0,-21 -7,-21 0,0" fill=#3a3645></polygon><path d=M-23.9-375H0v354h-7l-17-19v-335H-23.9z fill=#d6d4db></path></g><g class=pencil><rect class=leg-pencil x=0 y=-375 width=24 height=307 style="transform-box:fill-box;transform-origin:bottom center" fill=#d6d4db></rect><g><path d=M72-48c-0.5,0-3,5-3,5H39c0,0-2.5-5-3-5v-106h36C72-154,72-48,72-48z></path><rect x=47 y=-154 width=14 height=111 fill=#000 opacity=0.3></rect><path d=M37.4-47.3l2.2,2.6c0.4,0.5,1,0.8,1.6,0.8c0.5,0,1-0.2,1.4-0.6l2.8-3.9c0.9-0.8,2.3-0.9,3.3-0.2l3.6,3.2c1,0.8,2.4,0.8,3.4,0l3.6-3.2c1-0.7,2.4-0.6,3.3,0.2l2.8,3.9c0.4,0.4,0.9,0.6,1.4,0.6c0.6,0,1.2-0.3,1.6-0.8l2.2-2.6c0.3-0.4,0.8-0.7,1.4-0.7L61.4-19.6c-4.8-1.9-10-1.9-14.8,0L36-48C36.6-48,37.1-47.7,37.4-47.3z fill=#f7eecb></path><path d=M46.6-19.6c4.8-1.9,10-1.9,14.8,0L54,0L46.6-19.6z></path></g><path d=M81-56H15c-1.7,0-3-1.3-3-3v-18c0-1.7,1.3-3,3-3h66c1.7,0,3,1.3,3,3v18C84-57.3,82.7-56,81-56z fill=#d6d4db></path><circle cx=12 cy=-68 r=16 fill=#d6d4db></circle><circle cx=12 cy=-68 r=9 fill=#3a3645></circle></g><g class=top><path d=M19-422H9v-25c0-2.8-2.2-5-5-5h-8c-2.8,0-5,2.2-5,5v25h-10c-2.8,0-5,2.2-5,5l0.1,42l9.2,19.2c0.4,1,1.4,4,4,4h21.7c2.7,0,3.7-3,4.1-4L24-375v-42C24-419.8,21.8-422,19-422z fill=#3a3645></path><circle cy=-386 r=9 fill=#d6d4db></circle></g>';var _t=50,ld=100,yr=class extends ${constructor(t,i,r){super(t,i,r);this.cannotRotate=!0;this.cannotDragToSelect=!0;this.$el.addClass("utensil"),this.absoluteEnd=new d(this.props.width,0),this.setup(),this.$handles=[0,1].map(o=>this.makeHandle("c",(n,a)=>{var p;let l=o?this.posn:this.absoluteEnd,c=(p=this.$parent.snapping.snap([a]))==null?void 0:p.shift;a=c?a.add(c):a.snap(l,10),d.distance(a,l)<ld&&(a=new q(l,ld).project(a)),this[o?"absoluteEnd":"posn"]=a,this.rot=this.props.rot=Vt(this.absoluteEnd.angle(this.posn)),this.props.isFixed||(this.props.width=this.absoluteEnd.subtract(this.posn).length),this.update()})),this.update()}applyChange(t){super.applyChange(t),this.update()}flip(){this.props.isFlipped=!this.props.isFlipped,this.update()}moveEnd(){this.absoluteEnd=new d(this.props.width,0).rotate(W(this.rot)).add(this.posn),super.moveEnd()}update(){this.$handles[1].setCenter({x:this.props.width,y:0}),this.transform()}getDrawingPath(t){var r;let i=(r=this.transformed)==null?void 0:r.project(t);if(i&&d.distance(t,i)<30)return this.transformed}},r1=new Set(["ruler","protractor","set-triangle","compass"]);function hd(e){return r1.has(e.props.name)}var o1=2.54,On=60,vr=_t*o1;function*cd(e,s,t,i){let r=(s+.1)/e;for(let o=0;o<=r;o+=1){let n=i?i.findIndex(l=>!(o%l)):-1,a=o*e;yield[t?s-a:a,n]}}var ii=class extends yr{constructor(t,i,r){super(t,i,r);this.padding=[0,20,0,20];this.props.watch("units fixed",()=>this.update())}setup(){this.$glass=h("rect",{x:-20,height:On,class:"glass",rx:5},this.$el),this.$ticks=h("path",{class:"ticks"},this.$el),this.$labelsTop=I(t=>h("text",{text:t},this.$el),31),this.$labelsBottom=I(t=>h("text",{text:t,y:42},this.$el),12),this.$labelsBottom[0].text="0 in"}update(){let{units:t,width:i,isFlipped:r}=this.props,o=t==="both",n=t==="hidden";this.$glass.setAttr("width",i+40),this.path=new S(P,i,On);let a="";if(!n&&t!=="in")for(let[c,p]of cd(_t/10,i,r,[10,5]))a+=`M${c} 0v${([20,15][p]||10)*(o?.8:1)}`;if(!n&&t!=="cm"){let c=o?On:0;for(let[p,u]of cd(vr/16,i,r,[16,8,4]))a+=`M${p} ${c}v${([20,16,12][u]||8)*(o?-.8:1)}`}this.$ticks.setAttr("d",a),this.$labelsTop[0].text=t==="in"?"0 in":"0 cm";let l=t==="in"?vr:_t;for(let[c,p]of this.$labelsTop.entries())p.toggle(!n&&c*l<=i+.1),p.setAttr("y",o?26:32),p.setAttr("x",r?i-l*c:l*c);for(let[c,p]of this.$labelsBottom.entries())p.toggle(!n&&o&&c*vr<=i+.1),p.setAttr("x",r?i-vr*c:vr*c);super.update()}getSnapPoints(){if(this.props.units==="hidden")return[];let t=this.props.units==="both",i=vr/2,r=I(n=>new d(this.props.isFlipped?this.props.width-n*_t:n*_t,0),this.props.width/_t),o=I(n=>new d(this.props.isFlipped?this.props.width-n*i:n*i,t?On:0),this.props.width/i);return this.props.units==="cm"?r:t?[...r,...o]:o}getSnapLines(){let[t,i,r]=this.path.edges;return this.props.units==="both"?[t,r]:[t]}getDrawingPath(t){if(!this.transformed)return;let[i,r,o]=this.transformed.edges,n=d.distance(t,i.project(t)),a=d.distance(t,o.project(t));return n<30?i:this.props.units==="both"&&a<30?o:void 0}static altText(){return""}};ii.type="ruler",ii.defaultProps={width:400,layer:"front",units:"cm"},ii=w([T],ii);function n1(e){return`M0-${e}A${e},${e},0,0,0-${e},0V3a5,5,0,0,0,5,5H${e-5}a5,5,0,0,0,5-5V0A${e},${e},0,0,0,0-${e}Z`}var ri=class extends yr{constructor(){super(...arguments);this.padding=[0,0,10,0]}setup(){this.$glass=h("path",{d:"",class:"glass"},this.$el),this.$ticks=h("path",{class:"ticks"},this.$el),this.$labels=I(t=>[h("text",{text:t*10},this.$el),h("text",{text:t*10,style:"font-size:9px"},this.$el)],19),this.$labels[9][0].css("font-size","20px"),this.$labels[9][1].hide()}update(){let t=this.props.width;this.path=new ge(P,new d(-this.props.width,0),Math.PI),this.$glass.setAttr("d",n1(t));let i="",r=this.props.width<120?5:1;for(let o=0;o<=180;o+=r){let n=!(o%10),a=!n&&!(o%5),l=d.fromPolar(W(-o)),c=t-(n?30:a?23:15);i+=`M${l.x*t} ${l.y*t}L${l.x*c} ${l.y*c}`,n&&(i+=`M${l.x*8} ${l.y*8}L${l.x*(t-60)} ${l.y*(t-60)}`)}this.$ticks.setAttr("d",i);for(let[o,[n,a]]of this.$labels.entries()){if(o===9){n.setAttr("y",52-t);continue}n.toggle(t>160||!(o%3)),a.toggle(t>160),n.setAttr("y",44-t),a.setAttr("y",55-t),n.setAttr("transform",`rotate(${(this.props.isFlipped?-1:1)*(90-10*o)})`),a.setAttr("transform",`rotate(${(this.props.isFlipped?1:-1)*(90-10*o)})`)}super.update()}getSnapPoints(){return[P,this.path.start,this.path.at(.5),this.path.end]}getSnapLines(){return[]}static altText(){return""}};ri.type="protractor",ri.defaultProps={width:200,layer:"front"},ri=w([T],ri);var Ql=234,Nn=150;function a1(e){let s=e<Nn?e/(Nn/(Ql/6)):e<Ql?Ql/6:e/6,t=s+s*Math.SQRT2;return`M0,0 H${e} L0,${-e} V0 M${s},${-s} H${e-t} L${s},${-e+t} V${s},${-s}`}var oi=class extends yr{setup(){this.$glass=h("path",{d:"","fill-rule":"evenodd",class:"glass"},this.$el),this.$ticks=h("path",{class:"ticks"},this.$el),this.$hLabels=I(t=>h("text",{text:t,y:-23},this.$el),31),this.$hLabels[0].hide(),this.$vLabels=I(t=>h("text",{text:t,x:25,"dominant-baseline":"central"},this.$el),31),this.$vLabels[0].hide()}update(){this.path=new D(P,new d(this.props.width,0),new d(0,-this.props.width)),this.$glass.setAttr("d",a1(this.props.width));let t=this.props.width-50,i="",r=2,o=1;for(let n=0;n<=t;n+=_t/10){let a=n%_t?n%(_t/2)?0:o:r,l=n<10?-10*(n/10):[-10,-15,-20][a];i+=`M${n} 0V${l}`}for(let n=0;n<=t;n+=_t/10){let a=n%_t?n%(_t/2)?0:o:r,l=n<10?10*(n/10):[10,15,20][a];i+=`M0,${-n} H${l}`}this.$ticks.setAttr("d",i);for(let[n,a]of this.$hLabels.entries())n>0&&a.toggle(this.props.width>=Nn&&n<t/_t),a.setAttr("x",_t*n);for(let[n,a]of this.$vLabels.entries())n>0&&a.toggle(this.props.width>=Nn&&n<t/_t),a.setAttr("y",_t*-n);super.update()}getSnapPoints(){let t=this.props.width,i=new dt(P,new d(t,0)),r=new dt(P,new d(0,-t)),o=I(a=>i.at(a*_t/t),t/_t),n=I(a=>r.at(a*_t/t),t/_t);return o.concat(n)}getSnapLines(){return[this.path]}static altText(){return""}};oi.type="set-triangle",oi.defaultProps={width:280,layer:"front"},oi=w([T],oi);var Rn=375,In=new d(54,68),ni=class extends yr{setup(){this.$el.html=ad,this.$pencil=this.$el.$(".pencil"),this.$top=this.$el.$(".top"),this.$legPin=this.$el.$(".leg-pin"),this.$legPencil=this.$el.$(".leg-pencil"),this.props.watch("color",({color:r})=>this.$pencil.css("fill",r));let t,i=0;this.$parent.events.listen(this.$pencil.$("g"),{start:r=>{let o=new d(this.props.width,0).rotate(W(this.rot)).add(this.posn);t=new we(this.$parent,"",this.props.color,"pen"),t.start(o,new q(this.posn,this.props.width)),i=Vt(r.posn.angle(this.posn))-this.rot;for(let n of this.$handles)n.setAttr("hidden",!0)},move:r=>{this.rot=Vt(r.posn.angle(this.posn))-i,this.transform();let o=d.fromPolar(W(this.rot),this.props.width).add(this.posn);t.addPoint(o)},end:()=>{t.end(),this.$parent.change({added:[t],changed:[this]}),t=void 0;for(let r of this.$handles)r.removeAttr("hidden")}}),this.$parent.events.listen(this.$top,{start:r=>{i=Vt(r.posn.angle(this.posn))-this.rot;for(let o of this.$handles)o.setAttr("hidden",!0)},move:r=>{this.rot=Vt(r.posn.angle(this.posn))-i,this.transform()},end:()=>{this.$parent.change({changed:[this]});for(let r of this.$handles)r.removeAttr("hidden")}})}update(){this.props.width>730&&(this.props.width=730);let t=this.props.width-In.x,i=Rn-In.y,r=new q(P,Rn),o=new q(new d(t,-In.y),i),n=Ht(r,o)[0],a=Math.acos(n.x/Rn),l=Math.acos((t-n.x)/i);this.$legPin.css("transform",`rotate(${-a+ht}rad`),this.$legPencil.css("transform",`rotate(${l-ht}rad`),this.$pencil.setTransform({x:this.props.width-In.x,y:0}),this.$top.setTransform({x:n.x,y:Rn+n.y}),this.path=new dt(P,new d(this.props.width,0)),super.update()}getSnapPoints(){return[P,new d(this.props.width,0)]}getDrawingPath(){}static altText(){return""}};ni.type="compass",ni.defaultProps={width:300,layer:"front",color:y.red},ni=w([T],ni);O([{id:"flip",type:"button",tileTypes:["ruler","protractor"],label:"",click:(e,s)=>{for(let t of e)t.flip();s.change({changed:e})}}]);O([{id:"labels",type:"select",tileTypes:["ruler"],label:"",options:[{label:"",key:"cm"},{label:"",key:"in"},{label:"",key:"both"},{label:"",key:"hidden"}],location:"more",get:e=>e.props.units,set:(e,s)=>s.props.units=e},{id:"fixed-length",type:"checkbox",tileTypes:["ruler"],label:"",location:"more",get:e=>!!e.props.isFixed,set:(e,s)=>s.props.isFixed=e}]);var bs=class{constructor(s){this.$parent=s}getTileAt(s){let t=this.$parent.snapping.snapGeo(s.posn);if(t!=null&&t.tile&&t.tile.canSelect)return t.tile;let i=s.event.target;for(;i;){let r=hn.get(i);if(r!=null&&r.canSelect&&r.props.name!=="geo")return r;if(i=i.parentNode||void 0,i===this.$parent._el)return}}hoverGeoTile(s){var t;this.hoveringTile!==s&&((t=this.hoveringTile)==null||t.hover(!1)),s==null||s.hover(),this.hoveringTile=s}down(s){}start(s){}move(s){}up(s){}end(s){}click(s){}hover(s){}cancel(){}},Gn=class extends bs{constructor(){super(...arguments);this.clickTimeout=0}down(t){var r,o;let i=this.activeTile=(r=this.getTileAt(t))==null?void 0:r.root;this.previousSelection=void 0,(o=this.$parent.focussedTile)==null||o.blur(),this.$parent.warningBanner.hide(),i?(i.isActive&&this.$parent.events.shiftKey?this.$parent.selection.remove(i):(this.$parent.events.shiftKey||!i.isActive)&&this.$parent.selection.add(i,!this.$parent.events.shiftKey),i.down(t),ps.addClass("grabbing")):this.$parent.events.shiftKey?this.previousSelection=new Set(this.$parent.selection.tiles):this.$parent.selection.clear()}up(t){var i;(i=this.activeTile)==null||i.up(t)}start(){if(this.activeTile){let t=this.activeTile.props.status==="generator";(this.$parent.events.altKey||t)&&(t&&this.$parent.selection.add(this.activeTile,!0),this.$parent.paste(this.$parent.selection.copy(),P)),this.$parent.selection.moveStart()}else this.$parent.$selection.show()}move(t){var r;if(this.activeTile){this.$parent.selection.move(t);return}let i=S.aroundPoints([t.startPosn,t.posn]);this.$parent.$selection.setRect(i);for(let o of this.$parent.tiles.values()){if(!o.canSelect||o.cannotDragToSelect||!o.transformed||o.group)continue;let n=or(i,o.transformed,o.props.name);(this.$parent.events.shiftKey&&((r=this.previousSelection)==null?void 0:r.has(o))?!n:n)?this.$parent.selection.add(o,!1,!0):this.$parent.selection.remove(o,!0)}this.$parent.selection.update(!0)}end(){this.activeTile?this.$parent.selection.moveEnd():this.$parent.$selection.hide(),ps.removeClass("grabbing")}click(t){if(this.activeTile){this.activeTile.click(t);let i=Date.now();i-this.clickTimeout<500&&this.activeTile.doubleClick(t),this.clickTimeout=i}}hover(t){let i=this.getTileAt(t);this.hoverGeoTile(i!=null&&i.is("geo")?i:void 0),this.$parent.$svg.css("cursor",i?"grab":"")}},_n=class extends bs{constructor(){super(...arguments);this.erased=[]}down({posn:t}){this.erase(t)}move({posn:t,lastPosn:i}){let r=d.distance(t,i)/4;for(let o=0;o<r;++o)this.erase(d.interpolate(t,i,o/r))}shouldErase(t,i,r){return Mt(i)?d.distance(i,t)<10:Rt(i)?i.distanceSquared(t)<100:Lo(i)?i.edges.some(o=>o.distanceSquared(t)<100):yt(i)&&r==="geo"?Math.abs(d.distance(t,i.c)-i.r)<10:i.contains(t)}erase(t){for(let i of this.$parent.tiles.values())if(!(!i.transformed||i.cannotDragToSelect||!i.canSelect||i.cannotEdit||ne(i))&&this.shouldErase(t,i.transformed,i.props.name)){i.delete(),this.erased.push(i);return}for(let i of this.$parent.strokes.values())if(i.hitTest(t,10)){i.delete(),this.erased.push(i);return}}end(){this.erased.length&&(this.$parent.change({deleted:this.erased}),this.$parent.snapping.updateIntersections()),this.erased=[]}click(){this.end()}},zn=class extends bs{constructor(){super(...arguments);this.options="text"}down({posn:t}){let i=$.create(this.$parent,{name:this.options,x:t.x-10,y:t.y-15});this.$parent.trigger("add-tile",{tile:i}),this.$parent.setActiveTool("move"),i.focus(!0)}},Bn=class extends bs{enable(){this.previousTool=this.$parent.state.tool,this.$parent.setActiveTool("pan")}down(t){this.initialOrigin=this.$parent.origin,this.startPosn=ce(t.event)}move(t){let i=ce(t.event).subtract(this.startPosn),r=this.initialOrigin.subtract(i.scale(1/this.$parent.zoom));this.$parent.setViewport(r,this.$parent.zoom)}disable(){this.$parent.setActiveTool(this.previousTool)}},Hn=class extends bs{constructor(){super(...arguments);this.options="pen"}getUtensil(t){for(let i of this.$parent.tiles.values()){let r=hd(i)?i.getDrawingPath(t):void 0;if(r)return r}}down({posn:t}){this.stroke=new we(this.$parent,"",this.$parent.state.penColor,this.options),this.stroke.start(t,this.getUtensil(t))}move({posn:t}){this.stroke.addPoint(t)}click(){this.$parent.change({added:[this.stroke]}),this.stroke=void 0}end(t){this.stroke.end(),this.click()}},po=class extends bs{constructor(){super(...arguments);this.options="line";this.angleIndex=0}expr(t,i){var r;switch(this.options){case"line":return`segment(${t},${i})`;case"circle":return`circle(${t},distance(${t},${i}))`;case"rect":return`rectangle(${t},${i}.x-${t}.x,${i}.y-${t}.y)`;case"angle":return`angle(${i},${(r=this.midPoint)==null?void 0:r.props.key},${t})`}}snapPoint(t){var n;this.$parent.options.canvas!=="infinite"&&(t=t.clamp(this.$parent.canvasBounds));let i=this.$parent.snapping.snap([t]);i&&(t=t.add(i.shift));let r="",o=((n=i==null?void 0:i.tile)==null?void 0:n.props.name)==="geo"?i==null?void 0:i.tile:void 0;return o!=null&&o.path&&Mt(o.path)&&(r=o.props.key),i!=null&&i.intersection&&(r=i.intersection),{point:t,tile:o,expr:r||`point(${t.x},${t.y})`}}getOrMakePointTile(t){var r,o;if((r=t==null?void 0:t.tile)!=null&&r.path&&Mt(t.tile.path))return t.tile;if((o=t==null?void 0:t.tile)!=null&&o.path){let n=t.tile.path.offset(t.point),a=new ae(this.$parent,{expr:`${t.tile.props.key}.at(${n})`});return this.$parent.trigger("add-tile",{tile:a}),a}let i=new ae(this.$parent,{expr:t.expr});return this.$parent.trigger("add-tile",{tile:i}),i}drawPendingPoint(t){var o,n;let i=((n=(o=t.tile)==null?void 0:o.path)==null?void 0:n.type)==="point",r=t.expr.startsWith("intersection");this.$parent.$pendingPoint.toggle(!i),i||(this.$parent.$pendingPoint.setCenter(t.point),this.$parent.$pendingPoint.setClass("intersection",r),this.$parent.$pendingPoint.setAttr("r",r?3.5:6))}down({posn:t}){var o;let i=this.snapPoint(t),r=this.getOrMakePointTile(i);this.createdNewStart=((o=i.tile)==null?void 0:o.geoType)!=="point",this.options==="angle"?this.angleIndex===0?(this.startPoint=r,this.angleIndex=1,this.createdNewStart&&this.$parent.change({added:[r]})):this.angleIndex===1?(this.midPoint=r,this.angleIndex=2,this.path=new ae(this.$parent,{expr:this.expr(this.startPoint.props.key,r.props.key)}),this.createdNewStart&&this.$parent.change({added:[r]})):(this.path.setExpr(this.expr(this.startPoint.props.key,r.props.key)),this.$parent.change({added:this.createdNewStart?[r,this.path]:[this.path]}),this.angleIndex=0,this.path=this.startPoint=this.midPoint=this.createdNewStart=void 0):this.startPoint=r}start(){var t;this.options!=="angle"&&(this.path=new ae(this.$parent,{}),this.startPoint.pending=this.path.pending=!0,(t=this.$parent.$pendingPoint)==null||t.show(),this.hoverGeoTile())}move({posn:t}){var i;this.options!=="angle"&&(this.endSnap=this.snapPoint(t),this.path.setExpr(this.expr(this.startPoint.props.key,this.endSnap.expr),!0),this.drawPendingPoint(this.endSnap),this.hoverGeoTile((i=this.endSnap)==null?void 0:i.tile))}end(){var r,o,n;if(this.options==="angle")return;let t=d.distance(this.startPoint.path,this.endSnap.point)<8,i;if(t?this.path.delete():(i=this.getOrMakePointTile(this.endSnap),this.path.setExpr(this.expr(this.startPoint.props.key,i.props.key)),this.path.setPending(!1),this.$parent.trigger("add-tile",{tile:this.path})),this.startPoint.setPending(!1),(r=this.$parent.$pendingPoint)==null||r.hide(),this.hoverGeoTile(),this.$parent.snapping.updateIntersections(),this.createdNewStart||!t){let a=[];this.createdNewStart&&a.push(this.startPoint),this.path&&a.push(this.path),i&&((n=(o=this.endSnap)==null?void 0:o.tile)==null?void 0:n.geoType)!=="point"&&a.push(i),this.$parent.change({added:a})}this.startPoint=this.path=this.endSnap=void 0}click(){this.options!=="angle"&&this.createdNewStart&&this.$parent.change({added:[this.startPoint]})}hover(t){var r;let i=this.snapPoint(t.posn);this.drawPendingPoint(i),this.hoverGeoTile(((r=i==null?void 0:i.tile)==null?void 0:r.props.name)==="geo"?i.tile:void 0),this.options==="angle"&&this.angleIndex===2&&this.path.setExpr(this.expr(this.startPoint.props.key,i.expr))}cancel(){this.$parent.$pendingPoint.hide(),this.path&&this.path.delete(),this.startPoint=this.path=this.endSnap=void 0,this.angleIndex=0}},Fn=class extends po{constructor(){super(...arguments);this.startId="";this.expression=""}enable(t){var i;this.expression=t,this.$parent.selection.clear(),this.$parent.setActiveTool("geoPending"),(i=window.event)!=null&&i.clientX&&this.hover({posn:Ue(window.event,this.$parent.$svg)})}makePath(){return this.path=new ae(this.$parent,{}),this.path.$el.css("opacity",.5),this.path.pending=!0,this.path}down(t){if(!this.expression)return;super.down(t);let i=this.path||this.makePath();i.$el.css("opacity",1),i.setExpr(this.expression.replace(/\$1/g,this.startPoint.props.key)),i.pending=!1,this.path=void 0,this.$parent.selection.add(i,!0);let r=this.createdNewStart?[this.startPoint]:[];this.$parent.change({added:[...r,i]}),this.$parent.snapping.updateIntersections(),this.$parent.trigger("add-tile",{tile:i}),this.$parent.setActiveTool("move")}hover({posn:t}){var r;if(!this.expression)return;let i=this.snapPoint(t);this.drawPendingPoint(i),this.hoverGeoTile(((r=i==null?void 0:i.tile)==null?void 0:r.props.name)==="geo"?i.tile:void 0),this.path||this.makePath(),this.path.setExpr(this.expression.replace(/\$1/g,i.expr))}cancel(){super.cancel(),this.expression=""}},qn=class extends bs{enable(){if(this.tiles=Array.from(this.$parent.selection.tiles),!this.tiles.length)return this.cancel();this.$parent.selection.clear(),this.$parent.setActiveTool("cutPolygon");for(let t of this.tiles)t.$el.addClass("active")}down(){}start({posn:t}){var i;this.tiles&&(this.startPoint=((i=this.$parent.snapping.snap([t]))==null?void 0:i.posn)||t,this.$stroke=h("line",{class:"stroke cut"},this.$parent.$strokes))}move({posn:t}){var i,r;this.tiles&&(this.endPoint=((i=this.$parent.snapping.snap([t]))==null?void 0:i.posn)||t.snap(this.startPoint,5),(r=this.$stroke)==null||r.setLine(this.startPoint,this.endPoint))}end(t){var a;if(!this.tiles)return;if(t.cancelled)return this.cancel();let i=new It(this.startPoint,this.endPoint),r=!1,o=[],n=[];for(let l of this.tiles||[]){let p=l.transformed.cut(i);if(p.length>1){for(let u of p)o.push(new Ie(this.$parent,{shape:ys(u),color:l.props.color}));l.delete(),n.push(l),r=!0}else l.$el.removeClass("active")}r&&this.$parent.change({added:o,deleted:n}),(a=this.$stroke)==null||a.remove(),this.$stroke=this.tiles=this.startPoint=this.endPoint=void 0,this.$parent.setActiveTool("move")}click(){this.cancel()}cancel(){var t;for(let i of this.tiles||[])i.$el.removeClass("active");(t=this.$stroke)==null||t.remove(),this.$stroke=this.tiles=this.startPoint=this.endPoint=void 0,setTimeout(()=>this.$parent.setActiveTool("move"))}};var pd='<x-icon class=bg-icon name=eye-off size=360 hidden></x-icon><svg class=canvas tabindex=0><defs><pattern class=grid-pattern id=square2-grid x=0 y=0 width=50 height=50 patternUnits=userSpaceOnUse><rect x=0 y=0 width=50 height=50 opacity=0.4></rect></pattern><pattern class=grid-pattern id=square-dots x=-4 y=-4 width=25 height=25 patternUnits=userSpaceOnUse><circle cx=4 cy=4 r=2 opacity=0.6></circle></pattern><pattern class=grid-pattern id=square-grid x=0 y=0 width=125 height=125 patternUnits=userSpaceOnUse><g opacity=0.4><line x1=25 y1=0 x2=25 y2=125></line><line x1=0 y1=25 x2=125 y2=25></line><line x1=50 y1=0 x2=50 y2=125></line><line x1=0 y1=50 x2=125 y2=50></line><line x1=75 y1=0 x2=75 y2=125></line><line x1=0 y1=75 x2=125 y2=75></line><line x1=100 y1=0 x2=100 y2=125></line><line x1=0 y1=100 x2=125 y2=100></line></g><rect x=0 y=0 width=125 height=125></rect></pattern><pattern class=grid-pattern id=tri-dots x=0 y=-4 width=25 height=43.302 patternUnits=userSpaceOnUse><circle cx=0 cy=4 r=2 opacity=0.6></circle><circle cx=25 cy=4 r=2 opacity=0.6></circle><circle cx=12.5 cy=25.651 r=2 opacity=0.6></circle></pattern><pattern class=grid-pattern id=tri-grid x=0 y=0 width=25 height=43.302 patternUnits=userSpaceOnUse><g opacity=0.4><line x1=0 y1=0 x2=25 y2=0></line><line x1=0 y1=21.651 x2=25 y2=21.651></line><line x1=0 y1=43.302 x2=25 y2=43.302></line><line x1=0 y1=0 x2=25 y2=43.302></line><line x1=25 y1=0 x2=0 y2=43.302></line></g></pattern><pattern class=grid-pattern id=tri2-dots x=-4 y=0 width=43.302 height=25 patternUnits=userSpaceOnUse><circle cx=4 cy=0 r=2 opacity=0.6></circle><circle cx=4 cy=25 r=2 opacity=0.6></circle><circle cx=25.651 cy=12.5 r=2 opacity=0.6></circle></pattern><pattern class=grid-pattern id=tri2-grid x=0 y=0 width=43.302 height=25 patternUnits=userSpaceOnUse><g opacity=0.4><line x1=0 y1=0 x2=0 y2=25></line><line x1=21.651 y1=0 x2=21.651 y2=25></line><line x1=43.302 y1=0 x2=43.302 y2=25></line><line x1=0 y1=0 x2=43.302 y2=25></line><line x1=0 y1=25 x2=43.302 y2=0></line></g></pattern><pattern class=grid-pattern id=square-checked x=0 y=0 width=50 height=50 patternUnits=userSpaceOnUse><rect class=filled x=0 y=0 width=25 height=25 opacity=0.4></rect><rect class=filled x=25 y=25 width=25 height=25 opacity=0.4></rect></pattern><radialGradient id=sphere-gradient cx=65% cy=35% r=65%><stop offset=0 stop-color=white stop-opacity=0.3></stop><stop offset=0.32 stop-color=white stop-opacity=0></stop><stop offset=0.33 stop-opacity=0></stop><stop offset=1 stop-opacity=0.2></stop></radialGradient><linearGradient id=card-gradient><stop offset=0 stop-color=#999></stop><stop offset=0.08 stop-color=#bbb></stop><stop offset=0.92 stop-color=#bbb></stop><stop offset=1 stop-color=#999></stop></linearGradient><filter id=handdrawn x=-20% y=-20% width=140% height=140%><feTurbulence type=fractalNoise basefrequency="0.004 0.004" numoctaves=26 stitchtiles=stitch result=turbulence></feTurbulence><feDisplacementMap in=SourceGraphic in2=turbulence scale=20 xchannelselector=R ychannelselector=G result=displacementMap></feDisplacementMap></filter><filter id=pencil x=-10% y=-10% width=110% height=110% filterUnits=objectBoundingBox><feTurbulence type=fractalNoise baseFrequency=1.2 numOctaves=3 result=noise></feTurbulence><feDisplacementMap xChannelSelector=R yChannelSelector=G scale=2 in=SourceGraphic result=newSource></feDisplacementMap></filter><filter id=outline><feMorphology in=SourceAlpha result=DILATED operator=dilate radius=1.2></feMorphology><feFlood flood-color=var(--canvas-bg) flood-opacity=1 result=WHITE></feFlood><feComposite in=WHITE in2=DILATED operator=in result=OUTLINE></feComposite><feMerge><feMergeNode in=OUTLINE></feMergeNode><feMergeNode in=SourceGraphic></feMergeNode></feMerge></filter><symbol id=suit-c viewBox="-12 -12 24 24" width=24 height=24 x=-12 y=-12><path d="m0-10c2.3.1 4.2 1.9 4.3 4.2 0 1.6-.9 3-2.3 3.8.8-.3 1.6-.5 2.5-.5 2.4-.1 4.4 1.7 4.5 4.1v.2c0 2.3-1.9 4.2-4.2 4.2-.1 0-.2 0-.3 0-1.2-.1-2.4-.4-3.5-1 0 0-.3 2 2 5h-6c2.3-3 2-5 2-5-1.1.6-2.3.9-3.5 1-2.3.2-4.3-1.6-4.5-3.9 0-.1 0-.2 0-.3 0-2.4 1.9-4.3 4.3-4.3h.2c.9 0 1.7.2 2.5.5-1.4-.8-2.3-2.2-2.3-3.8.1-2.3 2-4.1 4.3-4.2z"></path></symbol><symbol id=suit-s viewBox="-12 -12 24 24" width=24 height=24 x=-12 y=-12><path d="m0-10c-3 5-8 7-8 12 .1 2.1 1.9 3.9 4 4 1.1.1 2.2-.2 3-1 0 0 .3 2-2 5h6c-2-3-2-5-2-5 .8.8 1.9 1.1 3 1 2.1-.1 3.9-1.9 4-4 0-5-5-7-8-12z"></path></symbol><symbol id=suit-h viewBox="-12 -12 24 24" width=24 height=24 x=-12 y=-12><path d="m0 8.5-1.3-1.3c-4.6-4.1-7.7-6.9-7.7-10.3-.1-2.7 2.1-4.9 4.8-5h.2c1.5 0 3.1.7 4 1.9 1-1.2 2.5-1.9 4-1.9 2.8-.1 4.9 2.1 5 4.8v.2c0 3.4-3.1 6.2-7.7 10.3z"></path></symbol><symbol id=suit-d viewBox="-12 -12 24 24" width=24 height=24 x=-12 y=-12><path d="m7 0-7 10-7-10 7-10"></path></symbol><pattern id=card-bg width=6 height=8 patternUnits=userSpaceOnUse><rect width=6 height=8 fill=#0f82f2></rect><line x2=6 y2=8 stroke=#eee stroke-width=1></line><line x1=6 y2=8 stroke=#eee stroke-width=1></line></pattern></defs><rect class=grid></rect><path class=group-shadow></path><path class=mask></path><g class=tiles></g><g class=tiles></g><g class=strokes></g><g class=geo-shadows></g><g class=geo-paths></g><g class=geo-points></g><g class=tiles></g><rect class=selection></rect><g class=transform-tools hidden><path class=group-outline></path><line class=rotate-bar></line><circle class=rotate-circle r=10></circle></g></svg><div class=html-overlay></div><div class=rotate-label></div><button class="btn btn-blue exit-mode"><x-icon name=construction></x-icon></button><button class="btn btn-blue exit-mode"><x-icon name=eye-off></x-icon>/</button><slot></slot>';var l1=new Set(["x","y","","r"]);function br(e){if(e instanceof Ft&&e.fn==="="){let[s,t]=e.args;if(s instanceof pr&&!l1.has(s.i))return[s.i,t]}return[void 0,e]}var Un=class{constructor(){this.assignments=new Map;this.callbackDeps=new Map;this.updatedNames=new Set}findFirstAssigner(s){var t;return(t=this.assignments.get(s))==null?void 0:t.keys().next().value}findDependants(s,t=[]){let i=[];for(let[o,n]of this.assignments.entries())n.size===1&&o!==s&&!t.includes(o)&&Es(n.values()).unknowns.filter(l=>!t.includes(l)).includes(s)&&i.push(o);let r=Xi(i,o=>this.findDependants(o,i));return[...i,...r]}validate(s){let t=new Set,i=(r,o=[])=>{if(!this.assignments.has(r)){t.add(r);return}if(o.includes(r))return{message:`The variable <em>${r}</em> is defined recursively.`,locations:o.splice(o.indexOf(r)).map(a=>this.findFirstAssigner(a))};let n=this.assignments.get(r);if(n.size===1){let a=Es(n.values());for(let l of a.unknowns){let c=i(l,[...o,r]);if(c)return c}}else return{message:`You have defined <em>${r}</em> in multiple places.`,locations:Array.from(n.keys())}};for(let r of s.unknowns){let o=i(r);if(o)return{error:o,dependsOn:[],unknowns:[]}}return{dependsOn:[],unknowns:Array.from(t)}}evaluate(s){let{error:t,unknowns:i}=this.validate(s);if(t||i.length)return{error:t,value:Number.NaN};try{return{value:s.evaluate(this.evalContext)}}catch(r){return{value:Number.NaN}}}get evalContext(){let s={};for(let[t,i]of this.assignments.entries())i.size===1&&(s[t]=Es(i.values()));return s}get serializedEvalContext(){let s={};for(let[t,i]of Object.entries(this.evalContext))s[t]=i.toString();return s}substituteAssignments(s){let[t,i]=br(s);return t?new Ft("=",[new pr(t),i.recursiveSubstitute(this.evalContext)]):s.recursiveSubstitute(this.evalContext)}markUpdated(s){this.updatedNames.add(s);for(let t of this.findDependants(s))this.updatedNames.add(t)}flushChanges(){for(let[t,i]of this.callbackDeps.entries())i.some(r=>this.updatedNames.has(r))&&t();let s=Array.from(this.updatedNames);return this.updatedNames.clear(),s}updateSource(s,t,i,r=!0){this.removeSource(s,!1),this.assignments.has(t)||this.assignments.set(t,new Map),this.assignments.get(t).set(s,i),this.markUpdated(t),r&&this.flushChanges()}attemptUpdateSource(s,t,i=!0){if(typeof t=="string")try{t=Je.parse(t).collapse()}catch(n){return}let[r,o]=br(t);return r?this.updateSource(s,r,o,i):this.removeSource(s),o}removeSource(s,t=!0){for(let[i,r]of this.assignments.entries())r.has(s)&&this.markUpdated(i),r.delete(s),r.size===0&&this.assignments.delete(i);t&&this.flushChanges()}watch(s,t,i=!1){this.callbackDeps.set(t,s),i&&t()}unwatch(s){s&&this.callbackDeps.delete(s)}};var Ve="https://mathigon.org/polypad/assets/audio/",dd={roll:new be(`${Ve}roll.mp3`,.6,!1),spin:new be(`${Ve}spin.mp3`,.5,!1),coinToss:new be(`${Ve}coin-toss.mp3`,.3,!1),shuffle:new be(`${Ve}shuffle.mp3`,.3,!1),rng:new be(`${Ve}rng-roll.mp3`,.3,!1),draw:new be(`${Ve}card-draw.mp3`,.2,!1),click:new be(`${Ve}click.mp3`,.3,!1),woosh:new be(`${Ve}woosh.mp3`,.2,!1),rise:new be(`${Ve}rise.mp3`,.3,!1),fall:new be(`${Ve}fall.mp3`,.3,!1),splitCoins:new be(`${Ve}split-coins.mp3`,.175,!1),mergeCoins:new be(`${Ve}merge-coins.mp3`,.3,!1)};var is=25,tc=is*Math.sqrt(3)/2,c1=Math.sqrt(2*is**2)/2;function wr(e,s,t){let i,r,o;t:for(let n of t)for(let a of s){let l=n.posn||n.path.project(a),c=l.subtract(a),p=c.length;if(p<e&&(e=p,i=l,r=c,o=n,p<1))break t}return r?it(U({},o),{posn:i,shift:r}):void 0}function*ec(e){var s;for(let[t,i]of e){let r=Ht(t.path,i.path);for(let[o,n]of r.entries())yield{posn:n,intersection:`intersections(${t.props.key},${((s=i==null?void 0:i.props)==null?void 0:s.key)||i.path})[${o}]`}}}var Zn=class{constructor(s){this.$parent=s;this.geoIntersections=new Set;this.strokeIntersections=new Set}*getGeoPoints(){for(let s of this.$parent.getTilesOfType("geo"))s.isActive||s.pending||s.props.status==="hidden"||s.path&&Mt(s.path)&&(yield{posn:s.path,tile:s});for(let s of this.geoIntersections)yield s}*getVertices(){for(let s of this.$parent.tiles.values())if(!(s.isActive||s.pending||s.props.name==="geo"))for(let t of s.snapPoints)yield{posn:t,tile:s};for(let s of this.$parent.strokes.values())for(let t of s.snapPoints||[])yield{posn:t};for(let s of this.strokeIntersections)yield s}*getGridPoints(s){if(!this.$parent.options.grid||this.$parent.options.grid==="none")return;let t=this.$parent.options.grid.split("-")[0],i=S.aroundPoints(s),r=new bt(i.p.x-is,i.p.x+i.w+2*is,i.p.y-is,i.p.y+i.h+2*is);if(t.startsWith("square")){let o=(t==="square2"?2:1)*is,n=tt(r.xMin,o);for(let a=tt(r.yMin,o);a<r.yMax;a+=o)for(let l=n;l<r.xMax;l+=o)yield{posn:new d(l,a)}}else if(t.startsWith("tri")){let o=t==="tri2";o&&(r=r.flip);let n=tt(r.xMin,is);for(let a=Math.floor(r.yMin/tc);a*tc<r.yMax;++a)for(let l=n+(a%2?is/2:0);l<r.xMax;l+=is){let c=new d(l,a*tc);yield{posn:o?c.flip:c}}}}*getSnapLines(){for(let s of this.$parent.tiles.values())if(!(s.isActive||s.pending))for(let t of s.snapLines)yield{path:t,tile:s};for(let s of this.$parent.strokes.values())s.snap&&(yield{path:s.path})}snap(s){var t,i,r;if(!this.$parent.options.noSnapping)return(r=(i=(t=wr(12,s,this.getGeoPoints()))!=null?t:wr(8,s,this.getVertices()))!=null?i:wr(c1,s,this.getGridPoints(s)))!=null?r:wr(6,s,this.getSnapLines())}*getGeoEls(s=!0){for(let t of this.$parent.getTilesOfType("geo"))!t.canSelect||!t.transformed||(s&&Mt(t.transformed)&&(yield{posn:t.transformed,tile:t}),!s&&!Mt(t.transformed)&&(yield{path:t.transformed,tile:t}))}snapGeo(s){if(!this.$parent.options.noSnapping)return wr(12,[s],this.getGeoEls(!0))||wr(6,[s],this.getGeoEls(!1))}*geoTiles(){for(let s of this.$parent.getTilesOfType("geo"))s.path&&s.props.status!=="hidden"&&!Mt(s.path)&&(yield s)}*strokes(){for(let s of this.$parent.strokes.values())s.snap&&(yield s)}updateIntersections(){this.geoIntersections.clear(),this.strokeIntersections.clear();let s=Array.from(this.geoTiles()),t=Array.from(this.strokes());for(let i of ec(Ga(s)))this.geoIntersections.add(i);for(let i of ec(Zr(s,t)))this.geoIntersections.add(i);for(let[i,r]of Ga(t))for(let o of Ht(i.path,r.path))this.strokeIntersections.add({posn:o})}addStroke(s){if(s.snap){for(let t of this.strokes())if(t!==s)for(let i of Ht(t.path,s.path))this.strokeIntersections.add({posn:i});for(let t of ec(Zr(this.geoTiles(),[s])))this.geoIntersections.add(t)}}};function sc(e,s){var n,a,l,c,p,u,f;if(s.value!==void 0)return["",s.value,0,s.value,0];if(s.is("algebra")){let v=(s.props.expr.startsWith("-")?-1:1)/s.denominator,m=v<0?s.props.expr.slice(1):s.props.expr,g=(n=e.tileWeights.get("x"))!=null?n:5,b=(a=e.tileWeights.get("y"))!=null?a:4;switch(m){case"1":return["",v,0,v,0];case"x":return["x",v,0,v*g,g];case"x2":return["x",0,v,v*g*g,g];case"y":return["y",v,0,v*b,b];case"y2":return["y",0,v,v*b*b,b];case"xy":return["x",v*b,0,v*b*g,g]}}let t=s.props,i=(u=(p=(c=(l=t.shape)!=null?l:t.index)!=null?c:t.href)!=null?p:t.sides)!=null?u:t.expr,r=btoa(s.props.name+i+s.props.raw.color).replace(/=/g,""),o=(f=e.tileWeights.get(r))!=null?f:1;return[r,1,0,o,o]}function h1(e,s,t){let i={},r=0,o=(f,v=1)=>{let[m,g,b,x,k]=sc(e,f);r+=v*x,m&&(i[m]||(i[m]=[0,0,0]),i[m][0]+=v*g,i[m][1]+=v*b,i[m][2]=k)};for(let f of s)o(f,1);for(let f of t)o(f,-1);if(E(r,0))return;let n=Object.keys(i).filter(f=>i[f][0]||i[f][1]),a=n.find(f=>!e.tileWeights.has(f))||z(n);if(!a)return!0;let[l,c,p]=i[a],u=E(c,0)?p-r/l:Math.max(...Fa(c,l,r-l*p-c*p*p));e.tileWeights.set(a,u),e.options.tileWeights=Array.from(e.tileWeights.entries()).map(f=>f.join("=")).join(",")}function vd(e,s){e.tileWeights.clear();for(let t of s.split(",")){let[i,r]=t.split("=");i&&e.tileWeights.set(i,+r||0)}}var ud="M0,26A18.1,18.1,0,0,0-18,44V72H18V44A18.1,18.1,0,0,0,0,26Z",fd=new Set(["text","number-line","spinner","decimal-grid","axes","custom-spinner","ruler","protractor","compass","geo","dot-machine","abacus","balance","chess-board","multi-jump","set-triangle","bucket","table","number-grid","ten-frame","chart","pie-chart","box-whisker","clock","polyhedron","rectangle","question-blank","logic-switch","logic-gate","logic-speaker","chess-piece"]),uo=15,Yt=40,md=180;function jn(e){let s=e/2;return`M${s},0C${s},16,66.3,20,0,20S${-s},16${-s},0Z`}function gd(e,s){var i;let t=e.posn.shift(0,s);e.$el.setTransform(t,W(e.rot)),e.transformed=(i=e.path)==null?void 0:i.rotate(e.rot).translate(t)}var ai=class extends ${constructor(t,i,r){super(t,i,r);this.cannotRotate=!0;this.left=[];this.right=[];this.isAnimating=!1;this.$beam=h("path",{class:"balance-beam"},this.$el),this.$left=h("path",{class:"balance"},this.$el),this.$right=h("path",{class:"balance"},this.$el),this.$base=h("path",{d:ud,class:"balance"},this.$el),this.$leftRect=h("rect",{class:"balance-target"},this.$el),this.$rightRect=h("rect",{class:"balance-target"},this.$el),this.$handle=this.makeHandle("c",n=>{this.props.size=M(tt(n.x-Yt,20),120,800),this.resize(),this.draw(),this.transform()},void 0,()=>this.showTargets(),()=>this.hideTargets()),this.props.watch("color",({color:n})=>{this.$beam.css("stroke",n);for(let a of[this.$base,this.$left,this.$right])a.css("fill",n)}),this.customTransform(),this.resize(),this.draw();let o=[];this.onMoveStart=()=>{o=Array.from(t.selection.tiles).filter(n=>!fd.has(n.props.name)),this.isActive&&this.showTargets()},this.onMove=()=>{if(this.isActive||!o.length)return;for(let l of o)l.transform();let[n,a]=this.checkTileOverlaps(o);this.$leftRect.toggle(!!n.length),this.$rightRect.toggle(!!a.length)},this.onMoveEnd=()=>{this.hideTargets(),o=[]},this.onChange=n=>{n.action==="change"&&([this.left,this.right]=this.checkTileOverlaps(this.$parent.tiles.values()),this.rebalance(400,n))},t.on("move-start",this.onMoveStart),t.on("move-selection",this.onMove),t.on("move-end",this.onMoveEnd),setTimeout(()=>t.on("change",this.onChange))}delete(){this.$parent.off("move-start",this.onMoveStart),this.$parent.off("move-selection",this.onMove),this.$parent.off("move-end",this.onMoveEnd),this.$parent.off("change",this.onChange),super.delete()}showTargets(){this.$leftRect.show(),this.$rightRect.show()}hideTargets(){this.$leftRect.hide(),this.$rightRect.hide()}targetAreas(){let t=new S(new d(0,-md),this.props.size,md),i=t.shift(-this.props.size-Yt,this.props.level*uo),r=t.shift(Yt,-this.props.level*uo);return[i,r]}checkTileOverlaps(t){let[i,r]=this.targetAreas().map(a=>a.translate(this.posn)),o=[],n=[];for(let a of t)!a.transformed||fd.has(a.props.name)||(or(i,a.transformed)?o.push(a):or(r,a.transformed)&&n.push(a));return[o,n]}resize(){this.$left.setAttr("d",jn(this.props.size)),this.$right.setAttr("d",jn(this.props.size))}draw(t=this.props.level){let i=this.props.size/2+Yt,r=new d(-i,t*15),o=new d(i,-t*15);this.$beam.draw(new ve(r.shift(0,10),r.shift(0,44),o.shift(0,44),o.shift(0,10))),this.$left.setTransform(r),this.$right.setTransform(o),this.$handle.setCenter({x:this.props.size+Yt,y:-t*15});let[n,a]=this.targetAreas();this.$leftRect.setRect(n),this.$rightRect.setRect(a)}rebalance(t=400,i){return H(this,null,function*(){let r=_(this.left.map(c=>sc(this.$parent,c)[3])),o=_(this.right.map(c=>sc(this.$parent,c)[3])),n=E(r,o)?0:r<o?-1:1;if(n===this.props.level||this.isAnimating)return;let a=this.props.level,l=(n-a)*uo;this.props.level=n;for(let c of this.left)c.setTransform(c.posn.shift(0,l));for(let c of this.right)c.setTransform(c.posn.shift(0,-l));if(i!=null&&i.data){let c=i.data.changed=i.data.changed||[],p=new Set([...i.data.added||[],...i.data.deleted||[]]);for(let u of[this,...this.left,...this.right])!c.includes(u)&&!p.has(u)&&c.push(u)}this.isAnimating=!0,yield et(c=>{this.draw(rt(a,n,c));for(let p of this.left)gd(p,(c-1)*l);for(let p of this.right)gd(p,(1-c)*l);this.$parent.selection.update()},t).promise,this.isAnimating=!1,this.transform(),this.$parent.selection.update()})}customTransform(){let t=this.props.level*uo,i=this.props.size+Yt;this.path=new D(new d(-i,t),new d(-Yt,t),new d(-Yt,25),new d(Yt,25),new d(Yt,-t),new d(i,-t),new d(i,-t+48),new d(Yt,-t+48),new d(Yt,72),new d(-Yt,72),new d(-Yt,t+48),new d(-i,t+48))}getSnapPoints(){let t=this.props.level*uo,i=this.props.size+Yt;return[new d(-i,t),new d(-Yt,t),new d(Yt,-t),new d(i,-t)]}getSnapLines(){let[t,i,r,o]=this.getSnapPoints();return[new dt(t,i),new dt(r,o)]}balance(){if(h1(this.$parent,this.left,this.right))return rn("balance-error");let i=new Set;for(let r of this.$parent.getTilesOfType("balance")){r.rebalance();for(let o of[r,...r.left,...r.right])i.add(o)}}static makeThumbnail(t){let i=h("svg",{width:250,height:50,viewBox:"-290 -10 580 82",class:"scale"},t);h("path",{d:"M-160 10v34h320v-34",fill:"transparent",stroke:"#bbb","stroke-width":10},i),h("path",{d:jn(240),transform:"translate(-160 0)",fill:"#bbb"},i),h("path",{d:jn(240),transform:"translate(160 0)",fill:"#bbb"},i),h("path",{d:ud,fill:"#bbb"},i)}static altText(){return""}};ai.type="balance",ai.defaultProps={level:0,size:240,color:"#bbb"},ai=w([T],ai);O([{id:"balance",type:"button",tileTypes:["balance"],label:"",show:e=>e.length===1&&!!e[0].props.level,click:(e,s)=>{e[0].balance(),s.change({changed:e})}}]);function Wn(e){return[...e].sort((s,t)=>s.props.zIndex-t.props.zIndex)}function yd(e,s,t){let i=Na(e,s,t);i>=0&&e.splice(i,1)}function p1(e,s){if(!e.length)return e.push({item:s,val:s.props.zIndex});let t=Ia(e,s.props.zIndex,Ra.firstGreater);e.splice(t<0?e.length:t,0,{item:s,val:s.props.zIndex})}var Kn=class{constructor(){this.sorted={front:[],normal:[],back:[]};this.layers=new WeakMap;this.pendingChanges=new Set}clear(){this.pendingChanges.clear(),this.sorted={front:[],normal:[],back:[]},this.layers=new WeakMap}addOrUpdate(s){let t=this.layers.get(s);t&&yd(this.sorted[t.layer],s,t.z);let i=t&&t.layer!==s.props.layer,r=this.sorted[s.props.layer];(s.props.raw.zIndex===void 0||i)&&(s.props.raw.zIndex=r.length?z(r).val+1:0),this.layers.set(s,{layer:s.props.layer,z:s.props.zIndex}),p1(r,s)}remove(s){let t=this.sorted[s.props.layer];yd(t,s,s.props.zIndex),this.layers.delete(s)}bringToFront(s,t,i){for(let r of Wn(s)){if(r.noAutoLayering&&!t)continue;let o=z(this.sorted[r.props.layer]);o.item!==r&&(r.props.zIndex=o?o.val+1:0,i&&this.pendingChanges.add(r.id))}}bringToBack(s,t){for(let i of Wn(s)){if(i.noAutoLayering&&!t)continue;let r=this.sorted[i.props.layer][0];if(r.item===i)return;i.props.zIndex=r?r.val-1:0}}getTileAbove(s){let t=this.sorted[s.props.layer],i=Na(t,s,s.props.zIndex);for(let r=i+1;r<t.length;++r){let o=t[r].item;if(o!==s&&o.$container===s.$container)return o}}};var bd=`<div class=section-block><label class="form-row color"><span></span><input type=color><span class=swatch></span></label><label class=form-row><span></span><select class=input-field :bind=canvas><option value=infinite></option><option value=fixed></option><option value=notebook></option></select></label><label class=form-row :show="canvas == 'fixed'" data-display=flex><span></span><input class="input-field input-pair size" type=number min=5 max=100 aria-label= placeholder=><input class="input-field input-pair size" type=number min=5 max=100 aria-label= placeholder=></label><label class=form-row :show="canvas == 'notebook'" data-display=flex><span></span><input class="input-field size" type=number min=5 max=100 aria-label= placeholder=></label><label class=form-row><span></span><select class=input-field :bind=uiPreset><option value=simple></option><option value=default></option><option value=advanced></option><option value=custom></option></select></label><p class=small :show="uiPreset === 'simple'"><button class=custom></button></p><p class=small :show="uiPreset === 'default'"><button class=custom></button></p><div class=advanced :show="uiPreset === 'custom'"><h4>Polypad </h4><label class=form-row><x-icon name=shapes size=18></x-icon><span></span><input class="toggle sidebar" type=checkbox><div class=control></div></label><label class=form-row><x-icon name=undo size=18></x-icon><span></span><input class=toggle type=checkbox :bind=!noUndoRedo><div class=control></div></label><label class=form-row><x-icon name=grid size=18></x-icon><span></span><input class="toggle setting" type=checkbox data-key=grid><div class=control></div></label><label class=form-row><x-icon name=hand size=18></x-icon><span></span><input class=toggle type=checkbox :bind=!noPinchPan><div class=control></div></label><h4></h4><label class=form-row><x-icon name=copy size=18></x-icon><span></span><input class=toggle type=checkbox :bind=!noCopyPaste><div class=control></div></label><label class=form-row><x-icon name=delete size=18></x-icon><span></span><input class=toggle type=checkbox :bind=!noDeleting><div class=control></div></label><label class=form-row><x-icon name=geo-angle size=18></x-icon><span></span><input class=toggle type=checkbox :bind=!noRotating><div class=control></div></label><label class=form-row><x-icon name=snap-to-grid size=18></x-icon><span></span><input class=toggle type=checkbox :bind=!noSnapping><div class=control></div></label><label class=form-row><x-icon name=music size=18></x-icon><span></span><input class=toggle type=checkbox :bind=!noMusic><div class=control></div></label><label class=form-row><x-icon name=cards size=18></x-icon><span></span><input class=toggle type=checkbox :bind=mergeTiles><div class=control></div></label><h4></h4><label class=form-row><x-icon name=audio size=18></x-icon><span></span><input class=toggle type=checkbox :bind=!noAudio><div class=control></div></label><label class=form-row><x-icon name=color size=18></x-icon><span></span><input class=toggle type=checkbox :bind=altColors><div class=control></div></label><label class=form-row><x-icon name=brightness size=18></x-icon><span></span><input class=toggle type=checkbox :bind=highContrast><div class=control></div></label></div><div class=s-btn-row :show="uiPreset === 'custom'"><button class=s-btn><x-icon name=construction size=18></x-icon></button></div><div class=s-btn-row><button class=s-btn><x-icon name=eye-off size=18></x-icon>/</button></div></div>`;var d1=["noCopyPaste","noUndoRedo","noPinchPan","noDeleting","noAudio","noMusic","noRotating","noSnapping","altColors"],Xn={mergeTiles:!0};for(let e of d1)Xn[e]=!1;var Jn={advanced:U({sidebar:"",toolbar:"",actionbar:"",settings:""},Xn),default:U({sidebar:"",toolbar:"",actionbar:"--interactivity,labels,layer,handles,altText,group,ungroup",settings:""},Xn),simple:it(U({},Xn),{sidebar:"polygons,polyominoes,tangram,measuring,number-tiles,number-bars,number-frames,number-cards,number-line,fraction-bars,fraction-circles,algebra,balance,random,playing-cards,polyhedral-dice,clocks,currency",toolbar:"move,pen,text,eraser,color",actionbar:"balance,cash-in,copy,cut,delete,divisions,draw,fill,fix-vertices,flip,fold-net,join,labels,make-change,merge,negate,organize,randomise,rename,seconds,send-to-back,send-to-front,shuffle,split,stack,start,step,tabulate,turn-over,unfold,width",settings:"fullscreen,grid",mergeTiles:!0,noPinchPan:!0,noMusic:!0})},Yn=class extends lt{bindPolypad(s){var f;this.bindModel(s.options);let t=this.$('input[type="color"]');t.change(v=>s.options.background=v);let i=this.$(".bg-warn"),r=()=>{let v=s.options.background||"#ffffff";t.value=v,t.next.css("background",v),i==null||i.toggle(R.theme.isDark&&s.flipTheme)};s.options.watch(r),R.onThemeChange(r);let[o,n]=this.$$("select");o.on("change",()=>{let v=s.options.canvas;s.options.canvasX=v==="infinite"?void 0:750,s.options.canvasY=v==="fixed"?750:void 0,s.resetViewport()});for(let[v,m]of this.$$(".size").entries()){let g=v===1?"canvasY":"canvasX";m.onKey("Enter",()=>m.blur()),m.change(b=>{b&&(s.options[g]=(Math.round(+b)||15)*50,s.resetViewport())}),s.options.watch(b=>m.value=`${(b[g]||0)/50}`)}n.on("change",()=>{let v=s.options.uiPreset;s.state.customiseMode=!1,v&&Jn[v]&&s.options.assign(Jn[v])});for(let v of this.$$("input.toggle"))v.on("change",()=>s.selection.update());let a=this.$$(".custom");for(let v of a)v.on("click",()=>s.options.uiPreset="custom");let l=this.$(".sidebar");s.options.watch(v=>l.checked=v.sidebar!=="hidden"),l.on("click",()=>s.options.sidebar=l.checked?"":"hidden");let c=this.$$(".setting");s.options.watch(({settings:v})=>{let m=(v==null?void 0:v.split(","))||[];for(let g of c)g.checked=!v||m.includes(g.data.key)});for(let v of c)v.on("change",()=>{s.options.settings=c.every(m=>m.checked)?void 0:c.filter(m=>m.checked).map(m=>m.data.key).join(",")||"other"});ic||(f=this.$(".handdrawn"))==null||f.parent.remove();let p=this.parents("x-pp-sidebar")[0],u=this.$$(".s-btn");s.state.watch(v=>{for(let m of u)m.setAttr("disabled",v.customiseMode||v.setupMode?"true":void 0)}),u[0].on("click",()=>{p.toggleTab(0),s.trigger("enter-customise-mode"),s.state.customiseMode=!0}),u[1].on("click",()=>s.state.setupMode=!0)}};Yn=w([ct("x-pp-customise",{template:bd})],Yn);var Qn=4,ta=e=>`${e.xMin} ${e.yMin} ${e.dx} ${e.dy}`,wd=e=>!!e.name,ic=R.isChrome&&!R.isMobile,ea=class extends lt{constructor(){super(...arguments);this.tiles=new Map;this.strokes=new Map;this.options=Ze({});this.state=Ze({tool:"move",changeCount:0,penColor:"#242436",audioPlaying:0});this.mathContext=new Un;this.snapping=new Zn(this);this.zIndex=new Kn;this.geoData=new dn;this.tools={move:new Gn(this),pen:new Hn(this),geo:new po(this),geoPending:new Fn(this),eraser:new _n(this),text:new zn(this),pan:new Bn(this),cutPolygon:new qn(this)};this.origin=P;this.zoom=1;this.margins=[40,40,40,40];this.initial={};this.newTileShift=0;this.tileWeights=new Map;this.setup=!1;this.undoStack=[];this.redoStack=[]}ready(){this.$svg=this.$("svg.canvas"),this.$tiles=this.$svg.$$(".tiles"),this.$selection=this.$svg.$(".selection"),this.$strokes=this.$svg.$(".strokes"),this.$grid=this.$svg.$(".grid"),this.$html=this.$(".html-overlay"),this.$mask=this.$(".mask"),this.$geoShadows=this.$svg.$(".geo-shadows"),this.$geoPaths=this.$svg.$(".geo-paths"),this.$geoPoints=this.$svg.$(".geo-points"),this.$pendingPoint=h("circle",{class:"geo-point pending",hidden:!0},this.$geoPoints),this.setAttr("data-tool","move"),this.events=new un(this.$svg,{down:r=>this.tools[this.state.tool].down(r),up:r=>this.tools[this.state.tool].up(r),start:r=>this.tools[this.state.tool].start(r),move:r=>this.tools[this.state.tool].move(r),end:r=>this.tools[this.state.tool].end(r),click:r=>this.tools[this.state.tool].click(r),hover:r=>this.tools[this.state.tool].hover(r),cursor:!1}),this.selection=new Cn(this),this.warningBanner=new tn(this),this.setViewport(P,1),this.options.watch(r=>{this.$grid.setAttr("fill",r.grid&&r.grid!=="none"?`url(#${r.grid})`:"none"),this.$grid.setRect(this.viewportBounds.rect)}),this.$svg.on("contextmenu",r=>{this.focussedTile||r.preventDefault()}),this.enablePinchPan(),this.enableAccessibility(),R.onThemeChange(()=>{this.setBackground(this.options.background);for(let r of this.tiles.values())r.props.updateTheme();for(let r of this.strokes.values())r.setColor(r.color)}),this.options.watch(r=>this.setBackground(r.background)),this.options.watch(r=>this.setClass("high-contrast",!!r.highContrast)),ic&&this.options.watch(r=>this.setClass("handdrawn",!!r.handdrawn));let t=this.$$(".exit-mode");this.state.watch(r=>t[0].toggle(r.customiseMode)),this.state.watch(r=>t[1].toggle(r.setupMode));for(let[r,o]of t.entries())o.on("click",()=>{this.state.customiseMode=this.state.setupMode=!1,r===0&&this.trigger("exit-customise-mode")});let i=this.$(".bg-icon");this.state.watch(r=>{i.setAttr("name",r.customiseMode?"construction":"eye-off"),i.toggle(r.customiseMode||r.setupMode),this.setClass("setup-mode",!!r.setupMode),this.selection.clear()}),this.options.watch(()=>{let{canvas:r,canvasX:o=750,canvasY:n=750}=this.options,a=2e4;this.$mask.toggle(r!=="infinite"),r==="notebook"?this.$mask.setAttr("d",`M-1 -1h${o+2}V${a}H${a}V${-a}H${-a}V${a}H-1z`):r==="fixed"&&this.$mask.setAttr("d",`M-1 -1h${o+2}v${n+2}h${-o-2}zM${-a}${-a}V${a}H${a}V${-a}z`),this.canvasBounds=r==="infinite"?void 0:new bt(0,o,0,r==="notebook"?1e10:n)})}playSound(t){this.options.noAudio||dd[t].play()}setBackground(t="#fff"){let i=G.fromHex(t).hsl[2],r=t;this.flipTheme=i>=70,R.theme.isDark&&this.flipTheme&&(r=i>99?"#22212e":te(t),i=100-i);let o=i<50?"#e2e1e6":"#181824";this.parent.css("--canvas-bg",r),this.parent.css("--canvas-fg",o),this.parent.css("--grid-opacity",.5-Math.abs(i/50-1)/4),this.parent.setClass("dark",i<50),this.$mask.css("fill",G.mix("#000",r,.25).hex),this.$mask.css("stroke",G.mix(o,r,.4).hex)}getTileAt(t,i){for(let r of this.tiles.values())if(!(i&&!i.includes(r.props.name))&&r.contains(t))return r}getInputAt(t,i){for(let r of this.tiles.values()){let o=r.getClosestPort(t,i);if(o)return o}}*getTilesOfType(t){for(let i of this.tiles.values())i.is(t)&&(yield i)}getBounds(t=0){let{canvas:i,canvasX:r,canvasY:o}=this.options;if(i==="infinite")return this.contentBounds.extend(t);let n=i==="notebook"?this.contentBounds.yMax+t:o;return new bt(0,r!=null?r:0,0,n!=null?n:0)}enablePinchPan(){this.on("wheel",r=>{if(!this.options.noPinchPan)if(r.preventDefault(),r.ctrlKey){let o=this.zoom*(1-r.deltaY/100);this.setViewport(this.origin,o,Ue(r,this.$svg))}else{let o=this.origin.shift(r.deltaX/this.zoom,r.deltaY/this.zoom);this.setViewport(o,this.zoom)}});let t=0,i=this.origin;this.on("gesturestart",r=>{this.options.noPinchPan||(r.preventDefault(),i=new d(r.pageX,r.pageY).subtract(this.origin),t=this.zoom,this.events.cancel())}),this.on("gesturechange",r=>{if(this.options.noPinchPan)return;r.preventDefault();let o=t*r.scale,n=new d(r.pageX,r.pageY).subtract(i);this.setViewport(n,o,Ue(r,this.$svg))}),this.on("gestureend",r=>{this.options.noPinchPan||r.preventDefault()})}enableImageDrop(t,i){let r=h("div",{class:"image-drop"},this);this.imageUploadCallback=t,this.on("dragenter dragover dragleave drop",n=>n.preventDefault()),this.on("dragenter dragover",()=>r.show()),this.on("dragleave drop",()=>r.hide());let o=(n,a)=>H(this,null,function*(){let c=Array.from((n==null?void 0:n.files)||[]).slice(0,10).map((u,f)=>this.newImage(u,a.shift(f*25),t)),p=yield Promise.all(c);this.change({added:p}),this.trigger("paste")});this.on("drop",n=>o(n.dataTransfer,Ue(n,this.$svg))),i==null||i.on("change",()=>H(this,null,function*(){yield o(i._el,this.viewportBounds.center),i.value=""}))}bindKeyboardEvents(t=at,i){this.selection.bindKeyboardEvents(t),t.onKey("Backspace Clear Delete",()=>this.selection.delete()),t.onKey("z",r=>{r.preventDefault(),this[r.shiftKey?"redo":"undo"]()},{meta:!0}),t.onKey("y",r=>{r.preventDefault(),this.redo()},{meta:!0}),t.onKey("c",()=>{if(this.options.noCopyPaste)return;let r=this.selection.copy();this.paste(r,new d(25,25))}),t.onKey("a",r=>{var n;if((n=ot("x-modal"))!=null&&n.getOpenModal())return;r.preventDefault();let o=Array.from(this.tiles.values());this.state.setupMode||(o=o.filter(a=>a.canSelect)),this.selection.select(o)},{meta:!0}),at.on("cut copy",r=>{var n;if(i!=null&&i()||!this.selection.tiles.size||this.options.noCopyPaste||R.formIsActive)return;let o=this.selection.copy();(n=window.navigator.clipboard)==null||n.writeText(JSON.stringify(o)),r.type==="cut"&&this.selection.delete()}),at.on("paste",r=>H(this,null,function*(){var a;if(i!=null&&i()||this.options.noCopyPaste||R.formIsActive)return;let o=jh(r.clipboardData);if(o&&this.imageUploadCallback){let l=yield this.newImage(o,this.center.shift(-50),this.imageUploadCallback);return this.trigger("paste"),this.change({added:[l]})}let n=yield(a=window.navigator.clipboard)==null?void 0:a.readText();if(n)try{let l=JSON.parse(n);if(!Object.keys(l).length)return;this.paste(l)}catch(l){let c=$.create(this,{name:"text",html:n});c.setTransform(this.viewportBounds.center.subtract(c.center)),this.selection.add(c,!0),this.change({added:[c]}),this.trigger("paste"),this.selection.select([c])}})),t.onKey("Space",r=>{this.options.noPinchPan||this.state.tool==="pan"||(r.preventDefault(),this.tools.pan.enable())}),t.onKey("Space",r=>{this.options.noPinchPan||this.state.tool!=="pan"||(r.preventDefault(),this.tools.pan.disable())},{up:!0})}enableAccessibility(){let t,i=!1,r=o=>{this.focussedTile||(t=o,this.$svg.setAttr("aria-description",o?o.altText:"Empty Canvas"),o&&this.selection.add(o,!0))};this.$svg.on("focusin",()=>{if(!i)return;let o=Array.from(this.tiles.values());r(this.events.shiftKey?z(o):o[0])}),this.$svg.on("focusout",()=>t=void 0),at.on("keydown",o=>{if(i=!0,o.keyCode!==9||!t)return;let n=Array.from(this.tiles.values()).filter(a=>!a.group);r(n[n.indexOf(t)+(o.shiftKey?-1:1)]),t&&o.preventDefault()}),at.on("pointerdown",()=>i=!1),this.$svg.on("pointerdown",()=>{i=!1,this.focussedTile||this.$svg.focus()})}newImage(t,i,r){return H(this,null,function*(){let o=new FileReader;o.readAsDataURL(t),yield new Promise(a=>o.onloadend=a);let n=$.create(this,{name:"image",href:(o.result||"").toString(),x:i.x,y:i.y});return this.selection.add(n,!0),yield r==null?void 0:r(t,n),n})}setViewport(t,i=1,r){var b;if(i=M(i,1/Qn,Qn),r){let x=this.zoom/i;t=r.subtract(r.subtract(this.origin).scale(x))}let o=this.width/i,n=this.height/i,{canvas:a,canvasX:l=0,canvasY:c=0,grid:p}=this.options,[u,f,v,m]=this.margins;if(a==="infinite")this.origin=t.clamp(this.contentBounds.extend(n,0,0,o),50/i);else{let x=a==="notebook"?this.contentBounds.yMax+n-u/i:c,k=new bt(-m/i,l-o+f/i,-u/i,x-n+v/i,"center");this.origin=t.clamp(k)}this.zoom=i,this.viewportBounds=new bt(this.origin.x,this.origin.x+o,this.origin.y,this.origin.y+n),this.$svg.setAttr("viewBox",this.attr("viewBox")||ta(this.viewportBounds)),this.$html.setTransform(this.origin.inverse.scale(this.zoom),0,this.zoom);let g=this.viewportBounds.rect;p!=="none"&&this.$grid.setRect(g),this.geoData.redrawLines(((b=this.canvasBounds)==null?void 0:b.rect)||g),this.newTileShift=0,this.trigger("viewport")}resetViewport(){let t=this.options.canvas;if(t==="infinite"&&!this.tiles.size&&!this.strokes.size)return this.setViewport(P,1);let i=this.getBounds(),{width:r,height:o,margins:n}=this,[a,l,c,p]=n,u=(r-p-l)/i.dx,f=t==="notebook"?1:(o-a-c)/i.dy,v=M(Math.min(u,f),1/Qn,t==="infinite"?1:Qn);if(t==="notebook")return this.setViewport(new d(0,-a),v);let m=new d(r+p-l,o+a-c),g=i.center.subtract(m.scale(1/2/v));this.setViewport(g,v)}setZoom(t){let i=this.viewportBounds.center;this.setViewport(this.origin,this.zoom*t,i)}bindSource(t,i){let r=t.attr("tile");$.thumbnail(this,r,t);let o,n=i==null?void 0:i.$(".tiles");this.events.listen(t,{down:()=>this.trigger("add-tile-start"),start:({posn:a})=>{o=$.create(this,Object.assign({name:r},Pt(t.attr("props"),{}))),o.setTransform(a.subtract(o.center)),this.selection.add(o,!0),this.selection.moveStart(!0),i&&i.setAttr("viewBox",ta(this.viewportBounds)),(n||o.$container).append(o.$el),this.trigger("add-tile",{tile:o})},move:a=>this.selection.move(a,!0),end:a=>{o.$container.append(o.$el),this.selection.moveEnd(a,!0)},click:()=>{o=$.create(this,Object.assign({name:r},Pt(t.attr("props"),{}))),o.setTransform(this.center.subtract(o.center).shift(this.newTileShift*25)),this.selection.add(o,!0),o.moveEnd(),this.trigger("add-tile",{tile:o}),this.change({added:[o]}),this.newTileShift+=1}})}get center(){let[t,i,r,o]=this.margins;return this.viewportBounds.center.shift((o-i)/this.zoom/2,(t-r)/this.zoom/2)}setActiveTool(t,i){this.tools[this.state.tool].cancel(),this.warningBanner.hide(),this.selection.clear(),this.state.assign({tool:t,toolOptions:i}),i&&(this.tools[this.state.tool].options=i),this.setAttr("data-tool",t)}clear(t=!0){this.selection.clear();let i=[...Array.from(this.tiles.values()),...Array.from(this.strokes.values())];for(let r of i)r.delete();t&&this.setViewport(P,1),i.length&&this.change({deleted:i})}thumbnail(t,i,r="jpg"){return H(this,null,function*(){let o=this.canEditQuestions?Array.from(this.getTilesOfType("question-blank")):[];for(let a of o)a.hideForThumbnail();let n=yield this.$svg.image(r,t,i,ta(this.getBounds(50)));for(let a of o)a.hideForThumbnail(!0);return n})}downloadImage(t="png",i){var n;this.selection.clear();let r=i||((n=this.state.title)==null?void 0:n.replace(/\s+/g,"-").replace(/[^\w-]/g,"").toLowerCase())||"polypad",o=this.getBounds(50);this.$svg.downloadImage(`${r}.${t}`,o.dx,o.dy,ta(o))}paste(t,i){this.selection.clear();let r=new Map;for(let l of Object.keys(t))r.set(l,He(10));let o=new Map,n=Object.entries(t).sort((l,c)=>(l[1].zIndex||0)-(c[1].zIndex||0)).map(([l,c])=>{var p,u;return c.name==="geo"&&Object.assign(c,ae.copy(o,c,this.geoData)),c.name==="group"&&(c.children=(p=c.children)==null?void 0:p.split(",").map(f=>r.get(f)).join(",")),c.status=void 0,c.zIndex=void 0,c.cables=(u=c.cables)==null?void 0:u.map(f=>it(U({},f),{toTileId:r.get(f.toTileId)})),$.create(this,c,r.get(l))}).filter(Boolean);for(let l of n)l.delayedSetup();let a=ut(...n.map(l=>l.transformed)).center;i===void 0&&(i=this.center.subtract(a).shift(this.newTileShift*25));for(let l of n)l.is("geo")?l.shift(i):l.setTransform(l.posn.add(i));this.newTileShift+=1,this.change({added:n}),this.trigger("paste"),this.selection.select(n)}check(t){let i=!1;return new Promise(r=>{this.on("change",()=>{!i&&t(Array.from(this.tiles.values()))&&(i=!0,r())})})}change(t){if(this.setup||this.options.noUndoRedo)return;this.trigger("change",{action:"change",data:t});let i=new Map;for(let r of t.added||[])i.set(r.id,[void 0,r.serialize()]);for(let r of t.changed||[]){let o=gl(r.lastSavedData,r.serialize());o&&i.set(r.id,o)}for(let r of t.deleted||[])i.set(r.id,[r.lastSavedData,void 0]);if(i.size){for(let r of this.zIndex.pendingChanges){if(r in i)continue;let o=this.tiles.get(r),n=o?gl(o.lastSavedData,o.serialize()):void 0;n&&i.set(r,n)}this.contentBounds=sn(this.tiles,this.strokes),this.undoStack.push(i),this.zIndex.pendingChanges.clear(),this.trigger("change-api",z(this.undoStack)),this.undoStack.length>50&&this.undoStack.shift(),this.redoStack=[],this.state.canUndo=!0,this.state.canRedo=!1,this.state.changeCount+=1}}undo(){{let t=new Event("undo",{cancelable:!0});if(this.trigger("undo",t),this.state.canRedo=!0,t.defaultPrevented||!this.undoStack.length)return}this.applyChange(z(this.undoStack),!0),this.redoStack.push(this.undoStack.pop()),this.state.canUndo=!!this.undoStack.length,this.state.canRedo=!0,this.state.changeCount-=1,this.selection.update(),this.trigger("change",{action:"undo"})}redo(){{let t=new Event("redo",{cancelable:!0});if(this.trigger("redo",t),this.state.canUndo=!0,t.defaultPrevented||!this.redoStack.length)return}this.applyChange(z(this.redoStack)),this.undoStack.push(this.redoStack.pop()),this.state.canUndo=!0,this.state.canRedo=!!this.redoStack.length,this.state.changeCount+=1,this.selection.update(),this.trigger("change",{action:"redo"})}applyChange(t,i=!1){var r,o,n;for(let[a,[l,c]]of t.entries()){if(i&&([l,c]=[c,l]),l)c?(o=this.tiles.get(a))==null||o.applyChange(c):(r=(wd(l)?this.tiles:this.strokes).get(a))==null||r.delete();else if(wd(c)){let p=$.create(this,c,a);p.lastSavedData=c}else we.create(this,c,a);this.contentBounds=sn(this.tiles,this.strokes)}for(let a of t.keys())(n=this.tiles.get(a))==null||n.delayedSetup()}serialize(t=5e3,i=2e3,r=16e3){var o;return{title:(o=this.state.title)==null?void 0:o.slice(0,30),version:2,tiles:fl(this.tiles.values(),n=>n.props.copy(),t),strokes:fl(this.strokes.values(),n=>n.serialize(r),i),options:this.options.copy()}}load(t){this.setup=!0,this.clear(!1),this.geoData.reset(),this.zIndex.clear(),this.initial=t,this.state.assign({title:t.title,canUndo:!1,canRedo:!1,changeCount:0,audioPlaying:0}),this.undoStack=this.redoStack=[];let i=this.attr("user-type")==="teacher";this.canEditQuestions=i,t.options||(t.options=Object.assign({uiPreset:"advanced"},Jn.advanced)),t.options.grid||(t.options.grid="none"),t.options.canvas||(t.options.canvas="infinite"),t.options.algebraXSize||(t.options.algebraXSize=Np),t.options.algebraYSize||(t.options.algebraYSize=Gp),t.options.uiPreset||(t.options.uiPreset="custom"),this.options.assign(t.options,!0),this.options.forceUpdate(),vd(this,t.options.tileWeights||"");for(let[o,n]of Object.entries(t.tiles||{}))$.create(this,n,o);for(let[o,n]of Object.entries(t.strokes||{}))we.create(this,n,o);for(let o of this.tiles.values())o.delayedSetup();this.snapping.updateIntersections(),this.contentBounds=sn(this.tiles,this.strokes),this.resetViewport(),this.setActiveTool("move"),this.setup=!1}};ea=w([ct("x-polypad",{template:pd})],ea);var u1='<div class="tabs-header"></div><div class="tabs-body"><slot></slot></div>',xd=680;var $d=300,f1=48,sa=class extends lt{constructor(){super(...arguments);this.visible=[]}ready(){this.$body=this.$(".tabs-body"),this.$body.css("width",$d+"px"),this.$panels=this.$body.children,this.visible=this.$panels.map(()=>!0);let t=this.$(".tabs-header");this.$buttons=this.$panels.map((o,n)=>{let a=h("button",{},t);return h("x-icon",{name:o.attr("icon")},a),h("span",{text:o.attr("tab")},a),a.on("click",()=>this.toggleTab(n)),a});let i=this.$buttons.length-1,r=0;this.parent.width<xd&&(r=-1),this.active=r>=0?r:void 0,r>=0?(this.setPanelClasses(r),this.$panels[r].show()):this.addClass("animating")}bindPolypad(t){let i=()=>{t.width<xd&&this.close()};t.on("add-tile",i),this.on("clickOutside",i),t.margins[3]=(this.isOpen?308:0)+t.margins[1];let r;this.on("toggle",()=>{if(t.options.canvas==="infinite")return t.margins[3]=(this.isOpen?308:0)+t.margins[1];r==null||r.cancel(),r=et(o=>{let n=wt("sine-out",o);t.margins[3]=t.margins[1]+rt(0,308,this.isOpen?n:1-n),t.setViewport(t.origin,t.zoom)},400)}),t.resetViewport(),this.show()}setPanelClasses(t){for(let[r,o]of this.$panels.entries())o.setClass("left",r<t),o.setClass("right",r>t);this.addClass("open");let i=(this.$panels[t].attr("width")||$d)+"px";this.css("width",i),this.$body.css("width",i),this.$buttons[t].addClass("active")}showTab(t,i){this.visible[t]!==i&&(this.visible[t]=i,this.active===t&&this.close(),this.$buttons[t].toggleDOM(i),this.$panels[t].toggleDOM(i),this.toggle(this.visible.some(Boolean)))}show(){this.visible.some(Boolean)&&super.show()}toggleTab(t){if(!this.visible[t])return;if(this.active===t)return this.close();clearTimeout(this.timeout);let i=this.active;this.active=t,i===void 0?(this.setPanelClasses(t),this.$panels[t].show(),this.trigger("toggle",{open:!0})):(this.addClass("animating"),this.$panels[t].show(),R.redraw(),this.setPanelClasses(t),this.$buttons[i].removeClass("active")),this.timeout=window.setTimeout(()=>{for(let[r,o]of this.$panels.entries())o.toggle(r===t);this.removeClass("animating")},400)}close(){this.active!==void 0&&(clearTimeout(this.timeout),this.addClass("animating"),this.$buttons[this.active].removeClass("active"),this.removeClass("open"),this.css("width",this.visible.filter(Boolean).length*(f1+1)-1+"px"),this.active=void 0,this.trigger("toggle",{open:!1}),this.timeout=window.setTimeout(()=>{for(let t of this.$panels)t.hide()},400))}get isOpen(){return this.active!==void 0}};sa=w([ct("x-pp-sidebar",{template:u1})],sa);var rc=class{constructor(s,t){this.$heading=s;this.parent=t;this.visible=!0;var i;this.$body=s.next,this.$body.css("overflow","hidden"),this.$body.hide(),s.setAttr("tabindex","0"),this.key=s.data.key||s.text.toLowerCase().replace(/[\s,]+/,"-"),this.$button=s.$("a, button"),this.$button&&s.insertAfter(this.$button),(i=this.$button)==null||i.hide(),t.checkboxes&&(this.$check=h("input",{type:"checkbox",class:"check"}),s.insertAfter(this.$check),this.$check.on("change",()=>{if(!this.$check.checked)return this.close()})),s.on("click",()=>{var r;t.active===this?this.close():((r=t.active)==null||r.close(),this.open(),t.checkboxes&&(this.$check.checked=!0)),s.blur()})}init(){var s;this.$body.show(),(s=this.$button)==null||s.show(),this.$heading.addClass("active"),this.parent.active=this}setOpen(){var s;this.$body.show(),(s=this.$button)==null||s.show(),this.$heading.addClass("active"),this.parent.active=this,this.parent.trigger("open",{$el:this.$body})}open(){var s;this.$body.enter("reveal",300),(s=this.$button)==null||s.enter("fade",300),this.$heading.addClass("active"),this.parent.active=this,this.parent.trigger("open",{$el:this.$body}),this.parent.trigger("toggle",{key:this.key,isOpen:!0})}close(){var s;this.$heading.removeClass("active"),this.$body.exit("reveal",300),(s=this.$button)==null||s.exit("fade",300),this.parent.active=void 0,this.parent.trigger("toggle",{key:this.key,isOpen:!1})}toggleDOM(s=!1){var t,i;this.visible=s,s||this.$body.hide(),this.$heading.toggleDOM(s),this.$body.toggleDOM(s),(t=this.$button)==null||t.toggleDOM(s),(i=this.$check)==null||i.toggleDOM(s)}},ia=class extends lt{ready(){this.checkboxes=this.hasAttr("checkboxes"),this.items=this.children.filter(t=>["H2","H3","H4"].includes(t.tagName)).map(t=>new rc(t,this)),this.hasAttr("closed")||this.items[0].init()}get childCount(){return this.items.filter(t=>t.visible).length}openFirst(){var t;(t=this.items.find(i=>i.visible))==null||t.setOpen()}};ia=w([ct("x-accordion")],ia);var m1="polypad.sidebarTiles",ra=class extends lt{bindPolypad(s,t){var v;let r=Ze({labels:"fraction",round:m=>Math.round(m)});for(let m of this.$$(".primes, .model"))m.bindModel(r);for(let m of this.$$("x-drag"))m.bindVariable(s.options,m.attr("name")),m.on("start",()=>zp(s,m));let o=new Set,n=this.$("x-accordion"),a=n.$$("x-accordion"),l=_(a.map(m=>m.items.length));function c(m){R.setHash(m),R.setStorage(m1,m)}let p=m=>{for(let[g,b]of n.items.entries()){if(!b.visible)continue;let x=a[g].items.find(k=>k.key===m);if(!(!x&&b.key!==m)&&(b.setOpen(),!!(x!=null&&x.visible)))return x.setOpen(),!0}};for(let[m,g]of a.entries()){let b=(v=n.items[m])==null?void 0:v.key;g.on("open",x=>{if(!o.has(x.$el)){o.add(x.$el);for(let k of x.$el.$$(".source"))k.setAttr("tabindex",0),s.bindSource(k,t)}})}let u=this.parents("x-pp-sidebar")[0],f=(m,g)=>{var L;let b=m==="hidden"&&!g;if(u.showTab(0,!b),b)return;this.setClass("customising",!!g);let x=new Set((m||"").split(","));for(let[A,Z]of n.items.entries()){let Q=!1;a[A].active=void 0;for(let V of a[A].items){let N=(!m||x.has(V.$heading.data.key))&&!V.$heading.hasAttr("hidden");V.toggleDOM(g||N),V.$check.toggle(g),g&&(V.$check.checked=N),N&&(Q=!0)}Z.toggleDOM(g||Q),Z.$check.toggle(g),g&&(Z.$check.checked=Q)}this.setClass("single",!!m&&m!=="hidden"&&x.size===1&&!g),n.openFirst();let k=(L=n.active)==null?void 0:L.$body;(k==null?void 0:k.childCount)===1&&k.openFirst()};s.on("exit-customise-mode",()=>{let m=[];for(let[g,b]of n.items.entries())if(b.$check.checked)for(let x of a[g].items)x.$check.checked&&m.push(x.$heading.data.key);s.options.sidebar=m.length===l?void 0:m.length?m.join(","):"hidden"}),s.state.watch(m=>f(s.options.sidebar,m.customiseMode)),s.options.watch(m=>f(m.sidebar,s.state.customiseMode))}};ra=w([ct("x-pp-tiles")],ra);var Pd="<x-select><button class=switch data-value=palette title=><x-icon name=tiles size=32></x-icon></button><button class=switch data-value=sliders title=RGB><x-icon name=controls size=32></x-icon></button></x-select><div class=color-content><div class=palette></div><div class=sliders><div class=slider-row><label></label><div class=slider><div class=handle></div></div><input class=input-field type=number name=></div><div class=slider-row><label></label><div class=slider><div class=handle></div></div><input class=input-field type=number name=></div><div class=slider-row><label></label><div class=slider><div class=handle></div></div><input class=input-field type=number name=></div><div class=slider-row><label></label><div class=slider><div class=handle></div></div><input class=input-field type=number name=></div></div></div>";var nc=["#fd8c00","#eb4726","#cd0e66","#6d3bbf","#0f82f2","#009ea6","#22ab24","#bfc212"],li=[];for(let e of nc)li.push(G.mix(e,"#fff",.5));li.push(G.fromHex("#eee"));for(let e of nc)li.push(G.fromHex(e));li.push(G.fromHex("#777"));for(let e of nc)li.push(G.mix(e,"#000",.7));li.push(G.fromHex("#111"));function oc(e,s,t,i,r,o){return`linear-gradient(90deg, rgb(${e},${s},${t}), rgb(${i},${r},${o}))`}function g1(e,s,t){s==="r"&&(e.r=t),s==="g"&&(e.g=t),s==="b"&&(e.b=t),s==="a"&&(e.a=t/255)}function v1(e,s){return s==="r"?e.r:s==="g"?e.g:s==="b"?e.b:e.a*255}var oa=class extends lt{constructor(){super(...arguments);this.sliders=[];this.swatches=[]}ready(){this.$("x-select").on("change",r=>{this.setClass("custom",r.data.value!=="palette")});let i=this.$(".palette");this.swatches=li.map(r=>{let o=h("button",{style:`background: ${r.hex}`},i);return o.on("click",()=>{this.setColor(r),this.trigger("click-swatch"),this.commit()}),{$el:o,color:r}}),this.$inputs=this.$$("input");for(let r of this.$inputs)r.change(()=>this.setColor(this.inputColor)),r.on("change",o=>o.stopPropagation()),r.on("blur",()=>this.commit()),r.onKey("Enter",()=>r.blur());this.sliders=this.$$(".slider").map((r,o)=>{let n=["r","g","b","a"][o],a=r.$(".handle"),l=new qo(a,{moveY:!1,bounds:new bt(0,180,0,0)});return l.on("start",()=>{for(let c of this.$inputs)c.blur();a.addClass("active")}),l.on("drag",({posn:c})=>{let p=this.color.copy();g1(p,n,c.x*255/180),this.setColor(p,!0)}),l.on("end",()=>{a.removeClass("active"),this.commit()}),{$el:r,c:n,drag:l}}),this.setColor(new G(0,0,0))}commit(){this.lastCommittedColor!==this.color&&(this.trigger("commit-color"),this.lastCommittedColor=this.color)}get inputColor(){let[t,i,r]=this.$inputs.map(n=>M(+n.value||0,0,255)),o=M(+this.$inputs[3].value,0,100)/100;return new G(t,i,r,o)}setColor(t,i=!1,r=!1){if(typeof t=="string"&&(t=G.fromHex(t)),!(this.color&&this.color.hex===t.hex)){if(this.color=t,r&&(this.lastCommittedColor=t),this.$activeSwatch&&(this.$activeSwatch.removeClass("active"),this.$activeSwatch=void 0),!i){for(let o of this.swatches)if(o.color.hex===t.hex){o.$el.addClass("active"),this.$activeSwatch=o.$el;break}for(let o of this.sliders)o.drag.setPosition(v1(t,o.c)/255*180,0)}this.$inputs[0].value=""+Math.round(t.r),this.$inputs[1].value=""+Math.round(t.g),this.$inputs[2].value=""+Math.round(t.b),this.$inputs[3].value=""+Math.round(t.a*100),this.sliders[0].$el.css("background",oc(0,t.g,t.b,255,t.g,t.b)),this.sliders[1].$el.css("background",oc(t.r,0,t.b,t.r,255,t.b)),this.sliders[2].$el.css("background",oc(t.r,t.g,0,t.r,t.g,255)),this.sliders[3].$el.css("background",`linear-gradient(90deg, black, rgb(${t.r},${t.g},${t.b}))`),r||this.trigger("change",t)}}};oa=w([ct("x-color-picker",{template:Pd})],oa);var y1=new Set(["pen","text","geo"]),na=class extends lt{constructor(){super(...arguments);this.$imageUpload=this.$("#image-upload")}bindPolypad(t){this.$polypad=t;let i=this.$$("[data-key]").map(m=>({$el:m,key:m.data.key,$check:m.prev.$("input")})),r=(m,g)=>{let b=m==="hidden"&&!g;if(this.toggle(!b),b)return;this.setClass("customising",!!g);let x=new Set((m||"").split(","));for(let k of i)k.$el.css("display",g||!m||x.has(k.key)?"block":"none"),g&&(k.$check.checked=!m||x.has(k.key)),k.$check.toggle(g)};t.on("exit-customise-mode",()=>{let m=i.filter(g=>g.$check.checked);t.options.toolbar=m.length===i.length?"":m.length?m.map(g=>g.key).join(","):"hidden"}),t.state.watch(m=>r(t.options.toolbar,m.customiseMode)),t.options.watch(m=>r(m.toolbar,t.state.customiseMode));let o=this.$$("[data-tool]"),n="line",a="pen";t.state.watch(({tool:m,toolOptions:g})=>{let b=`${m}:${g}`;for(let x of o)x.setClass("active",x.data.tool===m||x.data.tool===b);y1.has(m)&&f(te(t.state.penColor,t.flipTheme))});for(let m of o){if(m.tagName==="DIV")continue;let[g,b]=m.data.tool.split(":");m.on("click",()=>{b&&g==="geo"&&(n=b),b&&g==="pen"&&(a=b);let x=g==="geo"?n:g==="pen"?a:b;t.setActiveTool(g,x)})}t.on("add-tile-start paste",()=>t.setActiveTool("move"));let l=this.$("x-popup.color-picker"),c=this.$("x-color-picker"),p=this.$(".color-picker .popup-target"),u=this.$$(".brushes .fill");l.on("pointerdown",m=>{var g;m.target.tagName==="INPUT"&&((g=t.focussedTile)==null?void 0:g.props.name)!=="text"||(m.preventDefault(),m.stopPropagation())});let f=(m,g)=>{p==null||p.setClass("rainbow",!m),p==null||p.css("background-color",m!=null?m:""),g||c==null||c.setColor(m!=null?m:"#aaa",!1,!0);for(let b of u)b.setAttr("fill",m);t.$pendingPoint.css("color",m)};c==null||c.on("change",m=>{let g=te(m.hex,t.flipTheme);if(t.state.penColor=g,t.focussedTile)return t.focussedTile.format("color",g);for(let b of t.selection.tiles)b.props.color=g;f(m.hex,!0)}),c==null||c.on("click-swatch",()=>l==null?void 0:l.close()),c==null||c.on("commit-color",()=>{let m=t.selection.flatTiles;m.length&&t.change({changed:m})}),t.on("change-selection",({tiles:m,color:g})=>{f(m.length?te(g,t.flipTheme):void 0,!1)});let v=()=>{["move","eraser"].includes(t.state.tool)||f(te(t.state.penColor,t.flipTheme))};t.options.watch(v),R.onThemeChange(v)}};na=w([ct("x-polypad-toolbar")],na);function fo(e){let s=e[0];for(let t of e)if(t!==s)return;return s}var Gs=class{constructor(s,t){this.data=s;this.$bar=t;s.tileTypes[0]==="all"&&this.build()}show(s){var t;return this.$bar.valid&&!this.$bar.valid.has(this.data.id)||this.data.tileTypes[0]!=="all"&&Xt(s,i=>!this.data.tileTypes.includes(i))||this.$bar.focussed&&!((t=this.data.focus)!=null&&t.startsWith("show"))?!1:this.$bar.focussed||this.data.focus!=="show"}load(s,t){var r;let i=t.some(o=>o.hideActionBar)?!1:this.show(s);i&&!this.$el&&this.build(),this.visible=i&&(!this.data.show||this.data.show(t,this.$bar.focussed))&&(!t.some(o=>o.props.status==="generator")||this.data.showForGenerators),(r=this.$el)==null||r.toggle(this.visible),this.$check&&this.$bar.$parent.state.customiseMode&&this.$check.toggle(this.visible),this.visible&&this.init(t,s)}build(){this.$el=this.setup(this.data),(this.data.location?this.$bar.$dropdowns[this.data.location==="music"?0:1]:this.$bar.$actions).prepend(this.$el)}get selection(){return this.data.flattenGroups?this.$bar.flatSelection:this.$bar.selection}init(s,t){}change(s){this.$bar.$parent.change({changed:this.selection}),this.$bar.$parent.selection.update()}},aa=class extends Gs{setup(t){let i=h("button",{text:t.icon?"":t.label,class:"action"});return t.icon&&(h("x-icon",{name:t.icon,size:t.location?20:24},i),h("div",{text:t.label,class:"tooltip"},i)),i.on("click",()=>this.change()),i.on("pointerdown",r=>{this.$bar.focussed&&(r.preventDefault(),r.stopPropagation())}),i}init(t,i){this.data.labelFn&&(this.$el.text=this.data.labelFn(t,i))}change(){var t,i;this.$el.blur(),this.data.click(this.selection,this.$bar.$parent,this.$bar.focussed),this.$bar.focussed||this.$bar.$parent.selection.update(),(t=window.ga)==null||t.call(window,"send","event","Polypad",`action:${this.data.id}`),(i=window.gtag)==null||i.call(window,"event","polypad-action",{key:this.data.id})}},la=class extends Gs{setup(t){let i=h("label",{class:"action","data-display":"flex"});return t.icon&&h("x-icon",{name:t.icon,size:t.location?20:24},i),h("span",{text:t.label},i),this.$checkbox=h("input",{type:"checkbox",class:"toggle"},i),h("div",{class:"control"},i),this.$checkbox.on("change",()=>this.change(this.$checkbox.checked)),i}init(t){let i=fo(t.map(r=>this.data.get(r)));this.$checkbox._el.indeterminate=i===void 0,this.$checkbox.checked=i||!1}change(t){for(let i of this.selection)this.data.set(t,i);super.change()}};function Sd(e,s,t="input-field"){let i=e.data.value||"text",r=h("input",{type:i,class:t,style:e.data.style},s);return r.change(o=>{i==="number"&&(!o||o==="-")||e.pendingChange(o)}),r.on("focus",()=>e.focussed=!0),r.on("blur",()=>{e.focussed=!1,e.change()}),r.onKey("Enter",()=>r.blur()),r}function Td(e,s=!0){let t=Math.pow(10,Math.floor(Math.log10(e))),i=[.5*t,t,2*t,5*t,10*t],r=i.find((o,n)=>s?o>e:i[n+1]>=e);return""+M(r,1e-4,1e12)}var ca=class extends Gs{constructor(){super(...arguments);this.focussed=!1}setup(t){let i=h(t.increment?"div":"label",{class:"action","data-display":"flex"});if(t.large&&i.addClass("wide-input"),t.icon&&h("x-icon",{name:t.icon,size:t.location?20:24},i),t.label&&h("span",{text:t.label},i),this.$input=Sd(this,i),t.increment){let r=h("button",{text:"",class:"increment"}),o=h("button",{text:"+",class:"increment"});r.on("click",()=>this.pendingChange(Td(+this.$input.value||1,!1))),o.on("click",()=>this.pendingChange(Td(+this.$input.value||1))),this.$input.insertBefore(r),this.$input.insertAfter(o)}return t.range&&(this.$input.setAttr("min",t.range[0]),this.$input.setAttr("max",t.range[1])),i}init(t){if(this.focussed)return;let i=fo(t.map(r=>this.data.get(r)));this.$input.value=(i!=null?i:"").toString()}pendingChange(t){var i,r;if(!((i=this.data.range)!=null&&i[0]&&+t<this.data.range[0])&&!((r=this.data.range)!=null&&r[1]&&+t>this.data.range[1]))for(let o of this.selection)this.data.set(t,o)}},ha=class extends Gs{constructor(){super(...arguments);this.focussed=!1}setup(t){let i=h("label",{class:"action","data-display":"flex"});return t.value||(t.value="number"),h("span",{text:t.label},i),this.$inputs=I(()=>Sd(this,i,"input-field input-range"),2),i}init(t){if(!this.focussed)for(let i of[0,1]){let r=fo(t.map(o=>this.data.get(o)[i]));this.$inputs[i].value=(r==null?void 0:r.toString())||""}}pendingChange(){let t=this.$inputs.map(i=>+i.value);for(let i of this.selection)this.data.set(t,i)}},pa=class extends Gs{constructor(){super(...arguments);this.active=-1}setup(t){let i=h(t.radio?"div":"label",{class:"action","data-display":"flex"});if(t.radio)i.addClass("select"),this.$buttons=t.options.map(r=>{let o=h("button",{text:r.icon?"":r.label},i);return r.icon&&h("x-icon",{name:r.icon},o),r.icon&&r.label&&h("div",{text:r.label,class:"tooltip"},o),o.on("click",()=>{this.change(r.key),o.blur()}),o}),t.options.length>10?this.setupPagination(i):t.location&&t.options.length>6&&i.addClass("wrap");else{t.icon&&h("x-icon",{name:t.icon,size:t.location?20:24},i),t.label&&h("span",{text:t.label},i),this.$select=h("select",{class:"input-field"},i);for(let r of t.options)h("option",{text:r.label,value:r.key},this.$select);this.$select.on("change",()=>this.change(this.$select.value))}return i}setupPagination(t){t.addClass("paginated");let i=h("button",{class:"arrow",html:'<svg width="16" height="50"><path d="M14 2L2 25L14 48"/></svg>'},t),r=h("div",{class:"select"},t),o=h("button",{class:"arrow",html:'<svg width="16" height="50"><path d="M2 2L14 25L2 48"/></svg>'},t);for(let l of this.$buttons)r.append(l);let n=Math.ceil(this.data.options.length/10),a=-1;this.goToPage=l=>{if(!(l===a||l<0||l>=n)){i.setAttr("disabled",l===0?"true":void 0),o.setAttr("disabled",l===n-1?"true":void 0);for(let[c,p]of this.$buttons.entries())p.toggle(Math.floor(c/10)===l);a=l}},i.on("click",()=>this.goToPage(a-1)),o.on("click",()=>this.goToPage(a+1)),this.goToPage(0)}init(t){var r;let i=fo(t.map(o=>this.data.get(o)));this.data.radio?(this.active>=0&&this.$buttons[this.active].removeClass("active"),this.active=this.data.options.findIndex(o=>o.key===i),this.active>=0&&this.$buttons[this.active].addClass("active"),(r=this.goToPage)==null||r.call(this,Math.floor(this.active/10))):this.$select.value=i||""}change(t){let i=this.$bar.selection;for(let r of this.selection)this.data.set(t,r);this.$bar.selection=i,super.change()}},da=class extends Gs{setup(t){let i=h("div",{class:"action","data-display":"flex"});return t.location&&h("span",{text:t.label},i),this.$drag=h("x-drag",{},i),this.$drag.on("start",()=>{for(let r of this.selection)t.start(r)}),this.$drag.on("move",({posn:r})=>{for(let o of this.selection)t.move(o,r.x/80)}),this.$drag.on("end",()=>{for(let r of this.selection)t.end(r);super.change()}),i}init(t){setTimeout(()=>{let i=fo(t.map(r=>this.data.get(r)));i!==void 0&&(this.$drag.value=i)},0)}};var ua=200,fa=75,rs=20,b1='<tspan style="font-style:italic"></tspan> &nbsp;=&nbsp; <tspan></tspan>',xr="M8,6.8V17.2a.9.9,0,0,0,1.5.8l8.2-5.2a1,1,0,0,0,0-1.7L9.5,6A1,1,0,0,0,8,6.8Z",ac="M8 19a2 2 0 0 0 2-2v-10a2 2 0 0 0 -2-2 2 2 0 0 0 -2 2v10a2 2 0 0 0 2 2zm6-12v10a2 2 0 0 0 2 2 2 2 0 0 0 2-2v-10a2 2 0 0 0 -2-2 2 2 0 0 0 -2 2z";function w1(e,s,t){let i=(Date.now()-e)/1e3;if(t==="once")return i/s;if(t==="loop")return i/s%1;let r=i/(s*2)%1;return r<.5?r*2:1-(r-.5)*2}var ci=class extends ${constructor(t,i,r){super(t,i,r);this.path=new S(P,ua,fa);this.$body=h("rect",{class:"polygon-tile",rx:10},this.$el),this.$outline=h("rect",{class:"outline",rx:10},this.$el),this.$body.setRect(this.path),this.$outline.setRect(this.path),this.$expr=h("text",{x:rs,y:30,html:b1,style:"text-anchor:start"},this.$el),[this.$exprName,this.$exprValue]=this.$expr.$$("tspan"),this.$bar=h("line",{x1:rs,x2:ua-rs,y1:fa-rs,y2:fa-rs,opacity:.5,style:"stroke-width: 4"},this.$el);let o=h("g",{transform:"translate(162 12)",style:"cursor:pointer"},this.$el);h("rect",{x:-4,y:-4,width:32,height:32,fill:"transparent"},o),this.$playIcon=h("path",{d:xr},o),t.events.listen(o,{click:()=>this.play()}),this.$handle=this.makeHandle("c",n=>{let a=rt(this.props.min,this.props.max,(n.x-rs)/(ua-2*rs));this.setValue(a)}),this.$handle.addClass("persistent"),this.props.watch("color",({color:n})=>this.setColour(n)),this.props.watch("variable min max stepN playback duration",()=>{this.animation&&this.stopAnimating(),this.setValue(this.props.value,!0)})}applyChange(t){this.stopAnimating(),super.applyChange(t),"value"in t&&this.setValue(t.value,!0)}play(){if(this.animation){this.stopAnimating(),this.$parent.change({changed:[this]});return}this.$playIcon.setAttr("d",ac);let{min:t,max:i,playback:r,duration:o}=this.props,n=Date.now(),a=n+o*1e3;this.animation=et(()=>{let l=w1(n,o,r);this.setValue(rt(t,i,l)),r==="once"&&Date.now()>=a&&this.stopAnimating()})}stopAnimating(){var t;(t=this.animation)==null||t.cancel(),this.animation=void 0,this.$playIcon.setAttr("d",xr)}delete(){this.animation&&this.stopAnimating(),super.delete()}setValue(t,i=!1){if(t=M(tt(t,this.props.stepN),this.props.min,this.props.max),!i&&this.value!==void 0&&E(t,this.value))return;this.value=this.props.value=t;let r=rt(rs,ua-rs,(t-this.props.min)/(this.props.max-this.props.min));this.$handle.setTransform(new d(r,fa-rs)),this.$exprName.text=this.props.variable,this.$exprValue.text=mt(t,5),this.$parent.mathContext.updateSource(this,this.props.variable,new Xe(t))}setColour(t){let i=G.from(t).brightness<180?"#fff":"#000";this.$body.setAttr("fill",t);for(let r of[this.$expr,this.$playIcon])r.setAttr("fill",i);this.$handle.css("fill",i),this.$bar.setAttr("stroke",i)}static makeThumbnail(t,i){let r=h("svg",{width:104,height:54},t);h("rect",{x:2,y:2,width:100,height:50,fill:i.color,rx:5},r),h("rect",{x:10,y:40,width:84,height:3,fill:"white",rx:2,opacity:.5},r),h("circle",{cx:32,cy:41.5,r:6,fill:"white"},r),h("text",{x:52,y:28,fill:"white",style:"font-size:24;font-style:italic",text:i.variable},r)}static altText(t){return` ${t.variable}`}};ci.type="slider",ci.defaultProps={min:-5,max:5,stepN:.1,playback:"bounce",duration:2,value:0},ci=w([T],ci);O([{id:"name",type:"input",tileTypes:["slider"],label:"",style:"font-style:italic",get:e=>e.props.variable,set:(e,s)=>s.props.variable=e.replace(/[^A-Za-z]/g,"")},{id:"range",type:"range",tileTypes:["slider"],label:"",get:e=>[e.props.min,e.props.max],set:(e,s)=>s.props.assign({min:e[0],max:e[1]})},{id:"increment",type:"input",tileTypes:["slider"],label:"",value:"number",location:"more",get:e=>e.props.stepN,set:(e,s)=>s.props.stepN=+e},{id:"duration",type:"input",tileTypes:["slider"],label:"",value:"number",range:[.1,10],location:"more",get:e=>e.props.duration,set:(e,s)=>s.props.duration=+e},{id:"motion",type:"select",tileTypes:["slider"],label:"",options:[{label:"",key:"bounce"},{label:"",key:"loop"},{label:"",key:"once"}],location:"more",get:e=>e.props.playback,set:(e,s)=>s.props.playback=e}]);var Ne=[...ss,"fraction-bar","fraction-circle","number-bar","axes"];function*lc(e,s=!1,t){let i=s||e.some(l=>l.is("fraction-bar")||l.is("number-bar")),r=100,o=new Map;for(let l of e)o.set(l,l.is("fraction-circle")?l.posn.x:ut(l.transformed).p.x);let n=t!=null?t:Math.min(...o.values()),a=new Set(e.filter(l=>l.is("fraction-circle")));for(;a.size;){let l=a.values().next().value,c=[l];a.delete(l);for(let m of a)m.posn.equals(l.posn,1)&&(c.push(m),a.delete(m));let p=c.map(m=>{let g=360/m.props.denominator;return{tile:m,rot:K(m.rot-g/2,360),size:g*m.props.count}}).sort((m,g)=>m.rot-g.rot),u=p.find((m,g)=>{let b=p[g?g-1:p.length-1],x=K(b.rot+b.size,360);return!Y(x,m.rot-1,m.rot+m.size+1)})||p[0],f=ut(...e.map(m=>m.transformed)),v=i?(f.p.x-n)/r:0;for(let{tile:m,rot:g}of p)yield[m,v+(g+(g<u.rot?360:0)-u.rot)/360*5]}for(let l of e){if(l.is("fraction-circle"))continue;let c=o.get(l)||0;yield i?[l,(c-n)/r]:[l,0]}}var hi=class extends ${constructor(t,i,r){super(t,i,r);this.cannotDragToSelect=!0;this.cannotRotate=!0;this.currentLoop=0;this.isPlaying=!1;this.$blackKeys=h("path",{opacity:.15,fill:"#000",style:"pointer-events:none"},this.$el),this.$highlight=h("rect",{fill:y.yellow,opacity:.4,style:"pointer-events:none"},this.$el),this.$gridLines=h("path",{opacity:.4,"stroke-width":2,style:"pointer-events:none"},this.$el),this.$gridBold=h("path",{"stroke-width":4,style:"pointer-events:none"},this.$el),this.$labels=h("g",{style:"font-weight:600"},this.$el),this.$frame=h("path",{class:"polygon-tile"},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.$playhead=h("line",{y2:0,"stroke-width":6,hidden:!0,stroke:y.fg},this.$el),this.$playIcon=h("path",{d:xr,transform:"translate(6 7)"},this.$el);let o=h("rect",{width:40,height:37.5,fill:"transparent",style:"cursor:pointer"},this.$el);this.$loopCount=h("text",{style:"text-anchor:right"},this.$el);let n=c=>M(tt(c,25),50,1e4);this.$handles=[this.makeHandle("c",c=>this.props.assign({width:n(c.x),height:M(Math.round(-c.y/50),1,50)})),this.makeHandle("c",c=>{let p=Math.round(c.y/50);p&&this.setTransform(this.worldPosn(new d(0,p*50)));let u=M(this.props.height+p,1,50),f=this.props.startNote-p;this.props.assign({width:n(c.x),startNote:f,height:u})})],t.events.listen(o,{click:()=>this.play()}),this.props.watch("width height labels musicScale startNote",()=>this.redraw()),this.props.watch("color",c=>{for(let u of[this.$frame,this.$labels])u.setAttr("fill",c.color);for(let u of[this.$gridLines,this.$gridBold])u.setAttr("stroke",c.color);let p=G.from(c.color).brightness<220?"#fff":"#000";for(let u of[this.$playIcon,this.$loopCount])u.setAttr("fill",p)});let a,l;this.onMoveStart=()=>{if(this.props.musicScale==="none"||t.selection.size!==1)return;let c=Es(t.selection.tiles);Ne.includes(c.props.name)&&(a=c)},this.onMoveSelection=()=>{if(!a)return;let c=this.relativePosn(a.worldPosn(a.center)),p=this.body.contains(c);if(this.$highlight.toggle(p),!p)return l=void 0;let u=Math.round(-(c.y+25)/50);u!==l&&(l=u,this.$highlight.setRect(new S(new d(0,-(u+1)*50),this.body.w,50)),Jo(this.getKeyAtY(u),a.props.sound))},this.onMoveEnd=()=>{if(this.props.musicScale==="none")return;let c=this.isActive?void 0:t.selection.tiles.values();for(let[p,u]of this.getContainingTiles(c))p.props.note=this.getKeyAtY(u);this.$highlight.hide(),l=a=void 0},t.on("move-start",this.onMoveStart),t.on("move-selection",this.onMoveSelection),t.on("move-end",this.onMoveEnd),this.makeOutPort("main",{persistent:!0,tileTypes:["song"]}),this.makeInPort("main",{message:()=>0,tileTypes:["song"]})}delete(){this.pause(),this.$parent.off("move-start",this.onMoveStart),this.$parent.off("move-selection",this.onMoveSelection),this.$parent.off("move-end",this.onMoveEnd),super.delete()}getKeyAtY(t){return Wo(this.props.musicScale,t+this.props.startNote)}*getContainingTiles(t=this.$parent.tiles.values()){for(let i of t){if(!i.transformed||!Ne.includes(i.props.name))continue;let r=this.relativePosn(i.worldPosn(i.center));this.body.contains(r)&&(yield[i,Math.round(-(r.y+25)/50)])}}redraw(){this.pause();let{width:t,height:i,musicScale:r,labels:o,startNote:n}=this.props,a=i*50;this.body=new S(new d(0,-a),t,a),this.path=this.body.padding(12.5,12.5,37.5,12.5);let[l,c,p]=this.path.points;this.$handles[0].setCenter(c),this.$handles[1].setCenter(p),this.$outline.draw(this.path),this.$playhead.setAttr("y1",-a),this.$frame.setAttr("d",`M${l.x} ${l.y}h${this.path.w}v${this.path.h}h${-this.path.w}ZM0 ${-a}v${a}h${t}v${-a}Z`),this.$loopCount.setCenter({x:t-12.5,y:24}),this.transform(),this.$parent.selection.update();for(let g of[this.$gridLines,this.$gridBold])g.toggle(r!=="none");if(this.$labels.toggle(r!=="none"&&o!=="hidden"),this.$blackKeys.toggle(r==="chromatic"),r==="none")return;let u="";for(let g=1;g<i;++g)u+=`M0 ${-g*50}h${t}`;if(this.$gridLines.setAttr("d",u),r==="chromatic"){let g="";for(let b=0;b<i;++b)[1,3,6,8,10].includes(K(n+b,12))&&(g+=`M0 ${-b*50}v-50h${t}v50z`);this.$blackKeys.setAttr("d",g)}let f=Xr[r].length,v=f*Math.floor(n/f),m="";for(let g=v+f;g<n+i;g+=f)m+=`M0 ${-(g-n)*50}h${t}`;if(this.$gridBold.setAttr("d",m),o!=="hidden"){this.$labels.removeChildren();for(let g=0;g<i;++g){let b=this.getKeyAtY(g),x=o==="text"?Ko(r,K(b,12)):b;h("text",{text:x,x:-32,y:-g*50-20},this.$labels)}}}getSnapPoints(){let{width:t,height:i}=this.props,r=I(n=>new d(0,-n*50),i+1),o=r.map(n=>n.shift(t,0));return[...r,...o]}getSnapLines(){let{width:t,height:i}=this.props,r=new dt(new d(0,-i*50),P),o=r.shift(t,0),n=new dt(P,new d(t,0)),a=I(l=>n.shift(0,-l*50),i+1);return[r,o,...a]}moveStart(t=!1){if(super.moveStart(),t)return;let i=Array.from(this.getContainingTiles()).map(r=>r[0]);this.$parent.selection.select(i)}play(t=rr()){if(this.isPlaying)return this.pause();this.isPlaying=!0,this.currentLoop=0,this.$parent.state.audioPlaying+=1,this.$parent.selection.clear(),t=Math.max(t,rr()+us/2),this.props.playbackType==="timeline"&&setTimeout(()=>this.$playhead.show(),(t-rr())*1e3),this.$playIcon.setAttr("d",ac);let i=r=>{this.currentLoop+=1,this.props.loops>1&&(this.$loopCount.text=`${this.currentLoop}/${this.props.loops}`);let o=Array.from(this.getContainingTiles()).map(l=>l[0]);for(let l of o)l.track||l.setupAudioTrack();this.playingTracks=o.map(l=>l.track);let n=0;if(this.props.playbackType==="timeline"){let l=lc(o,!0,this.posn.x),c=Array.from(l,([p,u])=>{let f=p.track.play(r+u/this.props.tempo,this.props.tempo);return u/this.props.tempo+f});n=Math.max(...c)}else{let l=o.map(p=>ut(p.transformed).p.x),c=o.map((p,u)=>[p,u]).sort((p,u)=>l[p[1]]-l[u[1]]).map(p=>p[0]);for(let p of c){let u=p.track.play(r+n,this.props.tempo);n+=u}}let a=["translateX(0)",`translateX(${this.props.width}px)`];this.$playhead.animate({transform:a},10*this.props.width/this.props.tempo,100,"linear"),this.timer=window.setTimeout(()=>{var l,c;if(this.currentLoop>=this.props.loops){for(let p of this.outPorts.get("main").cables)(c=(l=p.to)==null?void 0:l.tile)==null||c.play(r+n);setTimeout(()=>this.pause(),us)}else{for(let p of this.playingTracks||[])p.stop();i(r+n)}},n*1e3)};i(t)}pause(){if(this.isPlaying){this.isPlaying=!1;for(let t of this.playingTracks||[])t.stop();this.$parent.state.audioPlaying-=1,this.playingTracks=void 0,this.$playhead.hide(),this.$loopCount.text="",this.$playIcon.setAttr("d",xr),clearTimeout(this.timer),this.$parent.selection.update()}}static makeThumbnail(t){let i=h("svg",{width:140,height:100},t);h("path",{d:"M5 5h130v90h-130zM12 12v64h116v-64z",fill:y.bg},i),h("path",{d:xr,transform:"translate(8 74) scale(.8)",fill:y.fg},i);let r=[[38,18,50,y.red],[18,35,55,y.blue],[75,35,35,y.green],[30,52,70,y.yellow]];for(let[o,n,a,l]of r)h("rect",{x:o,y:n,width:a,height:15,opacity:.6,rx:3,fill:l},i)}};hi.type="song",hi.defaultProps={width:400,height:6,labels:"text",loops:1,musicScale:"major",color:"#666",tempo:1,startNote:0,layer:"back",playbackType:"timeline"},hi=w([T],hi);O([{id:"playback",type:"select",tileTypes:["song"],label:"",location:"music",options:[{key:"timeline",label:""},{key:"sequence",label:""}],get:e=>e.props.playbackType,set:(e,s)=>s.props.playbackType=e},{id:"loops",type:"input",tileTypes:["song"],label:"",range:[1,100],get:e=>e.props.loops,set:(e,s)=>s.props.loops=+e},{id:"notes",type:"select",tileTypes:["song"],label:"",location:"music",options:[{key:"none",label:""},{key:"major",label:""},{key:"minor",label:""},{key:"chromatic",label:""},{key:"blues",label:""},{key:"pentatonic",label:""}],get:e=>e.props.musicScale,set:(e,s)=>s.props.musicScale=e},{id:"labels",type:"select",tileTypes:["song"],label:"",location:"music",show:e=>e.every(s=>s.props.musicScale!=="none"),options:[{key:"hidden",label:""},{key:"number",label:""},{key:"text",label:""}],get:e=>e.props.labels||"text",set:(e,s)=>s.props.labels=e},{id:"tempo",type:"input",tileTypes:["song"],label:"",value:"number",location:"music",range:[.01,8],get:e=>e.props.tempo,set:(e,s)=>s.props.tempo=+e}]);var kd=[{id:"play",type:"button",tileTypes:Ne,label:"",icon:"play",flattenGroups:!0,show:e=>!e[0].$parent.options.noMusic&&!e[0].$parent.state.audioPlaying&&e.every(s=>{var t;return!((t=s.track)!=null&&t.isPlaying)}),click:(e,s)=>{var t;s.selection.clear();for(let[i,r]of lc(e))i.track||i.setupAudioTrack(),(t=i.track)==null||t.play(rr()+us+r)}},{id:"pause",type:"button",tileTypes:Ne,label:"",icon:"pause",flattenGroups:!0,show:e=>!e[0].$parent.options.noMusic&&!e[0].$parent.state.audioPlaying&&e.some(s=>{var t;return(t=s.track)==null?void 0:t.isPlaying}),click:e=>{var s;for(let t of e)(s=t.track)==null||s.stop()}},{id:"sound",type:"select",tileTypes:[...Ne,"piano","logic-speaker"],label:"",location:"music",radio:!0,flattenGroups:!0,options:qh.map(({key:e,label:s})=>({key:e,label:s,icon:e})),show:e=>!e[0].$parent.options.noMusic,get:e=>e.props.sound||"piano",set:(e,s)=>{s.props.sound=e,Jo(s.props.note,s.props.sound)}},{id:"arpeggiation",type:"checkbox",tileTypes:ss,label:"",location:"music",flattenGroups:!0,show:e=>!e[0].$parent.options.noMusic,get:e=>{var s;return(s=e.props.arpeggio)!=null?s:!0},set:(e,s)=>s.props.arpeggio=e},{id:"tempo",type:"input",tileTypes:Ne,label:"",value:"number",location:"music",range:[.01,10],flattenGroups:!0,show:e=>!e[0].$parent.options.noMusic,get:e=>e.props.tempo||1,set:(e,s)=>{s.props.tempo=+e}},{id:"pitch",type:"input",tileTypes:[...Ne,"logic-speaker"],label:"",location:"music",flattenGroups:!0,show:e=>!e[0].$parent.options.noMusic,get:e=>Yo(e.props.note),set:(e,s)=>s.props.note=Xo(e)},{id:"lfo-gain",type:"input",tileTypes:[...Ne,"piano","logic-speaker"],label:"",location:"music",flattenGroups:!0,show:e=>!e[0].$parent.options.noMusic&&e.every(s=>s.props.sound==="synth"),value:"number",range:[-1e5,1e4],get:e=>{var s;return(s=e.props.modGain)!=null?s:2},set:(e,s)=>s.props.modGain=+e},{id:"lfo-freq",type:"input",tileTypes:[...Ne,"piano","logic-speaker"],label:"",show:e=>!e[0].$parent.options.noMusic&&e.every(s=>s.props.sound==="synth"),location:"music",flattenGroups:!0,value:"number",range:[0,1e3],get:e=>e.props.modFreq||8,set:(e,s)=>s.props.modFreq=+e},{id:"volume",type:"slider",tileTypes:[...Ne,"piano","logic-speaker"],label:"",location:"music",flattenGroups:!0,show:e=>!e[0].$parent.options.noMusic,get:e=>{var s;return((s=e.props.volume)!=null?s:1)/10},start:()=>0,move:(e,s)=>e.props.volume=s*10,end:()=>0}];var Cd=[{id:"handles",type:"checkbox",tileTypes:["axes","balance","fraction-bar","fraction-circle","decimal-grid","multi-jump","number-line","ten-frame","number-tile","image","spinner","custom-spinner","box-whisker","chart","pie-chart","table","rectangle","reg-polygon","custom-polygon","circle"],label:"",icon:"handles",location:"more",get:e=>!e.props.hideHandles,set:(e,s)=>s.props.hideHandles=!e},{id:"copy",type:"button",tileTypes:["all"],label:"",icon:"copy",showForGenerators:!0,show:e=>!e[0].$parent.options.noCopyPaste&&e.every(s=>!s.cannotEdit),click:(e,s)=>s.paste(s.selection.copy(),new d(25,25))},{id:"delete",type:"button",tileTypes:["all"],label:"",icon:"delete",show:e=>!e[0].$parent.options.noDeleting&&e.every(s=>!ne(s)),click:(e,s)=>s.selection.delete()},{id:"layer",type:"select",tileTypes:["all"],label:"",icon:"layer-front",flattenGroups:!0,show:e=>e.every(s=>s.props.name!=="geo"),options:[{key:"front",label:""},{key:"normal",label:""},{key:"back",label:""}],location:"more",get:e=>e.props.layer,set:(e,s)=>s.props.layer=e},{id:"interactivity",type:"select",tileTypes:["all"],label:"",icon:"lock",showForGenerators:!0,options:[{key:"",label:""},{key:"locked",label:""},{key:"hidden",label:""},{key:"generator",label:""},{key:"fixed",label:""}],location:"more",get:e=>e.props.status||"",set:(e,s)=>s.props.status=e||void 0},{id:"altText",type:"input",tileTypes:["all"],label:"",icon:"accessibility",location:"more",large:!0,get:e=>e.altText,set:(e,s)=>s.props.altText=e||void 0}];var Md='<div class=actions></div><x-popup animation=pop><button class="action popup-target"><x-icon name=music></x-icon><div class=tooltip></div></button><div class=popup-body aria-label= hidden></div></x-popup><x-popup animation=pop><button class="action popup-target"><x-icon name=more></x-icon><div class=tooltip></div></button><div class=popup-body aria-label= hidden><button class="pin action"><x-icon name=pin size=16></x-icon><span>Pin actionbar</span></button></div></x-popup><x-popup animation=pop><button class="action popup-target blue" title=><x-icon name=construction></x-icon><div class=tooltip></div></button><div class="popup-body blue" aria-label= hidden></div></x-popup>';var ma=class extends lt{constructor(){super(...arguments);this.selection=[];this.flatSelection=[];this.focussed=!1;this.dragging=!1;this.cachedWidth=0}bindPolypad(t){this.$parent=t,this.$actions=this.$(".actions"),this.$advanced=this.$$("x-popup"),this.$pin=this.$(".pin"),this.$dropdowns=this.$advanced.map(l=>l.$(".popup-body")),this.actions=[...xl,...kd,...Cd].reverse().map(l=>this.createAction(l)),this.viewport=new bt(0,t.width,0,t.height),this.setAttr("data-display","flex"),this.setFloating(!0),this.$pin.on("click",()=>this.setFloating(!this.floating)),t.events.listenAll({start:()=>{this.dragging=!0,this.toggle()},end:()=>{this.dragging=!1,this.updatePosition(),this.toggle()}}),R.onResize(()=>{R.width<600&&this.floating&&this.setFloating(!1),this.viewport=new bt(0,t.width,0,t.height),this.redraw()}),t.on("viewport",()=>this.redraw()),t.on("shift-selection",()=>this.updatePosition()),t.on("change-selection",({tiles:l})=>this.update(l,!1)),t.on("change-focus",({tiles:l})=>this.update(l,!0)),this.on("wheel",l=>t.trigger("wheel",l));let i=this.$dropdowns[2].parent,r=Ze({}),o=re(this.actions.map(l=>l.data.id)),n=l=>l==="copy"?"*copy":l;t.one("enter-customise-mode",()=>{let l=this.actions.sort((c,p)=>c.data.label.localeCompare(p.data.label));for(let c of l)c.$check=h("label",{},this.$dropdowns[2]),h("input",{type:"checkbox"},c.$check).bindVariable(r,n(c.data.id)),h("span",{text:c.data.label.replace(":","")},c.$check)}),t.on("exit-customise-mode",()=>{let l=o.filter(c=>r[n(c)]);t.options.actionbar=l.length===o.length?void 0:l.length?l.join(","):"hidden"});let a=(l,c)=>{if(this.setClass("customising",!!c),i.css("display",c?"block":"none"),l!=null&&l.startsWith("--")){let u=new Set(l.slice(2).split(","));l=o.filter(f=>!u.has(f)).join(",")}let p=l?l==="hidden"?new Set:new Set(l.split(",")):void 0;if(this.valid=c?void 0:p,this.update(this.selection,this.focussed),!!c)for(let u of o)r[n(u)]=!p||p.has(u)};t.state.watch(l=>a(t.options.actionbar,l.customiseMode)),t.options.watch(l=>a(l.actionbar,t.state.customiseMode))}toggle(){let t=(!this.floating||!this.dragging)&&!!this.selection.length&&this.actions.some(i=>i.visible);super.toggle(t)}setFloating(t=!0){this.floating=t,this.$pin.$("x-icon").setAttr("name",t?"pin":"unpin"),this.$pin.$("span").text=t?"":"",this.$pin.blur(),t||this.css("transform",""),R.redraw(),this.setClass("floating",t),this.setClass("pinned",!t),this.updatePosition()}updatePosition(){if(!this.floating)return;let t=this.selection.map(r=>r.transformedPadded||r.transformed).filter(Boolean);!this.focussed&&this.$parent.selection.rotateHandle&&t.push(this.$parent.selection.rotateHandle);let i=ut(...t);this.posn=i.p.shift(-3,i.h+3),this.redraw()}redraw(){if(!this.floating)return;let t=this.viewport.extend(0,-this.cachedWidth,-96,-this.$parent.margins[3]+40),i=this.posn.changeCoordinates(this.$parent.viewportBounds,this.viewport).shift(0,10).clamp(t,8);this.setClass("nearBtm",i.y>this.viewport.yMax-328),this.setTransform(i)}update(t,i){if(this.focussed=i,this.selection=t,!this.selection.length)return this.hide();this.flatSelection=[...Ae(t)];let r=new Set(t.map(n=>n.props.name)),o=new Set(this.flatSelection.map(n=>n.props.name));for(let n of this.actions)n.load(n.data.flattenGroups?o:r,n.data.flattenGroups?this.flatSelection:t);for(let[n,a]of["music","more"].entries())this.actions.some(l=>l.visible&&l.data.location===a)?this.$advanced[n].show():this.$advanced[n].hide();this.toggle(),R.redraw(),this.cachedWidth=this.width,this.updatePosition()}createAction(t){switch(t.type){case"button":return new aa(t,this);case"checkbox":return new la(t,this);case"input":return new ca(t,this);case"select":return new pa(t,this);case"range":return new ha(t,this);case"slider":return new da(t,this)}}};ma=w([ct("x-polypad-actionbar",{template:Md})],ma);var ga=class extends lt{bindPolypad(s){let t=this.$$("[data-key]");s.options.watch(u=>{let f=new Set((u.settings||"").split(","));for(let v of t){let m=v.data.key,g=m==="pan"?!s.options.noPinchPan:m==="undo"?!s.options.noUndoRedo:!u.settings||f.has(m);v.css("display",g?"block":"none")}});let i=!!this.$(".logo");s.options.watch(u=>this.toggle(i||u.settings!=="hidden"));let r=this.parents(".polypad")[0],o=this.$$("x-popup");for(let u of o)for(let f of u.$$(".popup-body button"))f.on("click",()=>u.close());this.$(".grid-select").bindVariable(s.options,"grid");let n=this.$$("[data-action]"),a=this.$('[data-key="fullscreen"] x-icon'),l=!!document.fullscreenElement;document.addEventListener("fullscreenchange",()=>{l=!!document.fullscreenElement,a==null||a.setAttr("name",l?"fullscreen-reverse":"fullscreen"),l||s.resetViewport()});for(let u of n)u.on("click",()=>{switch(u.data.action){case"fullscreen":return l?document.exitFullscreen():r==null?void 0:r._el.requestFullscreen();case"undo":return s.undo();case"redo":return s.redo();case"resetZoom":return s.resetViewport();case"download-png":return s.downloadImage("png");case"download-jpg":return s.downloadImage("jpg");case"download-svg":return s.downloadImage("svg");case"zoomIn":return s.setZoom(1.1);case"zoomOut":return s.setZoom(.9);case"pan":return s.tools.pan.enable()}});let c=this.$$(".undo-btn");s.state.watch(u=>{c[0].setAttr("disabled",u.canUndo?void 0:"true"),c[1].setAttr("disabled",u.canRedo?void 0:"true")}),R.isIOS&&n[0].hide();let p=this.$('[data-action="pan"]');s.state.watch(u=>p==null?void 0:p.setClass("active",u.tool==="pan"))}};ga=w([ct("x-polypad-settings")],ga);var Ad="<svg width=70 height=80><path d=M20.5,7.4,27.2,24c-1.9-4.7,6-7.1,8-2.3l1.4,3.6c-1.9-4.8,6.1-7.1,8-2.3l1.3,3.1c-2-4.7,5.7-6.5,7.7-1.8,3.3,7.8,5.8,13.6,9,21.3S60.8,56.2,65,66.7L44.9,75A13.9,13.9,0,0,0,36,66.9c-7.7-2.2-11.4-8.3-18.4-14.3a44.2,44.2,0,0,0-9.5-6.5c-2.6-1.5-4.2-3.4-2.2-5.7,3.5-4.1,9.3-1.3,13.1,1.5,1.6,1.2,4.4,4.1,5.9,3.8s1.7-.8,1-2.6L12.8,10.5c-1.9-4.7,5.8-7.9,7.7-3.1Z></path></svg>";function x1(e,s){let t=s.positionLeft-e.positionLeft+s.width/2,i=s.positionTop-e.positionTop+s.height/2;return new d(t,i)}var va=class extends lt{constructor(){super(...arguments);this.running=!1}start(t,i){this.$start=t,this.slide=i,this.$start.one("click pointerdown focus",()=>this.stop()),this.running||(this.running=!0,this.runAnimation())}stop(){this.running=!1}runAnimation(){return H(this,null,function*(){if(!this.running)return;this.show();let t=x1(this,this.$start),i=`translate(${t.x-15}px,${t.y-10}px)`;if(this.slide){let r=`translate(${t.x+this.slide.x-15}px,${t.y+this.slide.y-10}px)`;yield this.animate({transform:[i+" scale(2)",i],opacity:[0,1]},300).promise,yield this.animate({transform:[i,r]},1e3).promise,yield this.animate({transform:[r,r+" scale(2)"],opacity:[1,0]},300).promise}else yield this.animate({transform:[i+" scale(2)",i],opacity:[0,1]},500).promise,yield this.animate({transform:[i,i+" scale(2)"],opacity:[1,0]},500,200).promise;this.hide(),setTimeout(()=>this.runAnimation(),1e3)})}};va=w([ct("x-gesture",{template:Ad})],va);var ya=class extends lt{constructor(){super(...arguments);this.min=0;this.range=1;this.size=80}ready(){let t=h("div",{class:"handle"},this);this.drag=new qo(t,{moveY:!1,bounds:new bt(0,this.size,0,0)}),this.drag.on("start",()=>this.trigger("start")),this.drag.on("move",i=>this.trigger("move",i)),this.drag.on("end",()=>this.trigger("end")),this.css("width",this.size+20+"px"),this.onAttr("label",i=>t.text=i||""),this.onAttr("min",i=>this.min=+i||0),this.onAttr("max",i=>this.range=(+i||1)-this.min),this.onAttr("step",i=>this.step=+i||void 0)}bindVariable(t,i){t[i]===void 0&&(t[i]=this.value),this.on("move",()=>t[i]=this.value),t.watch(()=>this.value=t[i])}get value(){let t=this.min+this.drag.position.x/this.size*this.range;return this.step?Jt(t,this.step):t}set value(t){if(E(t,this.value))return;let i=(t-this.min)/this.range||0;this.drag.setPosition(this.size*M(i,0,1),0)}};ya=w([ct("x-drag")],ya);var gt=50;function $1(e,s,t,i,r){return new D(new d(-r,-r),new d(-r,e),new d(r,e),new d(r,-r),new d(s,-r),new d(s,r),new d(r,r),new d(r,t),new d(-r,t),new d(-r,r),new d(i,r),new d(i,-r))}function Ed(e,s){for(let t of e)if(s(t))return t}var hc=class{constructor(s){this.promises=new Map;this.latestPromises=new Map;{let t=new Blob(['"use strict";(()=>{var In=Object.defineProperty,Nn=Object.defineProperties;var Sn=Object.getOwnPropertyDescriptors;var Bt=Object.getOwnPropertySymbols;var yn=Object.prototype.hasOwnProperty,Cn=Object.prototype.propertyIsEnumerable;var _t=(t,n,e)=>n in t?In(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,ft=(t,n)=>{for(var e in n||(n={}))yn.call(n,e)&&_t(t,e,n[e]);if(Bt)for(var e of Bt(n))Cn.call(n,e)&&_t(t,e,n[e]);return t},ht=(t,n)=>Nn(t,Sn(n));function jt(t=10){return Math.random().toString(36).substr(2,t)}function b(t,...n){return n.includes(t)}var Dt=class extends Error{constructor(t){super("[Cache Error]"),this.data=t}};function mt(t){let n=new Map;return function(...e){let r=e.join("--");if(!n.has(r))try{n.set(r,t(...e))}catch(s){n.set(r,new Dt(s))}let i=n.get(r);if(i instanceof Dt)throw i.data;return i}}function L(t,n){return new Array(n).fill(t)}function Tt(t,n,e){let r=[];for(let i=0;i<n;++i)r.push(L(t,e));return r}function Ft(t,n){let e=[];for(let r=0;r<n;++r)e.push(t(r));return e}function Rt(t,n,e){let r=[];for(let i=0;i<n;++i){let s=[];for(let o=0;o<e;++o)s.push(t(i,o));r.push(s)}return r}function Vt(t,n,e=1){let r=[];if(n===void 0&&t>=0)for(let i=0;i<t;i+=e)r.push(i);else if(n===void 0)for(let i=0;i>t;i-=e)r.push(i);else if(t<=n)for(let i=t;i<=n;i+=e)r.push(i);else for(let i=t;i>=n;i-=e)r.push(i);return r}function M(t,n=0){return t[t.length-1-n]}function q(t){return t.reduce((n,e)=>n+e,0)}function B(t){return t.filter((n,e)=>t.indexOf(n)===e)}function pt(t){return t.reduce((n,e)=>n.concat(Array.isArray(e)?pt(e):e),[])}function Ut(...t){return t.reduce((n,e)=>n.concat(e),[])}function W(t,n=/\\s+/){return t?t.trim().split(n):[]}var lt=class{constructor(...t){this.values=t}map(t){let n=this.values;return new lt(function*(){let e=0;for(let r of n)for(let i of r)yield t(i,e),e+=1}())}every(t){let n=0;for(let e of this.values)for(let r of e){if(!t(r,n))return!1;n+=1}return!0}some(t){let n=0;for(let e of this.values)for(let r of e){if(t(r,n))return!0;n+=1}return!1}slice(t,n){let e=this.values;return new lt(function*(){let r=0;for(let i of e)for(let s of i)r<t||n!==void 0&&r>t+n||(yield s,r+=1)}())}filter(t){let n=this.values;return new lt(function*(){let e=0;for(let r of n)for(let i of r)t(i,e)&&(yield i),e+=1}())}concat(t){this.values.push(t)}[Symbol.iterator](){let t=this.values;return function*(){for(let n of t)for(let e of n)yield e}()}static make(t,n){return new lt(function*(){let e=0;for(;n===void 0||e<n;)yield t(e),e+=1}())}};var Pn=Object.defineProperty,bt=(t,n)=>{for(var e in n)Pn(t,e,{get:n[e],enumerable:!0})},Xt=1e-6;function C(t,n,e=Xt){return isNaN(t)||isNaN(n)?!1:Math.abs(t-n)<e}function tt(t,n,e,r=Xt){return n>e&&([n,e]=[e,n]),t>n+r&&t<e-r}function nt(t,n=-1/0,e=1/0){return Math.min(e,Math.max(n,t))}function _(...t){let[n,...e]=t;if(e.length>1)return _(n,_(...e));let r=Math.abs(n),i=Math.abs(e[0]);for(;i;)[r,i]=[i,r%i];return r}function k(...t){let[n,...e]=t;return e.length>1?k(n,k(...e)):Math.abs(n*e[0])/_(n,e[0])}var On={};bt(On,{determinant:()=>_n,fill:()=>zt,identity:()=>Gt,inverse:()=>Jt,product:()=>gt,reflection:()=>qn,rotation:()=>An,scalarProduct:()=>Bn,shear:()=>Ln,sum:()=>Yt,transpose:()=>Zt});function zt(t,n,e){return Tt(t,n,e)}function Gt(t=2){let n=zt(0,t,t);for(let e=0;e<t;++e)n[e][e]=1;return n}function An(t){let n=Math.sin(t),e=Math.cos(t);return[[e,-n],[n,e]]}function Ln(t){return[[1,t],[0,1]]}function qn(t){let n=Math.sin(2*t),e=Math.cos(2*t);return[[e,n],[n,-e]]}function Yt(...t){let[n,...e]=t,r=e.length>1?Yt(...e):e[0];if(n.length!==r.length||n[0].length!==r[0].length)throw new Error("Matrix sizes don\t match");let i=[];for(let s=0;s<n.length;++s){let o=[];for(let u=0;u<n[s].length;++u)o.push(n[s][u]+r[s][u]);i.push(o)}return i}function Bn(t,n){return t.map(e=>e.map(r=>r*n))}function gt(...t){let[n,...e]=t,r=e.length>1?gt(...e):e[0];if(n[0].length!==r.length)throw new Error("Matrix sizes don\t match.");let i=[];for(let s=0;s<n.length;++s){let o=[];for(let u=0;u<r[0].length;++u){let a=0;for(let h=0;h<r.length;++h)a+=n[s][h]*r[h][u];o.push(a)}i.push(o)}return i}function Zt(t){let n=[];for(let e=0;e<t[0].length;++e){let r=[];for(let i=0;i<t.length;++i)r.push(t[i][e]);n.push(r)}return n}function _n(t){if(t.length!==t[0].length)throw new Error("Not a square matrix.");let n=t.length;if(n===1)return t[0][0];if(n===2)return t[0][0]*t[1][1]-t[0][1]*t[1][0];let e=0;for(let r=0;r<n;++r){let i=t[0][r],s=t[0][r];for(let o=1;o<n;++o)s*=t[o][(r+o)%n],i*=t[o][(r-o+n)%n];e+=s-i}return e}function Jt(t){let n=t.length;if(n!==t[0].length)throw new Error("Not a square matrix.");let e=Gt(n),r=Rt((i,s)=>t[i][s],n,n);for(let i=0;i<n;++i){let s=r[i][i];if(C(s,0)){for(let o=i+1;o<n;++o)if(r[o][i]!==0){for(let u=0;u<n;++u)[r[o][u],r[i][u]]=[r[i][u],r[o][u]],[e[o][u],e[i][u]]=[e[i][u],e[o][u]];break}if(s=r[i][i],C(s,0))throw new Error("Matrix not invertible.")}for(let o=0;o<n;++o)r[i][o]=r[i][o]/s,e[i][o]=e[i][o]/s;for(let o=0;o<n;++o){if(o===i)continue;let u=r[o][i];for(let a=0;a<n;++a)r[o][a]-=u*r[i][a],e[o][a]-=u*e[i][a]}}return e}var Dn={};bt(Dn,{bernoulli:()=>Kt,binomial:()=>Vn,cauchy:()=>Gn,chiCDF:()=>Zn,exponential:()=>Xn,find:()=>Fn,geometric:()=>zn,integer:()=>Tn,integrate:()=>tn,normal:()=>Wn,normalPDF:()=>Yn,poisson:()=>Un,shuffle:()=>jn,smart:()=>Rn,uniform:()=>Hn,weighted:()=>Qt});function jn(t){t=t.slice(0);for(let n=t.length-1;n>0;--n){let e=Math.floor(Math.random()*(n+1));[t[n],t[e]]=[t[e],t[n]]}return t}function Tn(t,n){let e=n===void 0?0:t,r=n===void 0?t:n-t+1;return e+Math.floor(r*Math.random())}function Qt(t){let n=Math.random()*q(t),e=0;return t.findIndex(r=>(e+=r)>=n)}function Fn(t){return t[Math.floor(t.length*Math.random())]}var dt=new Map;function Rn(t,n){n||(n=jt()),dt.has(n)||dt.set(n,L(1,t));let e=dt.get(n),r=Qt(e.map(i=>i*i));return e[r]-=1,e[r]<=0&&dt.set(n,e.map(i=>i+1)),r}function Kt(t=.5){return Math.random()<t?1:0}function Vn(t=1,n=.5){let e=0;for(let r=0;r<t;++r)e+=Kt(n);return e}function Un(t=1){if(t<=0)return 0;let n=Math.exp(-t),e=1,r=0;for(;e>n;++r)e*=Math.random();return r-1}function Hn(t=0,n=1){return t+(n-t)*Math.random()}function Wn(t=0,n=1){let e=Math.random(),r=Math.random();return Math.sqrt(-2*Math.log(e))*Math.cos(2*Math.PI*r)*Math.sqrt(n)+t}function Xn(t=1){return t<=0?0:-Math.log(Math.random())/t}function zn(t=.5){if(!(t<=0||t>1))return Math.floor(Math.log(Math.random())/Math.log(1-t))}function Gn(){let t,n,e;do n=2*Math.random()-1,e=2*Math.random()-1,t=n*n+e*e;while(t>=1);return n/e}function Yn(t,n=1,e=0){return Math.exp(-((t-n)**2)/(2*e))/Math.sqrt(2*Math.PI*e)}var Ht=7,Wt=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,15056327351493116e-23];function kt(t){if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*kt(1-t));t-=1;let n=Wt[0];for(let r=1;r<Ht+2;r++)n+=Wt[r]/(t+r);let e=t+Ht+.5;return Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*n}function tn(t,n,e,r=1){let i=0;for(let s=n;s<e;s+=r)i+=t(s)*r||0;return i}function Zn(t,n){return 1-tn(r=>Math.pow(r,(n-2)/2)*Math.exp(-r/2),0,t)/Math.pow(2,n/2)/kt(n/2)}var Jn={};bt(Jn,{bestPolynomial:()=>ee,coefficient:()=>en,exponential:()=>kn,linear:()=>Kn,logarithmic:()=>te,polynomial:()=>nn,power:()=>ne});function Qn(t,n){let e=1,r=t[0];for(let i=1;i<t.length;++i)e*=n,r+=e*t[i];return r}function Kn(t,n=!1){let e=0,r=0,i=0,s=0,o=t.length;for(let h=0;h<o;h++)e+=t[h][0],r+=t[h][1],i+=t[h][0]*t[h][0],s+=t[h][0]*t[h][1];if(n)return[0,s/i];let u=(o*s-e*r)/(o*i-e*e);return[r/o-u*e/o,u]}function kn(t){let n=[0,0,0,0,0,0];for(let s of t)n[0]+=s[0],n[1]+=s[1],n[2]+=s[0]*s[0]*s[1],n[3]+=s[1]*Math.log(s[1]),n[4]+=s[0]*s[1]*Math.log(s[1]),n[5]+=s[0]*s[1];let e=n[1]*n[2]-n[5]*n[5],r=Math.exp((n[2]*n[3]-n[5]*n[4])/e),i=(n[1]*n[4]-n[5]*n[3])/e;return[r,i]}function te(t){let n=[0,0,0,0],e=t.length;for(let s of t)n[0]+=Math.log(s[0]),n[1]+=s[1]*Math.log(s[0]),n[2]+=s[1],n[3]+=Math.pow(Math.log(s[0]),2);let r=(e*n[1]-n[2]*n[0])/(e*n[3]-n[0]*n[0]);return[(n[2]-r*n[0])/e,r]}function ne(t){let n=[0,0,0,0],e=t.length;for(let s of t)n[0]+=Math.log(s[0]),n[1]+=Math.log(s[1])*Math.log(s[0]),n[2]+=Math.log(s[1]),n[3]+=Math.pow(Math.log(s[0]),2);let r=(e*n[1]-n[2]*n[0])/(e*n[3]-n[0]*n[0]);return[Math.exp((n[2]-r*n[0])/e),r]}function nn(t,n=2){let e=t.map(a=>Vt(n+1).map(h=>Math.pow(a[0],h))),r=Zt(e),i=t.map(a=>[a[1]]),s=gt(r,e),o=Jt(s);return gt(o,r,i).map(a=>a[0])}function en(t,n){let r=t.reduce((o,u)=>o+u[1],0)/t.length,i=t.reduce((o,u)=>o+(u[1]-r)**2,0);return 1-t.reduce((o,u)=>o+(u[1]-n(u[0]))**2,0)/i}function ee(t,n=.85,e=8){if(!(t.length<=1))for(let r=1;r<e;++r){let i=nn(t,r),s=u=>Qn(i,u);if(en(t,s)>=n)return{order:r,coefficients:i,fn:s}}}var f=class extends Error{constructor(t,n){super(n),this.name=t}static undefinedVariable(t){return new f("EvalError",`Undefined variable \${t}\.`)}static undefinedFunction(t){return new f("EvalError",`Undefined function \${t}\.`)}static uncallableExpression(t){return new f("EvalError",`Cannot call \${t}\.`)}static evalLoop(t){return new f("EvalError",`Loop in nested evaluation \${t}\.`)}static invalidCharacter(t){return new f("SyntaxError",`Unknown symbol \${t}\.`)}static conflictingBrackets(t){return new f("SyntaxError",`Conflicting brackets \${t}\.`)}static unclosedBracket(t){return new f("SyntaxError",`Unclosed bracket \${t}\.`)}static startOperator(t){return new f("SyntaxError",`A term cannot start with a \${t}\.`)}static endOperator(t){return new f("SyntaxError",`A term cannot end with a \${t}\.`)}static consecutiveOperators(t,n){return new f("SyntaxError",`A \${t}\ cannot be followed by a \${n}\.`)}static invalidExpression(){return new f("SyntaxError","This expression is invalid.")}},Pt={pi:Math.PI,\:Math.PI,e:Math.E},Nt={"(":")","[":"]","{":"}"},G={"*":"\\xB7","**":"\","//":"//","+-":"\\xB1","\":"\","-":"\",xx:"\\xD7",sum:"\",prod:"\",int:"\",del:"\",grad:"\",aleph:"\",not:"\\xAC",AA:"\",EE:"\","\'":"\","!=":"\","<=":"\",">=":"\",in:"\","!in":"\","==":"\","~=":"\","~~":"\",sub:"\",sube:"\",prop:"\",oo:"\",cap:"\",cup:"\","<-":"\","->":"\","=>":"\","<=>":"\","|->":"\",uarr:"\",darr:"\",lArr:"\"},it={Gamma:"\",Delta:"\",Theta:"\",Lambda:"\",Xi:"\",Pi:"\",Sigma:"\",Phi:"\",Psi:"\",Omega:"\",alpha:"\",beta:"\",gamma:"\",delta:"\",epsilon:"\",zeta:"\",eta:"\",theta:"\",iota:"\",kappa:"\",lambda:"\",mu:"\",nu:"\",xi:"\",pi:"\",rho:"\",sigma:"\",tau:"\",upsilon:"\",phi:"\",chi:"\",psi:"\",omega:"\",CC:"\",NN:"\",QQ:"\",RR:"\",ZZ:"\"},ln="abcdefghijklmnopqrstuvwxyz",re=ln.split(""),ie=ln.toUpperCase().split(""),se=Object.values(it),oe=[...re,...ie,...se,"$"],ue="|()[]{}\\xF7,!<>=*/+-\\~^_\\\xB0\\\\'\:%\\",ae=Object.values(G),ce=[...ue,...ae],fe={_:"sub","^":"sup","//":"/","\\xF7":"/"},rn={"<":"&lt;",">":"&gt;"};function mn(t){return t in rn?rn[t]:t}var he=["abs","round","floor","ceil","max","min","mod","lcm","gcd","gcf","log","exp","ln","sqrt","root","sin","cos","tan","sec","csc","cot","cosec","cotan","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","cosech"];function rt(t){return he.includes(t)}var Y={"+":"plus","\":"minus","\\xB7":"times","\\xD7":"times","/":"over","//":"divided by","%":"percent","!":"factorial","\\xB1":"plus-minus","=":"equals","\":"does not equal","<":"is less than",">":"is greater than","\":"is less than or equal to","\":"is greater than or equal to",\:"pi","\":"is congruent to","\":"is parallel to","\":"is perpendicular to"};for(let t of Object.keys(it))Y[it[t]]=t;var pn=t=>typeof t=="number"?t:t[0],dn=t=>typeof t=="number"?[t,t]:t,O=class{evaluate(t={},n){return NaN}interval(t={},n){return dn(this.evaluate(t))}substitute(t={}){return this}recursiveSubstitute(t){let n=Object.keys(t);return this.unknowns.filter(e=>n.includes(e)).length?this.substitute(t).recursiveSubstitute(t):this}get simplified(){return this}get unknowns(){return this.variables.filter(t=>!Object.prototype.hasOwnProperty.call(Pt,t))}get variables(){return[]}get functions(){return[]}collapse(){return this}toString(){return""}toVoice(t={}){return""}toMathML(t={}){return""}},xt=new Set;function St(t,n,e=!1){var r;let i=(r=n[t])!=null?r:Pt[t];if(i===void 0)throw f.undefinedVariable(t);if(typeof i=="string"||i instanceof O){if(e||xt.clear(),xt.has(t))throw f.evalLoop(t);return xt.add(t),typeof i=="string"&&(i=At.parse(i)),i.evaluate(n,!0)}else return typeof i=="function"?i():i}var st=class extends O{constructor(t){super(),this.n=t}evaluate(){return this.n}toString(){return`${this.n}`}toVoice(){return`${this.n}`}toMathML(){return`<mn>${this.n}</mn>`}},ot=class extends O{constructor(t){super(),this.i=t}evaluate(t={},n){return pn(St(this.i,t,n))}interval(t={},n){return dn(St(this.i,t,n))}toMathML(){return`<mi${rt(this.i)?\' mathvariant="normal"\':""}>${this.i}</mi>`}substitute(t={}){return t[this.i]||this}get variables(){return[this.i]}toString(){return this.i}toVoice(){return this.i in Y?Y[this.i]:this.i.length===1?`_${this.i}_`:this.i}},le=class extends O{constructor(t){super(),this.s=t}evaluate(t={},n){return pn(St(this.s,t,n))}toString(){return`"${this.s}"`}toVoice(){return this.s}toMathML(){return`<mtext>${this.s}</mtext>`}},gn=class extends O{toString(){return" "}toMathML(){return"<mspace></mspace>"}},$=class extends O{constructor(t){super(),this.o=t}toString(){return this.o.replace("//","/")}toVoice(){return Y[this.o]||this.o}get functions(){return[this.o]}toMathML(){let t=mn(this.toString());return`<mo value="${t}">${t}</mo>`}},sn=[-1/0,1/0],z=[NaN,NaN],D=Math.PI/2,yt=Math.PI*2,l=(t,n)=>[t-Number.EPSILON,n+Number.EPSILON],j=(...t)=>l(Math.min(...t),Math.max(...t)),Ot=t=>Math.abs(t[1]-t[0]),vn=t=>t[0]===-1/0&&t[1]===1/0,X=t=>isNaN(t[0])||isNaN(t[1]),on=t=>!isFinite(t[0])&&t[0]===t[1],me=(t,n)=>tt(n,t[0]-Number.EPSILON,t[1]+Number.EPSILON),Z=t=>me(t,0),x={add:(...t)=>t.reduce((n,e)=>n+e,0),sub:(...t)=>t.length>1?t[0]-t[1]:-t[0],mul:(...t)=>t.reduce((n,e)=>n*e,1),div:(t,n)=>t/n,abs:t=>Math.abs(t),round:t=>Math.round(t),floor:t=>Math.floor(t),ceil:t=>Math.ceil(t),max:(...t)=>Math.max(...t),min:(...t)=>Math.min(...t),mod:(t,n)=>t%n,lcm:(...t)=>k(...t),gcd:(...t)=>_(...t),gcf:(...t)=>_(...t),sup:(t,n)=>Math.pow(t,n),log:(t,n)=>Math.log(t)/(n===void 0?1:Math.log(n)),exp:t=>Math.exp(t),ln:t=>Math.log(t),sqrt:t=>Math.sqrt(t),root:(t,n)=>Math.pow(t,1/n),sin:t=>Math.sin(t),cos:t=>Math.cos(t),tan:t=>Math.tan(t),sec:t=>1/Math.cos(t),csc:t=>1/Math.sin(t),cot:t=>1/Math.tan(t),cosec:t=>x.csc(t),cotan:t=>x.cot(t),arcsin:t=>Math.asin(t),arccos:t=>Math.acos(t),arctan:t=>Math.atan(t),sinh:t=>Math.sinh(t),cosh:t=>Math.cosh(t),tanh:t=>Math.tanh(t),sech:t=>1/Math.cosh(t),csch:t=>1/Math.sinh(t),coth:t=>1/Math.tanh(t),cosech:t=>x.csch(t)};function vt(t,n){if(t[0]>0)return n[0]>=0?l(t[0]**n[0],t[1]**n[1]):j(t[0]**n[0],t[0]**n[1],t[1]**n[0],t[1]**n[1]);let e=n[0];return Number.isInteger(e)&&e===n[1]?e===0?[Z(t)?0:1,1]:e%2?l(t[0]**e,t[1]**e):Z(t)?[0,Math.max(t[0]**e,t[1]**e)]:j(t[1]**e,t[0]**e):z}function un(t,n=yt){let e=Math.floor(t[0]/n)*n;return[t[0]-e,t[1]-e]}var c={add:(...t)=>l(q(t.map(n=>n[0])),q(t.map(n=>n[1]))),sub:(t,n)=>n!==void 0?l(t[0]-n[1],t[1]-n[0]):l(-t[1],-t[0]),mul:(t,...n)=>(n.length>1&&(n=[c.mul(...n)]),j(t[0]*n[0][0],t[0]*n[0][1],t[1]*n[0][0],t[1]*n[0][1])),div:(t,n)=>Z(n)?sn:j(t[0]/n[0],t[0]/n[1],t[1]/n[0],t[1]/n[1]),abs:t=>Z(t)?l(0,Math.max(-t[0],t[1])):j(Math.abs(t[0]),Math.abs(t[1])),round:t=>l(Math.round(t[0]),Math.round(t[1])),floor:t=>l(Math.floor(t[0]),Math.floor(t[1])),ceil:t=>l(Math.ceil(t[0]),Math.ceil(t[1])),max:(...t)=>l(Math.max(...t.map(n=>n[0])),Math.max(...t.map(n=>n[1]))),min:(...t)=>l(Math.min(...t.map(n=>n[0])),Math.min(...t.map(n=>n[1]))),mod:(t,n)=>{if(X(t)||X(n))return z;let e=t[0]/(t[0]<0?n[0]:n[1]);return e=e<0?Math.ceil(e):Math.floor(e),c.sub(t,c.mul(n,[e,e]))},lcm:(...t)=>j(k(...t.map(n=>n[0]))),gcd:(...t)=>j(_(...t.map(n=>n[0]))),gcf:(...t)=>c.gcd(...t),sup:(t,n)=>vt(t,n),log:(t,n)=>(n!==void 0&&c.div(c.log(t),c.log(n)),l(t[0]<=0?-1/0:Math.log(t[0]),Math.log(t[1]))),exp:t=>vt([Math.E,Math.E],t),ln:t=>c.log(t),sqrt:t=>vt(t,[.5,.5]),root:(t,n)=>vt(t,c.div([1,1],n)),sin:t=>c.cos(c.sub(t,[D,D])),cos:t=>X(t)||on(t)?z:Ot(t)>=yt-Number.EPSILON?[-1,1]:(t=un(t),t[0]>Math.PI+Number.EPSILON?c.sub(c.cos(c.sub(t,[Math.PI,Math.PI]))):t[1]<Math.PI-Number.EPSILON?l(Math.cos(t[1]),Math.cos(t[0])):t[1]<yt-Number.EPSILON?l(-1,Math.max(Math.cos(t[1]),Math.cos(t[0]))):l(-1,1)),tan:t=>X(t)||on(t)?z:(t=un(t,Math.PI),t[0]>D+Number.EPSILON&&(t=c.sub(t,[Math.PI,Math.PI])),t[0]<-D+Number.EPSILON||t[1]>D-Number.EPSILON?sn:l(Math.tan(t[0]),Math.tan(t[1]))),sec:t=>c.div([1,1],c.cos(t)),csc:t=>c.div([1,1],c.sin(t)),cot:t=>c.div([1,1],c.tan(t)),cosec:t=>c.csc(t),cotan:t=>c.cot(t),arcsin:t=>X(t)||t[1]<-1||t[0]>1?z:l(t[0]<=-1?-D:Math.asin(t[0]),t[1]>=1?D:Math.asin(t[1])),arccos:t=>X(t)||t[1]<-1||t[0]>1?z:l(t[1]>=1?0:Math.acos(t[1]),t[0]<=-1?Math.PI:Math.acos(t[0])),arctan:t=>l(Math.atan(t[0]),Math.atan(t[1])),sinh:t=>l(Math.sinh(t[0]),Math.sinh(t[1])),cosh:t=>t[1]<0?l(Math.cosh(t[1]),Math.cosh(t[0])):t[0]>0?l(Math.cosh(t[0]),Math.cosh(t[1])):l(1,Math.cosh(Math.max(-t[0],t[1]))),tanh:t=>l(Math.tanh(t[0]),Math.tanh(t[1])),sech:t=>c.div([1,1],c.cosh(t)),csch:t=>c.div([1,1],c.sinh(t)),coth:t=>c.div([1,1],c.tanh(t)),cosech:t=>c.csch(t)},Mt=W("+ \ * \\xD7 \\xB7 / \\xF7 // sup sub subsup"),an=W("sub sup subsup"),$t=\'<mo value="," lspace="0">,</mo>\';function Mn(t,n){return Mt.includes(n)?t instanceof wt?!0:!(t instanceof p)||!Mt.includes(t.fn)?!1:an.includes(t.fn)&&an.includes(n)?!0:Mt.indexOf(n)>Mt.indexOf(t.fn):!1}function pe(t,n,e){return Mn(t,n)?`<mfenced>${e}</mfenced>`:e}function P(t,n){return t instanceof wt||t instanceof p?`<mrow>${n}</mrow>`:n}function cn(t){return t==="2"?"squared":t==="3"?"cubed":`to the power of ${t}`}var p=class extends O{constructor(t,n=[]){super(),this.fn=t,this.args=n}evaluate(t={}){let n=this.args.map(e=>e.evaluate(t));if(this.fn in t){let e=t[this.fn];if(typeof e=="function")return e(...n);if(typeof e=="number"&&n.length===1)return x.mul(e,n[0]);throw f.uncallableExpression(this.fn)}if(this.fn==="+")return x.add(...n);if(this.fn==="\")return x.sub(...n);if(["*","\\xB7","\\xD7"].includes(this.fn))return x.mul(...n);if(this.fn==="/")return x.div(...n);if(this.fn==="sup")return x.sup(...n);if(rt(this.fn))return x[this.fn](...n);if(this.fn==="(")return n[0];throw f.undefinedFunction(this.fn)}interval(t={}){let n=this.args.map(e=>e.interval(t));if(this.fn in t){let e=t[this.fn];if(typeof e=="function")return L(e(...n.map(r=>r[0])),2);if(typeof e=="number"&&n.length===1)return c.mul([e,e],n[0]);if(Array.isArray(e)&&n.length===1)return c.mul(e,n[0]);throw f.uncallableExpression(this.fn)}if(this.fn==="+")return c.add(...n);if(this.fn==="\")return c.sub(...n);if(["*","\\xB7","\\xD7"].includes(this.fn))return c.mul(...n);if(this.fn==="/")return c.div(...n);if(this.fn==="sup")return c.sup(...n);if(rt(this.fn))return c[this.fn](...n);if(this.fn==="(")return n[0];throw f.undefinedFunction(this.fn)}substitute(t={}){return new p(this.fn,this.args.map(n=>n.substitute(t)))}collapse(){return this.fn==="("?this.args[0].collapse():new p(this.fn,this.args.map(t=>t.collapse()))}get simplified(){return this}get variables(){return B(pt(this.args.map(t=>t.variables)))}get functions(){return B([this.fn,...pt(this.args.map(t=>t.functions))])}toString(){let t=this.args.map(n=>Mn(n,this.fn)?`(${n.toString()})`:n.toString());return this.fn==="\"?t.length>1?t.join(" \ "):`\${t[0]}`:this.fn==="sup"?t.join("^"):this.fn==="sub"?t.join("_"):this.fn==="subsup"?`${t[0]}_${t[1]}^${t[2]}`:W("+ * \\xD7 \\xB7 / = < > \ \ \").includes(this.fn)?t.join(` ${this.fn} `):b(this.fn,"(","[","{")?this.fn+this.args.join(", ")+Nt[this.fn]:b(this.fn,"!","%")?t[0]+this.fn:`${this.fn}(${t.join(", ")})`}toMathML(t={}){let n=this.args.map(i=>i.toMathML(t)),e=this.args.map((i,s)=>pe(i,this.fn,n[s]));if(this.fn in t){let i=n.map((s,o)=>({toString:()=>s,val:this.args[o]}));return t[this.fn](...i)}if(this.fn==="\")return e.length>1?e.join(\'<mo value="\">\</mo>\'):`<mo rspace="0" value="\">\</mo>${e[0]}`;if(b(this.fn,"+","=","<",">","\","\","\")){let i=mn(this.fn);return e.join(`<mo value="${i}">${i}</mo>`)}if(b(this.fn,"*","\\xD7","\\xB7")){let i=e[0];for(let s=1;s<e.length-1;++s){let o=this.args[0]instanceof st&&this.args[1]instanceof st;i+=(o?\'<mo value="\\xD7">\\xD7</mo>\':"")+e[1]}return i}if(this.fn==="//")return e.join(\'<mo value="/">/</mo>\');if(this.fn==="sqrt")return`<msqrt>${e[0]}</msqrt>`;if(b(this.fn,"/","root")){let i=this.fn==="/"?"mfrac":"mroot",s=this.args.map((o,u)=>P(o,n[u]));return`<${i}>${s.join("")}</${i}>`}if(b(this.fn,"sup","sub")){let i=[P(this.args[0],e[0]),P(this.args[1],n[1])];return`<m${this.fn}>${i.join("")}</m${this.fn}>`}return this.fn==="subsup"?`<msubsup>${[P(this.args[0],e[0]),P(this.args[1],n[1]),P(this.args[2],n[2])].join("")}</msubsup>`:b(this.fn,"(","[","{")?`<mfenced open="${this.fn}" close="${Nt[this.fn]}">${e.join($t)}</mfenced>`:b(this.fn,"!","%")?`${e[0]}<mo value="${this.fn}" lspace="0">${this.fn}</mo>`:this.fn==="abs"?`<mfenced open="|" close="|">${e.join($t)}</mfenced>`:this.fn==="bar"?`<mover>${P(this.args[0],e[0])}<mo value="\">\</mo></mover>`:this.fn==="vec"?`<mover>${P(this.args[0],e[0])}<mo value="\">\</mo></mover>`:`<mi${rt(this.fn)?\' mathvariant="normal"\':""}>${this.fn}</mi><mfenced>${e.join($t)}</mfenced>`}toVoice(t={}){let n=this.args.map(r=>r.toVoice(t)),e=n.join(" ");if(this.fn in t){let r=n.map((i,s)=>({toString:()=>i,val:this.args[s]}));return t[this.fn](...r)}return b(this.fn,"(","[","{")?e:this.fn==="sqrt"?`square root of ${e}`:this.fn==="%"?`${e} percent`:this.fn==="!"?`${e} factorial`:this.fn==="/"?`${n[0]} over ${n[1]}`:this.fn==="//"?`${n[0]} divided by ${n[1]}`:this.fn==="sub"?e:this.fn==="subsup"?`${n[0]} ${n[1]} ${cn(n[2])}`:this.fn==="sup"?`${n[0]} ${cn(n[1])}`:Y[this.fn]?n.join(` ${Y[this.fn]} `):rt(this.fn)?`${this.fn} ${e}`:`${this.fn} of ${e}`}},wt=class extends O{constructor(t){super(),this.items=t}evaluate(t={}){return this.collapse().evaluate(t)}interval(t={}){return this.collapse().interval(t)}substitute(t={}){return this.collapse().substitute(t)}get simplified(){return this.collapse().simplified}get variables(){return B(Ut(...this.items.map(t=>t.variables)))}get functions(){return this.collapse().functions}toString(){return this.items.map(t=>t.toString()).join(" ")}toMathML(t={}){return this.items.map(n=>n.toMathML(t)).join("")}toVoice(t={}){return this.items.map(n=>n.toVoice(t)).join(" ")}collapse(){return Ct(this.items).collapse()}};function It(t,n){if(n===2)return new le(t);if(!(!t||!n)){if(n===1&&t.length>1)return new gn;if(n===3){if(isNaN(+t))throw f.invalidExpression();return new st(+t)}if(n===4)return t in it?new ot(it[t]):t in G?new $(G[t]):new ot(t);if(n===5)return t in G?new $(G[t]):new $(t)}}function de(t){let n=[],e="",r=0;for(let s of t){if(s===\'"\'){let u=r===2?0:2,a=It(e,r);a&&n.push(a),e="",r=u;continue}else if(r===2){e+=s;continue}let o=s.match(/[0-9.]/)?3:oe.includes(s)?4:ce.includes(s)?5:s.match(/\\s/)?1:0;if(!o)throw f.invalidCharacter(s);if(!r||r===3&&o!==3||r===4&&o!==4&&o!==3||r===5&&!(e+s in G)||r===1&&o!==1){let u=It(e,r);u&&n.push(u),e="",r=o}e+=s}let i=It(e,r);return i&&n.push(i),n}function ge(t){return t.length>1?new wt(t):t[0]instanceof $?new wt(t):t[0]}function ve(t,n){let e=[[]];for(let r of t)n(r)?e.push([]):M(e).push(r);return e}function d(t,n){return t instanceof $&&W(n).includes(t.o)}function et(t){return t instanceof p&&t.fn==="("?t.args[0]:t}function Et(t,n){if(d(t[0],n))throw f.startOperator(t[0]);if(d(M(t),n))throw f.endOperator(M(t));for(let e=1;e<t.length-1;++e){if(!d(t[e],n))continue;let r=t[e],i=t[e-1],s=t[e+1];if(i instanceof $)throw f.consecutiveOperators(i.o,r.o);if(s instanceof $)throw f.consecutiveOperators(r.o,s.o);let o=t[e+2];if(n==="^ _"&&d(r,"_ ^")&&d(o,"_ ^")&&r.o!==o.o){let u=t[e+3];if(u instanceof $)throw f.consecutiveOperators(o.o,u.o);let a=[et(i),et(s),et(u)];r.o==="^"&&([a[1],a[2]]=[a[2],a[1]]),t.splice(e-1,5,new p("subsup",a)),e-=4}else{let u=fe[r.o]||r.o,a=[et(i),et(s)];t.splice(e-1,3,new p(u,a)),e-=2}}}function fn(t){return Et(t,"^ _"),Et(t,"/"),ge(t)}function Me(t,n){let e=[[]],r=["\",...(n==null?void 0:n.variables)||[]];for(let i of t){let s=M(e).length?M(e)[0].o:void 0;if(d(i,") ] }")){if(!d(i,Nt[s]))throw f.conflictingBrackets(i.o);let o=e.pop(),u=M(e),a=M(u),v=d(i,")")&&a instanceof ot&&!r.includes(a.i)?u.pop().i:o[0].o,N=ve(o.slice(1),F=>d(F,","));u.push(new p(v,N.map(fn)))}else d(i,"( [ {")?e.push([i]):M(e).push(i)}if(e.length>1)throw f.unclosedBracket(M(e)[0].o);return fn(e[0])}function hn(t,n,e=!1){let r=[],i=[],s=!1;function o(){if(s)throw f.invalidExpression();i.length&&(r.push(i.length>1?new p(n[0],i):i[0]),i=[])}for(let u of t)if(d(u,n)){if(s||!i.length)throw f.invalidExpression();s=!0}else if(u instanceof $)o(),r.push(u),s=!1;else{let a=!e||u instanceof st;if(i.length&&!s&&a)throw f.invalidExpression();i.push(u),s=!1}return o(),r}function Ct(t){if(t=t.filter(e=>!(e instanceof gn)),!t.length)throw f.invalidExpression();let n=t.findIndex(e=>d(e,"= < > \ \"));if(n===0)throw f.startOperator(t[0]);if(n===t.length-1)throw f.endOperator(t[0]);if(n>0){let e=Ct(t.slice(0,n)),r=Ct(t.slice(n+1));return new p(t[n].o,[e,r])}if(d(t[0],"%!"))throw f.startOperator(t[0]);for(let e=0;e<t.length;++e)d(t[e],"%!")&&(t.splice(e-1,2,new p(t[e].o,[t[e-1]])),e-=1);Et(t,"// \\xF7");for(let e=1;e<t.length;++e){let r=t[e];if(r instanceof p&&r.fn==="/"){let i=t[e-1];if(i instanceof st)t.splice(e-1,2,new p("+",[i,r])),e-=1;else if(!(i instanceof $))throw f.consecutiveOperators(i.toString(),r.toString())}}if(t=hn(t,"\\xD7 * \\xB7",!0),d(t[0],"\ \\xB1")&&t.splice(0,2,new p(t[0].o,[t[1]])),Et(t,"\ \\xB1"),d(t[0],"+")&&(t=t.slice(1)),t=hn(t,"+"),t.length>1)throw f.invalidExpression();return t[0]}function we(t,n=!1,e){let r=Me(de(t),e);return n?r.collapse():r}function Ee(t,n){try{let e=B([...t.variables,...n.variables]),r=t.collapse(),i=n.collapse(),s=0;for(let o=0;o<5;++o){let u={};for(let v of e)u[v]=Pt[v]||Math.random()*5;let a=r.evaluate(u),h=i.evaluate(u);if(!(isNaN(a)||isNaN(h))){if(!C(a,h))return!1;s+=1}}return!!s}catch(e){return!1}}var At={numEquals:Ee,parse:mt(we)};var wn=mt(t=>{var n;return(n=At.parse(t))==null?void 0:n.collapse()}),En=new Set(["y","r","\"]),ut=.002,bn=2*Math.PI*5;function xn(t,n,e){let r=(n-t)/e;return Ft(i=>t+e*i,r)}function be(t,n,e=[0,bn],r=ut){return xn(e[0],e[1],r).map(i=>{let s=t.evaluate(ht(ft({},n),{\:i}));return[[s*Math.cos(i),0],[s*Math.sin(i),0]]})}function T(t,n,e,r,i,s,o=ut,u=[]){let a=t.interval(ht(ft({},n),{[e]:i,[r]:s}));if(!Z(a))return u;if(Ot(i)<=o)u.push([i,s]);else{let h=(i[0]+i[1])/2,v=(s[0]+s[1])/2;T(t,n,e,r,[h,i[1]],[v,s[1]],o,u),T(t,n,e,r,[h,i[1]],[s[0],v],o,u),T(t,n,e,r,[i[0],h],[v,s[1]],o,u),T(t,n,e,r,[i[0],h],[s[0],v],o,u)}return u}function xe(t,n,e,r=[-5,5],i=ut){return xn(r[0],r[1],i).map(s=>{let o=[s,s+i],u=t.interval(ht(ft({},n),{[e]:o}));return[o,u]})}function $e(t,n,e,r,i,s,o,u,a,h){let v=Object.keys(n),N=wn(t);for(let m of v)n[m]=wn(n[m]);let F=[r*s,i*s],J=[o*a,u*a],I,R=N;N instanceof p&&N.fn==="="&&(I=N.args[0],R=N.args[1]);let V=I&&I instanceof ot?I.i:void 0;V&&delete n[V];let S=R.unknowns.filter(m=>!v.includes(m)),y=N.unknowns.filter(m=>!v.includes(m)),Q=[],Lt=!1;if(V==="r"&&(S.includes("\")||S.length===0))Q=be(R,n,[0,S.length?bn:2*Math.PI]),Lt=!0;else if(!I&&S.length<=1||V&&V!=="x"&&!S.includes(V)&&!S.includes("y")){let m=S.includes("x")?"x":S[0];En.has(m)||(Q=xe(R,n,m,F,s*ut))}else{let m=s*ut,g=I?new p("\",[I,R]):R;if(y.length===1){let E=y[0];Q=E==="x"?T(g,n,"x","",F,J,m):T(g,n,"",E,F,J,m)}if(y.length===2){let E=y.includes("x")?"x":y.find(w=>!En.has(w)),U=y.includes("y")?"y":y.find(w=>w!==E);(!I||I&&y.some(w=>w==="x"||w==="y"))&&(Q=T(g,n,E,U,F,J,m))}}let A=[],K=!1;for(let[m,g]of Q){if(Number.isNaN(g[0])||Number.isNaN(g[1])||vn(g)||g[0]>J[1]||g[1]<J[0]){K=!1;continue}let E=[m[0]/s,m[1]/s],U=[g[0]/a,g[1]/a];if(Lt){let qt=tt(E[0],r,i)&&tt(U[0],o,u);qt&&A.push(L([E[0]*h,U[0]*h],K?1:2)),K=qt;continue}let w=[nt(E[0],r,i)*h,nt(U[0],o,u)*h],at=[nt(E[1],r,i)*h,nt(U[1],o,u)*h],H=K?M(A):void 0,ct=H?M(H):void 0;K=!0,ct&&C(ct[1],w[1],.2)?A.push([at]):ct&&C(ct[1],at[1],.2)?A.push([w]):H&&H.length>1&&C(H[0][1],at[1],.2)?(H.reverse(),A.push([w])):A.push([w,at])}let $n=A.map(([m,g])=>g?`M${m[0].toFixed(2)} ${-m[1].toFixed(2)}L${g[0].toFixed(2)} ${-g[1].toFixed(2)}`:`L${m[0].toFixed(2)} ${-m[1].toFixed(2)}`).join("");return[e,$n]}onmessage=t=>{let[n,...e]=t.data;if(n==="plot")try{postMessage($e(...e))}catch(r){postMessage([e[1],"[Error] "+r.message])}};})();'],{type:"application/javascript"});this.worker=new Worker(URL.createObjectURL(t))}this.worker.onmessage=t=>{if(!t.data)return;let i=t.data[0],r=this.promises.get(t.data[0]);this.promises.delete(i),!(!r||this.latestPromises.get(r[0])!==i)&&r[1](t.data[1])}}draw(s,t,i,{xMin:r,xMax:o,yMin:n,yMax:a},[l,c]){let p=He();return this.latestPromises.set(s,p),this.worker.postMessage(["plot",t,i,p,r,o,l,n,a,c,gt]),new Promise(u=>this.promises.set(p,[s,u]))}},cc,pi=class extends ${constructor(t,i,r){super(t,i,r);this.showSelectionOutline=!0;this.cannotDragToSelect=!0;this.functions=new Map;this.scatterPlots=new Map;this.steps=[1,1];this.watchers=new Map;this.$fill=h("path",{fill:"transparent"},this.$el),this.$grid=h("path",{class:"axis-gridlines"},this.$el),this.$content=h("g",{},this.$el),this.$axes=h("path",{class:"grid-axis"},this.$el),this.$labels=h("g",{class:"axis-labels"},this.$el),this.$scatter=h("g",{},this.$el),this.$outline=h("rect",{class:"outline active",hidden:!0},this.$el),this.watchPolypadOptions(o=>this.$grid.toggle(o.grid==="none")),this.$handles=[this.makeHandle("c",o=>this.props.xMin=M(Math.round(o.x/gt),-20,0)),this.makeHandle("c",o=>this.props.xMax=M(Math.round(o.x/gt),0,20)),this.makeHandle("c",o=>this.props.yMin=M(Math.round(-o.y/gt),-20,0)),this.makeHandle("c",o=>this.props.yMax=M(Math.round(-o.y/gt),0,20))];for(let o of[2,3])this.$handles[o].css("cursor","ns-resize");t.events.listen(this.$el,{click:o=>this.setAndDrawFocus(o),blurInput:!1,checkIfActive:()=>this.$focusSource!==void 0}),this.makeInPort("main",{connect:o=>{o.from.tile.is("equation")?this.functions.set(o,h("path",{class:"geo-path"},this.$content)):o.from.tile.is("table")&&this.scatterPlots.set(o,[h("g",{},this.$scatter),[]])},message:(o,n)=>{if(n.from.tile.is("equation")){let a=this.functions.get(n);a.css("color",n.from.tile.props.color),this.drawEquation(n.from.tile,a)}else if(o.type==="table"){let a=this.scatterPlots.get(n),l=n.from.tile.props.color==="#bbb"?"#666":n.from.tile.props.color;a[0].setAttr("fill",l),a[1]=o.table,this.drawScatterPoints(a[0],o.table)}},disconnect:o=>{var n,a;o.from.tile.is("equation")?((n=this.functions.get(o))==null||n.remove(),this.functions.delete(o),this.$parent.mathContext.unwatch(this.watchers.get(o.from.tile))):o.from.tile.is("table")&&((a=this.scatterPlots.get(o))==null||a[0].remove(),this.scatterPlots.delete(o))},tileTypes:["table","equation"]}),this.props.watch("xMin xMax yMin yMax xStep yStep arrows",()=>this.redraw()),this.props.watch("color",({color:o})=>{for(let n of[this.$axes,this.$labels])n.setAttr("fill",o);for(let n of[this.$axes,this.$grid])n.setAttr("stroke",o)})}highlight(t=!0){var i;(i=this.$outline)==null||i.toggle(t)}redraw(){var m;let{xMin:t,xMax:i,yMin:r,yMax:o,xStep:n,yStep:a,arrows:l}=this.props,c=gt;this.$handles[0].setCenter({x:t*c,y:0}),this.$handles[1].setCenter({x:i*c,y:0}),this.$handles[2].setCenter({x:0,y:-r*c}),this.$handles[3].setCenter({x:0,y:-o*c}),this.$labels.removeChildren();let p="",u=`M${t*c} 0L${i*c} 0M0 ${-r*c}L0 ${-o*c}`;l!=="none"&&(u+=`M0 ${-o*c-3}l5 8h-10ZM${i*c+3} 0l-8 5v-10Z`),l==="both"&&(u+=`M0 ${o*c+3}l5 -8h-10ZM${-i*c-3} 0l8 5v-10Z`);let f=j.fromString(n),v=j.fromString(a);this.steps=[(f==null?void 0:f.value)||1,(v==null?void 0:v.value)||1];for(let g=t+1;g<i;++g)g&&(u+=`M${g*c} 0L${g*c} 5`,p+=`M${g*c} ${-r*c}L${g*c} ${-o*c}`,h("text",{text:(f==null?void 0:f.multiply(g).toString())||"",x:g*c,y:21},this.$labels));for(let g=r+1;g<o;++g)g&&(u+=`M0 ${-g*c}L-5 ${-g*c}`,p+=`M${t*c} ${-g*c}L${i*c} ${-g*c}`,h("text",{text:(v==null?void 0:v.multiply(g).toString())||"",x:-10,y:-g*c+5,"text-anchor":"end"},this.$labels));this.$axes.setAttr("d",u),this.$grid.setAttr("d",p),this.$fill.draw($1(-o*gt,i*gt,-r*gt,t*gt,15)),this.path=new S(new d(t*gt,-o*gt),(i-t)*gt,(o-r)*gt),(m=this.$outline)==null||m.setRect(this.path);for(let[g,b]of this.functions.entries())this.drawEquation(g.from.tile,b);for(let[g,b]of this.scatterPlots.values())this.drawScatterPoints(g,b);this.transform(),this.$parent.selection.update()}getSnapPoints(){let{xMin:t,xMax:i,yMin:r,yMax:o}=this.props,n=[];for(let a=t;a<=i;++a)for(let l=r;l<=o;++l)n.push(new d(a*gt,-l*gt));return n}getSnapLines(){let{xMin:t,xMax:i,yMin:r,yMax:o}=this.props;return[new dt(new d(t*gt,0),new d(i*gt,0)),new dt(new d(0,-r*gt),new d(0,-o*gt))]}format(t,i){var r;this.$focusSource&&(this.$focusSource.from.tile.props.color=i,(r=this.$focusShadow)==null||r.css("stroke",i),this.$parent.change({changed:[this.$focusSource.from.tile]}))}getX(t){return t/this.steps[0]*gt}getY(t){return t/this.steps[1]*gt}drawEquation(t,i){let r=Je.parse(t.props.expr).collapse(),o=this.$parent.mathContext;o.unwatch(this.watchers.get(t));let n=()=>H(this,null,function*(){let[a,l]=br(r),{error:c,unknowns:p}=o.validate(l);if(this.showErrorIcon(c),c)i.setAttr("d","");else if(p.length>2)this.showErrorIcon({message:"An equation has too many degrees of freedom.",locations:[t]}),i.setAttr("d","");else{cc||(cc=new hc(this.$parent.attr("worker")));let u=yield cc.draw(t,r.toString(),o.serializedEvalContext,this.props,this.steps);i.setAttr("d",u.startsWith("[Error]")?"":u)}});this.watchers.set(t,n),o.watch(r.unknowns,n,!0)}drawScatterPoints(t,i){let r=t.children;for(let o of r)o.hide();for(let o=1;o<i.length;++o){if(i[o].length<2)continue;let n=+i[o][0],a=+i[o][1];if(!Y(n/this.steps[0],this.props.xMin,this.props.xMax,-1e-5)||!Y(a/this.steps[1],this.props.yMin,this.props.yMax,-1e-5))continue;let l=r[o]||h("circle",{r:6},t);l.setAttr("cx",this.getX(n)),l.setAttr("cy",-this.getY(a)),l.show()}}select(){this.$focusSource&&this.blur(),super.select()}blur(){var t;this.$focusSource&&((t=this.$focusShadow)==null||t.hide(),this.$focusSource=void 0,super.blur())}doubleClick(t){this.setAndDrawFocus(t)}setAndDrawFocus(t){var o,n,a;let i=ot(t.event.target);if(i.tagName==="CIRCLE"){let l=i.parent;this.$focusSource=(o=Ed(this.scatterPlots.entries(),([c,[p]])=>l===p))==null?void 0:o[0]}else if(i.hasClass("geo-path"))this.$focusSource=(n=Ed(this.functions.entries(),([l,c])=>c===i))==null?void 0:n[0];else return this.$parent.selection.add(this);this.focus(),this.$focusShadow||(this.$focusShadow=h("path",{class:"chart-shadow"})),this.$el.prepend(this.$focusShadow);let r="";if(this.$focusSource.from.tile.is("equation"))r=this.functions.get(this.$focusSource).attr("d")||"";else if(this.$focusSource.from.tile.is("table")){let l=this.scatterPlots.get(this.$focusSource)[0].children;for(let c of l)r+=Gt(new q(c.center,7))}this.$focusShadow.css("stroke",(a=this.$focusSource)==null?void 0:a.from.tile.props.color),this.$focusShadow.setAttr("d",r),this.$focusShadow.show()}setupAudioTrack(){let t=h("g",{hidden:!0},this.$el),i=h("line",{opacity:.4,"stroke-width":6},t),r=60;this.track=new Qt(this,()=>{i.setAttr("stroke",this.props.color);let{xMin:o,xMax:n,yMin:a,yMax:l}=this.props,c=Array.from(this.functions.entries(),m=>{let g=m[1].attr("d").slice(1).split(/[LM]/).map(x=>x.split(" ").map(k=>+k/gt)),b=new Map;for(let[x,k]of g)b.set(Math.round((x-o)*r),-k*2);return b}),p=Array.from(this.functions.keys(),m=>h("circle",{r:8,fill:m.from.tile.props.color},t));return{beats:c.map(m=>({note:b=>m.get(Math.round(b*r)),time:0,duration:n-o})),step:()=>t.show(),tick:m=>{let g=o+m;i.setLine({x:g*gt,y:-a*gt},{x:g*gt,y:-l*gt});for(let[b,x]of p.entries()){let k=c[b].get(Math.round(m*r));x.toggle(k!==void 0),k!==void 0&&x.setCenter({x:g*gt,y:-k/2*gt})}},end:()=>{for(let m of p)m.remove();t.hide()}}}),this.props.watch("xMin xMax yMin yMax xStep yStep arrows",()=>this.track.stop())}static makeThumbnail(t){let i=h("svg",{width:120,height:120},t);h("path",{d:"M20 4v112M40 4v112M80 4v112M100 4v112M4 20h112M4 40h112M4 80h112M4 100h112",class:"axis-gridlines",stroke:y.bg},i),h("path",{d:"M5 60h112M60 4v112M60 2l4 6h-8ZM118 60l-6 4v-8Z",fill:y.bg,stroke:y.bg,"stroke-width":2},i)}static altText(){return""}};pi.type="axes",pi.defaultProps={xMin:-5,xMax:5,xStep:"1",yMin:-5,yMax:5,yStep:"1",color:y.darkGrey,arrows:"positive"},pi=w([T],pi);O([{id:"x-axis",type:"input",tileTypes:["axes"],label:"X",range:[0,void 0],increment:!0,get:e=>e.props.xStep,set:(e,s)=>{var t;return s.props.xStep=((t=j.fromString(e))==null?void 0:t.clamp(.01).toString())||"1"}},{id:"y-axis",type:"input",tileTypes:["axes"],label:"Y",range:[0,void 0],increment:!0,get:e=>e.props.yStep,set:(e,s)=>{var t;return s.props.yStep=((t=j.fromString(e))==null?void 0:t.clamp(.01).toString())||"1"}}]);var Vd=e=>50*Math.log(e)/Math.log(2),ws=class extends st{constructor(s,t,i){super(s,t,i),this.$el.append(this.$outline);let r=h("path",{class:"polygon-tile",opacity:.3},this.$el),o=h("text",{class:"polygon-label",y:6},this.$el);this.props.watch("value",({value:n})=>{o.textStr=this.value=n,this.setPath(new S(new d(-25,-20),50,Vd(n)).polygon);let a="",l=ls(cs(n).map(c=>Vd(c)));l.pop();for(let c of l)a+=`M-25 ${c-20}h50`;r.setAttr("d",a)})}static makeThumbnail(s){s.setAttr("width",21),s.setAttr("fill",y.blue);let t=h("text",{class:"polygon-label",x:+s.attr("x")+10.5,y:+s.attr("y")+16},s.parent);s.onAttr("props",i=>{let r=Pt(i,{});s.setAttr("height",Math.min(21*Math.log(r.value)/Math.log(2),100)),s.setAttr("aria-label",ws.altText(r)),t.textStr=r.value,t.css("font-size",r.value<99?"":"11px")})}static altText(s){return` ${s.value}`}};ws.type="log-bar",ws.defaultProps={color:y.blue},ws=w([T],ws);var pc={circle:"M-25 0a25,25 0 1 0 50 0a25 25 0 1 0 -50 0",square:"M0 -25L25 0L0 25L-25 0Z",cross:"M25 -9L9 -9L9 -25L-9 -25L-9 -9L-25 -9L-25 9L-9 9L-9 25L9 25L9 9L25 9L25 -9Z",weight:"M24.3,22.1,17.7-6.1A4,4,0,0,0,14-9H8a10.3,10.3,0,0,0,2-6A10,10,0,0,0,0-25,10,10,0,0,0-10-15,10.3,10.3,0,0,0-8-9h-6a4,4,0,0,0-3.7,2.9l-6.6,28.2A2.2,2.2,0,0,0-22,25H22A2.2,2.2,0,0,0,24.3,22.1ZM0-11a4,4,0,0,1-4-4,4,4,0,0,1,4-4,4,4,0,0,1,4,4A4,4,0,0,1,0-11Z",star:"M0 15.7L15.5 23.8L12.5 6.6L25 -5.6L7.7 -8.1L0 -23.8L-7.7 -8.1L-25 -5.6L-12.5 6.6L-15.5 23.8L0 15.7Z",heart:"M3.4,20.8a4.9,4.9,0,0,1-6.7-.1l-.3-.2C-16.7,8.6-25.3.8-25-8.9a13.7,13.7,0,0,1,5.9-10.7A14.4,14.4,0,0,1,0-16.8a14.4,14.4,0,0,1,19.1-2.8A13.7,13.7,0,0,1,25-8.9C25.3.8,16.7,8.6,3.6,20.5Z"},Dd={circle:y.orange,square:y.purple,cross:y.green,weight:y.blue,star:y.yellow,heart:y.red},P1={circle:"",square:"",cross:"",weight:"",star:"",heart:""},$r=class extends st{constructor(s,t,i){super(s,t,i),this.props.color||(this.props.color=Dd[this.props.shape]),this.setPath(),this.props.watch("shape",({shape:r})=>{this.$path.setAttr("d",pc[r]),this.$outline.setAttr("d",pc[r].replace(/ZM.+$/,"Z"))})}static makeThumbnail(s,t){let i=h("svg",{width:36,height:36},s),r=h("path",{d:pc[t.shape],class:"polygon-tile"},i);r.setTransform({x:18,y:18},0,.6),r.setAttr("fill",Dd[t.shape])}static altText(s){return`${P1[s.shape]} `}};$r.type="token",$r=w([T],$r);var se=50,Ld="#585",Od=["r","n","b","q","k","b","n","r"],T1={k:"",q:"",r:"",b:"",n:"",p:""},Rd={k:"M25,37c2,0,9.4,0,12,1.6s2.2,3.7,1.9,6.4H11.1c-.3-2.7.1-5.3,1.9-6.4S23,37,25,37ZM34.3,16.6a13.8,13.8,0,0,0-6.1,1.3l-.9-4h3.8c1.2,0,1.7-1.5,1.7-2.6s-.5-2.6-1.7-2.6H27.8v-3c0-.9-1.7-1.4-2.8-1.4s-2.8.5-2.8,1.4v3H18.9c-1.2,0-1.7,1.6-1.7,2.6s.5,2.6,1.7,2.6h3.8l-.9,4a13.8,13.8,0,0,0-6.1-1.3c-9.8,0-14.3,11.5-3.2,19.1l.8,2.8C16.1,37,23,37,25,37s8.9,0,11.7,1.5l.8-2.8C48.6,28.1,44.1,16.6,34.3,16.6ZM22,30.9s-3.6.2-5.3.5c-2.8-1.7-5.4-4.8-4.6-6.7,1.2-3.8,9.9.3,9.9.3Zm11.3.5c-1.7-.3-5.3-.5-5.3-.5V25c1.6-1.8,8.7-4.1,9.9-.3C38.7,26.6,36.1,29.7,33.3,31.4Z",q:"M25,37c2,0,9.4,0,12,1.6s2.2,3.7,1.9,6.4H11.1c-.3-2.7.1-5.3,1.9-6.4S23,37,25,37ZM40,13.6a4,4,0,0,0-3.4,6.2l-4.9,3.4V14.4c4.5-1.2,3.6-7.8-1.1-7.8a3.9,3.9,0,0,0-2.3,7.2L25,21.9l-3.3-8.1a3.9,3.9,0,0,0-2.3-7.2c-4.7,0-5.6,6.6-1.1,7.8v8.8l-4.9-3.4A4,4,0,0,0,10,13.6a4,4,0,1,0,.6,7.9l6.3,16A55,55,0,0,1,25,37a55,55,0,0,1,8.1.5l6.3-16a4,4,0,1,0,.6-7.9Z",r:"M17.8,20.7a53.4,53.4,0,0,1,14.4,0c2.6-.1,4.8-2,3.8-10.9l-3.7-.5L31.2,13H28l-.5-3.8h-5L22,12.9H18.8L17.7,9.3,14,9.8C13,18.7,15.2,20.6,17.8,20.7ZM25,37c2,0,9.4,0,12,1.6s2.2,3.7,1.9,6.4H11.1c-.3-2.7.1-5.3,1.9-6.4S23,37,25,37ZM25,37c1.7,0,7,0,10.3,1L32.2,20.7a53.4,53.4,0,0,0-14.4,0L14.7,38C18,37,23.3,37,25,37Z",b:"M16.9,37.5A55,55,0,0,1,25,37a53.2,53.2,0,0,1,8,.5,17.4,17.4,0,0,0,1-18.2l-4.6,6.3a2.4,2.4,0,0,1-3.9-2.8L31,15a27.6,27.6,0,0,0-3.8-3.9l1.5-2.6c0-1.1-1.7-2-3.7-2s-3.8.9-3.8,2l1.5,2.6C8.6,23.4,15.3,35.1,16.9,37.5ZM25,37c2,0,9.4,0,12,1.6s2.2,3.7,1.9,6.4H11.1c-.3-2.7.1-5.3,1.9-6.4S23,37,25,37Z",n:"M25,37c2,0,9.4,0,12,1.6s2.2,3.7,1.9,6.4H11.1c-.3-2.7.1-5.3,1.9-6.4S23,37,25,37ZM14.8,26.1c3-2.6,5.5-2.1,9.2-3.7,1.9,3.1-11.9,9.3-9.4,15.6,3.2-1,8.7-1,10.4-1s8.2,0,11.2,1.3c-5.9-8.9,9.4-23.2-10.5-29.5a7.9,7.9,0,0,0-5.2-2.7V9.4L8.4,21.9C11.1,26.9,14.8,26.1,14.8,26.1ZM20.7,15c.1-.5.4-1.4,1.1-1.4h0a2.9,2.9,0,0,1,1,.3.4.4,0,0,1,.1.3,1.9,1.9,0,0,1-.9,1.2l-1.2.2h-.1Z",p:"M25,10.8a6,6,0,0,0-4.1,10.5c-4,1.7-3.7,2.3-3.3,6.5h3.8c-1.6,8.3-9.1,6.4-8.9,15.7h25c.2-9.3-7.3-7.3-8.9-15.7h3.8c.4-4.2.7-4.8-3.3-6.5A6,6,0,0,0,25,10.8Z"};function Id(e,s,t){let{x:i,y:r,tile:o}=s,n=(f,v)=>f>=0&&v>=0&&f<8&&v<8,a=(f,v)=>e.pieces.filter(m=>m.x===f&&m.y===v),l=(f,v,m=!1)=>{let g=e.pieces.filter(b=>b.tile.props.dark===o.props.dark||b.x!==f||b.y!==v).map(b=>b.x===i&&b.y===r&&b.tile.props.dark===o.props.dark?it(U({},b),{x:f,y:v,justJumped:b.justJumped||m}):U({},b));return{newX:f,newY:v,isJump:m,newState:{pieces:g}}};if(o.props.piece==="n")return[[1,-2],[2,-1],[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2]].map(([f,v])=>[i+f,r+v]).filter(([f,v])=>n(f,v)&&!a(f,v).some(m=>m.tile.props.dark===o.props.dark)).map(([f,v])=>l(f,v));let c=[],p=o.props.dark?1:-1;if(o.props.piece==="p"){let f=[[i-1,r+p],[i+1,r+p]].filter(([v,m])=>{let g=a(v,m)[0];return n(v,m)&&g&&g.tile.props.dark!==o.props.dark});if(r===(o.props.dark?4:3)){let v=a(i-1,r)[0];v&&v.tile.props.dark!==o.props.dark&&v.tile.props.piece==="p"&&v.justJumped&&f.push([i-1,r+p]);let m=a(i+1,r)[0];m&&m.tile.props.dark!==o.props.dark&&m.tile.props.piece==="p"&&m.justJumped&&f.push([i+1,r+p])}if(c.push(...f.map(([v,m])=>l(v,m))),t)return c}let u=[];["k","q","r"].includes(o.props.piece)&&u.push([-1,0],[0,1],[1,0],[0,-1]),["k","q","b"].includes(o.props.piece)&&u.push([-1,-1],[1,1],[1,-1],[-1,1]),o.props.piece==="p"&&u.push([0,p]);for(let f of u){let{x:v,y:m}=s,g=7;o.props.piece==="k"&&(g=1),o.props.piece==="p"&&(g=m===(o.props.dark?1:6)?2:1);for(let b=0;b<g&&(v+=f[0],m+=f[1],!!n(v,m));b++){let x=a(v,m)[0];if(x){x.tile.props.dark!==o.props.dark&&o.props.piece!=="p"&&c.push(l(v,m));break}c.push(l(v,m,o.props.piece==="p"&&b===1))}}return c}var xs=class extends ${constructor(t,i,r){super(t,i,r);this.cannotDragToSelect=!0;this.cannotRotate=!0;this.$cells=[];this.$dots=[];for(let o=0;o<8;o++)for(let n=0;n<8;n++){let a=(o*8+n+o)%2?Ld:"#ccc";this.$cells.push(h("rect",{x:n*se,y:o*se,width:se,height:se,fill:a},this.$el)),this.$dots.push(h("circle",{cx:(n+.5)*se,cy:(o+.5)*se,r:16,opacity:.7},this.$el))}this.path=new S(P,se*8,se*8),this.$outline=h("rect",{class:"outline"},this.$el),this.$outline.setRect(this.path),this.hideDots()}getPiecePosition(t){let i=this.relativePosn(t.posn).scale(1/se).floor();return i.x>=0&&i.x<=7&&i.y>=0&&i.y<=7?i:void 0}getCurrentState(){let t=[];for(let i of this.$parent.getTilesOfType("chess-piece")){let r=this.getPiecePosition(i);r&&t.push({x:r.x,y:r.y,tile:i,justJumped:i.justJumped})}return{pieces:t}}moveStart(t=!1){if(super.moveStart(),!t)for(let i of this.getCurrentState().pieces)this.$parent.selection.add(i.tile)}showDots(t){if(this.props.highlight==="off")return;let i=this.getCurrentState(),r=i.pieces.find(n=>n.tile===t),o=Id(i,r,!1);for(let n=0;n<8;n++)for(let a=0;a<8;a++){let l=this.$dots[n*8+a];l.hide();let c=o.find(p=>p.newX===a&&p.newY===n);if(c){if(l.show(),this.props.highlight==="moves")l.setAttr("fill",y.yellow);else if(this.props.highlight==="danger"){let p=!1;for(let u of c.newState.pieces){if(u.tile.props.dark===r.tile.props.dark)continue;let f=Id(c.newState,u,!0);p||(p=f.some(v=>{if(v.newX===a&&v.newY===n)return!0;let m=r.tile.props.dark?1:-1;if(c.isJump&&v.newX===a&&v.newY===n-m)return!0}))}l.setAttr("fill",p?y.red:y.blue)}}}}hideDots(){for(let t of this.$dots)t.hide()}completeMove(t,i){let r=this.getCurrentState(),o=r.pieces.find(a=>a.tile===t);if(!o||o.x===i.x&&o.y===i.y)return;let n=r.pieces.filter(a=>a.tile.props.dark!==o.tile.props.dark&&a.x===o.x&&a.y===o.y&&a!==o);for(let a of n)a.tile.delete();for(let a of r.pieces)a.tile.justJumped=!1;(i.y===6&&o.y===4||i.y===1&&o.y===3)&&o.tile.props.piece==="p"&&(o.tile.justJumped=!0),this.$parent.change({changed:[t],deleted:n.map(a=>a.tile)})}getSnapPoints(){let t=[];for(let i=0;i<=8;i++)for(let r=0;r<=8;r++)t.push(new d(i*se,r*se));return t}reset(t=!1){let i=[],r=[];for(let a of this.getCurrentState().pieces)r.push(a.tile),a.tile.delete();let o=(a,l,c,p)=>{let u=this.posn.add(new d(a+.5,l+.5).scale(se)),f=$.create(this.$parent,{name:"chess-piece",piece:c,dark:p,x:u.x,y:u.y});i.push(f)},n=a=>a==="k"?"k":t?vt.find(["q","r","b","n","p"]):a;for(let a=0;a<8;++a)o(a,0,n(Od[a]),!0),o(a,1,n("p"),!0),o(a,6,n("p"),!1),o(a,7,n(Od[a]),!1);return{added:i,deleted:r}}static makeThumbnail(t){let i=h("svg",{width:124,height:124},t),r=120/8;for(let o=0;o<8;o++)for(let n=0;n<8;n++){let a=(n*8+o+n)%2?Ld:"#ccc";h("rect",{width:r,height:r,x:2+o*r,y:2+n*r,fill:a},i)}}static altText(){return"Chess Board"}static reset(t,i,r=!1){let o=[],n=[];for(let a of t){let l=a.reset(r);o=o.concat(l.added),n=n.concat(l.deleted)}i.change({added:o,deleted:n})}};xs.type="chess-board",xs.defaultProps={layer:"back",highlight:"off"},xs=w([T],xs);O([{id:"hints",type:"select",label:"",tileTypes:["chess-board"],options:[{label:"",key:"off"},{label:"",key:"moves"},{label:"",key:"danger"}],get:e=>e.props.highlight||"off",set:(e,s)=>s.props.highlight=e},{id:"reset",type:"button",label:"",tileTypes:["chess-board"],click:(e,s)=>xs.reset(e,s)},{id:"randomise",type:"button",label:"",tileTypes:["chess-board"],click:(e,s)=>xs.reset(e,s,!0)}]);var Pr=class extends ${constructor(t,i,r){super(t,i,r);this.cannotRotate=!0;this.justJumped=!1;this.path=new S(new d(-se/2,-se/2),se,se),h("path",{path:this.path,fill:"transparent"},this.$el);let o=h("path",{style:"transform: translate(-25px, -25px)"},this.$el);this.$outline=h("path",{class:"outline",path:this.path},this.$el),this.props.color||(this.props.color=this.props.dark?"#333":"#eee"),this.props.watch("piece",({piece:n})=>o.setAttr("d",Rd[n])),this.props.watch("color dark",({color:n})=>{o.setAttr("fill",n),o.setAttr("stroke",this.props.dark?"white":"#181824")})}get board(){return this.$parent.getTileAt(this.posn,["chess-board"])}down(){var t,i;this.$parent.selection.size>1||(this.startCell=(t=this.board)==null?void 0:t.getPiecePosition(this),(i=this.board)==null||i.showDots(this))}up(){var t;(t=this.board)==null||t.hideDots()}moveEnd(){if(super.moveEnd(),this.$parent.selection.size>1)return;let t=this.board;t&&this.startCell&&(t.completeMove(this,this.startCell),this.$parent.selection.tiles.delete(this),setTimeout(()=>this.$parent.selection.tiles.add(this))),this.startCell=void 0}static makeThumbnail(t,i){let r=h("svg",{width:40,height:40,viewBox:"0 0 50 50"},t),o=Rd[i.piece],n=i.dark?"#333":"#ddd",a=i.dark?"#fff":"#181824";h("path",{d:o,fill:n,stroke:a},r)}static altText(t){return`${t.dark?"":""} ${T1[t.piece]}`}};Pr.type="chess-piece",Pr=w([T],Pr);var Gd=["hours","minutes","seconds"],S1={hours:"M-3,0-4-29l4-5,4,5L3,0Z",minutes:"M-2,0-3-47l3-5,3,5L2,0",seconds:"M-1,-52L1,-52L1,0L-1,0Z"};function Nd(e,s=75){let t=s-5,i="";for(let a=0;a<60;++a){let l=d.fromPolar(a/30*Math.PI),c=t-(a%5?3:8);i+=`M${l.x*c} ${l.y*c}L${l.x*t} ${l.y*t}`}let r=h("circle",{r:s,class:"polygon-tile"},e);h("circle",{r:t,class:"clock-face"},e);let o=h("path",{d:i,class:"clock-ticks"},e);for(let a=1;a<=12;++a){let l=d.fromPolar((a-3)/6*Math.PI).scale(53).shift(0,5);h("text",{text:a,x:l.x,y:l.y,class:"clock-label"},e)}let n=Gd.map(a=>h("path",{class:"clock-handle",d:S1[a],opacity:a==="hours"?.8:void 0},e));return h("circle",{r:4,class:"spinner"},e),[r,o,...n]}var di=class extends ${constructor(t,i,r){super(t,i,r);this.prevAngle=0;this.currentAngle=0;let o=75;this.path=new q(P,o);let[n,a,...l]=Nd(this.$el,o);this.$hands=l,this.$outline=h("circle",{class:"outline",r:o},this.$el);for(let[c,p]of this.$hands.entries())t.events.listen(p,{start:({posn:u})=>this.prevAngle=this.getPointerAngle(u)%B,move:({posn:u})=>this.handleMoveHand(Gd[c],u),end:()=>t.change({changed:[this]})});this.props.watch("color",({color:c})=>{n.setAttr("fill",c),a.setAttr("stroke",c),l[2].css("fill",c)}),this.props.watch("showSeconds",({showSeconds:c})=>this.$hands[2].toggle(c)),this.update()}applyChange(t){super.applyChange(t),this.props.clock!=="live"&&this.update()}update(){if(this.props.clock==="live"){let t=new Date().getTimezoneOffset()*60,i=-1;this.animation=et(()=>{let r=Math.round(Date.now()/1e3-t);r!==i&&(i=r,this.setTime(r))});for(let r of this.$hands)r.css("pointer-events","none")}else if(this.props.clock==="geared")this.setTime(this.props.ms);else{let{h:t,m:i,s:r}=this.props;this.setHands(t,i,r)}}setTime(t){this.props.clock==="geared"&&(this.props.ms=t);let i=t%60,r=t/60%60,o=t/3600%12;this.setHands(o,r,i)}setHands(t,i,r){Object.assign(this.props,{h:t%12,m:i%60,s:r%60}),this.$hands[2].setTransform(void 0,Math.round(r)/60*B),this.$hands[1].setTransform(void 0,i/60*B),this.$hands[0].setTransform(void 0,t/12*B),this.value=K(t,12)+K(i,60)/60+K(r,60)/3600}delete(){var t;(t=this.animation)==null||t.cancel(),super.delete()}getPointerAngle(t){return this.relativePosn(t).angle()+ht}handleMoveHand(t,i){this.currentAngle=this.getPointerAngle(i)%B,this.prevAngle/B>.75?this.currentAngle/B<.25&&(this.currentAngle+=B):this.prevAngle/B<.25&&this.currentAngle/B>.75&&(this.currentAngle-=B);let r=(this.currentAngle-this.prevAngle)/B;if(this.props.clock==="geared"){let o=r*(t==="hours"?43200:t==="minutes"?3600:60);this.setTime(this.props.ms+o)}else if(this.props.clock==="free"){let{h:o,m:n,s:a}=this.props;t==="hours"?o+=r*12:t==="minutes"?n+=r*60:a+=r*60,this.setHands(o,n,a)}this.currentAngle>=B?this.currentAngle-=B:this.currentAngle<0&&(this.currentAngle+=B),this.prevAngle=this.currentAngle}static makeThumbnail(t,i){let r=h("svg",{width:80,height:80,viewBox:"-80 -80 160 160"},t),[o,n,...a]=Nd(r,75);o.removeClass("polygon-tile"),o.setAttr("fill",i.color),n.setAttr("stroke",i.color),a[2].css("fill",i.color),a[2].setTransform(void 0,57/60*B),a[1].setTransform(void 0,37/60*B),a[0].setTransform(void 0,2.62/12*B)}static altText(t){return t.clock==="live"?"":t.clock==="geared"?"":""}};di.type="clock",di.defaultProps={showSeconds:!0},di=w([T],di);O([{id:"seconds",type:"checkbox",tileTypes:["clock"],label:"",get:e=>!!e.props.showSeconds,set:(e,s)=>s.props.showSeconds=e}]);var dc=3.5,Sr={USD:[{value:1,width:19.05},{value:5,width:21.21},{value:10,width:17.91},{value:25,width:24.26},{value:100,width:26.49}],EUR:[{value:1,width:16.25},{value:2,width:18.75},{value:5,width:21.25},{value:10,width:19.75},{value:20,width:22.25},{value:50,width:24.25},{value:100,width:23.25},{value:200,width:25.75}],GBP:[{value:1,width:20.3},{value:2,width:25.9},{value:5,width:18},{value:10,width:24.5},{value:20,width:21.2},{value:50,width:27.3},{value:100,width:22.4},{value:200,width:28.4}],CAD:[{value:1,width:19.05},{value:5,width:21.2},{value:10,width:18.03},{value:25,width:23.88},{value:50,width:27.13},{value:100,width:26.5},{value:200,width:28}]},Hd=Sr.EUR[0].width*dc,k1=Hd-2;function ba(e){return Object.keys(Sr).map(s=>e.filter(t=>t.props.currency===s)).filter(s=>s.length)}var C1=Zt((e,s)=>{let t=Sr[e].map(n=>n.value).filter(n=>n<s),i=[],r=t.length-1,o=0;for(;o<s&&r>=0;)o+t[r]<=s?(o+=t[r],i.push(t[r])):r-=1;return i});function _d(e){let s=e[0].props.currency,t=e.map(l=>l.props.value),i=_(t),r=Sr[s].map(l=>l.value).filter(l=>l<=i),o=[],n=r.length-1,a=0;for(;a<i&&n>=0;)a+r[n]<=i?(a+=r[n],o.push(r[n])):n-=1;if(!(a!==i||o.sort().join("")===t.sort().join("")))return o}function zd(e,s=!1){s&&(e=e.sort((f,v)=>v-f));let t=e.length,i={};for(let f of e)i[f]=(i[f]||0)+1;let r=Object.values(i),o=r.filter(f=>f>=4).length>1||r.filter(f=>f>=3).length>2||r.some(f=>f>=8)||r.some(f=>f>=5)&&t>10||r.some(f=>f>=4)&&t>12,n=10,a=0,l=-1,c=e.map((f,v)=>{if(!o)return[v%n,Math.floor(v/n)];let m=v>0&&(l+1>=n||f!==e[v-1]);return l=m?0:l+1,a=m?a+1:a,[l,a]}),p=Math.max(...c.map(f=>f[0])),u=Math.max(...c.map(f=>f[1]));return c.map(([f,v],m)=>({value:e[m],posn:new d(f-p/2,v-u/2).scale(k1)}))}function Bd(e,s){let t=`https://mathigon.org/polypad/assets/currency/coins-${s.value}-${e.toLowerCase()}.svg`;return h("image",{width:s.width,height:s.height||s.width,href:t})}function M1(e,s){let t=B/(e===5?4.5:e),i=Math.PI*Math.random(),r=s*.5;return I(o=>{if(e===5&&o===4)return P;let n=t*(Math.random()-.5)/2,a=Math.random()*s*(e===3?.33:.1);return d.fromPolar(t*o+i+n,r+a)},e)}var Tr=class extends ${constructor(t,i,r){super(t,i,r);this.change=C1(this.props.currency,this.props.value),this.value=this.props.value;let o=Sr[this.props.currency].find(n=>n.value===+this.props.value);if(!o.height){let n=o.width*dc/2,a=Bd(this.props.currency,o);a.css("transform",`translate(${-o.width/2}px,${-o.width/2}px) scale(${dc})`),this.$el.append(a),this.$outline=h("circle",{r:n,class:"outline"},this.$el),this.path=new q(P,n);return}}split(){let t=M1(this.change.length,Hd);return this.change.map((i,r)=>{let{x:o,y:n}=this.posn.add(t[r]);return $.create(this.$parent,{name:"currency",value:i,currency:this.props.currency,x:o,y:n,rot:this.rot})})}static makeThumbnail(t,i){let r=Sr[i.currency].find(l=>l.value===i.value),o=!r.height,n=`-1 -1 ${r.width+2} ${(r.height||r.width)+2}`;h("svg",{width:o?60:120,height:60,viewBox:n},t).append(Bd(i.currency,r))}static altText(t){return`${t.value/100} ${t.currency} `}};Tr.type="currency",Tr=w([T],Tr);O([{id:"make-change",type:"button",tileTypes:["currency"],label:"",show:e=>Y(_(e.map(s=>s.change.length)),1,201),click:(e,s)=>{let t=[],i=[];for(let r of e)r.change.length&&(t.push(...r.split()),r.delete(),i.push(r));s.selection.select(t),s.playSound("splitCoins"),s.change({added:t,deleted:i})}},{id:"cash-in",type:"button",tileTypes:["currency"],label:"",show:e=>e.length>1&&ba(e).some(s=>_d(s)),click:(e,s)=>{let t=[],i=[];for(let r of ba(e)){let o=_d(r);if(o){let n=r[0].props.currency,a=S.aroundPoints(r.map(l=>l.posn)).center;for(let l of r)l.delete();i.push(...r);for(let{value:l,posn:c}of zd(o,!0))t.push($.create(s,{name:"currency",value:l,currency:n,x:a.x+c.x,y:a.y+c.y}))}}s.selection.select(t),s.playSound("mergeCoins"),s.change({deleted:i,added:t})}},{id:"organize",type:"button",tileTypes:["currency"],label:"",show:e=>e.length>1&&ba(e).some(s=>s.length>1),click:(e,s)=>{for(let t of ba(e)){if(t.length<=1)return;let i=S.aroundPoints(t.map(n=>n.posn)).center,r=[...t].sort((n,a)=>a.props.value-n.props.value||n.posn.y-a.posn.y||n.posn.x-a.posn.x),o=zd(r.map(n=>n.props.value));for(let[n,a]of r.entries())a.select(),s.selection.tiles.delete(a),s.selection.tiles.add(a),a.animateTo(i.add(o[n].posn))}s.change({changed:e})}}]);var os=["logic-gate","logic-button","logic-switch","logic-bulb","logic-display","logic-speaker","logic-metronome"],wa={and:"M37.3,9H18V41H37.3C47.6,41,56,33.8,56,25S47.6,9,37.3,9Z",buffer:"M25 9L25 41L55 25Z",xor:"M23,41a30.2,30.2,0,0,0,4.6-16A30.2,30.2,0,0,0,23,9h1c13.2,0,26.4,5.1,32,16C50.4,35.9,37.2,41,24,41Zm-2.5,0a26.8,26.8,0,0,0,5.1-16A26.8,26.8,0,0,0,20.5,9H18a25,25,0,0,1,5.6,16A25,25,0,0,1,18,41Z",or:"M24,9H18a25,25,0,0,1,5.6,16A25,25,0,0,1,18,41h6c13.2,0,26.4-5.1,32-16C50.4,14.1,37.2,9,24,9Z"},A1={buffer:[1,([e])=>e],not:[1,([e])=>!e],or:[2,([e,s])=>e||s],nor:[2,([e,s])=>!(e||s)],and:[2,([e,s])=>e&&s],nand:[2,([e,s])=>!(e&&s)],xor:[2,([e,s])=>e?!s:s],xnor:[2,([e,s])=>e?s:!s],t:[1,(e,[s],t)=>s===-1?!t:t],sr:[2,([e,s],t,i)=>e===s?i:e],d:[2,([e],[s,t],i)=>t===1?e:i],jk:[3,([e,s,t],[i,r,o],n)=>r!==1?n:e!==t?e:e?!n:n]};function Fd(e,s){let t=wa[e]||wa[e.slice(1)];if(e==="not"&&(t=wa.buffer),e==="xnor"&&(t=wa.xor),!t){s.addClass("logic-gate");let l=e==="sr"?"Latch":"Flip-flop",c={"font-weight":"bold",fill:"white"};h("text",U({text:e.toUpperCase(),x:38,y:35,"font-size":24},c),s),h("text",U({text:l,x:38,y:55,"font-size":14},c),s);return}h("path",{d:t,fill:"white"},s);let i={stroke:"white","stroke-width":2},r=e[0]==="n"||e==="xnor",o=e.startsWith("x"),n=r?63:50,a=o?22:25;e==="buffer"||e==="not"?(h("line",U({x1:10,y1:25,x2:a,y2:25},i),s),h("line",U({x1:n,y1:25,x2:66,y2:a},i),s),r&&h("circle",U({r:4,cx:58,cy:25,fill:"transparent"},i),s)):(h("line",U({x1:10,y1:16,x2:a,y2:16},i),s),h("line",U({x1:10,y1:34,x2:a,y2:34},i),s),h("line",U({x1:n,y1:25,x2:68,y2:25},i),s),r&&h("circle",U({r:4,cx:59,cy:25,fill:"transparent"},i),s))}var kr=class extends ${constructor(s,t,i){super(s,t,i);let r=["t","sr","d","jk"].includes(this.props.gate),o=r?75:50;this.path=new S(P,75,o);let n=h("rect",{width:75,height:o,rx:5},this.$el);this.$outline=h("rect",{class:"outline",width:75,height:o,rx:5},this.$el),Fd(this.props.gate,this.$el);let[a,l]=A1[this.props.gate],c=le(a,0),p=0;this.makeOutPort("main",{connect:v=>v.enqueueMessage({type:"number",value:p}),location:new d(75,o/2),persistent:!0,highlights:!0,tileTypes:os});let u=(v,m)=>{let g=c.map((x,k)=>k!==v||x===m?0:m?1:-1);c[v]=m;let b=p;p=l(c.map(x=>!!x),g,!!p)?1:0,p!==b&&this.emitMessage("main",{type:"number",value:p})},f=a===1?[0]:a===2?[-.2,.2]:[-.25,0,.25];for(let v=0;v<a;v++)this.makeInPort("in-"+v,{message:m=>{m.type==="number"&&u(v,m.value)},location:[new d(0,o*(.5+f[v])),Math.PI],disconnect:()=>u(v,0),max:1,tileTypes:os}),u(v,0);this.props.color||(this.props.color=r?y.teal:y.green),this.props.watch("color",({color:v})=>n.setAttr("fill",v))}applyChange(s){if("gate"in s)return this.recreate(s);super.applyChange(s)}static makeThumbnail(s,t){let i=["t","sr","d","jk"].includes(t.gate),r=h("svg",{width:55,height:i?55:39,viewBox:`0 0 75 ${i?75:53}`},s),o=i?y.teal:y.green;h("rect",{fill:o,rx:5,width:75,height:i?75:50},r),Fd(t.gate,r)}static altText(s){let t=["t","sr","d","jk"].includes(s.gate),i=s.gate.toUpperCase();return t?`${i} `:`${i} `}};kr.type="logic-gate",kr=w([T],kr);var mo=50,ui=class extends ${constructor(s,t,i){super(s,t,i),this.path=new S(P,mo,mo);let r=h("rect",{rx:5},this.$el);r.setRect(this.path),this.$outline=h("rect",{class:"outline",rx:5},this.$el),this.$outline.setRect(this.path);let o=Qr("audio","#fff",36,{x:9,y:7},this.$el);this.props.sound=this.props.sound.replace("perc","kick").replace("openHat","hihat-open").replace("closedHat","hihat-closed").replace("tomHigh","tom-high").replace("tomLow","tom-low"),this.props.watch("color",({color:l})=>r.setAttr("fill",l)),this.props.watch("sound",({sound:l})=>jo(l)),this.track=new Qt(this);let n=()=>{o.effect("speaker-move"),this.track.playNote(0)},a=0;this.makeInPort("main",{location:[new d(0,mo/2),Math.PI],message:l=>{l.type==="number"&&(l.value===1&&!a&&n(),a=l.value)},disconnect:()=>a=0,max:1,tileTypes:os})}static makeThumbnail(s){let t=h("svg",{width:40,height:44,viewBox:"0 0 50 55",style:"margin:0 16px"},s);h("rect",{fill:y.yellow,rx:5,width:50,height:50},t),Qr("audio","#fff",36,{x:7,y:7},t)}static altText(){return""}};ui.type="logic-speaker",ui.defaultProps={color:y.yellow,sound:"kick"},ui=w([T],ui);var qd="M37.9,37.8,30.5,9.5,25,8,19.5,9.5,12.1,37.8s-.1.6-.1.8A3.3,3.3,0,0,0,15.2,42H34.8A3.3,3.3,0,0,0,38,38.6C38,38.4,37.9,37.8,37.9,37.8ZM16.7,32,22,11.9l3-.8,3,.8L33.3,32Z",fi=class extends ${constructor(t,i,r){super(t,i,r);this.path=new S(P,mo,mo);this.props.running=!1;let o=h("rect",{rx:5},this.$el);o.setRect(this.path),this.$outline=h("rect",{class:"outline",rx:5},this.$el),this.$outline.setRect(this.path),h("path",{d:qd,fill:"white"},this.$el);let n=h("rect",{fill:"white",x:22.5,y:14,width:5,height:22,rx:3,"stroke-width":2,style:"transform-origin:center 100%;transform-box:fill-box;"},this.$el);h("rect",{fill:"white",x:18,y:32,width:14,height:10},this.$el),this.makeOutPort("main",{highlights:!0,location:this.path,persistent:!0,tileTypes:os}),this.props.watch("color",({color:v})=>{o.setAttr("fill",v),n.setAttr("stroke",v)});let a=()=>this.emitMessage("main",{type:"number",value:1}),l=()=>this.emitMessage("main",{type:"number",value:0}),c,p=Date.now(),u,f=()=>{this.props.running&&(Date.now()>=u*1e3+p&&(p=Date.now(),a(),window.setTimeout(l,50),c=window.setTimeout(f,u*1e3)),requestAnimationFrame(f))};this.props.watch("running bpm",()=>{c&&clearTimeout(c),u=60/(this.props.bpm||120),l(),this.props.running&&f(),n.css("animation",this.props.running?`metronome infinite ${u}s ease-in-out`:"")})}static makeThumbnail(t){let i=h("svg",{width:40,height:44,viewBox:"0 0 50 55",style:"margin:0 16px"},t);h("rect",{fill:y.purple,rx:5,width:50,height:50},i),h("path",{d:qd,fill:"white"},i),h("rect",{fill:"white",x:22.5,y:14,width:5,height:22,rx:3,"stroke-width":2,stroke:y.purple},i),h("rect",{fill:"white",x:18,y:32,width:14,height:10},i)}static altText(){return""}};fi.type="logic-metronome",fi.defaultProps={color:y.purple,bpm:120},fi=w([T],fi);O([{id:"play",type:"button",icon:"play",label:"",tileTypes:["logic-metronome"],show:e=>e.every(s=>!s.props.running),click:e=>{for(let s of e)s.props.running=!0}},{id:"pause",type:"button",icon:"pause",label:"",tileTypes:["logic-metronome"],show:e=>e.some(s=>s.props.running),click:e=>{for(let s of e)s.props.running=!1}},{id:"bpm",type:"input",value:"number",label:"",tileTypes:["logic-metronome"],range:[10,200],get:e=>e.props.bpm,set:(e,s)=>s.props.bpm=M(Math.round(+e),1,240)}]);var xt=50,mi=class extends ${constructor(t,i,r){super(t,i,r);this.path=new S(P,xt,xt);let o=h("rect",{rx:5,width:xt,height:xt},this.$el);this.$outline=h("rect",{class:"outline",rx:5,width:xt,height:xt},this.$el),this.$circle=h("circle",{fill:"#0005",cx:xt/2,cy:xt/2,r:8},this.$el),this.makeOutPort("main",{persistent:!0,highlights:!0,tileTypes:os,location:[new d(xt,xt/2),0]}),this.props.watch("color",({color:n})=>o.setAttr("fill",n))}down(){this.$circle.setAttr("fill","white"),this.emitMessage("main",{type:"number",value:1})}up(){this.$circle.setAttr("fill","#0005"),this.emitMessage("main",{type:"number",value:0})}static makeThumbnail(t){let i=h("svg",{width:40,height:44,viewBox:"0 0 50 55",style:"margin:0 16px"},t);h("rect",{fill:y.red,rx:5,width:50,height:50},i),h("circle",{cx:25,cy:25,r:8,fill:"white"},i)}static altText(){return""}};mi.type="logic-button",mi.defaultProps={color:y.red},mi=w([T],mi);var Ud="M30,16H20a9,9,0,0,0,0,18H30a9,9,0,0,0,0-18Z",gi=class extends ${constructor(t,i,r){super(t,i,r);this.path=new S(P,xt,xt),this.$body=h("rect",{rx:5,width:xt,height:xt},this.$el),this.$outline=h("rect",{class:"outline",rx:5,width:xt,height:xt},this.$el),this.$toggle=h("path",{d:Ud,fill:"none","stroke-width":3,style:"transition: stroke .1s"},this.$el),this.$circle=h("circle",{cx:20,cy:xt/2,r:5,style:"transition: transform .1s, fill .1s"},this.$el),this.makeOutPort("main",{connect:o=>o.enqueueMessage({type:"number",value:this.value||0}),location:[new d(xt,xt/2),0],persistent:!0,highlights:!0,tileTypes:os}),this.props.watch("color",({color:o})=>this.$body.setAttr("fill",o)),this.props.watch("state",({state:o})=>this.setState(o))}setState(t=!1){this.value=t?1:0,this.$toggle.css("stroke",t?"white":"#0005"),this.$circle.css("fill",t?"white":"#0005"),this.$circle.css("transform",t?"translate(10px)":""),this.emitMessage("main",{type:"number",value:this.value})}click(){this.props.state=!this.props.state,this.$parent.change({changed:[this]})}static makeThumbnail(t){let i=h("svg",{width:40,height:44,viewBox:"0 0 50 55",style:"margin:0 16px"},t);h("rect",{fill:y.red,rx:5,width:50,height:50},i),h("path",{d:Ud,fill:"none","stroke-width":3,stroke:"white"},i),h("circle",{cx:30,cy:xt/2,r:5,fill:"white"},i)}static altText(){return""}};gi.type="logic-switch",gi.defaultProps={color:y.red},gi=w([T],gi);var Zd="M28,11a3,3,0,1,1-3-3A2.9,2.9,0,0,1,28,11ZM25,36a3,3,0,1,0,3,3A2.9,2.9,0,0,0,25,36ZM8,25a3,3,0,1,0,3-3A2.9,2.9,0,0,0,8,25Zm28,0a3,3,0,1,0,3-3A2.9,2.9,0,0,0,36,25Zm1-7.8A3,3,0,0,1,32.8,13,3,3,0,0,1,37,17.2ZM17.2,32.8a3,3,0,1,0,0,4.2A2.9,2.9,0,0,0,17.2,32.8ZM13,13a3,3,0,0,0,4.2,4.2A3,3,0,0,0,13,13ZM32.8,32.8a3,3,0,1,0,4.2,0A2.9,2.9,0,0,0,32.8,32.8Z",vi=class extends ${constructor(t,i,r){super(t,i,r);this.value=0;this.path=new S(P,xt,xt),this.$path=h("rect",{fill:y.grey,rx:5,width:xt,height:xt},this.$el),this.$outline=h("rect",{class:"outline",rx:5,width:xt,height:xt},this.$el),h("circle",{cx:25,cy:25,r:8,fill:"white"},this.$el),this.$lights=h("path",{d:Zd,fill:"white",hidden:!0},this.$el),this.makeInPort("main",{message:o=>{o.type==="number"&&this.setState(!!o.value)},disconnect:()=>this.setState(!1),location:[new d(0,xt/2),Math.PI],max:1,tileTypes:os}),this.props.watch("color",()=>this.setColor()),this.setState(!1)}setState(t=!1){this.value=t?1:0,this.setColor(),this.$lights.toggle(t)}setColor(){this.$path.css("fill",this.value?this.props.color:y.grey)}static makeThumbnail(t){let i=h("svg",{width:40,height:44,viewBox:"0 0 50 55",style:"margin:0 16px"},t);h("rect",{fill:y.yellow,rx:5,width:50,height:50},i),h("circle",{cx:25,cy:25,r:8,fill:"white"},i),h("path",{d:Zd,fill:"white"},i)}static altText(){return""}};vi.type="logic-bulb",vi.defaultProps={color:y.yellow},vi=w([T],vi);var yi=class extends ${constructor(t,i,r){super(t,i,r);this.path=new S(P,100,100);let o={x:0,y:0,width:100,height:100,rx:10};this.$path=h("rect",U({},o),this.$el),this.$outline=h("rect",it(U({},o),{class:"outline"}),this.$el),this.$number=h("text",{x:50,y:56,fill:"#fff","font-size":58},this.$el),this.$binary=h("text",{x:50,y:82,fill:"#fff","font-size":20,"font-weight":600},this.$el);let n=[0,0,0,0],a=()=>{this.$number.textStr=_(n.map((l,c)=>l*2**c)),this.$binary.text=[...n].reverse().join(" ")};for(let l=0;l<4;l++)this.makeInPort(`bit-${l}`,{location:[new d(0,20+l*20),Math.PI],tileTypes:os,persistent:!0,max:1,disconnect(){n[l]=0,a()},message(c){c.type==="number"&&(n[l]=c.value,a())}});a(),this.props.watch("color",({color:l})=>this.$path.setAttr("fill",l))}static makeThumbnail(t){let i=h("svg",{width:40,height:44,viewBox:"0 0 50 55",style:"margin:0 16px"},t);h("rect",{fill:y.orange,rx:5,width:50,height:50},i),h("text",{x:25,y:35,fill:"#fff","font-size":30,text:"15"},i)}static altText(){return""}};yi.type="logic-display",yi.defaultProps={color:y.orange},yi=w([T],yi);var E1=[-1,1,void 0,-1,0,1,void 0],jd=[0,2,4,5,7,9,11],bi=class extends ${constructor(t,i,r){super(t,i,r);this.$outline1=h("path",{class:"outline"},this.$el),this.$keys=h("g",{stroke:"#000","stroke-width":2},this.$el),this.$labels=h("g",{style:"pointer-events:none;font-size:24"},this.$el),this.$top=h("rect",{fill:"#111",stroke:"#000","stroke-width":2},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.track=new Qt(this),this.$handles=[this.makeHandle("h",o=>{let n=Math.round(o.x/50);n&&(this.setTransform(this.worldPosn(new d(n*50,0))),this.props.assign({width:M(this.props.width-n,7,50),startNote:this.props.startNote+n}))}),this.makeHandle("h",o=>this.props.width=M(Math.round(o.x/50),7,50))],this.$handles[0].css("transform",`translate(-25px,0) rotate(${Math.PI}rad)`),t.events.listen(this.$keys,{down:o=>this.playKey(ot(o.event.target)),move:o=>this.playKey(ot(o.event.target)),up:()=>this.lastKeyPlayed=void 0}),this.props.watch("width startNote musicScale note labels",()=>this.render())}render(){let{width:t,startNote:i,labels:r,musicScale:o,note:n}=this.props;this.$keys.removeChildren(),this.$labels.removeChildren(),this.path=new S(P,t*50,225),this.$top.setRect(new S(P,t*50,25)),this.$handles[1].setTransform({x:t*50,y:0}),this.$outline.setAttr("d",`M0 227v-227h${t*50}v227`),this.$outline1.setAttr("d",`M0 227h${t*50}`),this.transform(),this.$parent.selection.update();for(let a=0;a<t;++a){let l=Math.floor((i+a)/7)*12+jd[K(i+a,7)];h("rect",{x:a*50,y:5,width:50,height:220,rx:3,fill:"white","data-note":l},this.$keys),this.drawLabel(l,l-n,r,o,a*50+25)}for(let a=0;a<t-1;++a){let l=E1[K(i+a,7)];if(l===void 0)continue;let c=Math.floor((i+a)/7)*12+jd[K(i+a,7)]+1;h("rect",{x:a*50+35+l*5,y:5,width:30,height:150,rx:3,fill:"#000","data-note":c,"data-black":1},this.$keys),h("rect",{x:a*50+37+l*5,y:5,width:26,height:140,rx:3,fill:"#333",style:"pointer-events:none"},this.$keys),this.drawLabel(c,c-n,r,o,a*50+50+l*5,!0)}}drawLabel(t,i,r,o,n,a){if(!r||r==="hidden")return;let l=Xr[o],c=K(i,12),p=l.indexOf(c);if(p<0)return;if(r==="color"){let f=c?y.yellow:y.red;return h("circle",{cx:n,cy:a?132:200,r:10,fill:f},this.$labels)}let u=r==="text"?Ko(o,t,this.props.note||0):r==="number"?mt(Math.floor(i/12)*l.length+p):p+1;h("text",{x:n,y:a?136:208,text:u,fill:a?"#fff":"#000"},this.$labels)}playKey(t){if(!(t!=null&&t.data.note))return;let i=+t.data.note;i!==this.lastKeyPlayed&&(this.lastKeyPlayed=i,this.track.playNote(i),t.data.black?t.next.animate({fill:["#555","#333"],height:["148px","140px"]},600):t.animate({fill:["#ccc","#fff"],height:["226px","220px"]},600))}static makeThumbnail(t){let i=h("svg",{width:204,height:70,"stroke-width":2,stroke:"black"},t);h("rect",{x:2,y:2,width:200,height:66,fill:"white"},i);for(let r of[0,1,3,4,5,7,8])h("rect",{x:17+r*20,y:2,width:10,height:40,rx:1},i);h("path",{d:I(r=>`M${2+20*(r+1)},2v66`,9).join("")},i)}};bi.type="piano",bi.defaultProps={width:8,startNote:0,musicScale:"major",note:0,labels:"number",sound:"piano"},bi=w([T],bi);O([{id:"audio-labels",type:"select",tileTypes:["piano"],label:"",location:"music",options:[{label:"",key:"hidden"},{label:"",key:"number"},{label:"",key:"modular"},{label:"",key:"text"},{label:"",key:"color"}],get:e=>e.props.labels||"hidden",set:(e,s)=>s.props.labels=e},{id:"scale",type:"select",tileTypes:["piano"],label:"",location:"music",show:e=>e.every(s=>s.props.labels!=="hidden"),options:[{label:"",key:"major"},{label:"",key:"minor"},{label:"",key:"chromatic"},{label:"",key:"blues"},{label:"",key:"pentatonic"}],get:e=>e.props.musicScale||"major",set:(e,s)=>s.props.musicScale=e},{id:"key",type:"input",tileTypes:["piano"],label:"",location:"music",show:e=>e.every(s=>s.props.labels!=="hidden"),get:e=>Yo(e.props.note),set:(e,s)=>s.props.note=Xo(e)}]);var zt=50,wi=[y.yellow,"#f15e19","#e1343b",y.red,"#8d2ca1","#4e53d0",y.blue,"#0595bf","#0ba27b",y.green,"#7dc410","#ebc000"];function go(...e){if(R.isSafari){for(let s of e)s==null||s.css("transform-box","view-box");setTimeout(()=>{for(let s of e)s==null||s.css("transform-box","fill-box")})}}function V1(e,s,t){if(e==="fraction")return`"${s}"/"${t}"`;let i=s/t;return e==="decimal"?`"${Jt(i,t<9?3:2)}"`:`"${Jt(i*100,1)}%"`}function fc(e,s,t,i,r){let o=h("g",{class:"fraction"},r);if(e!=="fraction"&&t>32)return o;let n=h("g",{style:"font-size:18px;text-anchor:start",class:"equation"},o),a=new Re(n,void 0,0,"",18,!0);a.setValue(V1(e||"fraction",s,t));let l=Math.min(1,.95*Math.min(i.w,i.h)/Math.max(a.root.width+6,a.root.height)),c=i.center.shift(-a.root.width*l/2,-a.root.height*l/2);return n.css("transform",`translate(${c.x}px, ${c.y}px)`+(l!==1?` scale(${l})`:"")),o}function uc(e,s,t,i,r,o="fraction"){let n=h("path",{fill:r,path:e,class:"polygon-tile"});return i.prepend(n),o==="hidden"?[n]:[n,fc(o,s,t,e,i)]}function*Wd(e,s,t=zt,i=-zt/2,r=-zt/2){let{denominator:o,count:n,active:a,color:l,labels:c,size:p,combine:u}=e,f=t*(p!=null?p:10)/o,v=new d(i,r),m=G.mix("#fff",l,.8).hex;if(u){let g=n-a;a&&(yield uc(new S(v,a*f,t),a,o,s,l,c)),g&&(yield uc(new S(v.shift(a*f,0),g*f,t),g,o,s,m,c));return}for(let g=0;g<n;g+=1){let b=g<a?l:m,x=new S(v.shift(g*f,0),f,t);yield uc(x,1,o,s,b,c)}}function mc(e,s){return G.mixMany(e.map(t=>G.from(t.props.color)),s).hex}var vo=class extends ${constructor(t,i,r){super(t,i,r);this.$parts=[];this.props.color||(this.props.color=wi[(this.props.denominator-1)%wi.length]),this.props.active===void 0&&(this.props.active=this.props.count),this.$wrap=h("g",{},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.$handle=this.makeHandle("h",o=>{let n=this.getHandleCount(o);this.props.active=M(this.props.active===this.props.count?n:this.props.active,0,n),this.props.count=n}),this.setup(),this.props.watch("denominator count active labels combine size",()=>this.redraw()),this.props.watch("color",({color:o,active:n,combine:a})=>{let l=G.mix("#fff",o,.8).hex,c=a?1:n;for(let[p,u]of this.$parts.entries())u[0].setAttr("fill",p<c?o:l);this.$wrap.css("color",G.from(o).brightness<220?"#fff":"#000")})}select(){super.select(),go(...this.$parts.map(t=>t[1]))}deselect(){super.deselect(),go(...this.$parts.map(t=>t[1]))}transform(t){var i;for(let r of this.$parts)(i=r[1])==null||i.css("transform",`rotate(${-this.rot}deg)`);super.transform(t)}changeDenominator(t){let{count:i,active:r,denominator:o}=this.props;for(let n=o+t;t>0?n<=64:n>=1;n+=t){let a=Math.round(i/o*n);if(!E(a,i/o*n))continue;let l=Math.round(r/o*n);if(!E(l,r/o*n))continue;let c=wi[(n-1)%wi.length];this.props.assign({denominator:n,count:a,active:l,color:c});return}}},Cr=class extends vo{setup(){this.$dark=this.makeHandle("h",t=>{let i=(t.x+zt/2)/this.tileWidth;this.props.active=M(Math.round(i),0,this.props.count)})}getHandleCount(t){return M(Math.round((t.x+zt/2)/this.tileWidth),1,120)}redraw(){let{denominator:t,count:i,active:r,size:o}=this.props;this.tileWidth=zt*(o!=null?o:10)/t,this.value=r/t,this.$wrap.removeChildren(),this.$parts=[...Wd(this.props,this.$wrap)],this.path=new S(new d(-zt/2,-zt/2),i*this.tileWidth,zt),this.$outline.draw(this.path),this.$handle.setTransform(new d(i*this.tileWidth-zt/2,-zt/2)),this.$dark.setTransform(new d(r*this.tileWidth-zt/2,zt/2)),this.$dark.setAttr("d",`M0 0V20L${r?-20:20} 0Z`),this.transform(),go(...this.$parts.map(n=>n[1])),this.$parent.selection.update()}getSnapPoints(){let t=[];for(let i=0;i<=this.props.count;i+=1)t.push(new d(i*this.tileWidth-zt/2,-zt/2),new d(i*this.tileWidth-zt/2,zt/2));return t}setupAudioTrack(){let t=h("rect",{y:-zt/2+.5,height:zt-1,opacity:0});this.track=new Qt(this,(i,r)=>{let{combine:o,active:n,color:a}=this.props,l=this.tileWidth/100*(o?n:1),c=I(f=>({note:i,time:f*l,duration:l}),o?1:n),p=f=>{t.setAttr("x",f*this.tileWidth-zt/2);let v=(o?n:1)*this.tileWidth,m={opacity:[.6,1],width:["1px",v+"px"]};t.animate(m,l/r*1e3,0,"linear")},u=()=>t.animate({opacity:0},200);return t.setAttr("fill",je(a)),this.$parts[0][0].insertAfter(t),{beats:c,step:p,end:u}})}split(){if(this.props.count===1)return[];let t=this.props.active,i=I(r=>{let{x:o,y:n}=this.posn.shift(r*this.tileWidth,0).rotate(W(this.rot),this.posn);return $.create(this.$parent,Object.assign({},this.props,{count:1,active:r<t?1:0,x:o,y:n}))},this.props.count);return this.$parent.selection.select(i),this.delete(),i}static makeThumbnail(t){let i=h("svg",{width:222,height:24,style:"color:#fff"},t);t.onAttr("props",r=>{let o=Pt(r),n=wi[o.denominator-1];i.removeChildren(),Array.from(Wd(it(U({},o),{color:n,size:10,active:o.denominator}),i,22,1,1))})}static altText(t){return`1/${t.denominator} `}};Cr.type="fraction-bar",Cr=w([T],Cr);O([{id:"rename",type:"button",tileTypes:["fraction-bar","fraction-circle"],label:"",icon:"fraction-up",click:(e,s)=>{for(let t of e)t.changeDenominator(1);s.change({changed:e})}},{id:"rename",type:"button",tileTypes:["fraction-bar","fraction-circle"],label:"",icon:"fraction-down",click:(e,s)=>{for(let t of e)t.changeDenominator(-1);s.change({changed:e})}},{id:"split",type:"button",tileTypes:["fraction-bar","fraction-circle"],label:"",show:e=>e.some(s=>s.props.count>1)&&e.every(s=>!s.props.combine),click:(e,s)=>{let t=e.flatMap(r=>r.split()||[]),i=e.filter(r=>r.props.count>1);s.change({added:t,deleted:i})}},{id:"labels",type:"select",tileTypes:["fraction-bar","fraction-circle"],location:"more",label:"",options:[{key:"fraction",label:""},{key:"percentage",label:""},{key:"decimal",label:""},{key:"hidden",label:""}],get:e=>e.props.labels||"fraction",set:(e,s)=>s.props.labels=e},{id:"input",type:"input",tileTypes:["fraction-bar"],label:"Scale:",location:"more",value:"number",get:e=>e.props.size||10,set:(e,s)=>s.props.size=M(Math.round(+e),1,20)},{id:"sum",type:"checkbox",label:"",tileTypes:["fraction-bar","fraction-circle"],location:"more",show:e=>e.some(s=>s.props.count>1),get:e=>!e.props.combine,set:(e,s)=>s.props.combine=!e}]);O([{id:"merge",type:"button",tileTypes:["fraction-bar"],label:"",show:e=>e.length>1&&e.every(s=>s.props.denominator===e[0].props.denominator),click:(e,s)=>{let t=Math.min(...e.map(c=>c.posn.x)),i=Math.min(...e.map(c=>c.posn.y)),r=e.map(c=>c.props.count),o=_(r),n=_(e.map(c=>c.props.active)),a=mc(e),l=$.create(e[0].$parent,Object.assign({},e[0].props,{count:o,active:n,color:a,x:t,y:i}));for(let c of e)c.delete();s.selection.add(l),s.change({added:[l],deleted:e})}}]);function gc(e,s,t,i,r,o,n=P,a="fraction",l=1/0){let c=B*e/s,p=new hs(n,n.add(new d(0,-o).rotate(c/e*(t-.5))),c);E(e/s,1)&&(p=p.contract(.001));let u=h("path",{path:p,fill:r,class:"polygon-tile"});if(i.prepend(u),a==="hidden")return[u];let f=Math.min(5*o*e/s,l),v=c/2-Math.PI/s,m=n.add(new d(0,-o*(.88-1.52/(s/e+2))).rotate(v+c*t)).shift(-f/2);return[u,fc(a,e,s,new S(m,f),i)]}var xi=class extends vo{constructor(){super(...arguments);this.rotateAroundOrigin=!0}setup(){this.$handle.css({"transform-origin":"0% 0%",cursor:"move"})}redraw(){let{denominator:t,count:i,color:r,labels:o,combine:n,size:a}=this.props,l=(a!=null?a:2)*50;if(this.value=i/t,this.$wrap.removeChildren(),this.$handle.toggleDOM(t>1),t===1)this.path=new q(P,l),this.$parts=[[h("circle",{r:l,fill:r,class:"polygon-tile"},this.$wrap)]];else{this.$parts=[];let c=B/t;if(this.path=new hs(P,new d(0,-l).rotate(-c/2),i*c),t===i&&(this.path=this.path.contract(.001)),n)this.$parts.push(gc(i,t,0,this.$wrap,r,l,P,o));else for(let p=0;p<i;p+=1)this.$parts.push(gc(1,t,p,this.$wrap,r,l,P,o));this.$handle.setTransform(this.path.end,c*(i-.5))}this.snapAngles=[0,...I(c=>90+(c*360-180)/t,i+1)],this.$outline.draw(this.path),this.transform(),go(...this.$parts.map(c=>c[1])),this.$parent.selection.update()}getHandleCount(t){let{denominator:i,count:r}=this.props,o=360/i,n=270-o/2,a=Vt(Us(t)),l=a>=n?a-n:360-n+a;if(l<=o/2)return r;let c=Math.round(l/o),p=M(c,1,i);return o<120&&Math.abs(p-r)*o>120?r:p}split(){if(this.props.count===1)return;let t=I(i=>{let r=this.rot+360/this.props.denominator*i;return $.create(this.$parent,Object.assign({},this.props,{count:1,rot:r}))},this.props.count);return this.$parent.selection.select(t),this.delete(),t}getSnapPoints(){var n;if(this.props.denominator===1)return super.getSnapPoints();let t=B/this.props.denominator,i=((n=this.props.size)!=null?n:2)*50,r=new d(0,-i).rotate(-t/2),o=I(a=>r.rotate(t*a),this.props.count+1);return[P,...o]}changeDenominator(t){let i=this.props.denominator;super.changeDenominator(t);let{denominator:r,count:o}=this.props;i!==r&&r!==o&&this.setTransform(void 0,this.rot-(1/i-1/r)*180)}setupAudioTrack(){let t=h("path",{},this.$el);this.track=new Qt(this,(i,r)=>{let{denominator:o,count:n,color:a,size:l,combine:c}=this.props,p=o===1?B-.001:B/o,u=p*(c?n:1),f=5*(c?n:1)/o,v=I(b=>({note:i,time:b*f,duration:f}),c?1:n);return t.setAttr("fill",je(a)),this.$parts[0][0].insertAfter(t),{beats:v,step:b=>{let x=d.fromPolar(p*(b-.5)-ht,50*l);o===1&&(x=x.rotate(B/2)),et(k=>{t.draw(new hs(P,x,k*u)),t.css("opacity",rt(.6,1,k))},f/r*1e3)},end:()=>t.animate({opacity:0},200)}})}static makeThumbnail(t){let i=h("svg",{width:80,height:44,style:"color:#fff"},t);t.onAttr("props",r=>{i.removeChildren();let{denominator:o,labels:n}=Pt(r),a=wi[o-1];o===1?h("circle",{cx:40,cy:22,r:20,class:"polygon-tile",fill:a},i):gc(1,o,0,i,a,40,new d(40,42),n,24)})}static altText(t){return`1/${t.denominator} `}};xi.type="fraction-circle",xi.defaultProps={count:1,size:2},xi=w([T],xi);O([{id:"merge",type:"button",tileTypes:["fraction-circle"],label:"",show:e=>e.length>1&&e[0].props.denominator>1&&e.every(s=>s.props.denominator===e[0].props.denominator),click:(e,s)=>H(void 0,null,function*(){let t=e[0].props.denominator,i=e.flatMap(n=>n.split()||n).sort((n,a)=>n.posn.x+n.posn.y-(a.posn.x+a.posn.y)),r=Ms(i,t);s.selection.clear();for(let n of e)for(let a of n.$parts)a[0].css("transition","fill .5s");yield Cs(0);let o=yield Promise.all(r.map(n=>H(void 0,null,function*(){n.sort((u,f)=>u.rot-f.rot);let a=mc(n);for(let u of n)u.props.color=a;let l=d.average(...n.map(u=>u.posn)),c=Math.max(...n.map(u=>d.distance(u.posn,l))),p=n.every((u,f)=>E(u.rot,f*360/t,1));(c>1||!p)&&(yield Promise.all(n.map((u,f)=>u.animateTo(l,void 0,500,f*360/t))));for(let u of n)u.delete();return $.create(s,{name:"fraction-circle",denominator:t,color:a,count:n.length,x:l.x,y:l.y,labels:n[0].props.labels})})));s.selection.select(o),s.change({added:o,deleted:e})})},{id:"input",type:"input",tileTypes:["fraction-circle"],label:"Radius:",location:"more",value:"number",get:e=>e.props.size||2,set:(e,s)=>s.props.size=M(Math.round(+e*2)/2,1,10)}]);var D1=10,L1=1e3,$i=class extends ${constructor(t,i,r){super(t,i,r);let o=h("circle",{class:"polygon-tile"},this.$el);this.$outline=h("circle",{class:"outline"},this.$el);let n=this.makeHandle("c",(a,l)=>{var p;let c=this.relativePosn(((p=this.$parent.snapping.snap([l]))==null?void 0:p.posn)||l);this.props.radius=M(Math.hypot(c.y,c.x),D1,L1)});n.css("cursor","move"),this.props.watch("radius",({radius:a})=>{this.path=new q(P,a),o.setAttr("r",a),this.$outline.setAttr("r",a),n.setTransform(new d(a,0)),this.transform()}),this.props.watch("color",({color:a})=>o.setAttr("fill",a))}static makeThumbnail(t){let i=h("svg",{width:60,height:60},t);h("circle",{cx:30,cy:30,r:22,class:"polygon-tile",fill:y.yellow},i),h("circle",{cx:52,cy:30,r:3,fill:y.bg},i)}};$i.type="circle",$i.defaultProps={color:y.yellow,radius:50},$i=w([T],$i);var O1=[[0,-.2],[1.2,-1],[.6,1],[-.6,1],[-1.2,-.2]],Kd=new D(...O1.map(e=>new d(e[0]*50,e[1]*50))),Pi=class extends st{constructor(t,i,r){super(t,i,r);this.$handles=[];this.showSelectionOutline=!0;this.$outline.css("cursor","crosshair"),this.setPath(Jl(this.props.shape).scale(this.props.scale||1));for(let[a,l]of this.path.points.entries())this.makeVertex(l,a);let o=this.props.scale||1;this.props.watch("scale",({scale:a})=>{if(!E(a||1,o)){for(let[l,c]of this.path.points.entries())this.$handles[l].setCenter(c.scale((a||1)/o));this.updatePath(),o=a||1}});let n;this.$parent.events.listen(this.$outline,{down:({posn:a})=>{var c;(c=this.track)==null||c.stop(),a=this.relativePosn(a);let l=this.path.edges.findIndex(p=>a.distanceFromLine(p)<5);n=this.makeVertex(a,(l+1)%this.$handles.length),this.updatePath()},move:({posn:a})=>{n&&this.moveVertex(n,a)},up:()=>{n&&this.$parent.change({changed:[this]})}})}applyChange(t){"shape"in t&&this.recreate(t),super.applyChange(t)}makeVertex(t,i){if(this.$handles.length>=24)return;let r=this.makeHandle("c",(o,n)=>this.moveVertex(r,n),()=>this.deleteVertex(r));return r.setCenter(t),r.setAttr("r",8),r.css("cursor","move"),this.$handles.splice(i,0,r),r}deleteVertex(t){t.remove(),this.$handles.splice(this.$handles.indexOf(t),1),this.updatePath(),this.$parent.change({changed:[this]})}moveVertex(t,i){var o;let r=(o=this.$parent.snapping.snap([i]))==null?void 0:o.shift;t.setCenter(this.relativePosn(r?i.add(r):i)),this.updatePath()}updatePath(){this.path=new D(...this.$handles.map(t=>t.center)),this.setPath(this.path),this.props.shape=ys(this.path.scale(1/(this.props.scale||1))),this.$parent.selection.update()}flip(t){super.flip(t);for(let i of this.$handles)i.setCenter(i.center.reflect(Pl));this.updatePath()}static makeThumbnail(t){let i=Kd.scale(.38).shift(30),r=h("svg",{width:60,height:60},t);h("path",{class:"polygon-tile",path:i,fill:y.green},r);for(let o of i.points)h("circle",{cx:o.x,cy:o.y,r:3,fill:y.bg},r)}static altText(){return""}};Pi.type="custom-polygon",Pi.defaultProps={color:y.green,shape:ys(Kd)},Pi=w([T],Pi);O([{id:"fix-vertices",type:"button",tileTypes:["custom-polygon"],label:"",click:(e,s)=>{let t=e.map(i=>{let r=new Ie(s,Object.assign({},i.props,{name:"polygon"}));return s.selection.add(r),i.delete(),r});s.change({added:t,deleted:e})}}]);var Yd="M-32.3,6.5,0,84.3H0L32.3,6.5A80.4,80.4,0,0,0,0,0,86.6,86.6,0,0,0-32.3,6.5Z",Xd="M0 0L-101.7 101.7L101.7 101.7Z",Jd="M42.1.1H-42.2l-59.5,59.6A143.4,143.4,0,0,0,0,101.8,143,143,0,0,0,101.7,59.7Z",Qd=[Yd,Yd,"M-42.1,0A288.5,288.5,0,0,0-20.2,110.2a287.6,287.6,0,0,0,62.3,93.3V0Z","M-42.1,0V203.5a289.5,289.5,0,0,0,62.4-93.3A286.5,286.5,0,0,0,42.1,0Z",Xd,Xd,"M0 0L-59.6 59.6L59.6 59.6Z",Jd,Jd],R1=[[66,-17.5],[82,-17.5],[23,-36.5],[125,-36.5],[56,47.3],[92,47.3],[74,101],[41,98],[107,98]],I1={0:1,1:1,2:3,3:2,7:8,8:7},tu=[y.lime,y.teal,y.blue,y.red,y.yellow,y.green,y.grey,y.orange,y.purple],Mr=class extends st{constructor(s,t,i){super(s,t,i),this.props.color||(this.props.color=tu[this.props.index]),this.props.watch("isFlipped index",({isFlipped:r,index:o})=>{let n=Qd[r&&I1[o]||o];this.setPath(new D(...Ws(n)));for(let a of[this.$path,this.$outline])a.setAttr("d",n);this.snapAngles=[0,45,90,135],o<=1&&this.snapAngles.push(22.5,67.5,112.5,157.5)})}static makeThumbnail(s,t){s.setAttr("d",Qd[t.index]);let i=R1[t.index];s.css("transform",`translate(${i[0]}px, ${i[1]}px) rotate(${t.rot}deg) scale(0.5)`),s.setAttr("fill",tu[t.index]),s.css("stroke-width","2px")}static altText(s){return` ${s.index+1}`}};Mr.type="egg",Mr=w([T],Mr);var vc=1/Math.sqrt(3),N1=50/vc,eu=[y.blue,y.purple,y.red,y.orange,y.yellow],Er=D.regular(6,N1).rotate(Math.PI/6);Er.points.splice(3,1);Er.points.splice(2,0,new d(2*Er.points[1].x,Er.points[0].y));var Ar=class extends st{constructor(s,t,i){super(s,t,i),this.props.color||(this.props.color=eu[this.props.index]),this.props.watch("isFlipped index",({isFlipped:r,index:o})=>this.setPath(Er.scale(vc**o),r))}static makeThumbnail(s,t){let i=t.index||0,r=Er.scale(.6*vc**i),o=S.aroundPoints(r.points),n=h("svg",{width:20+o.w,height:20+o.h},s);r=r.shift(10-o.center.x+o.w/2,10-o.center.y+o.h/2),h("path",{class:"polygon-tile",path:r,fill:eu[i]},n)}static altText(s){return` ${s.index+1}`}};Ar.type="fractal",Ar=w([T],Ar);var xa=["M-25,34.4a81.3,81.3,0,0,1,50,0h0A81.1,81.1,0,0,0,40.4-13.1h.1A81.5,81.5,0,0,1,0-42.5H0A81.5,81.5,0,0,1-40.5-13.2h.1A81.1,81.1,0,0,0-25,34.4Z","M-15.4-21.3A80.5,80.5,0,0,1,0-68.8,80.5,80.5,0,0,1,15.4-21.3a80.6,80.6,0,0,1,50,0A80.3,80.3,0,0,1,25,8.1,80.4,80.4,0,0,1,40.4,55.7,80.2,80.2,0,0,1,0,26.3,80.2,80.2,0,0,1-40.4,55.7,80.4,80.4,0,0,1-25,8.1,80.3,80.3,0,0,1-65.4-21.3,80.6,80.6,0,0,1-15.4-21.3Z","M65.4-21.3A80.5,80.5,0,0,1,0,12.1,80.5,80.5,0,0,1-65.4-21.3a80.6,80.6,0,0,1,50,0A80.5,80.5,0,0,1,0-68.8,80.5,80.5,0,0,1,15.4-21.3,80.6,80.6,0,0,1,65.4-21.3Z","M80.9-47.5h0A81.5,81.5,0,0,1,40.4-76.9,80.4,80.4,0,0,0,0-47.5,80.2,80.2,0,0,0-40.5-76.9h0A80.8,80.8,0,0,1-80.9-47.6h0A80.3,80.3,0,0,1-65.5,0,80.3,80.3,0,0,1-80.9,47.5h0A80.8,80.8,0,0,1-40.5,76.9h0A80.2,80.2,0,0,0,0,47.5,80.4,80.4,0,0,0,40.4,76.9,81.5,81.5,0,0,1,80.9,47.6h0A80.3,80.3,0,0,1,65.5,0,80.3,80.3,0,0,1,80.9-47.5Z","M0-47.5A80.3,80.3,0,0,1,15.5,0,80.3,80.3,0,0,1,0,47.5,80.3,80.3,0,0,1-15.5,0,80.3,80.3,0,0,1,0-47.5Z","M130.9,153.8a80.5,80.5,0,0,1,15.4-47.5,80.2,80.2,0,0,1-40.4-29.4A80.1,80.1,0,0,1,90.5,29.4a80.6,80.6,0,0,1-50,0A80.6,80.6,0,0,1,0,0,80.3,80.3,0,0,1-40.4,29.4a80.9,80.9,0,0,1-50.1,0,80.8,80.8,0,0,1-15.4,47.5,80.9,80.9,0,0,1-40.5,29.4,79.9,79.9,0,0,1,15.5,47.5,81.3,81.3,0,0,1,50,0A80.9,80.9,0,0,1,0,72.9a80.9,80.9,0,0,1,80.9,80.9A81.3,81.3,0,0,1,130.9,153.8Z","M40.4-13.2A80.4,80.4,0,0,0,0-42.5,80.7,80.7,0,0,0-40.4-13.1,80.9,80.9,0,0,0-25,34.4a80.6,80.6,0,0,0,50,0A81.2,81.2,0,0,0,40.4-13.2Z","M40.4-13.1A82,82,0,0,1,0-42.5,81.1,81.1,0,0,1-40.5-13.2,81.3,81.3,0,0,1-25,34.4a81.3,81.3,0,0,1,50,0A81.6,81.6,0,0,1,40.4-13.1Z"],su=["M16.2-.3a5.5,5.5,0,0,1-4.4,6.4A5.3,5.3,0,0,1,5.5,1.8,5.4,5.4,0,0,1,9.8-4.6,5.5,5.5,0,0,1,16.2-.3Zm8-8A3.8,3.8,0,0,0,28-4.5a3.7,3.7,0,0,0,3.7-3.8A3.6,3.6,0,0,0,28-12,3.7,3.7,0,0,0,24.2-8.3ZM19,23.4a4.9,4.9,0,0,0,4.8-4.8A4.8,4.8,0,0,0,19,13.9a4.7,4.7,0,0,0-4.7,4.7A4.8,4.8,0,0,0,19,23.4ZM-11.7,6.1A5.3,5.3,0,0,0-5.4,1.8,5.4,5.4,0,0,0-9.7-4.6,5.5,5.5,0,0,0-16.1-.3,5.5,5.5,0,0,0-11.7,6.1ZM-27.9-4.5a3.8,3.8,0,0,0,3.8-3.8A3.7,3.7,0,0,0-27.9-12a3.6,3.6,0,0,0-3.7,3.7A3.7,3.7,0,0,0-27.9-4.5ZM20.9-22A139.9,139.9,0,0,1,3-19.5a1.1,1.1,0,0,1-.1.5L1-15.2V30H-1V-15.2L-2.9-19a1.1,1.1,0,0,1-.1-.5,127,127,0,0,1-17.8-2.6A80.8,80.8,0,0,0,0-41.7,83.3,83.3,0,0,0,20.9-22ZM-3.8-26.7A3.2,3.2,0,0,0-7-30a3.3,3.3,0,0,0-3.3,3.3A3.2,3.2,0,0,0-7-23.5,3.2,3.2,0,0,0-3.8-26.7ZM6.5-30a3.2,3.2,0,0,0-3.2,3.3,3.2,3.2,0,0,0,3.2,3.2,3.2,3.2,0,0,0,3.3-3.2A3.3,3.3,0,0,0,6.5-30ZM-23.7,18.6a4.9,4.9,0,0,0,4.8,4.8,4.8,4.8,0,0,0,4.7-4.8,4.7,4.7,0,0,0-4.7-4.7A4.8,4.8,0,0,0-23.7,18.6Z","M-16.9-4.7l-17.7-6.1a.8.8,0,0,1-.5-.9.8.8,0,0,1,.9-.5L-16.5-6a.7.7,0,0,1,.5.9.7.7,0,0,1-.7.4ZM-24.6-13l9.7,5.4h.3a.9.9,0,0,0,.7-.3.9.9,0,0,0-.3-1l-9.7-5.4a.8.8,0,0,0-1,.2A.8.8,0,0,0-24.6-13ZM-7.8-4.9l5.9,1.2h.5c.2-.1.3-.2.3-.4l.3-1.4a.6.6,0,0,0-.5-.8L-7.2-7.7h-.6l-.3.4-.3,1.4A.8.8,0,0,0-7.8-4.9ZM2.8-2.5a.9.9,0,0,0,.7.6h.2l1.6-.3a1,1,0,0,0,.5-.4.7.7,0,0,0,.1-.5l-1.4-6a.8.8,0,0,0-.9-.6L2-9.4l-.5.3a1.3,1.3,0,0,0-.1.6ZM10.9.4a.7.7,0,0,0-.1-.5L10-1.3a.8.8,0,0,0-1-.2L4,1.9c-.2.1-.3.2-.3.4a.7.7,0,0,0,.1.5L4.6,4a.6.6,0,0,0,.6.3h.4l5-3.4ZM-4.5-1l-1.4-.3a.4.4,0,0,0-.5.1c-.2.1-.3.2-.3.4L-8.2,5.1a.7.7,0,0,0,.5.8l1.4.4h.5a.5.5,0,0,0,.3-.5L-4-.1A.7.7,0,0,0-4.5-1Zm-12.1-.6a.7.7,0,0,0,.7-.6c.1-.4-.2-.7-.6-.8l-11-1.7a.8.8,0,0,0-.8.6c0,.4.2.8.6.8l11,1.7Zm16.1,6H-1c-.2,0-.3.1-.5.3l-.8,1.1a.8.8,0,0,0,.1,1l4.9,3.6.4.2h.1l.4-.3.9-1.1c.2-.4.2-.8-.1-1Zm-9.4,8.8a.7.7,0,0,0-1,.1L-22.2,28.2a.7.7,0,0,0,.1,1l.4.2a.9.9,0,0,0,.6-.3l11.3-15A.6.6,0,0,0-9.9,13.2Zm-11.2,5.6c.2.2.3.3.5.3l.5-.2,8.2-7.6a.7.7,0,0,0,0-1,.8.8,0,0,0-1,0L-21,17.8A.7.7,0,0,0-21.1,18.8Zm14-4.9a.8.8,0,0,0-1,.4L-13,24.2a.6.6,0,0,0,.3.9h.3a.6.6,0,0,0,.6-.4l5-9.9A.8.8,0,0,0-7.1,13.9Zm17.4-.7a.8.8,0,0,0-1-.2.8.8,0,0,0-.2,1L19.9,29.4a.5.5,0,0,0,.5.3h.4a.7.7,0,0,0,.2-1ZM7,14.4A.7.7,0,0,0,6,14a.7.7,0,0,0-.3.9L10.3,25a.8.8,0,0,0,.7.4h.3a.8.8,0,0,0,.3-1Zm4-2.8,7.8,7.8.5.2.5-.2a.7.7,0,0,0,0-1L12,10.6a.7.7,0,0,0-1,1ZM34.4-11.2a.7.7,0,0,0-.8-.5l-18,5.5a.7.7,0,0,0-.4.9.6.6,0,0,0,.6.5c.1,0,.2,0,.2-.1l18-5.4A.7.7,0,0,0,34.4-11.2ZM26.7-4l-11,1.3a.6.6,0,0,0-.6.8.7.7,0,0,0,.7.6h.1l11-1.3c.4,0,.6-.4.6-.8S27.1-4,26.7-4ZM14-7.3h.3l9.8-5.1a.7.7,0,0,0,.3-1,.7.7,0,0,0-.9-.3L13.6-8.6a.8.8,0,0,0-.3,1A.8.8,0,0,0,14-7.3ZM-.5-16.6h0a.7.7,0,0,0,.7-.6L.6-36a.7.7,0,0,0-.7-.7.7.7,0,0,0-.7.7l-.4,18.7A.7.7,0,0,0-.5-16.6Zm3.2,1.2h.2a.7.7,0,0,0,.7-.6L5.7-26.9a.7.7,0,0,0-.5-.8.8.8,0,0,0-.9.6L2.2-16.3A.7.7,0,0,0,2.7-15.4Zm-6.1-.1h.1c.4-.1.7-.5.6-.8l-1.8-11c0-.4-.4-.6-.8-.6a.8.8,0,0,0-.6.8l1.8,11A.9.9,0,0,0-3.4-15.5Z","M60.8-16.2l-3.6-2.5,1.4-3.9-.9-.3-1.3,3.5h0l-9.5,3,2.8-7.8h-1l-3,8.3-9.5,3.1,4.4-11.8H39.5L35-12.5,25.5-9.4l5-14.7H29.4L24.3-9.1l-9.1,3,6-16.3-1.2.3L14-5.7l-1.8.5a50.6,50.6,0,0,0,5.3-16.2l-1.9.6-.4.2L1-9.8v-10L14.4-30.3c0-.4-.1-.8-.1-1.2L1-21.1v-10l11.7-9.1-.3-1.1L1-32.4v-10l8.9-6.9a3,3,0,0,0-.4-1L1-43.7v-10l5.2-4a4.1,4.1,0,0,0-.5-.9l-5.2,4h-1l-5.2-4a4.1,4.1,0,0,0-.5.9l5.2,4v10l-8.5-6.6a3,3,0,0,0-.4,1L-1-42.4v10l-11.4-8.9-.3,1.1L-1-31.1v10L-14.3-31.5c0,.4-.1.8-.1,1.2L-1-19.8v10L-15.2-20.6l-.4-.2-1.9-.6A50.6,50.6,0,0,0-12.2-5.2L-14-5.7l-6-16.4-1.2-.3,6,16.3-9.1-3L-29.4-24h-1.1l5,14.7L-35-12.5l-4.5-12.2h-1.1l4.4,11.8L-45.7-16l-3-8.3h-1l2.8,7.8-9.5-3h0l-1.3-3.5-.9.3,1.4,3.9-3.6,2.5.7.7,3.1-2.2v.2l9.4,3-6.8,4.8.7.7,7.3-5.1,9.6,3.1L-47.3-3.8l.9.6,10.8-7.4,9.5,3.1-13,8.9,1,.5,13.2-9,9.6,3-14.4,10,1.2.4,14.3-9.9h.4l3,1C-9.8-1-8.9.5-7.9,1.9L-18.4,9.4l1.3.3,9.8-7a64.2,64.2,0,0,0,6.6,8H.7a64.2,64.2,0,0,0,6.6-8l9.8,7,1.3-.3L7.9,1.9C8.9.5,9.8-1,10.8-2.6l3-1h.4L28.5,6.3l1.2-.4L15.3-4.1l9.6-3,13.2,9,1-.5-13-8.9,9.5-3.1L46.4-3.2l.9-.6L36.8-11l9.6-3.1L53.7-9l.7-.7-6.8-4.8,9.4-3v-.2l3.1,2.2Zm-76-3.2L-1-8.5V.6l-9.7-7.4A45.9,45.9,0,0,1-15.2-19.4ZM0,8.5A66.6,66.6,0,0,1-9.6-4.7L-1,1.8V6.3a1,1,0,0,0,1,1,1,1,0,0,0,1-1V1.8L9.6-4.7A71,71,0,0,1,0,8.5ZM10.7-6.8,1,.6V-8.5L15.2-19.4A45.9,45.9,0,0,1,10.7-6.8Z","M65-1V1.1A81.6,81.6,0,0,1,40,5c-8.9,0-12.7-.4-20.6-2.9A1,1,0,0,1,18.8.8.9.9,0,0,1,20,.2C27.7,2.7,31.2,3,40,3A79.7,79.7,0,0,0,64.7-.9ZM-64.6,1.1A82.4,82.4,0,0,0-39.4,5c8.8,0,12.6-.4,20.5-2.9A1.2,1.2,0,0,0-18.2.8,1,1,0,0,0-19.5.2C-27.2,2.7-30.7,3-39.4,3A79.9,79.9,0,0,1-64.2-.9H-65V1ZM-45.8,36a6.7,6.7,0,0,1,6.7-6.7A6.7,6.7,0,0,1-32.4,36a6.7,6.7,0,0,1-6.7,6.7A6.7,6.7,0,0,1-45.8,36Zm2,0a4.7,4.7,0,0,0,4.7,4.7A4.7,4.7,0,0,0-34.4,36a4.7,4.7,0,0,0-4.7-4.7A4.7,4.7,0,0,0-43.8,36Zm10.4-71.4a5.7,5.7,0,0,0-5.7-5.7,5.6,5.6,0,0,0-5.7,5.7,5.7,5.7,0,0,0,5.7,5.7A5.8,5.8,0,0,0-33.4-35.4ZM4.9-37.1a2.2,2.2,0,0,0,2.2,2.2,2.2,2.2,0,0,0,2.2-2.2,2.2,2.2,0,0,0-2.2-2.2A2.2,2.2,0,0,0,4.9-37.1ZM38.7,42.7h0A6.8,6.8,0,0,1,32,36a6.7,6.7,0,1,1,6.7,6.7ZM43.4,36a4.7,4.7,0,1,0-4.7,4.7h0A4.7,4.7,0,0,0,43.4,36ZM0,42.9c4.1.7,8.7-9.6,11.4-17.9A78.6,78.6,0,0,0,15.3.3c0-6.7-1.3-13.7-3.2-21.6-.6-1.6-3.4-4.2-5.8-5.1,2.2-2,1.8-2.9,2.3-3.7s.1-3.3,0-3.8c-4.5,1.1-6.3-2.7-4.3-5.5C9-44,19.3-53.3,29-55.2a6.4,6.4,0,0,0,1,1.3,3.1,3.1,0,0,0,1.8.5,2.9,2.9,0,0,0,2.4-1.2h0a3,3,0,0,0-.6-4.2,2.9,2.9,0,0,0-4.2.7,2.6,2.6,0,0,0-.5.9C19-55.4,8.7-46.5,3.6-41.5A33.5,33.5,0,0,1-.2-42.6l-3.7,1.2c-5-4.9-15.3-13.9-25.4-15.8a2.7,2.7,0,0,0-.5-1.1,3,3,0,0,0-4.2-.6,3,3,0,0,0-.6,4.2h0a3,3,0,0,0,2.4,1.2,3.2,3.2,0,0,0,1.8-.6,3.1,3.1,0,0,0,.9-1.1c10.1,2,20.8,11.8,25.2,16.3,1.3,2.5-.4,5.8-4.2,5-.1.6-.5,3,0,4s.6,1.5,2.3,3.5c-2.4.7-6,4-6.3,5.3-1.6,7-3,15.5-3,21.4a78.8,78.8,0,0,0,4,24.7C-8.8,33.3-3.5,43.8,0,42.9Zm-5.2-80a2.2,2.2,0,0,0-2.2-2.2,2.2,2.2,0,0,0-2.2,2.2,2.2,2.2,0,0,0,2.2,2.2A2.2,2.2,0,0,0-5.2-37.1ZM33-35.4a5.8,5.8,0,0,0,5.7,5.7,5.7,5.7,0,0,0,5.7-5.7,5.6,5.6,0,0,0-5.7-5.7A5.7,5.7,0,0,0,33-35.4Z","M.9,33.4v-9l12.7-9.9.3-1.4L.9,23.2v-10l14-10.9V1L.9,12V2L14.5-8.6c0-.3-.1-.7-.1-1.1L.9.8v-10l11.9-9.3a3.6,3.6,0,0,1-.2-1L.9-10.4v-10l9.2-7.1a4.2,4.2,0,0,0-.4-1L.9-21.6v-9.9h0l5.6-4.3L6-36.8.4-32.4H-.4L-6-36.8l-.5.9L-1-31.6a.1.1,0,0,0-.1.1v9.8l-8.6-6.8a4.2,4.2,0,0,0-.4,1l9,7v10l-11.5-9a3.6,3.6,0,0,1-.2,1L-1.1-9.3V.7L-14.4-9.7c0,.4-.1.8-.1,1.1L-1.1,1.9v10L-14.9,1V2.3L-1.1,13.1v10l-12.8-10,.3,1.4,12.5,9.8v9l-9.6-7.5.6,1.8,9,7v4.1a1,1,0,0,0,1,1,.9.9,0,0,0,1-1v-4l9.2-7.1.6-1.7Z","M0,.8A76.2,76.2,0,0,0,7.8,9.9c-1.6,1.9-5.4,7.6-6.6,21.6h-2C-2,17.1-6,11.4-7.6,9.7A72.7,72.7,0,0,0,0,.8ZM124.3,117.2c-6.5,4.7-6.3,16,.5,25.4a30,30,0,0,0,5.8,6,81.7,81.7,0,0,1,8.3-31.1C133.6,114.7,128.1,114.4,124.3,117.2ZM-82.6,86.3A82.8,82.8,0,0,0-104,75l-1.2,1.7A81,81,0,0,1-83.8,87.9a79.9,79.9,0,0,1,17.6,17.7l.3.5,1.3-1.7A81.3,81.3,0,0,0-82.6,86.3Zm47.3-33.1a80,80,0,0,1-3.9-23.7l-1.1.4-.9.2a83.5,83.5,0,0,0,4,23.7A79.9,79.9,0,0,0-25.8,76.6l2-.6-.3-.4A78.4,78.4,0,0,1-35.3,53.2Zm-81,62.7.6-1.9c-11.9-5.1-16.5-10-18.1-12.4a81.4,81.4,0,0,1-11.8,4.9,85.1,85.1,0,0,1,5.8,9.4C-138.6,115.3-132.2,112.1-116.3,115.9ZM-90,30.1a81.7,81.7,0,0,1-.8,11.1c2,.4,8.7,2.3,18.5,13.8l1.7-1.2c-6.9-11.4-7.6-18.1-7.4-20.9A99.4,99.4,0,0,1-90,30.1ZM38,53.8a85.2,85.2,0,0,0,4.1-23.4l-1.8-.5h-.2a81.5,81.5,0,0,1-4,23.4A81.4,81.4,0,0,1,24.6,75.5l-.4.6,2,.7h0A83,83,0,0,0,38,53.8Zm68.4,24.7-.9-1.3-.3-.4a82,82,0,0,1-17.3,17,82,82,0,0,1-22.5,11.3h-.2l1.2,1.7A85.2,85.2,0,0,0,89.1,95.4,81.6,81.6,0,0,0,106.4,78.5ZM70.8,54.6l1.6,1.2c9.9-11.4,16.5-13.4,18.5-13.7a80.8,80.8,0,0,1-.9-12,97.8,97.8,0,0,1-11.9,2.8C78.4,35.1,78.4,42.1,70.8,54.6ZM126.3,152a28,28,0,0,0-3.9-7.7,26.3,26.3,0,0,0-11.9-9.5c-4.6-1.6-8.8-1.3-12,1s-5.5,8.3-4.3,14.4A82.6,82.6,0,0,1,126.3,152Z","M0,4L5,6.6L4,1.1L8.1,-2.9L2.5,-3.7L0,-8.8L-2.5,-3.7L-8.1,-2.9L-4,1.1L-5,6.6Z","M0,4L5,6.6L4,1.1L8.1,-2.9L2.5,-3.7L0,-8.8L-2.5,-3.7L-8.1,-2.9L-4,1.1L-5,6.6Z"],iu=[y.red,y.blue,y.green,y.yellow,y.green,y.teal,y.orange,y.purple],G1=["","","","","","","",""],_1=["-30 -35 60 60","-35 -42 70 70","-35 -60 70 70","-45 -45 90 90","-15 -30 30 60","-75 28 150 100","-30 -35 60 60","-30 -35 60 60"],ru=[.7,.6,.3,.6,.3,.6,.7,.7],Vr=class extends st{constructor(s,t,i){super(s,t,i),this.props.color||(this.props.color=iu[this.props.index]);let r=h("path",{fill:"black"});this.$path.insertAfter(r),this.props.watch("index",({index:o})=>{this.setPath(new D(...Ws(xa[o]))),this.$path.setAttr("d",xa[o]),this.$outline.setAttr("d",xa[o]),r.setAttr("d",su[o]),r.setAttr("opacity",ru[o])})}static makeThumbnail(s,t){let i=t.index,o=h("svg",{width:i===4?40:i===5?120:80,height:80,viewBox:_1[i]},s),n=h("g",{transform:"scale(0.5)"},o);h("path",{d:xa[i],fill:iu[i],class:"polygon-tile"},n),h("path",{d:su[i],fill:"black",opacity:ru[i]},n)}static altText(s){return` ${G1[s.index]}`}};Vr.type="garden",Vr=w([T],Vr);var ou=["M13.9-13.9,2.8-25H-2.8L-25-2.8V2.8L-2.8,25H2.8L13.9,13.9C21.6,6.6,21.6-6.6,13.9-13.9Zm-2.8,25L0,22.2-22.2,0,0-22.2,11.1-11.1A15.8,15.8,0,0,1,11.1,11.1Z","M25-2.8,13.9-13.9c-7.3-7.7-20.5-7.7-27.8,0L-25-2.8V2.8l11.1,11.1c7.3,7.7,20.5,7.7,27.8,0L25,2.8ZM11.1,11.1a15.8,15.8,0,0,1-22.2,0L-22.2,0l11.1-11.1a15.8,15.8,0,0,1,22.2,0L22.2,0Z","M-25-2.8V2.8l11.1,11.1c7.3,7.6,20.5,7.6,27.8,0s7.6-20.5,0-27.8L2.8-25H-2.8ZM15.7,0a15.9,15.9,0,0,1-4.6,11.1,15.8,15.8,0,0,1-22.2,0L-22.2,0,0-22.2,11.1-11.1A15.9,15.9,0,0,1,15.7,0Z","M-25-2.8V2.8L-2.8,25H2.8L25,2.8V-2.8L2.8-25H-2.8Zm25,25L-22.2,0,0-22.2,22.2,0Z","M0-19.7a19.5,19.5,0,0,0-13.9,5.8c-7.6,7.3-7.6,20.5,0,27.8s20.5,7.6,27.8,0C26.3,1.6,17.5-19.7,0-19.7ZM11.1,11.1c-5.8,6.1-16.3,6.1-22.2,0a15.8,15.8,0,0,1,0-22.2,15.8,15.8,0,0,1,22.2,0A15.8,15.8,0,0,1,11.1,11.1Z","M0-19.7a19.5,19.5,0,0,0-13.9,5.8L-25-2.8V2.8l11.1,11.1c7.3,7.6,20.5,7.6,27.8,0C26.3,1.6,17.5-19.7,0-19.7ZM11.1,11.1a15.8,15.8,0,0,1-22.2,0L-22.2,0l11.1-11.1c5.9-6.1,16.4-6.1,22.2,0A15.8,15.8,0,0,1,11.1,11.1Z"],Dr=class extends st{constructor(s,t,i){super(s,t,i),this.props.color||(this.props.color=y.orange),this.setPath(),h("path",{d:ou[this.props.index],fill:"white"},this.$el),h("circle",{r:3,fill:"white"},this.$el),this.$el.append(this.$outline),this.$path.css("stroke-width",".5px")}static makeThumbnail(s,t){let i=h("svg",{width:60,height:60},s);h("rect",{class:"polygon-tile",fill:y.orange,x:5,y:5,width:50,height:50},i),h("path",{d:ou[t.index],fill:"white",transform:"translate(30 30)"},i),h("circle",{r:3,cx:30,cy:30,fill:"white"},i)}static altText(s){return` ${s.index+1}`}};Dr.type="kolam",Dr=w([T],Dr);var cu=25,bo=(1+Math.sqrt(5))/2*cu,$a=Math.sqrt((5+Math.sqrt(5))/2)*cu,yo=bo*(Math.sqrt(5)-1)/2,nu=[[[0,-bo],[$a,-yo],[0,bo],[-$a,-yo]],[[0,2*yo-bo],[$a,yo],[0,-bo],[-$a,yo]]].map(e=>new D(...e.map(s=>new d(s[0],s[1])))),au=["M29.4-30.9C25.3-18.2,13.4-9.5,0-9.5c-13.4,0-25.3-8.6-29.4-21.4M29.4,0C20.8-6.2,10.6-9.5,0-9.5c-10.6,0-20.8,3.3-29.4,9.5","M18.2,15.5C20.1,9.6,19,3.3,15.5-1.7C11.9-6.6,6.1-9.5,0-9.5c-6.1,0-11.9,2.9-15.5,7.9c-3.6,4.9-4.6,11.3-2.7,17.1M18.2-15.5C12.9-11.6,6.5-9.5,0-9.5c-6.5,0-12.9-2.1-18.2-5.9"],lu=[y.red,y.blue],Ti=class extends st{constructor(t,i,r){super(t,i,r);this.symmetric=!0;this.setPath(nu[this.props.index]),this.props.color||(this.props.color=lu[this.props.index]),this.$path.insertAfter(h("path",{d:au[this.props.index],class:"penrose-circles"}))}static makeThumbnail(t,i){let r=i.index||0,o=h("svg",{width:80,height:80,viewBox:"-50 -50 100 100"},t);h("path",{path:nu[r],class:"polygon-tile",fill:lu[r]},o),h("path",{d:au[r],class:"penrose-circles"},o)}static altText(t){return t.index?"":""}};Ti.type="penrose",Ti.defaultProps={index:0},Ti=w([T],Ti);var yc=25/2,hu=[[[0,2],[0,-4],[-2,-4],[-2,4],[2,4],[2,2]],[[0,0],[0,-4],[-2,-4],[-2,2],[0,2],[0,4],[2,4],[2,0]],[[-5,-1],[5,-1],[5,1],[-5,1]],[[-3,-2],[-3,2],[1,2],[1,0],[3,0],[3,-2]],[[3,-2],[3,0],[1,0],[1,-2],[-1,-2],[-1,2],[5,2],[5,-2]],[[-1,-3],[-1,-1],[-3,-1],[-3,3],[-1,3],[-1,1],[1,1],[1,-1],[3,-1],[3,-3]],[[1,1],[1,-3],[-1,-3],[-1,1],[-3,1],[-3,3],[3,3],[3,1]],[[1,-1],[1,-3],[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,1],[3,1],[3,-1]],[[-1,-3],[-1,-1],[-3,-1],[-3,1],[-1,1],[-1,3],[1,3],[1,-1],[3,-1],[3,-3]],[[-4,-2],[-4,0],[-2,0],[-2,2],[0,2],[0,0],[4,0],[4,-2]],[[-1,-3],[-1,1],[-3,1],[-3,3],[1,3],[1,-1],[3,-1],[3,-3]],[[-1,-3],[-1,1],[-5,1],[-5,3],[1,3],[1,-3]],[[-1,2],[1,2],[1,0],[3,0],[3,-2],[-3,-2],[-3,0],[-1,0]],[[-3,2],[-3,0],[-1,0],[-1,-2],[3,-2],[3,0],[1,0],[1,2]],[[-3,2],[-3,-2],[3,-2],[3,0],[-1,0],[-1,2]],[[-2,2],[2,2],[2,-2],[-2,-2]],[[-4,1],[4,1],[4,-1],[-4,-1]]].map(e=>new D(...e.map(s=>new d(s[0]*yc,s[1]*yc)))),z1=[[2,4],[4,4],[5,9],[7,2],[7,6],[11,3],[13,7],[15,3],[17,7],[20,2],[21,5],[23,7],[3,2],[7,2],[5,6],[10,4],[8,7]],pu=[...G.rainbow(12).map(e=>e.hex),y.red,y.blue,y.green,y.yellow,y.purple],B1=["T","S","L","",""],Lr=class extends st{constructor(s,t,i){super(s,t,i),this.props.color||(this.props.color=pu[this.props.index]),this.props.watch("isFlipped index",({isFlipped:r,index:o})=>this.setPath(hu[o],r))}static makeThumbnail(s,t){let i=t.index,r=z1[i];s.draw(hu[i].scale(10/yc).shift(10*r[0],10*r[1]).shift(1,1)),s.setAttr("fill",pu[i])}static altText(s){return s.index<12?` ${s.index+1}`:`${B1[s.index-12]} `}};Lr.type="polyomino",Lr=w([T],Lr);var Si=class extends st{constructor(t,i,r){super(t,i,r);this.$handle=this.makeHandle("c",(o,n,a)=>{var f;let l=1/(this.props.scale||1),c=this.relativePosn(((f=this.$parent.snapping.snap([n]))==null?void 0:f.posn)||n).scale(l),p=+c.x.toFixed(2),u=a.shiftKey?p:+c.y.toFixed(2);this.props.assign({width:p,height:u}),t.selection.update()}),this.$handle.css("cursor","move"),this.props.watch("width height scale",({width:o,height:n,scale:a})=>{this.setPath(new S(P,o,n).scale(a||1).polygon),this.$handle.setCenter(this.path.points[2])})}flip(t){super.flip(t),this.props.width=-this.props.width}static makeThumbnail(t){let i=h("svg",{width:60,height:60},t);h("rect",{class:"polygon-tile",x:8,y:14,width:44,height:32,fill:y.blue},i),h("circle",{cx:52,cy:46,r:3,fill:y.bg},i)}static altText(){return""}};Si.type="rectangle",Si.defaultProps={width:100,height:75,color:y.blue},Si=w([T],Si);var ki=class extends st{constructor(t,i,r){super(t,i,r);this.$handle=this.makeHandle("c",o=>{this.props.sides=M(Math.round(3+13*(o.length-30)/100),3,24),t.selection.update()}),this.$handle.css("cursor","move"),this.props.watch("sides scale",({sides:o,scale:n})=>{let a=D.regular(o,50*jt(o)*(n||1));this.setPath(a),this.$handle.setCenter(a.points[0])})}static makeThumbnail(t){let i=D.regular(6).scale(24).shift(30),r=h("svg",{width:60,height:60},t);h("path",{class:"polygon-tile",path:i,fill:y.red},r),h("circle",{cx:i.points[0].x,cy:i.points[0].y,r:3,fill:y.bg},r)}static altText(t){return` ${t.sides}`}};ki.type="reg-polygon",ki.defaultProps={sides:6,color:y.red},ki=w([T],ki);var H1=[[2,4],[4,2],[6,4],[3,7],[7,2],[4,5],[6,6]],fu=25,du=[[[-4,-2],[0,2],[4,-2]],[[-4,-2],[0,2],[4,-2]],[[-2,0],[0,-2],[2,0],[0,2]],[[-3,1],[1,1],[3,-1],[-1,-1]],[[0,-1],[2,1],[-2,1]],[[0,-1],[2,1],[-2,1]],[[-2,-2],[2,-2],[2,2]]].map(e=>new D(...e.map(s=>new d(...s))).scale(fu)),uu=[y.red,y.blue,y.green,y.yellow,y.orange,y.teal,y.purple],F1=["","","","","","",""],Or=class extends st{constructor(t,i,r){super(t,i,r);this.snapAngles=[0,45,90,135];this.props.color||(this.props.color=uu[this.props.index]),this.props.watch("isFlipped index",({isFlipped:o,index:n})=>this.setPath(du[n],o))}static makeThumbnail(t,i){let r=i.index,o=H1[r];t.draw(du[r].scale(1/fu).rotate(W(i.rot||0)).shift(...o).scale(18).shift(2,2)),t.setAttr("fill",uu[r])}static altText(t){return` ${F1[t.index]}`}getSnapLines(){return this.path.edges}};Or.type="tangram",Or=w([T],Or);var q1=["M34,0a16,16,0,0,1,6.3-12.7l-9-15.7A34.1,34.1,0,0,0,16,0,34.1,34.1,0,0,0,31.3,28.4l9-15.7A16,16,0,0,1,34,0Z","M-25,9.3a33.7,33.7,0,0,0-15.2,3.6l9,15.7A14.4,14.4,0,0,1-25,27.3a16.1,16.1,0,0,1,15.9,14h18A34,34,0,0,0-25,9.3Z","M-25-9.3a33.7,33.7,0,0,1-15.2-3.6l9-15.7A14.4,14.4,0,0,0-25-27.3a16.1,16.1,0,0,0,15.9-14h18A34,34,0,0,1-25-9.3Z","M-8.9,41.3h18A16.1,16.1,0,0,1,25,27.3a14.4,14.4,0,0,1,6.2,1.3l9-15.7A33.9,33.9,0,0,0-8.9,41.3Z","M-31.3-28.4l-9,15.6A65.9,65.9,0,0,1-9.1,41.3h18A83.7,83.7,0,0,0-31.3-28.4Z","M-8.9,41.3h18A65.9,65.9,0,0,1,40.3-12.8l-9-15.6A83.7,83.7,0,0,0-8.9,41.3Z","M-40.3 12.9L-31.3 28.4L40.3 -12.9L31.3 -28.4Z","M-40.2,12.9l9,15.6A65.7,65.7,0,0,1,0,20.6a65.7,65.7,0,0,1,31.2,7.9l9-15.6A82.6,82.6,0,0,0,0,2.6,82.6,82.6,0,0,0-40.2,12.9Z","M31.3,28.4l9-15.6A65.9,65.9,0,0,1,9.1-41.3h-18A83.7,83.7,0,0,0,31.3,28.4Z"],U1=[[6,3,2],[6,4,8],[7,2,5],[7,5,2],[2,6,3],[8,6,4],[5,7,2],[2,7,5],[3,2,6],[4,8,6],[2,5,7],[5,2,7],[0,1,2],[0,2,1]],gu="#242436",Z1=[y.red,y.green,y.yellow];function mu(e,s){let t=U1[e].map((i,r)=>[i,r]).sort((i,r)=>r[0]-i[0]);for(let[i,r]of t)h("path",{d:q1[i],class:"tantrix","stroke-width":2.8,stroke:gu,fill:Z1[r]},s)}var Rr=class extends st{constructor(s,t,i){super(s,t,i),this.setPath(ho["reg-hexagon"]),mu(this.props.index,this.$el)}static makeThumbnail(s,t){let i=h("svg",{width:60,height:60,viewBox:"-54 -54 108 108"},s);h("path",{class:"polygon-tile",path:ho["reg-hexagon"],fill:gu},i),mu(t.index,i)}static altText(s){return` ${s.index+1}`}};Rr.type="tantrix",Rr=w([T],Rr);var Nt=50,Mi=14,j1=`M-${Nt/2} -4.5h${Nt*Mi}v-33h9v75h-9v-33h-${Nt*Mi}v33h-9v-75h9Z`,Ci=class extends ${constructor(t,i,r){super(t,i,r);this.positions=this.props.positions.split(",").map(o=>+o),this.count=this.positions.length,this.path=new S(new d(-Nt/2-9,-Nt/2-12.5),Mi*Nt+18,Nt+25),h("path",{path:this.path,fill:"transparent"},this.$el),h("path",{d:j1,class:"polygon-tile",fill:"#7e7c86"},this.$el),h("path",{path:this.path,class:"outline"},this.$el),this.$beads=this.positions.map(o=>h("circle",{cx:o*Nt,r:Nt/2,class:"polygon-tile"},this.$el)),this.$gradients=this.positions.map(o=>h("circle",{cx:o*Nt,r:Nt/2,class:"bead-gradient"},this.$el));for(let[o,n]of this.$beads.entries())this.setupBead(n,o);this.props.watch("color",({color:o})=>{let n=this.$beads.length/2,a=G.mix("#fff",o,.8);for(let[l,c]of this.$beads.entries())c.setAttr("fill",l<n?o:a)})}applyChange(t){if("positions"in t)return this.recreate(t);super.applyChange(t)}setupBead(t,i){let r=0;this.$parent.events.listen(t,{click:()=>{this.canSelect&&this.$parent.selection.add(this,!this.$parent.events.shiftKey)},start:o=>{r=this.positions[i]-this.relativePosn(o.posn).x/Nt},move:o=>{let n=this.positions[i]=M(r+this.relativePosn(o.posn).x/Nt,i,Mi-(this.count-i)),a=n;for(let c=i+1;c<this.count;++c)this.positions[c]<a+1&&(this.positions[c]=a+1),a=this.positions[c];let l=n;for(let c=i-1;c>=0;--c)this.positions[c]>l-1&&(this.positions[c]=l-1),l=this.positions[c];for(let[c,p]of this.$beads.entries())p.setAttr("cx",this.positions[c]*Nt),this.$gradients[c].setAttr("cx",this.positions[c]*Nt)},end:()=>{this.props.positions=this.positions.map(o=>+o.toFixed(2)).join(","),this.$parent.change({changed:[this]})}})}getSnapPoints(){return[new d(-Nt/2,-25),new d((Mi-.5)*Nt,-25),new d(-Nt/2,25),new d((Mi-.5)*Nt,25),new d(-Nt/2,50),new d((Mi-.5)*Nt,50)]}static makeThumbnail(t){let i=h("svg",{width:240,height:40},t);h("line",{x1:5,y1:18,x2:235,y2:20,stroke:y.bg,"stroke-width":"3px"},i),h("line",{x1:4,y1:3,x2:4,y2:37,stroke:y.bg,"stroke-width":"3px"},i),h("line",{x1:236,y1:3,x2:236,y2:37,stroke:y.bg,"stroke-width":"3px"},i);for(let r=0;r<10;++r){let o=r<5?y.orange:G.mix("#fff",y.orange,.7),n={cx:16+20*r,cy:20,r:10,style:"stroke-width: 0.5px"};h("circle",it(U({},n),{class:"polygon-tile",fill:o}),i),h("circle",it(U({},n),{class:"bead-gradient"}),i)}}static altText(){return""}};Ci.type="abacus",Ci.defaultProps={color:y.orange,positions:"0,1,2,3,4,5,6,7,8,9"},Ci=w([T],Ci);var vu="M-125,0l35,252c0,11,40.3,20,90,20s90-9,90-20L125,0Z",yu=I(e=>new d(e<5?-45:45,65+40*(e%5)),10),W1=new D(new d(-125,0),new d(0,-28),new d(125,0),new d(90,252),new d(0,272),new d(-90,252)),Ai=class extends ${constructor(t,i,r){super(t,i,r);this.path=W1;this.cannotRotate=!0;this.cannotDragToSelect=!0;this.isAnimating=!1;this.tiles=le(void 0,20);h("path",{class:"polygon-tile bucket",d:vu,fill:"#ccc"},this.$el),h("ellipse",{class:"polygon-tile bucket",rx:125,ry:28,fill:"#888"},this.$el),this.$text=h("text",{text:0,class:"bucket-label",y:12},this.$el),this.onMoveEnd=()=>this.recompute(),t.on("change",this.onMoveEnd)}delete(){this.$parent.off("change",this.onMoveEnd),super.delete()}getSnapPoints(){return[]}recompute(){return H(this,null,function*(){var i;if(this.isAnimating)return;let t=[];for(let[r,o]of this.tiles.entries())o&&!Xt(this.$parent.tiles.values(),n=>n===o)&&(this.tiles[r]=void 0);for(let r of this.$parent.getTilesOfType("algebra")){if(!r.props.expr.endsWith("1"))continue;let o=r.props.expr!=="1",n=(i=this.transformed)==null?void 0:i.contains(r.posn),a=this.tiles.indexOf(r);if(a>=0&&!n&&(this.tiles[a]=void 0),!n)continue;if((o?a>=0&&a<10:a>=10)&&(this.tiles[a]=void 0,a=-1),a<0&&(a=this.tiles.findIndex((c,p)=>!c&&(o?p>=10:p<10))),a<0)return;this.tiles[a]=r;let l=yu[a%10].shift(o?15:-15,0).add(this.posn);l.equals(r.posn)||t.push({tile:r,from:r.posn,to:l})}if(this.$text.text=mt(_(this.tiles.map((r,o)=>r?o<10?1:-1:0))),t.length){this.isAnimating=!0,yield et(r=>{var n;let o=wt("quad",r);for(let{tile:a,from:l,to:c}of t){let p=d.interpolate(l,c,o);a.posn=p,a.$el.setTransform(p,W(a.rot)),a.transformed=(n=a.path)==null?void 0:n.translate(p)}this.$parent.selection.update()},240).promise;for(let r of t)r.tile.setTransform(),r.tile.move();this.isAnimating=!1}})}fill(){if(this.isAnimating)return[];let t=[];for(let[i,r]of this.tiles.entries()){if(r)continue;let o=yu[i%10].shift(i<10?-15:15,0).add(this.posn),n=$.create(this.$parent,{name:"algebra",expr:i<10?"1":"-1",x:o.x,y:o.y});this.tiles[i]=n,t.push(n)}return this.$text.text="0",t}static makeThumbnail(t){let i=h("svg",{width:120,height:140,viewBox:"-140 -40 280 320"},t);h("path",{class:"polygon-tile bucket",d:vu,fill:"#ccc",style:"stroke-width: 2px"},i),h("ellipse",{class:"polygon-tile bucket",rx:125,ry:28,fill:"#888",style:"stroke-width: 2px"},i)}static altText(){return""}};Ai.type="bucket",Ai.defaultProps={layer:"back"},Ai=w([T],Ai);O([{id:"fill",type:"button",tileTypes:["bucket"],label:"",click:(e,s)=>{let t=[];for(let i of e)t.push(...i.fill());t.length&&s.change({added:t})}}]);var Dt={1:y.yellow,10:y.blue,100:y.green,1e3:y.purple},_s=50,Pa=e=>e===0?y.grey:e<0?y.red:e<10?Dt[1]:e<100?Dt[10]:e<1e3?Dt[100]:Dt[1e3],K1=e=>e<=25?5:10,Y1=e=>e>300?tt(e**.5,10)*10:e;function bu(e,s,t=0){let i=e.text=mt(s,4),r=M(40/i.length*2,16,32);e.css("font-size",r+"px"),e.setAttr("y",.3*r+26+t)}var Ir=class extends ${constructor(t,i,r){super(t,i,r);this.path=new S(P,50);let o=h("rect",{class:"polygon-tile",rx:6,width:50,height:50},this.$el),n=h("text",{x:25,fill:"white"},this.$el);this.$outline=h("rect",{class:"outline",rx:6,width:50,height:50},this.$el),this.props.watch("value",({value:a})=>{this.value=Jt(a,3),bu(n,a)}),this.props.color||(this.props.color=Pa(this.value)),this.props.watch("color",({color:a})=>o.setAttr("fill",a))}highlight(t=!0){this.$el.setClass("active",t)}move(t){if(super.move(t),!this.$parent.options.mergeTiles||this.$parent.selection.tiles.size>1)return;let i=this.findNearby("number-card",35);this.setCollision(i&&Y(i.value+this.value,-9999,9999)?i:void 0)}collide(t){t.highlight(!1),t.props.value=M(Math.round(t.value+this.value),-9999,9999),t.props.color=Pa(t.value),this.$parent.playSound("click"),this.delete();let i=this.lastSavedData?[this]:void 0;this.$parent.change({changed:[t],deleted:i})}negate(){this.props.value=-this.props.value,this.flipColor(Pa(this.props.value))}split(){if(Math.abs(this.value)<2||!ke(this.value))return;let t=jc(this.value),i=Wc(this.value);this.delete();let r=[],o=i.filter(n=>n!==0).length>1;for(let[n,a]of i.entries()){if(a===0)continue;let l=o?1:a===1?10:a,c=o?a:1,p=a===1&&!o?n-1:n;for(let u=0;u<l;u++){let f=$.create(this.$parent,{name:"number-card",value:t*c*10**p});f.setTransform(this.posn),r.push(f)}}return r}static makeThumbnail(t){let i=h("svg",{width:60,height:60},t),r=h("rect",{x:5,y:5,width:50,height:50,class:"polygon-tile",rx:6},i),o=h("text",{fill:"white",x:30},i);t.onAttr("props",n=>{let a=Pt(n,{value:1}).value;r.setAttr("fill",Pa(M(Math.round(a),-9999,9999))),bu(o,a,5)})}static altText(t){return`${t.value} `}};Ir.type="number-card",Ir=w([T],Ir);function wu(e,s){let t=new Map;for(let c of e)t.has(c.value)||t.set(c.value,{tiles:[],points:[]}),t.get(c.value).tiles.push(c);let i=Array.from(t.keys()).sort((c,p)=>p-c),r=Xt(t.values(),c=>c.tiles.length>100)?_s:0,o=_s,n=0,a=0;for(let c of i){let{tiles:p,points:u}=t.get(c),f=p.length,v=Y1(f),m=K1(f),g=a;for(let Z=0;Z<f;++Z){let Q=0,V=0,N=f<100?Z:Z%v,kt=Math.floor(N/m),Te=N%m;f>=100&&(V=Math.floor(Z/v),Q=Math.floor(N/100)),u.push(new d(g+kt*_s+Q*o,(Te+V*m)*_s+V*o))}let b=Math.floor((f-1)/v),x=Math.min(f-b*v,m),k=Math.ceil(v/m),L=Math.min(f,x)+b*m,A=Math.floor((k-1)/10);a+=_s*k+A*o+r,n=Math.max(n,_s*L+b*o)}a-=r;let l=s.shift(-a/2,-n/2);for(let{tiles:c,points:p}of t.values())for(let[u,f]of c.entries())f.animateTo(p[u].add(l),void 0,300)}O([{id:"merge",type:"button",tileTypes:["number-card"],label:"",show:e=>e.length>1,click:(e,s)=>H(void 0,null,function*(){let t=s.selection.center.shift(-_s/2,-_s/2);s.selection.clear(),yield Promise.all(e.map(r=>r.animateTo(t,void 0,250)));for(let r of e)r.delete();let i=$.create(s,{name:"number-card",value:_(e.map(r=>r.value)),x:t.x,y:t.y});s.selection.add(i),s.playSound("click"),s.change({deleted:e,added:[i]})})},{id:"split",type:"button",tileTypes:["number-card"],label:"",show:e=>e.some(s=>Math.abs(s.value)>1)&&e.every(s=>ke(s.value)),click:(e,s)=>{let t=s.selection.center,i=[],r=[],o=[];s.selection.clear();for(let n of e){let a=n.split();a?(i.push(n),r.push(...a)):o.push(n)}wu([...r,...o],t),s.playSound("draw"),s.change({deleted:i,added:r}),setTimeout(()=>s.selection.select([...r,...o]),300)}},{id:"organize",type:"button",tileTypes:["number-card"],label:"",show:e=>e.length>1,click:(e,s)=>{wu(e,s.selection.center),s.playSound("draw"),s.change({changed:e})}}]);var Bt=25,Ei=class extends ${constructor(t,i,r){super(t,i,r);this.padding=[0,25,25,0];this.$handles=[];this.$tiles=h("g",{},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.$handles[0]=this.makeHandle("h",o=>this.props.width=M(Math.round(o.x/Bt),1,100)),this.$handles[1]=this.makeHandle("v",o=>this.props.height=M(Math.round(o.y/Bt),1,100)),this.$handles[2]=this.makeHandle("c",o=>this.props.base=M(Math.round((o.x+o.y)/2/Bt),2,Math.max(this.props.width,this.props.height))),this.$handles[1].css("cursor","ns-resize"),this.$handles[2].css("cursor","nwse-resize"),this.props.watch("color",({color:o})=>{if(!o)return this.redraw();for(let n of this.$tiles.children)n.setAttr("fill",o)}),this.props.watch("width height base",()=>this.redraw())}redraw(){let{width:t,height:i,base:r}=this.props;this.$tiles.removeChildren();let o=Math.floor(t/r)*r,n=Math.floor(i/r)*r,a=r*Bt;for(let l=0;l<o;l+=r)for(let c=0;c<n;c+=r)this.drawRect(l*Bt,c*Bt,a,a,Dt[100]);for(let l=o;l<t;++l)for(let c=0;c<n;c+=r)this.drawRect(l*Bt,c*Bt,Bt,a,Dt[10]);for(let l=0;l<o;l+=r)for(let c=n;c<i;++c)this.drawRect(l*Bt,c*Bt,a,Bt,Dt[10]);for(let l=o;l<t;++l)for(let c=n;c<i;++c)this.drawRect(l*Bt,c*Bt,Bt,Bt,Dt[1]);this.$handles[0].setTransform({x:t*Bt,y:0}),this.$handles[1].setTransform({x:0,y:i*Bt}),this.$handles[2].setTransform({x:a,y:a}),this.path=new S(P,t*Bt,i*Bt),this.$outline.draw(this.path),this.transform(),this.$parent.selection.update()}drawRect(t,i,r,o,n){h("rect",{x:t,y:i,width:r,height:o,fill:this.props.color||n,class:"polygon-tile"},this.$tiles)}static makeThumbnail(t){let i=h("svg",{width:140,height:80},t),r=(o,n,a,l,c)=>h("rect",{x:5+o,y:5+n,width:a,height:l,fill:c,class:"polygon-tile"},i);for(let o=0;o<2;++o)r(50*o,0,50,50,Dt[100]);for(let o=0;o<3;++o)r(100+10*o,0,10,50,Dt[10]);for(let o=0;o<2;++o)for(let n=0;n<2;++n)r(50*o,50+n*10,50,10,Dt[10]);for(let o=0;o<3;++o)for(let n=0;n<2;++n)r(100+o*10,50+n*10,10,10,Dt[1])}static altText(){return""}};Ei.type="decimal-grid",Ei.defaultProps={width:23,height:12,base:10},Ei=w([T],Ei);var Vi=class extends ${constructor(t,i,r){super(t,i,r);this.cannotRotate=!0;this.cannotDragToSelect=!0;this.cells=[];this.isAnimating=!1;this.$outline=h("rect",{class:"outline",rx:12},this.$el),this.props.watch("base boxes",({base:o,boxes:n})=>this.redraw(o,n)),this.onMove=()=>{let o=Array.from(t.selection.tiles).filter(n=>n.props.name==="dot");for(let n of this.cells)n.hover(o.some(a=>n.contains(a.posn)))},this.onMoveEnd=()=>{for(let o of this.cells)o.hover(!1)},t.on("move-selection",this.onMove),t.on("move-end",this.onMoveEnd),this.onChange=()=>this.rearrangeDots(),setTimeout(()=>{this.rearrangeDots(),t.on("change",this.onChange)}),this.props.watch("labels",({labels:o})=>this.$el.setClass("no-labels",o==="hidden")),this.props.watch("color",({color:o})=>{for(let n of this.cells)n.setColor(o)})}delete(){this.$parent.off("move-selection",this.onMove),this.$parent.off("move-end",this.onMoveEnd),this.$parent.off("change",this.onChange),super.delete()}select(){super.select();for(let t of this.cells)t.hover()}deselect(){super.deselect();for(let t of this.cells)t.hover(!1)}redraw(t,i){if(this.cells.length>i){for(let o=i;o<this.cells.length;++o)this.cells[o].delete();this.cells=this.cells.slice(0,i)}else if(this.cells.length<i)for(let o=this.cells.length;o<i;++o){let n=new bc(this,o,this.$parent);this.cells.push(n),n.setColor(this.props.color)}for(let o of this.cells)o.setBase(t);let r=150*(i-1)+10;this.path=new S(new d(-r,-10),r+160,170),this.$outline.setRect(this.path),this.transform(),this.$parent.selection.update()}getSnapPoints(){return[]}moveEnd(){super.moveEnd();for(let t of this.cells)for(let i of[...t.dots,...t.antiDots])i.cell=void 0}rearrangeDots(){if(!this.isAnimating){for(let t of this.cells)t.clear();for(let t of this.$parent.getTilesOfType("dot"))if(!t.deleted)for(let i of this.cells)(t.cell===i||!t.cell&&i.contains(t.posn))&&i.addDot(t);for(let t of this.cells)t.rearrange()}}static makeThumbnail(t){let i=h("svg",{width:160,height:60},t);for(let r of[105,55,5])h("rect",{x:r,y:5,width:50,height:50,class:"dot-cell",stroke:y.purple,style:"stroke-width: 8px"},i),h("circle",{cx:r+25,cy:5,r:3,fill:y.fg},i),h("circle",{cx:r+25,cy:55,r:3,fill:y.fg},i)}static altText(){return""}};Vi.type="dot-machine",Vi.defaultProps={color:y.purple,layer:"back",base:10,boxes:3},Vi=w([T],Vi);O([{id:"base",type:"input",tileTypes:["dot-machine"],label:"",value:"number",range:[2,25],get:e=>e.props.base,set:(e,s)=>s.props.base=Math.round(+e)},{id:"boxes",type:"input",tileTypes:["dot-machine"],label:"",value:"number",range:[1,10],get:e=>e.props.boxes,set:(e,s)=>s.props.boxes=Math.round(+e)},{id:"explode",type:"button",tileTypes:["dot-machine"],label:"",show:e=>e.some(s=>s.cells.some(t=>t.dots.length||t.antiDots.length)),click:(e,s)=>{let t=e.filter(i=>!i.isAnimating);for(let i of t)i.cells[0].explode();s.change({changed:t})}},{id:"annihilate",type:"button",tileTypes:["dot-machine"],label:"",show:e=>e.some(s=>s.cells.some(t=>t.dots.length&&t.antiDots.length)),click:(e,s)=>{let t=e.filter(i=>!i.isAnimating);for(let i of t)i.cells[0].annihilate();s.change({changed:t})}}]);var bc=class{constructor(s,t=0,i){this.machine=s;this.index=t;this.$doc=i;this.dots=[];this.antiDots=[];let r=-150*t;this.$el=h("rect",{class:"dot-cell",width:150,height:150,x:r}),this.$label=h("text",{class:"dot-label",x:75+r,y:154,"font-size":"12px"},s.$el),this.$value=h("text",{class:"dot-label",x:75+r,y:6,text:0,"font-size":"18px"},s.$el),this.bounds=new S(new d(r,0),150,150),s.$el.prepend(this.$el)}setBase(s){this.$label.text=mt(Math.pow(s,this.index))}delete(){this.$el.remove(),this.$label.remove(),this.$value.remove()}setColor(s){this.$el.setAttr("stroke",s),this.machine.isActive&&this.$el.css("fill",s)}hover(s=!0){this.machine.isActive&&!s||this.$el.css("fill",s?this.machine.props.color:"none")}contains(s){return this.bounds.translate(this.machine.posn).contains(s)}clear(){this.dots=[],this.antiDots=[]}addDot(s){(s.props.value>0?this.dots:this.antiDots).push(s),s.cell=this}rearrange(){this.$value.text=mt(this.dots.length-this.antiDots.length);let s=[...this.dots,...this.antiDots];if(!s.length)return;let t=Math.ceil(Math.sqrt(s.length)),i=Math.ceil(s.length/t),r=s.length<=16?30:s.length<=25?25:20,o=this.bounds.center.add(this.machine.posn).shift(-r*(t-1)/2,-r*(i-1)/2),n=I(a=>o.shift(a%t*r,Math.floor(a/t)*r),s.length);return this.animatePoints(s,n)}animatePoints(s,t){let i=s.map(r=>r.posn);for(let[r,o]of s.entries())o.setTransform(t[r]);return et(r=>{var o;for(let[n,a]of s.entries()){let l=d.interpolate(i[n],t[n],wt("quad",r));a.$el.setTransform(l),a.transformed=(o=a.path)==null?void 0:o.translate(l)}this.machine.$parent.selection.update()},240).promise}getDotsToExplode(){let s=this.machine.props.base;if(this.dots.length>=s)return this.dots.splice(0,s);if(this.antiDots.length>=s)return this.antiDots.splice(0,s)}explode(){return H(this,null,function*(){let s=this.machine.cells[this.index+1];if(!s){this.machine.isAnimating=!1,this.machine.$parent.change({changed:this.dots});return}this.machine.isAnimating=!0;let t=this.getDotsToExplode();if(!t)return s.explode();this.$doc.playSound("rise"),s.addDot(t[0]);for(let i of t.slice(1))i.popOut();return s.rearrange(),yield Cs(400),this.rearrange(),yield Cs(400),this.explode()})}annihilate(){return H(this,null,function*(){this.machine.isAnimating=!0;let s=Math.min(this.dots.length,this.antiDots.length);if(s){let i=this.dots.splice(0,s),r=this.antiDots.splice(0,s);for(let o of[...i,...r])o.popOut();this.$doc.playSound("woosh"),this.rearrange(),yield Cs(600)}let t=this.machine.cells[this.index+1];if(t)return t.annihilate();this.machine.isAnimating=!1,this.machine.$parent.change({changed:this.dots})})}},Ta=25/2,Di=class extends ${constructor(t,i,r){super(t,i,r);this.deleted=!1;this.path=new q(P,Ta);this.$path=h("circle",{r:Ta,class:"polygon-tile"},this.$el),this.$outline=h("circle",{r:Ta,class:"outline"},this.$el),this.props.color||(this.props.color=this.props.value<0?y.red:y.blue),this.props.watch("color",({color:o})=>this.$path.setAttr("fill",o)),this.props.watch("value",({value:o})=>this.value=o)}getSnapPoints(){return[]}getCell(){for(let t of this.$parent.getTilesOfType("dot-machine"))if(!t.isActive){for(let i of t.cells)if(i.contains(this.posn))return i}}moveEnd(){let t=this.cell,i=this.cell=this.getCell();if(!t||!i||t===i)return super.moveEnd();if(t.machine!==i.machine)return super.moveEnd();let r=Math.abs(t.index-i.index),o=t.machine.props.base**r;if(t.index<i.index){let n=this.props.value>0?t.dots:t.antiDots;if(n.length<o)return this.cell=t,super.moveEnd();for(let a of n.filter(l=>!l.isActive).slice(0,o-1))a.popOut()}else for(let n=0;n<o-1;++n){let a=$.create(this.$parent,this.props);a.posn=this.posn,a.cell=i}super.moveEnd()}static makeThumbnail(t,i){let r=i.value<0?y.red:y.blue,o=h("svg",{width:40,height:40},t);h("circle",{class:"polygon-tile",cx:20,cy:20,r:Ta,fill:r},o)}static altText(t){return t.value<0?"":""}negate(){this.props.value=-this.props.value,this.flipColor(this.props.value<0?y.red:y.blue)}popOut(){return H(this,null,function*(){this.deleted=!0,yield this.$path.exit("pop").promise,this.delete()})}};Di.type="dot",Di.defaultProps={value:1},Di=w([T],Di);var Nr=[y.yellow,"#f15e19","#e1343b",y.red,"#8d2ca1","#4e53d0",y.blue,y.teal,y.green,y.lime],xu=["#e6e2c6","#cc1030",y.green,y.red,"#ffd615",y.teal,"#181824","#9a2e13",y.blue,y.yellow],Ge=25,X1="transform-origin:center;transform-box:fill-box",Li=class extends st{constructor(t,i,r){super(t,i,r);this.$parent=t;this.$labels=[];let o=this.value=this.props.value;this.factors=Se(1,o).filter(n=>o%n===0),this.props.color||(this.props.color=(t.options.altColors?xu:Nr)[(o-1)%Nr.length]),this.$divisions=h("path",{class:"polygon-tile",opacity:.6},this.$el),this.setPath(on(o*Ge,Ge).polygon),this.$el.append(this.$outline),this.props.watch("denominator labels",n=>this.setDenominator(n.denominator))}transform(t){if(this.value<100)for(let i of this.$labels)i.css("transform",`rotate(${-this.rot}deg)`);super.transform(t)}setDenominator(t=0){for(let o of this.$labels)o.remove();let i=this.props.value/this.factors[t],r="";for(let o=0;o<this.props.value;o+=i)o&&(r+=`M${(-this.props.value/2+o)*Ge} ${-Ge/2}v${Ge}`),this.props.labels!=="hidden"&&this.$labels.push(h("text",{text:i,x:(-this.props.value/2+o+i/2)*Ge,class:"polygon-label",y:6,style:X1},this.$el));this.$divisions.setAttr("d",r)}split(){let t=this.factors[this.props.denominator],i=this.props.value/t,r=I(o=>{let n=$.create(this.$parent,{value:i,name:"number-bar"}),a=this.posn.shift((-this.props.value/2+(o+.5)*i)*Ge,0);return n.setTransform(a,this.rot),n},t);return this.$parent.selection.select(r),this.delete(),r}setupAudioTrack(){let t=h("rect",{y:-Ge/2+.5,height:Ge-1,opacity:0});this.$divisions.insertBefore(t),this.track=new Qt(this,(i,r)=>{let o=this.factors[this.props.denominator],n=this.props.value/4/o,a=this.props.value*Ge/o,l=I(u=>({note:i,time:u*n,duration:n}),o),c=u=>{t.setAttr("x",u*a-this.props.value*Ge/2),t.animate({opacity:[.6,1],width:["1px",a+"px"]},n/r*1e3,0,"linear")},p=()=>t.animate({opacity:0},200);return t.setAttr("fill",je(this.props.color)),{beats:l,step:c,end:p}})}static makeThumbnail(t,{value:i},r){let o=new S(new d(1,1),i*20,20),n=h("svg",{width:i*20+2,height:22},t),a=h("path",{class:"polygon-tile",path:o},n);h("text",{html:i,class:"polygon-label",x:i*10+1,y:16},n),r.options.watch(l=>a.setAttr("fill",(l.altColors?xu:Nr)[i-1]))}static altText(t){return`${t.value} `}};Li.type="number-bar",Li.defaultProps={denominator:0,value:1},Li=w([T],Li);O([{id:"divisions",type:"slider",tileTypes:["number-bar"],label:"",start:()=>0,move:(e,s)=>e.props.denominator=Math.round(s*(e.factors.length-1)),end:()=>0,get:e=>e.props.denominator/(e.factors.length-1)},{id:"split",type:"button",tileTypes:["number-bar"],label:"",show:e=>e.some(s=>s.factors[s.props.denominator]>1),click:(e,s)=>{let t=[];for(let r of e)t.push(...r.split()),r.$parent.selection.update();let i=e.filter(r=>r.factors.length>1);s.change({added:t,deleted:i})}},{id:"merge",type:"button",label:"",tileTypes:["number-bar"],show:e=>e.length>1,click:(e,s)=>{let t=_(e.map(a=>a.value)),{x:i,y:r}=ut(...e.map(a=>a.transformed)).center,o=_(e.map(a=>a.rot))/e.length,n=$.create(s,{name:"number-bar",value:t,x:i,y:r,rot:o,labels:e[0].props.labels});for(let a of e)a.delete();s.selection.add(n),s.change({added:[n],deleted:e})}},{id:"show-labels",type:"checkbox",tileTypes:["number-bar","number-tile","number-grid","dot-machine","algebra"],location:"more",label:"",icon:"numbers",get:e=>e.props.labels!=="hidden",set:(e,s)=>s.props.labels=e?void 0:"hidden"}]);var _e=25,Ps=_e*Math.sqrt(3)/2,$u=Zt(e=>[G.mix(e,"#000",.7),e,G.mix(e,"#fff",.7)]),J1=({vx:e,vy:s})=>e>1&&s===1?"vx":s===1?"vz":"vy",Q1=({vx:e,vy:s,vz:t})=>e>1&&s===1?"vy":e===1&&t>1?"vx":"vz";function Pu(e,s,t,i=25){let r=i*Math.sqrt(3)/2,o=-i*(e+s)/2,n=r*e,a=-r*s,l=new d(r*(e-s),o),c=new d(a,-i*s/2),p=new d(a,i*(t-s/2)),u=new d(0,t*i),f=new d(n,-i*e/2),v=new d(n,i*(t-e/2)),m="";for(let g of[0,1]){let b=g===0?1:-1,x=[e,s][g],k=[s,e][g];for(let L=1;L<t;++L)m+=`M0,${(t-L)*i} ${b*r*x},${i*(t-x/2-L)}`;for(let L=1;L<x;++L)m+=`M${b*r*L},${i*(t-L/2)}V${-i*L/2}`,m+=`M${b*r*L},${-i*L/2} ${b*r*(L-k)},${-i/2*(L+k)}`}return{grid:m,left:new D(P,u,p,c),right:new D(P,u,v,f),top:new D(P,f,l,c),outline:new D(l,f,v,u,p,c),thumbSize:[a+n,o+t*i],path:new D(l,f,v,u,p,c)}}var tv=[1e3,100,10,1],ev={1:[1,1,1],10:[1,1,10],100:[10,1,10],1e3:[10,10,10]};function Tu(e){let s=e.map(o=>o.value).sort().reverse(),t=_(s),i=[],r=0;for(let o of tv)for(;r+o<=t;)r+=o,i.push(o);if(i.join("")!==s.join(""))return i.map(o=>ev[o])}function sv(e,s,t,i,r){let o=r>=10?10:5;if(i==="vz"){let c=r;return o=Math.min(Math.floor(50/t),o),e*s*t===1&&r>300&&(c=tt(r**.5,10)*10),I(p=>{let u=Math.floor(p/c),f=Math.floor((p-u*c)/o),v=p%o,m=Math.floor((p-u*c)/100);return new d(Ps*(m+f*(e+s+1)),-_e*(v*(t+1)+u*(o*(t+1)+1)))},r)}let n=r%o,a=n||o,l=Math.ceil(r/o);return i==="vx"?I(c=>{let p=Math.floor(c/o),u=o-1-c%o;l-1===p&&(u-=o-a);let f=l-p-1;return new d(Ps*(u*(e+1)+p*(s+1)),-_e*(u*(e+1)+f*(s+1))/2)},r):I(c=>{let p=n&&c<n?0:Math.floor((c-n)/o)+(n?1:0),u=c<n?c:(c-n)%o,f=l-p-1,v=l===1?a-u-1:o-u-1;return new d(Ps*(u*(s+1)+f*(e+1)),-_e*(v*(s+1)+f*(e+1))/2)},r)}function Su(e,s,t,i=!1){let r=new Map;for(let p of e){let{vx:u,vy:f,vz:v}=p.props,m=[u,f,v].join(",");r.has(m)||r.set(m,{tiles:[],vx:u,vy:f,vz:v,value:p.value}),r.get(m).tiles.push(p)}let o=Array.from(r.values()).sort((p,u)=>u.value-p.value||u.vx-p.vx||u.vy-p.vy),n=new Map,a=0,l=0;for(let{tiles:p,vx:u,vy:f,vz:v}of o){let m=Wn(p),g=Q1(p[0].props),b=sv(u,f,v,g,p.length),x=new d(p[0].path.points[4].x,p[0].path.points[3].y);for(let[A,Z]of m.entries())n.set(Z,b[A].subtract(x).shift(a,0));let k=Math.max(...b.map(A=>Math.abs(A.x)))+(u+f)*Ps,L=Math.max(...b.map(A=>Math.abs(A.y)))+(v+(u+f)/2)*_e;L>l&&(l=L),a+=k+Ps}let c=t.shift(-(a-Ps)/2,l/2);for(let p of e){let u=n.get(p).translate(c);i?p.animateTo(u):p.setTransform(u)}}var $s=class extends ${constructor(t,i,r){super(t,i,r);this.noAutoLayering=!0;this.cannotRotate=!0;let[o,n,a,l]=I(()=>h("path",{class:"polygon-tile",style:"transition: .3s fill"},this.$el),4);this.$outline=h("path",{class:"outline"},this.$el),this.props.watch("vx vy vz",({vx:c,vy:p,vz:u})=>{this.value=c*p*u;let{grid:f,left:v,right:m,top:g,path:b,outline:x}=Pu(c,p,u);o.draw(v),n.draw(m),a.draw(g),l.setAttr("d",f),this.$outline.draw(x),this.path=b,this.splitDirection=J1(this.props),this.splitCount=this.props[this.splitDirection]}),this.props.color||(this.props.color=Dt[this.value]||y.teal),this.props.watch("color",({color:c})=>{let[p,u,f]=$u(c);o.setAttr("fill",p),n.setAttr("fill",u),a.setAttr("fill",f)})}split(){if(this.splitCount===1)return[];let t=this.splitDirection,i=it(U({},this.props),{[t]:1}),r=t==="vx"?this.posn:t==="vy"?this.posn.shift(Ps*(1-this.props.vy),_e*(1-this.props.vy)/2):this.posn.shift(0,(this.props.vz-1)*_e),o=I(a=>{let l=$.create(this.$parent,i);if(t==="vz")l.setTransform(r.shift(0,-_e*a)),l.animateTo(r.shift(0,-2*_e*a),void 0,250);else{t==="vx"&&(a=this.splitCount-a-1);let c=t==="vx"?-1:1,p=r.shift(Ps*a,c*_e*a/2);l.setTransform(p),l.animateTo(p.shift(Ps*a,c*_e*a/2),void 0,250)}return l},this.splitCount);R.redraw();let n=Dt[o[0].value]||y.teal;for(let a of o)a.props.color=n;return this.delete(),o}getSnapPoints(){return[P,...this.path.points]}static makeThumbnail(t,i){let o=!i.vx||i.vx===1?30:i.vy===1?60:80,n=h("svg",{width:o,height:80},t),a=h("g",{},n);t.onAttr("props",l=>{let{vx:c,vy:p,vz:u}=Pt(l,{vx:1,vy:1,vz:1}),{grid:f,left:v,right:m,top:g,thumbSize:b}=Pu(c,p,u,80/20),x=$u(Dt[c*p*u]||y.teal);a.setAttr("transform",`translate(${(o-b[0])/2}, ${(80-b[1])/2})`),a.removeChildren(),t.setAttr("aria-label",$s.altText({vx:c,vy:p,vz:u})),h("path",{class:"polygon-tile",path:v,fill:x[0]},a),h("path",{class:"polygon-tile",path:m,fill:x[1]},a),h("path",{class:"polygon-tile",path:g,fill:x[2]},a),h("path",{class:"polygon-tile",d:f,style:"opacity: .4;"},a)})}static altText({vx:t,vy:i,vz:r}){return`${t===1&&i===1&&r===1?"1":`${t}x${i}x${r}`} `}};$s.type="number-cube",$s.defaultProps={vx:1,vy:1,vz:1},$s=w([T],$s);O([{id:"merge",type:"button",tileTypes:["number-cube"],label:"",show:e=>e.length>1&&!!Tu(e),click:(e,s)=>{let t=ut(...e.map(r=>r.transformed)).center;for(let r of e)r.delete();let i=Tu(e).map(([r,o,n])=>$.create(s,{vx:r,vy:o,vz:n,name:"number-cube"}));Su(i,s,t),s.selection.select(i),s.change({added:i,deleted:e})}},{id:"organize",type:"button",tileTypes:["number-cube"],label:"",show:e=>e.length>1,click:(e,s)=>{let t=ut(...e.map(i=>i.transformed)).center;Su(e,s,t,!0),s.change({changed:e})}},{id:"split",type:"button",tileTypes:["number-cube"],label:"",show:e=>e.some(s=>s.splitCount>1)&&_(e.map(s=>s.splitCount-1))<=1e3,click:(e,s)=>{let t=e.flatMap(r=>r.split()),i=e.filter(r=>r.splitCount>1);s.selection.select(t),s.change({added:t,deleted:i})}},{id:"send-to-back",type:"button",icon:"layer-back",tileTypes:["number-cube"],label:"",click:(e,s)=>{s.zIndex.bringToBack(e,!0),s.change({changed:e})}},{id:"send-to-front",type:"button",icon:"layer-front",tileTypes:["number-cube"],label:"",click:(e,s)=>{s.zIndex.bringToFront(e,!0),s.change({changed:e})}}]);var Oi=50,Sa={1:y.grey,2:y.yellow,3:y.green,5:y.blue,7:y.purple},iv="M0-xAx,x,0,0,0-x,0,x,x,0,0,0,0,x,x,x,0,0,0,x,0,x,x,0,0,0,0-xZM0,yAz,z,0,0,1-y,0,z,z,0,0,1,0-y,z,z,0,0,1,y,0,z,z,0,0,1,0,yZ";function ku(e,s,t=1){let i=e.y*s.x-e.x*s.y>0?t:1-t;return[e.x,e.y+"A"+e.length,e.length,0,i,t,s.x,s.y].join(",")}function Cu(e,s,t=Oi){if(s===1)return iv.replace(/x/g,""+t).replace(/y/g,""+.4*t).replace(/z/g,""+(.4*t+.1));let i=B/s,r=-ht-i/2,o=d.fromPolar(r+i*e,t),n=d.fromPolar(r+i*(e+1),t);return`M${ku(o,n)}L${ku(n.scale(.4),o.scale(.4),0)}Z`}function Mu(e){return e===1?[1]:cs(e).reverse()}var Ts=class extends ${constructor(t,i,r){super(t,i,r);this.path=new q(P,Oi);this.$segments=[];this.factors=[];h("circle",{fill:"var(--canvas-bg)",r:Oi},this.$el),this.$segmentWrap=h("g",{},this.$el),this.$labelWrap=h("g",{style:"pointer-events:none"},this.$el),this.$product=h("text",{class:"prime-label",fill:"var(--canvas-fg)",y:5},this.$el),this.$outline=h("path",{class:"outline",path:this.path},this.$el),this.props.watch("value",({value:o})=>this.setValue(o)),this.props.watch("labels",({labels:o})=>{this.$product.toggle(o!=="hidden"),this.$labelWrap.toggle(o==="all")}),this.props.watch("color",({color:o})=>{if(!o)return this.setValue(this.props.value);for(let n of this.$segments)n[0].setAttr("fill",o)})}setValue(t){this.$product.text=""+t,this.value=t,this.factors=Mu(t);let i=this.factors.length;for(let r=0;r<i;++r){let[o,n]=this.getSegment(r);r===0&&o.setClass("prime-segment",i>1),o.setAttr("fill",this.props.color||Sa[this.factors[r]]||y.red),o.setAttr("d",Cu(r,i)),o.show(),n.toggle(i>1),i>1&&(n.setCenter(d.fromPolar(B/i*r-ht,Oi*.7).shift(0,4)),n.textStr=this.factors[r])}for(let r=i;r<this.$segments.length;++r)for(let o of this.$segments[r])o.hide()}multiply(t){this.props.value=M(this.props.value*t,1,9999999)}getSegment(t){if(this.$segments[t])return this.$segments[t];let i=h("path",{class:"polygon-tile prime-segment"},this.$segmentWrap),r=h("text",{style:"font-size:14px;font-weight:600",fill:"#fff"},this.$labelWrap),o=!1;return i.on("mouseenter",()=>{o||this.$segmentWrap.append(i)}),this.$parent.events.listen(i,{down:()=>{o=!0,this.$segmentWrap.append(i),this.$parent.selection.add(this,!this.$parent.events.shiftKey)},up:()=>o=!1,start:()=>{this.isActive&&(this.$parent.selection.add(this,!0),i.addClass("prime-move"),this.$container.append(i),this.props.labels==="all"&&this.$container.append(r))},move:n=>{if(!this.isActive)return;let a=this.posn.add(n.posn).subtract(n.startPosn);i.setTransform(a),r.setTransform(a),this.setCollision(this.findNearby("prime-disk",Oi,n.posn))},end:n=>{if(!this.isActive)return;i.removeClass("prime-move"),i.setTransform(),r.setTransform(),this.$segmentWrap.append(i),this.$labelWrap.append(r);let a=n.lastPosn.subtract(n.startPosn);if(a.length>Oi){let l=[],c=[this];if(this.collision)this.collision.multiply(this.factors[t]),this.$parent.selection.add(this.collision,!0),c.push(this.collision),this.setCollision();else{let p=this.posn.add(a),u=$.create(this.$parent,{name:"prime-disk",labels:this.props.labels,value:this.factors[t],x:p.x,y:p.y});l.push(u),this.$parent.selection.add(u,!0)}this.props.value=this.value/this.factors[t],this.$parent.change({changed:c,added:l})}},checkIfActive:()=>this.factors.length>1}),this.$segments[t]=[i,r],this.$segments[t]}highlight(t=!0){this.$el.setClass("active",t)}move(t){super.move(t),!(this.$parent.selection.tiles.size>1)&&this.setCollision(this.findNearby("prime-disk",Oi))}collide(t){t.highlight(!1),t.multiply(this.props.value),this.delete();let i=this.lastSavedData?[this]:void 0;this.$parent.change({changed:[t],deleted:i})}static makeThumbnail(t){let i=h("svg",{width:54,height:54},t),r=h("g",{transform:"translate(27 27)"},i);t.onAttr("props",o=>{let n=Pt(o,{value:1}),a=Math.round(n.value);r.removeChildren();let l=Mu(a);for(let c=0;c<l.length;++c){let p=Sa[l[c]]||y.red,u=Cu(c,l.length,25);h("path",{fill:p,d:u,class:"polygon-tile"},r),h("text",{text:a,y:4,fill:y.bg,style:"font-size:11px"},r)}t.setAttr("aria-label",Ts.altText(n))})}static altText(t){return`${t.value} `}};Ts.type="prime-disk",Ts.defaultProps={labels:"number"},Ts=w([T],Ts);O([{id:"labels",type:"select",icon:"numbers",tileTypes:["prime-disk"],location:"more",label:"",options:[{key:"all",label:""},{key:"number",label:""},{key:"hidden",label:""}],get:e=>e.props.labels||"all",set:(e,s)=>s.props.labels=e}]);var Vu=4,Du=6,Ri=6,Au=e=>e.reduce((s,t)=>s*t,1),Eu=e=>e===1?[1]:cs(e),rv=Zt((e,s)=>{if(e===2)return 2*s+1.5*Ri;let t=2*s+Ri,i=2*s+Ri;e===3&&(i/=Math.sqrt(3)),e===4&&(i/=Math.sqrt(2)),e>3&&e%2&&(e-=1);let o=Math.ceil((Math.sqrt(e*8/Du+1)-1)/2);return i+(o-1)*t+s+Ri});function wc(e){return e.reduceRight((s,t)=>rv(t,s),Vu)}function ov(e,s){if(e===1)return[];if(e===2)return[P.shift(-s-Ri/2,0),P.shift(s+Ri/2,0)];let t=[],i=2*s+Ri,r=i;e===3&&(r/=Math.sqrt(3)),e===4&&(r/=Math.sqrt(2)),e>3&&e%2&&(t.push(P),e-=1);let o=1;for(;e;){let n=Math.min(Du*o,e);t.push(...D.regular(n,r).points),e-=n,r+=i,o+=1}return t}function xc(e,s,t,i=P){if(e.length<1)return[];let r=h("g",{class:"tile","data-n":e.join("-")},t),o=Sa[e[0]]||y.red;h("circle",{r:s,cx:i.x,cy:i.y,fill:o,class:"polygon-tile"},r);let n=e.slice(1),a=wc(n),l=ov(e[0],a);if(n.length){let c=[r];for(let p of l)c.push(...xc(n,a,r,i.add(p)));return c}else{for(let c of l){let p=i.add(c);h("circle",{r:Vu,cx:p.x,cy:p.y,fill:"white"},r)}return[r]}}var Ss=class extends ${constructor(t,i,r){super(t,i,r);this.$body=h("g",{},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.props.watch("factors",({factors:o})=>{this.factors=o.split("-").map(n=>+n),this.value=Au(this.factors),this.buildTile()})}add(t){let i=M(this.value+t,1,999);this.props.factors=Eu(i).join("-")}buildTile(){this.$body.removeChildren(),this.radius=wc(this.factors);let t=xc(this.factors,this.radius,this.$body);if(this.factors.length>1)for(let i of t.slice(1))this.setupListeners(i);this.path=new q(P,this.radius),this.$outline.draw(this.path),this.transform()}setupListeners(t){let r=t.attr("data-n").split("-").reduce((a,l)=>+a*+l,1),o=t.parent,n=t.children[0];this.$parent.events.listen(t,{down:()=>this.$parent.selection.add(this,!this.$parent.events.shiftKey),start:()=>{this.isActive&&(this.$parent.selection.add(this,!0),n.addClass("prime-move"),this.$container.append(t))},move:a=>{this.isActive&&(t.setTransform(this.posn.add(a.posn).subtract(a.startPosn)),this.setCollision(this.findCollision(a.posn)))},end:a=>{if(this.isActive)if(a.lastPosn.subtract(this.posn).length<=this.radius)t.setTransform(),n.removeClass("prime-move"),o.append(t);else if(this.collision)t.remove(),this.collision.add(r),this.add(-r),this.$parent.selection.add(this.collision,!0),this.$parent.change({changed:[this,this.collision]}),this.setCollision();else{t.remove();let l=new Ss(this.$parent,{factors:`${r}`});l.setTransform(this.posn.add(a.lastPosn).subtract(a.startPosn)),this.add(-r),this.$parent.change({added:[l],changed:[this]})}}})}findCollision(t){for(let i of this.$parent.getTilesOfType("number-dot"))if(i!==this&&d.distance(t,i.posn)<i.radius)return i}highlight(t=!0){this.$el.setClass("active",t)}move(t){super.move(t),!(this.$parent.selection.tiles.size>1)&&this.setCollision(this.findCollision(this.posn))}collide(t){t.highlight(!1),t.add(this.value);let i=this.lastSavedData?[this]:void 0;this.$parent.change({changed:[t],deleted:i}),this.delete()}reorder(){this.factors.push(this.factors.shift()),this.props.factors=this.factors.join("-")}shrink(){this.factors.length<=1||(this.factors.push(this.factors.pop()*this.factors.pop()),this.props.factors=this.factors.join("-"))}grow(){let t=this.factors.length-1-this.factors.slice(0).reverse().findIndex(o=>!qa(o));if(t<0||!this.factors[t])return;let i=cs(this.factors[t])[0],r=Math.round(this.factors[t]/i);this.factors.splice(t,1,i,r),this.props.factors=this.factors.join("-")}static makeThumbnail(t){let i=h("svg",{width:54,height:54},t);t.onAttr("n",r=>{let o=M(Math.round(+r),1,999);i.removeChildren();let n=Eu(o);for(let l=0;l<n.length;++l){let c=wc(n);xc(n,c,i)[0].css("transform",`translate(27px, 27px) scale(${25/c})`)}let a={factors:n.join("-")};t.setAttr("props",JSON.stringify(a)),t.setAttr("aria-label",Ss.altText(a))})}static altText(t){var r;return`${Au(((r=t.factors)==null?void 0:r.split("-").map(o=>+o))||[])} `}};Ss.type="number-dot",Ss=w([T],Ss);O([{id:"combine-factors",type:"button",tileTypes:["number-dot"],label:"",icon:"combine-dots",show:e=>e.some(s=>s.props.factors.length>1),click:(e,s)=>{e=e.filter(t=>t.props.factors.length);for(let t of e)t.shrink();s.change({changed:e})}},{id:"split-factors",type:"button",tileTypes:["number-dot"],label:"",icon:"split-dots",click:(e,s)=>{for(let t of e)t.grow();s.change({changed:e})}},{id:"reorder",type:"button",tileTypes:["number-dot"],label:"",show:e=>e.some(s=>s.props.factors.length>1),click:(e,s)=>{e=e.filter(t=>t.props.factors.length);for(let t of e)t.reorder();s.change({changed:e})}}]);var At=25,Gr=20;function wo(e,s,t,i){let r=i.shift(e*t,0),o=r.shift(0,Math.floor(s/e)*t),n=i.shift(0,Math.ceil(s/e)*t),a=n.shift(s%e*t,0),l=a.shift(0,s%e?-t:0);return new D(i,r,o,l,a,n)}var _r=class extends ${constructor(t,i,r){super(t,i,r);this.$label=h("g",{class:"outline card-label"},this.$el),this.$body=h("path",{class:"polygon-tile"},this.$el),this.$grid=h("path",{class:"polygon-tile"},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.props.value>1&&(this.$handle=this.makeHandle("h",o=>this.props.width=M(Math.round(o.x/At),1,this.props.value))),this.props.color||(this.props.color=Dt[this.props.value]||Dt[1]),this.props.watch("color",({color:o})=>this.$body.setAttr("fill",o)),this.props.watch("labels",()=>{this.renderLabel(),this.transform()}),this.props.watch("width count",()=>this.redraw())}redraw(){var a;let{width:t,value:i}=this.props;this.value=i,this.path=wo(t,i,At,new d(-At/2,-At/2)),this.$body.draw(this.path),this.$outline.draw(this.path);let r=Math.ceil(i/t),o=t-(t*r-i),n="";for(let l=1;l<t;++l)n+=`M${(l-.5)*At} ${-At/2}v${(o<l?r-1:r)*At}`;for(let l=1;l<r;++l)n+=`M${-At/2} ${(l-.5)*At}h${t*At}`;this.$grid.setAttr("d",n),(a=this.$handle)==null||a.setTransform(new d((t-.5)*At,-At/2)),this.renderLabel(),this.transform(),this.$parent.selection.update()}select(){super.select(),R.isFirefox&&this.renderLabel()}renderLabel(){let t=this.props.value<5||this.props.labels==="hidden";if(this.padding=[0,25,t?0:Gr,0],this.$label.removeChildren(),t)return;let i=this.props.width,r=this.props.value%i,o=(this.props.value-r)/i;this.$label.setTransform(new d(-At/2,At*(Math.ceil(this.props.value/i)-.5)));let n=h("path",{},this.$label),a=h("text",{x:6,y:15,style:"text-anchor:start",text:`${i} \xD7 ${o}`},this.$label);r&&h("tspan",{"fill-opacity":.6,dx:6,text:` + ${r}`},a);let l=5,c=a._el.getBBox().width+12;n.setAttr("d",`M0,0 H${c-l}Q${c},0 ${c},${l}V${Gr-l}Q${c},${Gr} ${c-l},${Gr}H${l}Q0,${Gr} 0,${Gr-l}H0Z`)}static makeThumbnail(t,{width:i,value:r}){let o=Math.ceil(r/i),n=h("svg",{width:r===1?40:80,height:80},t),a=(r===1?20:40)-i/2*7,l=40-o/2*7,c=Dt[r]||Dt[1],p="";for(let f=1;f<i;++f)p+=`M${a+f*7} ${l}v${o*7}`;for(let f=1;f<o;++f)p+=`M${a} ${l+f*7}h${i*7}`;let u=wo(i,r,7,new d(a,l));h("path",{path:u,fill:c},n),h("path",{"stroke-weight":1,stroke:"white",d:p},n),h("path",{class:"polygon-tile",path:u,fill:"none"},n)}static altText(t){return t.value>1?`${t.value} `:"1 "}getSnapPoints(){let{width:t,value:i}=this.props,r=new d(-At/2,-At/2),o=[r];for(let a=1;a<=t;++a)o.push(r.shift(a*At,0));let n=Math.ceil(i/t);for(let a=1;a<=n;++a)o.push(r.shift(0,a*At));for(let a=0;a<i;++a)o.push(r.shift((a%t+1)*At,Math.floor(a/t+1)*At));return o}split(){let{width:t,value:i}=this.props;if(i===1)return[];this.delete();let r=Math.ceil(i/t);return r===1?I(o=>{let n=this.posn.shift(o*At,0).rotate(W(this.rot),this.posn);return $.create(this.$parent,Object.assign({},this.props,{value:1,width:1,x:n.x,y:n.y}))},i):I(o=>{let n=this.posn.shift(0,o*At).rotate(W(this.rot),this.posn),a=o<r-1?t:i%t||t;return $.create(this.$parent,Object.assign({},this.props,{value:a,width:a,x:n.x,y:n.y}))},r)}};_r.type="number-tile",_r=w([T],_r);O([{id:"merge",type:"button",tileTypes:["number-tile"],label:"",show:e=>e.length>1,click:(e,s)=>{let t=_(e.map(p=>p.props.value)),i=z(ko(e,p=>p.props.value)),r=i.$parent,o=ut(...e.map(p=>p.transformed)),n=Math.min(Math.round(o.w/At),t),{x:a,y:l}=o.p.shift(At/2),c=$.create(s,Object.assign({},i.props,{value:t,width:n,x:a,y:l}));for(let p of e)p.delete();r.selection.add(c),s.change({added:[c],deleted:e})}},{id:"split",type:"button",tileTypes:["number-tile"],label:"",show:e=>e.some(s=>s.props.value>1),click:(e,s)=>{let t=[];for(let i of e)t.push(...i.split());s.selection.select(t),s.change({added:t,deleted:e})}}]);var Lu=25;function Ou(e,s,t,i=!1,r=0,o=0){let n=Math.ceil(e/2);for(let a=0;a<e;++a){let l=(i?-1:1)*(a%n+.5)*s+r,c=(.5+(a<n?0:1))*s+o;h("circle",{fill:"white",cx:l,cy:c,r:s*.2},t)}}var zr=class extends st{constructor(s,t,i){super(s,t,i),this.props.color||(this.props.color=Nr[this.props.value-1]);let r=h("g",{},this.$el);this.props.watch("value isFlipped",({value:o,isFlipped:n})=>{this.value=o,this.setPath(wo(Math.ceil(o/2),o,Lu,P),n),r.removeChildren(),Ou(this.value,Lu,r,n)})}static makeThumbnail(s,t){let i=Math.ceil(t.value/2),r=wo(i,t.value,20,new d(5,5)),o=h("svg",{width:i*20+10,height:50},s);h("path",{path:r,fill:Nr[t.value-1],class:"polygon-tile"},o),Ou(t.value,20,o,!1,5,5)}static altText(s){return`${s.value} `}};zr.type="number-frame",zr=w([T],zr);var De=50,Ru=Zt((e,s,t,i,r)=>e==="number"?1+i+r*s:e==="addition"?!i&&!r?"+":!i||!r?i||r:i+r:!i&&!r?"\xD7":!i||!r?i||r:i*r),nv=Zt(e=>G.from(e).brightness<140),av=Zt(e=>G.mix(e,"#000",.7).hex);function Iu(e){return e?new Map(e.split(",").map(s=>s.split("-"))):new Map}function lv(e){return Array.from(e.entries()).map(s=>s.join("-")).join(",")}var Ii=class extends ${constructor(t,i,r){super(t,i,r);this.cells=[];this.$handles=[];this.selected=new Set;this.padding=[0,25,25,0];this.cannotRotate=!0;this.$cells=h("g",{},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.colors=Iu(this.props.colors),t.events.listen(this.$el,{down:o=>this.selectCell(o.posn),move:o=>this.selectCell(o.posn,!0),checkIfActive:()=>!!this.isFocussed}),this.$handles[1]=this.makeHandle("v",o=>this.props.rows=M(Math.round(o.y/De),2,21)),this.$handles[0]=this.makeHandle("h",o=>this.props.cols=M(Math.round(o.x/De),2,21)),this.$handles[1].css("cursor","ns-resize"),this.props.watch("rows cols kind isFlipped",()=>this.redraw()),this.props.watch("labels",({labels:o})=>this.$el.setClass("no-labels",o==="hidden"))}applyChange(t){super.applyChange(t),"colors"in t&&(this.colors=Iu(this.props.colors),this.updateColors())}redraw(){let{rows:t,cols:i}=this.props,r=i*t;for(let o=this.cells.length;o<r;++o)this.cells.push(this.makeCell());for(let o=r;o<this.cells.length;++o)this.cells[o][0].hide();this.updateCells(),this.path=new S(P,i*De,t*De),this.$outline.draw(this.path),this.$handles[0].setTransform({x:this.path.w,y:0}),this.$handles[1].setTransform({x:0,y:this.path.h}),this.transform(),this.$parent.selection.update()}makeCell(){let t=h("g",{class:"number-grid-cell"},this.$cells),i=h("circle",{r:23,cx:De/2,cy:De/2},t);return[t,i,h("text",{x:De/2,y:De/2+8},t)]}updateCells(){let{rows:t,cols:i,isFlipped:r}=this.props;for(let o=0;o<i;++o)for(let n=0;n<t;++n){let[a,l,c]=this.cells[o+n*i];a.show(),a.translate(o*De,r?(t-1-n)*De:n*De),c.text=""+this.getCellValue(o,n)}this.updateColors()}updateColors(){let t=this.props.kind==="number",i=av(this.props.color);for(let r=0;r<this.props.cols;++r)for(let o=0;o<this.props.rows;++o){let n=r+o*this.props.cols,a=!t&&(!r||!o),l=this.colors.get(t?`${n}`:`${o}/${r}`)||(a?i:this.props.color);this.cells[n][1].setAttr("fill",l),this.cells[n][2].setAttr("fill",nv(l)?"#fff":"#000")}}format(t,i){let r=this.props.kind==="number";for(let o of this.selected)this.colors.set(r?`${o}`:`${Math.floor(o/this.props.cols)}/${o%this.props.cols}`,i);this.props.colors=lv(this.colors),this.updateColors(),this.$parent.change({changed:[this]})}doubleClick(t){this.focus(),this.selectCell(t.posn)}selectCell(t,i=!1){if(t=this.relativePosn(t).scale(1/De).floor(),t.x<0||t.x>=this.props.cols||t.y<0||t.y>=this.props.rows)return;let r=t.x+(this.props.isFlipped?this.props.rows-1-t.y:t.y)*this.props.cols;if(i)this.selected.has(r)||this.addToSelection(r);else if(this.$parent.events.shiftKey)this.selected.has(r)?this.removeFromSelection(r):this.addToSelection(r);else{for(let o of this.selected)this.removeFromSelection(o);this.addToSelection(r)}}addToSelection(t){this.cells[t][0].addClass("active"),this.selected.add(t)}removeFromSelection(t){this.cells[t][0].removeClass("active"),this.selected.delete(t)}getCellValue(t,i){return Ru(this.props.kind,this.props.cols,this.props.rows,t,i)}blur(){if(this.isFocussed){for(let t of this.selected)this.removeFromSelection(t);super.blur()}}flip(){this.props.isFlipped=!this.props.isFlipped}selectMultiples(){let t=Array.from(this.selected).map(r=>+this.getCellValue(r%this.props.cols,Math.floor(r/this.props.cols))),i=t.length>1?Fs(...t):t[0];for(let r of this.selected)this.removeFromSelection(r);for(let r=0;r<this.props.cols;++r)for(let o=0;o<this.props.rows;++o)+this.getCellValue(r,o)%i===0&&this.addToSelection(r+o*this.props.cols)}static makeThumbnail(t,i){let r=i.kind?4:5,o=h("svg",{width:10+25*r,height:10+25*r,"font-size":"14"},t),n=(a,l,c,p)=>{h("circle",{cx:a+17.5,cy:l+17.5,r:12,fill:y.bg,opacity:c},o),h("text",{x:a+17.5,y:l+22,text:p,fill:y.bg},o)};for(let a=0;a<r;++a)for(let l=0;l<r;++l){let c=!i.kind||a&&l?.3:.5;n(25*a,25*l,c,Ru(i.kind||"number",r,r,a,l))}}static altText(t){return t.kind==="number"?"":t.kind==="addition"?"":""}};Ii.type="number-grid",Ii.defaultProps={color:"#ccc",kind:"number",rows:10,cols:10},Ii=w([T],Ii);O([{id:"switch-direction",type:"button",tileTypes:["number-grid"],label:"",click:(e,s)=>{for(let t of e)t.flip();s.change({changed:e})}},{id:"select-all-multiples",type:"button",tileTypes:["number-grid"],focus:"show",label:"",click:e=>{e[0].selectMultiples()}}]);var cv=20,hv=25,pv=500,Nu=new D(new d(-4,0),new d(4,5),new d(4,-5)),Ni=class extends ${constructor(t,i,r){super(t,i,r);this.cannotRotate=!0;this.$selectionArea=h("rect",{fill:"transparent"},this.$el),this.$line=h("path",{fill:"none",class:"number-line-ticks"},this.$el),this.$arrows=h("path",{class:"number-line-ticks"},this.$el),this.$sizeHandle=this.makeHandle("c",(o,n)=>{var l;let a=(l=this.$parent.snapping.snap([n]))==null?void 0:l.shift;n=a?n.add(a):n.snap(P,10),this.rot=this.props.rot=Vt(n.angle(this.posn))+(this.props.isFlipped?180:0),this.props.jumpSize=M(d.distance(n,this.posn),hv,pv)}),this.$jumpsHandle=this.makeHandle("c",(o,n)=>{this.props.jumps=M(Math.round(d.distance(n,this.posn)/this.props.jumpSize),1,cv)}),this.props.color||(this.props.color=this.props.jumpSize<0?y.red:y.yellow),this.props.jumps||(this.props.jumps=this.props.single?1:4),this.props.watch("color",({color:o})=>this.setColor(o)),this.props.watch("jumpSize jumps isFlipped",()=>this.redraw()),this.props.watch("single",({single:o})=>this.$jumpsHandle.css("visibility",o?"hidden":"visible"))}redraw(){let{jumpSize:t,jumps:i,color:r,isFlipped:o}=this.props,n=t*(o?-1:1),a=M(40+.4*t,-100,100),l=new d(-n/4,-a).unitVector.scale(12),c="",p="";for(let f=0;f<i;f++){let v=f*n,m=new d(v+n,0).add(l);c+=`M${v},0 C${v+n/4},${-a} ${v+3/4*n},${-a} ${m.x},${m.y}`,p+=Gt(new q(new d(v,0),3)),p+=Gt(Nu.rotate(l.angle()).shift(v+n,0).translate(l))}this.$line.setAttr("d",c),this.$arrows.setAttr("d",p);let u=new d(i*n,0);this.path=S.aroundPoints([P,u,new d(0,-a*3/4)]),this.$selectionArea.setRect(this.path),this.$sizeHandle.setCenter({x:n,y:0}),this.$jumpsHandle.setCenter(u),this.setColor(r),this.transform(),this.$parent.selection.update()}flip(){this.props.isFlipped=!this.props.isFlipped,this.flipColor(this.props.isFlipped?y.red:y.yellow),this.setTransform(z(this.snapPoints))}getSnapPoints(){let t=this.props.jumpSize*(this.props.isFlipped?-1:1);return I(i=>new d(i*t,0),this.props.jumps+1)}setColor(t){this.$line.setAttr("stroke",t),this.$arrows.setAttr("stroke",t),this.$arrows.setAttr("fill",t)}static makeThumbnail(t,i){let r=i.single?74:200,o=h("svg",{width:r,height:50,viewBox:`${i.isFlipped?-68:-6} -44 ${r} 50`},t),n=i.isFlipped?-64:64,a=50,l=new d(-n/4,-a).unitVector.scale(i.single?2:10),c=i.isFlipped?y.red:y.yellow,p="",u="";for(let f=0;f<(i.single?1:3);f++){let v=f*n,m=new d(v+n,0).add(l);p+=`M${v},0 C${v+n/4},${-a} ${v+3/4*n},${-a} ${m.x},${m.y}`,u+=Gt(new q(new d(v,0),2)),u+=Gt(Nu.scale(.6).rotate(l.angle()).shift(v+n,0).translate(l))}h("path",{d:p,fill:"none",stroke:c,"stroke-width":2.4},o),h("path",{d:u,fill:c,stroke:c,"stroke-width":2.4},o)}static altText(){return""}};Ni.type="multi-jump",Ni.defaultProps={jumpSize:100},Ni=w([T],Ni);O([{id:"flip",type:"button",label:"",tileTypes:["multi-jump"],click:(e,s)=>{for(let t of e)t.flip();s.change({changed:e})}}]);var xo=25,Gi=class extends ${constructor(t,i,r){super(t,i,r);this.padding=[0,25,20,25];this.$el.addClass("number-line"),this.$fill=h("path",{fill:"transparent"},this.$el),this.$lines=h("path",{class:"number-line-ticks"},this.$el),this.$labels=h("g",{},this.$el),this.$start=this.makeHandle("h",o=>{let n=M(Math.round(o.x/xo/this.props.size),this.props.width-100,this.props.width-1);n&&(this.setTransform(this.posn.rotate(-W(this.rot)).shift(n*xo*this.props.size,0).rotate(W(this.rot))),this.props.width-=n,this.props.start=j.fromString(this.props.start).add(j.fromString(this.props.step).multiply(n)).toString())}),this.$start.css("transform",`translate(${-xo}px, ${-2.5}px) rotate(${Math.PI}rad)`),this.$end=this.makeHandle("h",o=>{let n=o.x/xo/this.props.size;this.props.width=M(Math.round(n),1,100)}),this.props.watch("labels",({labels:o})=>{this.$labels.toggle(o!=="hidden"),this.$labels.css("transform",o==="above"?"translate(0,-44px)":"")}),this.props.watch("color",({color:o})=>{this.$lines.setAttr("stroke",o),this.$labels.setAttr("fill",o),this.$labels.css("color",o)}),this.props.watch("start step width size minor arrows",()=>this.redraw())}redraw(){let{start:t,step:i,width:r,size:o,minor:n,arrows:a}=this.props,l=j.fromString(t),c=j.fromString(i);this.$labels.removeChildren();let p=o*xo,u=`M0 10L${r*p} 10`;a!=="none"&&(u+=`M${r*p} 10h15M${r*p+25} 10l-8 5v-10Z`),a==="both"&&(u+="M0 10h-15M-25 10l8 5v-10Z");for(let f=0;f<=r*n;f+=1){let v=f*p/n,m=!(f%n);if(u+=`M${v} ${m?2:6}L${v} ${m?18:14}`,m){let g=l.add(c.multiply(f/n)).toString();if(g.includes("/")){let b=h("g",{},this.$labels),x=h("g",{class:"equation",style:"text-anchor:start"},b),k=new Re(x,void 0,0,"",18,!1);k.setValue(g),x.css("transform",`translate(${v-k.root.width/2}px, ${35-k.root.height/2}px)`)}else h("text",{text:g,class:"number-line-label",x:v,y:38},this.$labels)}}this.$lines.setAttr("d",u),this.$end.setTransform({x:r*p,y:-2.5}),this.linePoints=I(f=>new d(f*p/n,10),r*n+1),this.line=new dt(new d(0,10),new d(r*p,10)),this.path=new S(new d(0,-2.5),r*p,25),this.$fill.draw(this.path),this.transform(),this.$parent.selection.update()}getSnapPoints(){return this.linePoints}getSnapLines(){return[this.line]}transform(t){if(!R.isSafari){let i=this.$labels.children;for(let r of i)r.css("transform",`rotate(${-this.rot}deg)`)}super.transform(t)}static makeThumbnail(t){let i=h("svg",{width:240,height:40},t),r="M20 10L220 10";for(let o=0;o<=10;o+=1){let n=20+o*20;r+=`M${n} 5L${n} 15`,h("text",{text:o,x:n,y:30,class:"number-line-label",fill:y.bg},i)}h("path",{d:r,class:"number-line-ticks",stroke:y.bg},i)}static altText(){return""}};Gi.type="number-line",Gi.defaultProps={color:y.darkGrey,start:"0",step:"1",width:10,size:2,minor:1,arrows:"none"},Gi=w([T],Gi);O([{id:"start",type:"input",tileTypes:["number-line"],label:"",get:e=>e.props.start,set:(e,s)=>s.props.start=(j.fromString(e)||new j(0)).toString()},{id:"step",type:"input",tileTypes:["number-line"],label:"",range:[0,void 0],get:e=>e.props.step,set:(e,s)=>s.props.step=(j.fromString(e)||new j(1)).toString()},{id:"width",type:"input",tileTypes:["number-line"],label:"",value:"number",range:[1,25],location:"more",get:e=>e.props.size,set:(e,s)=>s.props.size=Math.round(+e)},{id:"divisions",type:"input",tileTypes:["number-line"],label:"",value:"number",range:[1,25],location:"more",get:e=>e.props.minor,set:(e,s)=>s.props.minor=Math.round(+e)},{id:"labels",type:"select",tileTypes:["number-line"],options:[{key:"below",label:""},{key:"above",label:""},{key:"hidden",label:""}],location:"more",label:"",icon:"numbers",get:e=>e.props.labels||"below",set:(e,s)=>s.props.labels=e||"below"}]);O([{id:"arrows",type:"select",tileTypes:["number-line","axes"],label:"",location:"more",icon:"axes",options:[{key:"both",label:""},{key:"positive",label:""},{key:"none",label:""}],get:e=>e.props.arrows||"none",set:(e,s)=>s.props.arrows=e}]);var Pe=50,_i=class extends ${constructor(t,i,r){super(t,i,r);this.cannotRotate=!0;this.cannotDragToSelect=!0;this.padding=[0,25,25,0];this.$handles=[];this.$border=h("rect",{"stroke-width":4,fill:"transparent"},this.$el),this.$minorGuides=h("path",{"stroke-width":3},this.$el),this.$majorGuides=h("path",{"stroke-width":2,opacity:.4},this.$el),this.$outline=h("rect",{class:"outline"},this.$el),this.$handles[0]=this.makeHandle("h",o=>this.props.cols=M(Math.round(o.x/Pe),1,25)),this.$handles[1]=this.makeHandle("v",o=>this.props.rows=M(Math.round(o.y/Pe),1,25)),this.$handles[1].css("cursor","ns-resize"),this.props.watch("color",({color:o})=>{for(let n of[this.$border,this.$minorGuides,this.$majorGuides])n.setAttr("stroke",o)}),this.props.watch("rows cols",()=>this.resize(this.props.cols,this.props.rows))}resize(t,i){this.path=new S(P,t*Pe,i*Pe),this.$outline.setRect(this.path),this.$border.setRect(this.path);let r=["",""];for(let o=1;o<i;++o)r[o%2?1:0]+=`M0,${Pe*o}h${Pe*t}`;for(let o=1;o<t;++o)r[o%5?1:0]+=`M${Pe*o},0v${Pe*i}`;this.$minorGuides.setAttr("d",r[0]),this.$majorGuides.setAttr("d",r[1]),this.$handles[0].setTransform({x:this.path.w,y:0}),this.$handles[1].setTransform({x:0,y:this.path.h}),this.transform(),this.$parent.selection.update()}*counters(){for(let t of this.$parent.getTilesOfType("ten-frame-counter"))this.transformed.contains(t.posn)&&(yield t)}moveStart(t=!1){if(super.moveStart(),!t)for(let i of this.counters())this.$parent.selection.add(i)}getSnapPoints(){return Wt(So((t,i)=>new d(.5+t,.5+i).scale(Pe),this.props.cols+1,this.props.rows+1))}fill(){let t=[],i=Array.from(this.$parent.getTilesOfType("ten-frame-counter")).map(r=>r.posn);for(let r=0;r<this.props.rows;r++)for(let o=0;o<this.props.cols;o++){let n=this.worldPosn(new d(Pe*(o+.5),Pe*(r+.5)));if(i.some(l=>l.equals(n,10)))continue;let a=$.create(this.$parent,{name:"ten-frame-counter"});a.setTransform(n),t.push(a)}return t}static makeThumbnail(t){let[i,r]=[5,2],o=h("svg",{width:i*25+4,height:r*25+4},t);h("rect",{x:2,y:2,width:i*25,height:r*25,fill:"none",stroke:y.bg,"stroke-width":3},o);let n="";for(let a=1;a<r;++a)n+=`M2,${2+25*a}h${25*i}`;for(let a=1;a<i;++a)n+=`M${2+25*a},2v${25*r}`;h("path",{d:n,stroke:y.bg,"stroke-width":1},o)}static altText(){return""}};_i.type="ten-frame",_i.defaultProps={color:y.darkGrey,layer:"back",rows:2,cols:5},_i=w([T],_i);var zi=class extends ${constructor(t,i,r){super(t,i,r);this.$path=h("circle",{r:20,class:"polygon-tile"},this.$el),this.$outline=h("circle",{r:20,class:"outline"},this.$el),this.path=new q(P,20),this.props.color||(this.props.color=this.props.value>0?y.yellow:y.red),this.props.watch("color",({color:o})=>this.$path.setAttr("fill",o)),this.props.watch("value",({value:o})=>this.value=o)}moveEnd(){super.moveEnd();let t=this.$parent.getTileAt(this.posn,["ten-frame"]);if(!t)return;let i=t.relativePosn(this.posn),r=t.worldPosn(i.scale(1/Pe).shift(-.5).round().shift(.5).scale(Pe));this.animateTo(r,this.posn,50)}flip(){this.props.value=-this.props.value,this.flipColor(this.props.value>0?y.yellow:y.red)}doubleClick(){this.flip(),this.$parent.change({changed:[this]})}getSnapPoints(){return[P]}static makeThumbnail(t,i){let r=h("svg",{width:40,height:40},t),o=i.value<0?y.red:y.yellow;h("circle",{cx:20,cy:20,r:18,fill:o},r)}static altText(t){return t.value<0?"":""}};zi.type="ten-frame-counter",zi.defaultProps={value:1},zi=w([T],zi);O([{id:"flip",type:"button",tileTypes:["ten-frame-counter"],label:"",click:(e,s)=>{for(let t of e)t.flip();s.change({changed:e})}}]);O([{id:"fill",type:"button",tileTypes:["ten-frame"],label:"",click:(e,s)=>{let t=Wt(e.map(i=>i.fill()));s.change({added:t})}}]);function ie(e){return!!e.setValue}function Gu(e,s){let t=e;for(let i of e.parents()){if(i.type in s&&i.children.indexOf(t)===s[i.type])return i;t=i}}function dv(e,s){for(let t of e.parents(!0))for(let i of s.parents(!0))if(t===i)return i}function _u(e,s,t=!1){let i=t?e.children.slice(0).reverse():e.children,r=s.parent;return i.findIndex((o,n)=>r.hasParent(a=>a===o)||ie(r)&&r===o||e===r&&(t?i.length-n:n)===s.offset)}var ka=class{constructor(s){this.equation=s;this.offset=0;this.$el=h("line",{class:"cursor",hidden:!0},s.$row),this.$range=h("rect",{class:"range",hidden:!0}),s.$row.prepend(this.$range),this.parent=s.root}redraw(){let s=this.getRangeRect();if(this.$el.toggle(!s),this.$range.toggle(!!s),s)this.$range.setRect(s);else{this.selected=void 0;let t=this.getCursorLine();t&&this.$el.setLine(...t),this.$el.restartAnimation()}}hide(){this.$el.hide(),this.$range.hide(),this.clearRange()}startRange(){this.start={parent:this.parent,offset:this.offset}}clearRange(){this.selected=void 0,this.start=void 0}moveToPoint(s){let t=this.equation.root.hitTest(s)||this.equation.root,i=t.worldTransform,r=(s.x-i.x)/(t.width*i.scale);ie(t)?this.moveInto(t,Math.round(r*t.value.length)):r<.5?this.moveBefore(t):this.moveAfter(t)}getRangeRect(){if(!this.start||this.start.parent===this.parent&&this.start.offset===this.offset)return;let s=dv(this.parent,this.start.parent),t=[s];if(s.children.length){let i=_u(s,this.start),r=_u(s,this);r<i&&([i,r]=[r,i]),(i>0||r<s.children.length-1)&&(t=s.children.slice(i,r+1)),t.length||(t=[s]),(i<0||r<0)&&s.type==="mrow"&&s.parent&&(t=[s.parent]),t.length===1&&t[0].type==="mrow"&&(t=t[0].children.slice(0))}return this.selected=t,S.aroundPoints(Xi(t,i=>{let r=i.worldTransform;return[r,{x:r.x+i.width*r.scale,y:r.y+i.height*r.scale}]}))}getCursorLine(){let s=ie(this.parent)?this.parent:this.prev||this.next;if(!s)return;let t=s.worldTransform,i=s.height*t.scale,r=-1;return ie(this.parent)?r=s.width*t.scale*this.offset/s.value.length:this.prev&&(r=this.prev.width*t.scale+1),[{x:t.x+r,y:t.y+2},{x:t.x+r,y:t.y+i-2}]}moveAfter(s){if(s.type==="mrow")return this.moveAfter(z(s.children));if(!s.parent)throw new Error("Move cursor to unattached node");this.parent=s.parent,this.offset=this.parent.children.indexOf(s)+1}moveBefore(s){if(s.type==="mrow")return this.moveBefore(s.children[0]);if(!s.parent)throw new Error("Move cursor to unattached node");this.parent=s.parent,this.offset=this.parent.children.indexOf(s)}moveInto(s,t){if(ie(s)){if(t<=0)return this.moveBefore(s);if(t>=s.value.length)return this.moveAfter(s)}this.parent=s,this.offset=t}get prev(){return this.parent.children[this.offset-1]}get next(){return this.parent.children[this.offset]}handleShift(s,t=!1){if(s&&!this.selected)this.startRange();else if(!s&&this.selected)return t?this.moveBefore(this.selected[0]):this.moveAfter(z(this.selected)),this.clearRange(),!0;this.selected&&this.parent!==this.selected[0].parent&&this.moveAfter(z(this.selected))}left(s){if(this.handleShift(s,!0))return;if(this.selected)return this.offset-=1;if(ie(this.parent))return this.moveInto(this.parent,this.offset-1);let t=this.prev;if(t)return ie(t)?this.moveInto(t,t.value.length-1):t.children.length?this.moveAfter(z(t.children)):this.moveBefore(t);let i=this.parent,r=(i==null?void 0:i.type)==="mrow";if(r&&(i!=null&&i.prev))return this.moveAfter(i.prev);let o=r?i.parent:i;o&&this.moveBefore(o)}right(s){if(this.handleShift(s))return;if(this.selected)return this.offset+=1;if(ie(this.parent))return this.moveInto(this.parent,this.offset+1);let t=this.next;if(t)return ie(t)?this.moveInto(t,1):t.children.length?this.moveBefore(t.children[0]):this.moveAfter(t);let i=this.parent,r=(i==null?void 0:i.type)==="mrow";if(r&&(i!=null&&i.next))return this.moveBefore(i.next);let o=r?i.parent:i;o&&this.moveAfter(o)}up(s){this.selected&&this.clearRange();let t=Gu(this.parent,{mfrac:1,msub:1,msup:0});(t==null?void 0:t.type)==="mfrac"&&this.moveAfter(z(t.children[0].children)),(t==null?void 0:t.type)==="msub"&&this.moveAfter(z(t.children[0].children)),(t==null?void 0:t.type)==="msup"&&this.moveBefore(t.children[1].children[0])}down(s){this.selected&&this.clearRange();let t=Gu(this.parent,{mfrac:0,msub:0,msup:1});(t==null?void 0:t.type)==="mfrac"&&this.moveBefore(t.children[1].children[0]),(t==null?void 0:t.type)==="msub"&&this.moveBefore(t.children[1].children[0]),(t==null?void 0:t.type)==="msup"&&this.moveAfter(z(t.children[0].children))}backspace(){var o;if(this.selected){this.moveBefore(this.selected[0]);for(let n of this.selected)n.deleteFromDom();this.clearRange(),this.parent.children.length||this.parent.addChildren([this.placeholder]);return}if(ie(this.parent)){let n=this.parent.value;return this.setText(n.slice(0,this.offset-1)+n.slice(this.offset)),this.moveInto(this.parent,this.offset-1)}let s=this.prev;if(s)return ie(s)&&s.value.length>1?s.setValue(s.value.slice(0,-1)):s.type==="placeholder"||s.children.length?this.left():(s.deleteFromDom(),this.parent.children.length||this.parent.addChildren([this.placeholder]),this.moveInto(this.parent,this.offset-1));let t=this.parent,i=t.children,r=0;t.type==="mrow"&&t.parent&&(r=((o=t.prev)==null?void 0:o.children.filter(n=>n.type!=="placeholder").length)||0,t=t.parent,i=Wt((t==null?void 0:t.children.map(n=>n.children))||[])),t!=null&&t.parent&&(this.moveInto(t.parent,t.index+r),t.insertAfter(i.filter(n=>n.type!=="placeholder")),t.deleteFromDom(),this.parent.children.length||this.parent.addChildren([this.placeholder]))}get placeholder(){return new ro(this.equation)}setText(s,t){if(!t&&ie(this.parent)&&(t=this.parent),!!t){if(s in Os&&(s=Os[s]),s==="sqrt"){let i=this.createNode("msqrt");return t.insertAfter([i]),t.deleteFromDom(),this.moveBefore(i.children[0].children[0])}t.setValue(s)}}createNode(s,t){let i=ts(this.equation,t||[this.placeholder]);if(s==="mfenced")return new ur([i],this.equation);if(s==="msqrt")return new si(s,[i],this.equation);let r=ts(this.equation,[this.placeholder]);if(s==="mfrac")return new oo([i,r],this.equation);if(s==="mroot")return new si(s,[i,r],this.equation);if(s==="msub"||s==="msup")return new ti(s,[i,r],this.equation)}splitTextNode(){let s=this.parent,t=s.value.slice(this.offset);s.setValue(s.value.slice(0,this.offset)),s.insertAfter([new Is(s.type,t,this.equation)]),this.moveAfter(s)}insert(s,t){var r,o,n,a,l;let i=((r=this.prev)==null?void 0:r.type)==="placeholder";if(ie(this.parent)&&!this.start&&!this.selected){let c=this.parent.value;((o=this.parent)==null?void 0:o.type)===s?(this.setText(c.slice(0,this.offset)+t+c.slice(this.offset)),this.moveInto(this.parent,this.offset+1)):(this.splitTextNode(),this.insert(s,t))}else if(s==="mi"||s==="mn"||s==="mtext")this.selected&&this.backspace(),((n=this.prev)==null?void 0:n.type)===s?this.setText(this.prev.value+t,this.prev):((a=this.next)==null?void 0:a.type)===s?(this.setText(t+this.next.value,this.next),this.moveInto(this.next,1)):(this.parent.addChildren([new Is(s,t,this.equation)],this.offset),i||(this.offset+=1));else if(s==="mo"||s==="mspace"){this.selected&&this.backspace();let c=s==="mo"?new Is("mo",t,this.equation):new io(this.equation);this.parent.addChildren([c],this.offset),i||(this.offset+=1)}else{let c=s==="msub"||s==="msup"||s==="mfrac"&&((l=this.prev)==null?void 0:l.type)!=="mo",p=this.selected||(c&&this.prev?[this.prev]:void 0);p&&this.moveBefore(p[0]),this.selected&&this.clearRange();let u=this.createNode(s,p);this.parent.addChildren([u],this.offset),this.moveBefore(u.children[p&&u.children.length>1?1:0].children[0])}}toSubSup(s){let t=this.placeholder,i=s.type==="msub"?2:1;s.addChildren([ts(this.equation,[t])],i),s.type="msubsup",this.moveBefore(t)}type(s){var t,i,r,o,n,a;if(s=s.replace("*","\xB7").replace("-",""),/^[A-Za-z]$/.test(s))this.insert("mi",s);else if("0123456789.".includes(s))this.insert("mn",s);else if("+\xB1\xD7\xB7\xF7<>=%!".includes(s))this.insert("mo",s);else if(s===" "){let l=(t=this.prev)==null?void 0:t.type,c=(i=this.next)==null?void 0:i.type;if(l==="placeholder"||l==="mspace"||c==="placeholder"||c==="mspace"||!ie(this.parent)&&l!=="mi"&&c!=="mi")return;this.insert("mspace")}else if(s==="frac"||s==="/")this.insert("mfrac",s);else if(s==="sqrt")this.insert("msqrt",s);else if(s==="^"||s==="sup"){if(((r=this.prev)==null?void 0:r.type)==="msub")return this.toSubSup(this.prev);this.insert("msup",s)}else if(s==="_"||s==="sub"){if(((o=this.prev)==null?void 0:o.type)==="msup")return this.toSubSup(this.prev);this.insert("msub",s)}else if(s==="brackets"||"([{|".includes(s))this.insert("mfenced",s);else if(")]}".includes(s))if(((a=(n=this.parent)==null?void 0:n.parent)==null?void 0:a.type)==="mfenced")this.moveAfter(this.parent.parent);else{let l=this.prev;this.parent.addChildren([this.createNode("mfenced",l?[l]:void 0)],this.offset),l||(this.offset+=1)}}copy(){return this.selected?this.selected.map(s=>s.expr).join(""):""}paste(s){try{let t=this.equation.parse(s);if(this.selected&&this.backspace(),t.length===1&&ie(t[0]))return this.insert(t[0].type,t[0].value),t[0].deleteFromDom();ie(this.parent)&&this.splitTextNode(),this.parent.addChildren(t,this.offset),this.moveAfter(z(t))}catch(t){}}};var $c=class{constructor(s,t,i=!0){this.$el=h("g",{class:"equation",style:"font-size:20px;text-anchor:start"},s),this.equation=new Re(this.$el,void 0,0,"",20,i);try{this.equation.setValue(t)}catch(r){console.warn("Parsing error",t,r.message)}}get expr(){return Je.parse(this.equation.root.expr).collapse()}setExpr(s){this.equation.setValue(s)}get width(){return this.equation.root.width}get height(){return this.equation.root.height}},Pc=class extends $c{constructor(t,i,r,o=!0){super(i,r,o);this.tile=t;this.cursor=new ka(this.equation),this.$textarea=h("textarea",{class:"hidden-input",tabindex:-1},t.$parent),this.$textarea.on("key",n=>this.handleKey(n)),this.$textarea.on("blur",()=>t.blur()),this.$textarea.on("cut copy",n=>{var a;(a=window.navigator.clipboard)==null||a.writeText(this.cursor.copy()),n.type==="cut"&&(this.cursor.backspace(),this.redraw())}),this.$textarea.on("paste",()=>H(this,null,function*(){var a;let n=yield(a=window.navigator.clipboard)==null?void 0:a.readText();n&&(this.cursor.paste(n),this.redraw())}))}redraw(){this.equation.resize(),this.tile.resize(),this.tile.transform(),this.cursor.redraw(),this.tile.$parent.trigger("change-focus",{tiles:[this.tile]})}bindSlideEvents(t,i){this.tile.$parent.events.listen(this.tile.$el,{down:r=>{r.event.preventDefault(),this.cursor.clearRange(),this.moveCursor(t(r))},start:()=>this.cursor.startRange(),move:r=>this.moveCursor(t(r)),blurInput:!1,checkIfActive:i})}handleKey(t){var i;if(!((i=this.excludedChars)!=null&&i.includes(t.char))){switch(Yr(t)){case"Enter":case"Escape":this.$textarea.blur(),setTimeout(()=>this.tile.$parent.selection.add(this.tile,!0));return;case"ArrowLeft":this.cursor.left(t.shift);break;case"ArrowRight":this.cursor.right(t.shift);break;case"ArrowUp":this.cursor.up(t.shift);break;case"ArrowDown":this.cursor.down(t.shift);break;case"Backspace":case"Delete":return this.cursor.backspace(),this.redraw();default:return this.cursor.type(t.char),this.redraw()}this.cursor.redraw()}}moveCursor(t){this.cursor.moveToPoint(t||P),this.cursor.redraw()}focus(){this.$textarea.show(),this.$textarea.focus()}blur(){return this.cursor.hide(),this.$textarea.hide(),this.equation.updateDescription(),this.equation.root.expr}delete(){this.$el.remove(),this.$textarea.remove()}};function uv(e){let s=br(e)[1];return s instanceof Xe?!1:!(s instanceof Ft&&s.fn===""&&s.args.length===1&&s.args[0]instanceof Xe)}var Bi=class extends ${constructor(t,i,r){super(t,i,r);this.creating=!1;this.$box=h("rect",{fill:"transparent"},this.$el),this.$outline=h("rect",{class:"outline"},this.$el),this.$resultText=h("text",{opacity:.5,style:"font-size:13px;text-anchor:start"},this.$el),this.props.watch("evaluate",({evaluate:o})=>{var n;this.$resultText.toggle(o),(n=this.watcher)==null||n.call(this)}),this.equationArea=new Pc(this,this.$el,this.props.expr),this.equationArea.bindSlideEvents(o=>this.getCursorOffset(o),()=>!!this.isFocussed),this.props.watch("fontSize",({fontSize:o})=>{this.equationArea.$el.css("transform",o?`scale(${this.scale})`:""),this.$resultText.css("font-size",14*this.scale+"px"),this.resize()}),this.props.color||(this.props.color=t.state.penColor),this.props.watch("color",({color:o})=>{this.equationArea.$el.css("color",o),this.$resultText.setAttr("fill",o),this.emitMessage("main",{type:"equation",text:this.props.expr})}),this.makeOutPort("main",{tileTypes:["axes"],connect:o=>o.enqueueMessage({type:"equation",text:this.props.expr})}),this.updateMath()}applyChange(t){super.applyChange(t),"expr"in t&&(this.equationArea.setExpr(this.props.expr),this.resize(),this.updateMath())}get scale(){return 1.2**(this.props.fontSize||0)}doubleClick(t){this.focus(!1,t)}resize(){let t=this.equationArea.width*this.scale+16,i=this.equationArea.height*this.scale+12;this.path=new S(P.shift(-8,-6),t,i);for(let r of[this.$box,this.$outline])r.setRect(this.path);this.$resultText.setTransform({x:0,y:i+10*this.scale-6}),this.transform()}delete(){super.delete(),this.equationArea.delete()}getSnapPoints(){return[]}focus(t=!1,i){this.isFocussed||(super.focus(),this.creating=t,this.showErrorIcon(),this.$el.css("cursor","text"),this.equationArea.focus(),this.equationArea.moveCursor(this.getCursorOffset(i)))}blur(){if(!this.isFocussed)return;super.blur(),this.$el.css("cursor","grab");let t=this.props.expr;if(this.props.expr=this.equationArea.blur(),this.resize(),this.updateMath(),this.creating||t!==this.props.expr){let i=this.creating?"added":"changed";this.$parent.change({[i]:[this]}),this.emitMessage("main",{type:"equation",text:this.props.expr})}}updateMath(){let t=this.$parent.mathContext;this.watcher&&t.unwatch(this.watcher);let i=t.attemptUpdateSource(this,this.props.expr);if(!i){this.watcher=void 0,this.value=0;return}let r=uv(i),o=()=>{let{error:n,value:a}=t.evaluate(i);this.showErrorIcon(this.props.evaluate?n:void 0),this.value=a||0,this.$resultText.textStr=r&&!Number.isNaN(a)?`= ${mt(a,8)}`:""};this.watcher=o,t.watch(i.unknowns,o,!0)}getCursorOffset(t){return t?this.relativePosn(t.posn).scale(1/this.scale):P}};Bi.type="equation",Bi.defaultProps={layer:"front",expr:"placeholder"},Bi=w([T],Bi);O([["","fraction","frac"],["","power","sup"],["","sqrt","sqrt"]].map(([e,s,t])=>({id:s,type:"button",label:e,icon:s,tileTypes:["equation"],focus:"show",click:i=>i[0].equationArea.handleKey({char:t})})));O([{id:"set-eval",icon:"calculate",label:"",type:"checkbox",tileTypes:["equation"],location:"more",get:e=>e.props.evaluate||!1,set:(e,s)=>s.props.evaluate=e}]);var fv=Zt(Fo),Br=class extends ${constructor(t,i,r){super(t,i,r);this.aspectRatio=1;let{href:o}=this.props;this.$image=h("image",{href:o,crossorigin:"anonymous"},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.$handle=this.makeHandle("c",n=>{let a=Math.max(50,50*this.aspectRatio),l=Math.min(1e3,1e3/this.aspectRatio);this.props.width=+M(n.x,a,l).toFixed(2)}),this.$handle.css("cursor","nwse-resize"),this.props.watch("href",l=>H(this,[l],function*({href:n,width:a}){if(!n)return;this.$image.setAttr("href",n);let c=yield fv(n);this.aspectRatio=c.height/c.width,a||(this.props.width=c.width),this.resize()})),this.props.watch("width",()=>this.resize())}resize(){let t=this.props.width||100,i=t*this.aspectRatio;this.$image.setAttr("width",t),this.$image.setAttr("height",i),this.path=new S(P,t,i),this.$outline.draw(this.path),this.$handle.setCenter({x:t,y:i}),this.transform(),this.$parent.selection.update()}};Br.type="image",Br=w([T],Br);var mv="M7,4,2.3-.3,6.6-5a1.2,1.2,0,0,0,0-1.5l-.4-.3a1,1,0,0,0-1.4,0L0-2.5-4.8-6.8a1,1,0,0,0-1.4,0l-.4.3A1.2,1.2,0,0,0-6.6-5L-2.3-.3-7,4a1.1,1.1,0,0,0-.1,1.4l1.5,1.4a.9.9,0,0,0,1.3,0L0,2.1,4.3,6.8a.9.9,0,0,0,1.3,0L7.1,5.4A1.1,1.1,0,0,0,7,4Z",Bu="M7.7-5.7l-.2-.4-.3-.2c-.1-.1-.3,0-.4,0A36.6,36.6,0,0,0-3,2.1,36.1,36.1,0,0,0-7.8-.8h-.5l-1,.9a.4.4,0,0,0-.1.3c0,.2,0,.3.1.4a72.1,72.1,0,0,1,6.6,7h.4l.4-.2C1.9,1,3.8-1.8,7.5-5.2,7.7-5.3,7.7-5.5,7.7-5.7Z",zu={fill:"none",style:"touch-action: none",stroke:y.green},Tc=class{constructor(s){this.$el=h("g",{});this.$ring=h("circle",U({opacity:.6},zu),this.$el);this.$burst=h("path",zu,this.$el);this.$mark=h("g",{class:"problem-marker"},this.$el);this.$circle=h("circle",{r:13},this.$mark);this.$cross=h("path",{d:mv,fill:"white"},this.$mark);this.$check=h("path",{d:Bu,fill:"white"},this.$mark);this.isAnimating=!1;s.append(this.$el)}show(s=!1,t=!0){this.$cross.toggle(!s),this.$check.toggle(s),this.$circle.setAttr("fill",s?y.green:y.red),this.$mark.addClass("show"),t&&s&&this.burst()}hide(){this.$mark.removeClass("show")}burst(s=1e3,t=60,i=20){return H(this,null,function*(){this.isAnimating||(this.isAnimating=!0,yield et(r=>{let o=wt("sine-out",r);this.$ring.setAttr("r",.6*o*t),this.$ring.setAttr("stroke-width",.25*(1-o)*t);let n=wt("exp-out",r),a=(.4+.6*n)*t,l=(.1+.9*n)*t,c="";for(let p=0;p<i;++p){let u=Math.cos(B*p/i),f=Math.sin(B*p/i);c+=`M${u*l} ${f*l}L${u*a} ${f*a}`}this.$burst.setAttr("d",c)},s).promise,this.isAnimating=!1)})}},ks=class extends ${constructor(t,i,r){super(t,i,r);this.cannotRotate=!0;this.correct=!1;this.solution=atob(this.props.solution||""),this.$bg=h("rect",{fill:y.bg,rx:6},this.$el),this.$box=h("rect",{class:"problem-box",rx:6},this.$el),this.$text=h("text",{class:"problem-text",text:this.text,y:36},this.$el),this.mark=new Tc(this.$el),this.$input=h("input",{class:"problem-text",style:"display:none"},t.$html),this.$input.onKey("Enter",()=>this.$input.blur()),this.$input.on("blur",()=>this.blur()),this.$parent.canEditQuestions?(this.$handle=this.makeHandle("c",o=>this.props.width=tt(M(o.x,50,400),25)),this.$handle.css("cursor","ew-resize")):(this.$input.setInputPattern(this.props.solution),this.checkAnswer(!1),this.cannotEdit=!0,this.hideActionBar=!0),this.props.watch("width",()=>this.resize())}applyChange(t){("solution"in t||"submitted"in t)&&this.recreate(t),super.applyChange(t)}resize(){var t;this.path=new S(P,this.props.width,50),this.$input.css({width:this.props.width+"px",height:"50px"}),this.$bg.setRect(this.path),this.$box.setRect(this.path),this.$text.setAttr("x",this.props.width/2),this.mark.$el.setTransform({x:this.props.width,y:0}),(t=this.$handle)==null||t.setCenter({x:this.props.width,y:50}),this.transform()}hideForThumbnail(t){this.$text.text=t?this.text:"?"}delete(){super.delete(),this.$input.remove()}get text(){return(this.$parent.canEditQuestions?this.solution:this.props.submitted)||"?"}click(){this.isFocussed||this.$parent.events.shiftKey||this.correct&&!this.$parent.canEditQuestions||(this.isFocussed=!0,this.$parent.selection.add(this,!0),setTimeout(()=>{this.$el.removeClass("correct incorrect"),this.mark.hide()}),this.$input.css({top:this.posn.y+"px",left:this.posn.x+"px"}),this.$input.value=this.text,this.$text.hide(),this.$input.show(),this.$input.focus(),document.execCommand("selectAll",!1))}blur(){if(!this.isFocussed)return;this.isFocussed=!1,this.$input.hide(),this.$text.show();let t=this.$input.value.trim();t!==this.text&&(this.$parent.canEditQuestions?(this.solution=t.replace(":",""),this.props.solution=btoa(this.solution),this.props.submitted="",this.props.attempts=0):(t&&t!==this.props.submitted&&(this.props.attempts+=1),this.props.submitted=t==="?"?"":t.replace(":",""),setTimeout(()=>{this.checkAnswer(),this.solution&&ks.gradeWorksheet(this.$parent)})),this.$text.text=this.text,this.$parent.change({changed:[this]}))}isCorrect(){if(!this.props.submitted||!this.solution)return!1;if(this.props.submitted.toLowerCase()===this.solution.toLowerCase())return!0;let t=Ba(this.solution),i=Ba(this.props.submitted);return E(i,t)||Ha(t)===this.props.submitted||this.solution===Ha(i)}checkAnswer(t=!0){this.solution&&(this.correct=this.isCorrect(),this.props.submitted&&this.mark.show(this.correct,t),this.$el.setClass("correct",this.correct),this.$el.setClass("incorrect",!!this.props.submitted&&!this.correct))}static gradeWorksheet(t){let i=[0,0,0,0];for(let r of t.getTilesOfType("question-blank"))r.solution&&(i[0]+=1,r.props.submitted&&(i[r.correct?r.props.attempts<=1?1:2:3]+=1));i[0]===i[1]+i[2]&&Rh()}static makeThumbnail(t){let i=h("svg",{width:130,height:70},t);h("rect",{x:15,y:15,width:100,height:50,class:"problem-box",rx:6},i),h("text",{x:65,y:50,text:"?",class:"problem-text"},i),h("circle",{cx:115,cy:15,r:13,fill:y.blue},i),h("path",{d:Bu,fill:"white",transform:"translate(115 15)"},i)}};ks.type="question-blank",ks.defaultProps={attempts:0,width:100,layer:"front"},ks=w([T],ks);var gv=/(https?:\/\/)?\w[\w#%+.:=~-]{1,256}\.[a-z]{2,6}\b([\w!#%&()+,./:=?@~-]*[\w#%&()+/=@~-])?/gi,vv={bold:"font-weight",italic:"font-style",underline:"text-decoration",color:"color"};function Hu(e,s){return e.style.getPropertyValue(s)||""}function Fu(e,s,t){e.style.setProperty(s,t)}function yv(e,s){s==="font-weight"||s==="font-style"?e.style.setProperty(s,"normal"):s==="text-decoration"?e.style.setProperty(s,"none"):e.style.removeProperty(s)}var Hi=class extends ${constructor(t,i,r){super(t,i,r);this.size=0;this.creating=!1;this.$box=h("rect",{fill:"transparent"},this.$el),this.$foreign=h("foreignObject",{width:1,height:1,overflow:"visible"},this.$el),this.$text=h("div",{class:"text-edit",style:"pointer-events: none",xmlns:"http://www.w3.org/1999/xhtml"},this.$foreign),this.$links=h("g",{},this.$el),this.$outline=h("path",{class:"outline"},this.$el),this.$handle=this.makeHandle("c",o=>this.props.width=M(tt(o.x,25),75,1e3)),this.$handle.css("cursor","ew-resize"),this.props.html=Kh(this.props.html||"Text"),this.$text.html=this.props.html,this.props.color||(this.props.color=t.state.penColor),this.props.watch("color",({color:o})=>this.$text.css("color",o)),this.props.watch("fontSize width",({fontSize:o,width:n})=>{this.$text.css("font-size",20*1.2**o+"px"),this.$text.css("white-space",n?"pre-wrap":"pre"),this.updateOutline()}),this.formatURLs(),this.$text.on("pointerdown",o=>o.handled=!0),this.$text.on("keydown",o=>this.interceptKeys(o)),this.$text.on("blur",()=>this.blur()),t.events.listen(this.$links,{}),this.$links.on("contextmenu",o=>o.stopPropagation())}applyChange(t){super.applyChange(t),"html"in t&&(this.$text.html=this.props.html,this.updateOutline())}getSnapPoints(){return[]}updateOutline(){var r;let t=(r=this.props.width)!=null?r:this.$text.width+1;this.$foreign.setAttr("width",t||1),t=this.$text.width;let i=this.$text.height;this.$foreign.setAttr("height",i||1),this.createLinkHitBoxes(),this.path=new S(P,t,i),this.$box.setRect(this.path),this.$outline.draw(this.path),this.$handle.setCenter({x:t,y:i}),this.transform(),this.$parent.selection.update()}selectAll(){let t=this.selection,i=document.createRange();i.selectNodeContents(this.$text._el),t==null||t.removeAllRanges(),t==null||t.addRange(i)}format(t,i){if(t==="color")return this.formatFont("color",i);this.formatFont(vv[t]||"",t),this.cleanupElements(this.$text._el.children),this.updateOutline(),this.props.html=this.$text.html}get selection(){var i,r;return(((r=(i=this.$el._el).getRootNode)==null?void 0:r.call(i))||document).getSelection()}formatFont(t,i){if(!this.isFocussed){let n=new Range,a=this.$text._el.childNodes;return n.setStartBefore(a[0]),n.setEndAfter(a[a.length-1]),this.formatRange(n,t,i)}let r=this.selection;if(!r)return;let o=[];for(let n=0;n<r.rangeCount;++n){let a=r.getRangeAt(n);this.formatRange(a,t,i),o.push(r.getRangeAt(n))}r.removeAllRanges();for(let n of o)r.addRange(n)}formatRange(t,i,r){let o=t==null?void 0:t.extractContents().childNodes;if(!o)return;let n=t.commonAncestorContainer;(n==null?void 0:n.nodeName)==="#text"&&n.parentNode&&(n=n.parentNode),this.removeEmptyTextNodes(o),this.wrapChildrenInSpans(n,o,i),this.updateRangeChildren(o,i,r);for(let a=o.length-1;a>=0;--a)t.insertNode(o[a])}removeEmptyTextNodes(t){for(let i=0;i<t.length;i++){let r=t[i];r.nodeName==="#text"&&!r.nodeValue&&r.remove()}}wrapChildrenInSpans(t,i,r){for(let o of Array.from(i)){if(!["#text","DIV"].includes(o.nodeName))continue;let n=document.createElement("span");n.append(document.createTextNode(o.textContent||"")),Fu(n,r,Hu(t,r)),o.nodeName==="DIV"?o.innerHTML=n.outerHTML:o.replaceWith(n)}}updateRangeChildren(t,i,r){if(r==="smaller"||r==="larger"){let o=t[0],n=Number.parseFloat(o.style.fontSize)||100,a=(r==="smaller"?1/1.2:1.2)*n;this.setChildrenStyles(t,"font-size",a+"%")}else this.allChildrenHaveStyle(t,i,r)?this.unsetChildrenStyles(t,i):this.setChildrenStyles(t,i,r)}allChildrenHaveStyle(t,i,r){for(let o=0;o<t.length;++o){let n=t[o];if(Hu(n,i)!==r)return!1}return!0}unsetChildrenStyles(t,i){for(let r=0;r<t.length;++r){let o=t[r];yv(o,i),this.unsetChildrenStyles(o.children,i)}}setChildrenStyles(t,i,r){for(let o=0;o<t.length;++o){let n=t[o];Fu(n,i,r),this.clearChildrenStyles(n.children,i)}}clearChildrenStyles(t,i){for(let r=0;r<t.length;++r){let o=t[r];o.style.removeProperty(i),this.clearChildrenStyles(o.children,i)}}cleanupElements(t){for(let i=0;i<t.length;++i)this.cleanupElements(t[i].children);for(let i=0;i<t.length;++i)!t[i].textContent&&t[i].nodeName!=="BR"&&t[i].remove();for(let i=0;i<t.length;++i)t[i].nodeName!=="DIV"&&(t[i].getAttribute("style")||t[i].replaceWith(...Array.from(t[i].childNodes)))}select(){super.select(),this.$links.hide()}deselect(){super.deselect(),this.$links.show()}doubleClick(){this.focus()}focus(t=!1){this.isFocussed||(super.focus(),this.removeAnchors(),this.$links.removeChildren(),this.creating=t,this.$text.css("pointer-events","all"),this.$text.setAttr("contenteditable",!0),this.$text.focus(),this.selectAll())}blur(){var r;if(!this.isFocussed)return;super.blur(),this.$text.css("pointer-events","none"),this.$text.removeAttr("contenteditable");let t=this.$text.html.replace(/\r\n|\r|\n/g,"<br>");this.$text.html=t,this.formatURLs();let i=this.props.html!==t;if(t){this.$text.show(),this.props.html=t,this.updateOutline();let o=this.creating?"added":"changed";(this.creating||i)&&this.$parent.change({[o]:[this]})}else this.delete(),this.creating||this.$parent.change({deleted:[this]});(r=this.selection)==null||r.removeAllRanges()}formatURLs(){this.removeAnchors(),this.replaceURLs(this.$text),this.createLinkHitBoxes()}replaceURLs(t){if(!(t instanceof Text)){for(let n of t.childNodes)this.replaceURLs(n);return}let i=t.textContent||"",r=0;for(let n of i.matchAll(gv)){let a=i.slice(r,n.index);a&&t.before(document.createTextNode(a));let l=document.createElement("a");l.setAttribute("style","text-decoration:underline;color:#0f82f2"),l.textContent=n[0],t.before(l),r=n.index+n[0].length}let o=i.slice(r);o&&t.before(document.createTextNode(o)),t.remove()}removeAnchors(){for(let t of this.$text.$$("a")){let i=t._el;i.replaceWith(...Array.from(i.childNodes))}}createLinkHitBoxes(){this.$links.removeChildren();for(let t of this.$text.$$("a")){let i=ot(document.createElementNS("http://www.w3.org/2000/svg","a")),r=t.text;r.startsWith("http")||(r=`https://${r}`),i.setAttr("href",r),i.setAttr("target","_blank"),this.$links.append(i),h("rect",{x:t.offsetLeft,y:t.offsetTop,width:t.width,height:t.height,fill:"transparent"},i)}}interceptKeys(t){if(t.key==="Escape"){this.$text.blur(),setTimeout(()=>this.$parent.selection.add(this));return}if(this.path=new S(P,this.$text.width,this.$text.height),this.transform(),this.$parent.trigger("change-focus",{tiles:[this]}),!(t.ctrlKey||t.metaKey))return;let r={b:"bold",i:"italic",u:"underline"}[t.key];r&&(t.stopPropagation(),t.preventDefault(),this.format(r))}};Hi.type="text",Hi.defaultProps={layer:"front"},Hi=w([T],Hi);O([["","bold"],["","italic"],["","underline"]].map(([e,s])=>({id:s,type:"button",label:e,icon:s,tileTypes:["text"],focus:"showAlways",click:(t,i,r)=>{for(let o of t)o.format(s);r||i.change({changed:t})}})));O(["",""].map((e,s)=>({id:s?"shrink":"grow",type:"button",label:e,icon:s?"font-shrink":"font-grow",tileTypes:["text","equation"],focus:"showAlways",show:(t,i)=>!i||t.every(r=>r.is("text")),click:(t,i,r)=>{if(r)for(let o of t)o.format(s?"smaller":"larger");else{for(let o of t){let n=o.path.h;o.props.fontSize=M((o.props.fontSize||0)+(s?-1:1),-5,10);let a=o.path.h;o.setTransform(o.posn.shift(0,n-a))}i.change({changed:t})}}})));var bv=[[0,0]],Uu=[[0,-39],[0,39]],wv=[...Uu,[0,0]],Ca=[[-18,-39],[18,-39],[-18,39],[18,39]],xv=[...Ca,[0,0]],Zu=[...Ca,[-18,0],[18,0]],$v=[...Zu,[0,-19]],Sc=[...Ca,[-18,-13],[18,-13],[-18,13],[18,13]],Pv=[...Sc,[0,0]],Tv=[...Sc,[0,-26],[0,26]],ju=250,Sv={C:"#333",S:"#333",H:y.orange,D:y.orange},kv={A:bv,2:Uu,3:wv,4:Ca,5:xv,6:Zu,7:$v,8:Sc,9:Pv,10:Tv},Cv="AH:2H:3H:4H:5H:6H:7H:8H:9H:0H:JH:QH:KH:AC:2C:3C:4C:5C:6C:7C:8C:9C:0C:JC:QC:KC:KD:QD:JD:0D:9D:8D:7D:6D:5D:4D:3D:2D:AD:KS:QS:JS:0S:9S:8S:7S:6S:5S:4S:3S:2S:AS".split(":").map(e=>e+"f"),Mv={A:1,J:11,Q:12,K:13,0:10},Av={C:"",S:"",H:"",D:""};function qu(e,s){e.removeChildren();let[t,i,r]=s.split("");if(s==="deck"||r)return h("rect",{x:-39,y:-57,width:78,height:114,rx:2,fill:"url(#card-bg)"},e);t==="0"&&(t="10"),e.setAttr("fill",Sv[i]);let o=`#suit-${i.toLowerCase()}`;if(i==="J")h("image",{href:"/css/svg/mathigon/joker.svg",style:"transform: translate(-35px, -53px)",width:70},e),t="Joker";else if(["K","Q","J"].includes(t))h("use",{href:o,style:"transform:translate(-35px,-36px) scale(0.6)",width:24,height:24},e),h("use",{href:o,style:"transform:rotate(180deg) translate(-35px,-36px) scale(0.6)",width:24,height:24},e),h("image",{href:`https://mathigon.org/polypad/assets/cards/${s.toLowerCase()}.svg`,style:"transform:translate(-35px,-53px)",width:70},e);else{let a=t==="A"?" scale(1.7)":"";for(let l of kv[t]||[]){let c=l[1]>0?" rotate(180deg)":"";h("use",{href:o,style:`transform: translate(${l[0]}px, ${l[1]}px)`+c+a,width:24,height:24},e)}}let n={text:t,x:-40,y:-45,style:"font-size:16px;letter-spacing:-1px;text-anchor:start"};h("text",n,e),h("text",it(U({},n),{style:"transform:rotate(180deg);text-anchor:start"}),e)}var ns=class extends ${constructor(t,i,r){super(t,i,r);this.padding=[0,0,20,0];this.count=0;this.cards=[];this.$label=h("g",{class:"outline card-label"},this.$el),this.$labelRect=h("rect",{width:30,height:35,rx:5},this.$label),this.$labelText=h("text",{x:6,y:30,style:"text-anchor:start"},this.$label),this.$stack=h("rect",{class:"polygon-tile",fill:"url(#card-gradient)",rx:10},this.$el),this.$path=h("rect",{class:"polygon-tile",fill:"#eee",rx:10},this.$el),this.$body=h("g",{transform:"scale(1.4)"},this.$el),this.$outline=h("rect",{class:"outline",rx:10},this.$el),this.$path.setRect(new S(new d(-125/2,-175/2),125,175)),this.setCards(this.props.cards==="deck"?Cv:this.props.cards.split(":"))}applyChange(t){super.applyChange(t),"cards"in t&&this.setCards(this.props.cards.split(":"))}setCards(t){this.cards=t,this.props.cards=t.join(":"),this.count=t.length,this.value=_(t.map(o=>+(Mv[o[0]]||o[0])));let i=Math.sqrt(this.count-1)*3;this.path=new S(new d(-125/2,-175/2),125,175+i);for(let o of[this.$stack,this.$outline])o.setRect(this.path);this.transform(),this.$label.setAttr("hidden",this.count<=1?!0:void 0),this.$label.setTransform({x:-125/2,y:175/2-15+i}),this.$labelRect.setAttr("width",46+this.count.toFixed(0).length*8),this.$labelText.text=`${this.count} cards`;let r=z(t);r!==this.top&&qu(this.$body,r),this.top=r}addCards(t){this.setCards(this.cards.concat(t))}highlight(t=!0){this.$el.setClass("active",t)}move(t){if(super.move(t),this.$parent.selection.tiles.size>1)return;let i=this.findNearby("card",75);i&&this.cards.length+i.cards.length>ju&&(i=void 0),this.setCollision(i)}collide(t){t.highlight(!1),t.addCards(this.cards),this.delete();let i=this.lastSavedData?[this]:void 0;this.$parent.change({changed:[t],deleted:i})}doubleClick(){let t=this.draw();t&&this.$parent.change({added:[t],changed:[this]})}flip(){this.$parent.playSound("click"),this.setCards(this.cards.reverse().map(t=>t.length>2?t.slice(0,2):t+"f"))}draw(){if(this.count<=1)return;this.$parent.playSound("draw"),this.$parent.selection.clear();let t=this.cards.pop();this.setCards(this.cards);let i=new ns(this.$parent,{cards:t});return i.rot=this.rot,i.animateTo(this.posn.shift(150,0),this.posn),i}shuffle(){this.count<=1||(this.$parent.playSound("shuffle"),this.setCards(vt.shuffle(this.cards)))}static makeThumbnail(t){let i=h("svg",{width:60,height:74},t);h("rect",{x:5,y:2,width:50,height:70,fill:"white",rx:4,stroke:y.bg,"stroke-width":.3},i);let r=h("g",{style:"transform: translate(30px, 37px) scale(0.55)"},i);t.onAttr("props",o=>{let n=Pt(o);qu(r,n.cards),t.setAttr("aria-label",ns.altText(n))})}static altText(t){return t.cards==="deck"?"":t.cards==="JJ"?"":`${t.cards[0]} ${Av[t.cards[1]]} `}};ns.type="card",ns=w([T],ns);O([{id:"turn-over",type:"button",tileTypes:["card"],label:"",click:(e,s)=>{for(let t of e)t.flip();s.change({changed:e})}},{id:"stack",type:"button",tileTypes:["card"],label:"",show:e=>e.length>1&&_(e.map(s=>s.cards.length))<=ju,click:(e,s)=>{let t=e.map(n=>n.props.cards).join(":"),{x:i,y:r}=ut(...e.map(n=>n.transformed)).center,o=new ns(e[0].$parent,{cards:t,x:i,y:r});for(let n of e)n.delete();s.selection.add(o),s.change({added:[o],deleted:e})}},{id:"draw",type:"button",tileTypes:["card"],label:"",show:e=>e.length===1&&e[0].count>1,click:(e,s)=>{let t=e[0].draw();s.change({added:[t],changed:e})}},{id:"shuffle",type:"button",tileTypes:["card"],label:"",show:e=>e.some(s=>s.count>1),click:(e,s)=>{for(let t of e)t.shuffle();s.change({changed:e})}}]);var Ev="M0 7.4L8.6 12L7 2.4L13.9 -4.4L4.3 -5.8L0 -14.5L-4.3 -5.8L-13.9 -4.4L-7 2.4L-8.6 12L0 7.4",Yu="M12.9,9.7C13.9,3,4,5.3,4,1.2H4C9.4-3.7,7.6-14,.1-14.3S-9.3-3.9-4,1.3c-.1,3.8-9.8,1.9-8.9,8.4h0C-5.5,13.2,5.2,13.2,12.9,9.7Z",Wu=23,Vv=[y.red,y.blue],Dv=[Ev,Yu],Ku={hideBackface:!0,fov:120},Hr=class extends ${constructor(t,i,r){var a;super(t,i,r);this.isAnimating=!1;let o=new q(P,Wu),n=Vv.map((l,c)=>{let p=new pe(o,{class:"dice-face",fill:l,stroke:l}),u=new pe(Dv[c],{class:"dice-dot"});return u.transform.translate(0,0,1),new xe([p,u])});n[1].transform.rotate(Math.PI,0,0),this.coin=new xe(n,{},this.$el),this.coin.sorting=!0,this.setValue((a=this.props.value)!=null?a:vt.integer(0,1)),this.path=new q(P,25),this.$outline=h("path",{class:"outline",path:this.path},this.$el)}applyChange(t){super.applyChange(t),"value"in t&&this.setValue(t.value)}get aggregationCategory(){return this.value===1?"":""}get aggregationCategories(){return["",""]}setValue(t){this.value=this.props.value=t,this.coin.transform.clear().rotate(t?Math.PI:0,0,0),this.coin.render(Ku)}roll(t=2e3){return H(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0,this.$parent.playSound("coinToss");let i=vt.integer(0,1),r=this.value?Math.PI:0,o=6*Math.PI+(i?Math.PI:0)-r;yield et(n=>{let a=wt("sine",n);this.coin.transform.clear().translate(0,0,4*a*(1-a)*Wu).rotate(r+a*o,.4*Math.sin(a*8*Math.PI),0),this.coin.render(Ku)},t).promise,this.setValue(i),this.isAnimating=!1})}doubleClick(){Ut.roll([this],this.$parent)}static makeThumbnail(t){let i=h("svg",{width:60,height:60},t);h("circle",{cx:30,cy:30,r:28,class:"polygon-tile",fill:y.blue},i),h("path",{d:Yu,class:"dice-dot"},i).setTransform({x:30,y:30},0,1.2)}static altText(){return""}};Hr.type="coin",Hr=w([T],Hr);var ze=50;function Ma(e,s,t,i=0,r=0){for(let o of ao[s]){let n=o[0]*.23*t+t/2+i,a=o[1]*.23*t+t/2+r;h("circle",{cx:n,cy:a,r:t/10,class:"dice-dot"},e)}}var Fi=class extends ${constructor(t,i,r){super(t,i,r);this.path=new S(P,ze,ze*2);let o=h("rect",{class:"polygon-tile",rx:5},this.$el);h("line",{x1:0,y1:ze,x2:ze,y2:ze,class:"polygon-tile"},this.$el),this.$outline=h("rect",{class:"outline",rx:5},this.$el),o.setRect(this.path),this.$outline.setRect(this.path),this.transform(),Ma(this.$el,this.props.a,ze,0,0),Ma(this.$el,this.props.b,ze,0,ze),this.value=this.props.a+this.props.b,this.props.watch("color",({color:n})=>o.setAttr("fill",n))}getSnapPoints(){return[...super.getSnapPoints(),new d(0,ze),new d(ze,ze)]}static makeThumbnail(t,i){let o=h("svg",{width:34,height:64},t);h("rect",{x:2,y:2,width:30,height:30*2,rx:2,class:"polygon-tile",fill:y.teal},o),h("line",{x1:2,y1:30+2,x2:30+2,y2:30+2,class:"polygon-tile"},o),Ma(o,i.a,30,2,2),Ma(o,i.b,30,2,2+30)}static altText({a:t,b:i}){return`${t} ${i} `}};Fi.type="domino",Fi.defaultProps={color:y.teal},Fi=w([T],Fi);var Lv={1:"M-1.92 3.18V2.24H-0.5V-1.94H-1.67V-2.66C-1.15-2.74-0.65-2.92-0.2-3.18H0.66V2.24H1.91V3.18Z",2:"M-2.13 3.24V2.57C-1.04 1.37 0.53 0.37 0.75-1.23 0.78-2.65-0.89-2.56-1.53-1.62L-2.18-2.26C-1.23-3.5 1.07-3.69 1.72-2.09 2.36-0.32 0.62 1.1-0.44 2.33 0.43 2.26 1.3 2.24 2.18 2.26V3.24Z",3:"M-0.04 3.3C-0.86 3.34-1.65 3.01-2.2 2.4L-1.65 1.66C0.56 3.88 2.73 0.26-0.84 0.32V-0.52C2.13-0.44 0.64-3.74-1.4-1.79L-1.99-2.5C-1-3.49 1.1-3.71 1.83-2.34 2.03-1.92 2.04-1.45 1.85-1.03 1.67-0.61 1.31-0.29 0.87-0.16V-0.12C3.22 0.57 2.17 3.46-0.04 3.3Z",4:"M0.46 3.18V1.54H-2.34V0.76L0.18-3.18H1.55V0.65H2.35V1.54H1.55V3.18ZM-1.21 0.65H0.46C0.47-0.13 0.45-1.34 0.51-2.11H0.47C0.31-1.77 0.14-1.46-0.05-1.12Z",5:"M-0.03 3.24C-0.84 3.26-1.63 2.94-2.2 2.36L-1.67 1.62C-0.91 2.53 1.08 2.63 1.05 1.08 1.11-0.14-0.33-0.42-1.14 0.25L-1.69-0.1-1.5-3.24H1.9V-2.27H-0.5L-0.63-0.73C2.69-2.07 3.34 3.22-0.03 3.24Z",6:"M-0.78 3.3C-3.49 3.25-3.6-0.85-2.32-2.48-1.9-2.98-1.28-3.28-0.63-3.3 0.03-3.32 0.66-3.06 1.11-2.58L0.49-1.88C-0.96-3.24-2.1-1.59-2.02-0.01-1.71-0.43-1.23-0.7-0.72-0.75-0.2-0.8 0.32-0.63 0.71-0.28 1.85 0.94 1.02 3.38-0.78 3.3ZM-0.8 2.42C0.17 2.46 0.41 0.95-0.11 0.36-0.41 0.13-0.79 0.04-1.16 0.13-1.52 0.22-1.83 0.47-1.99 0.81-1.88 1.7-1.63 2.37-0.8 2.42ZM2.38 3.3C1.97 3.27 1.64 2.93 1.64 2.52 1.64 2.1 1.97 1.76 2.38 1.74 3.35 1.7 3.35 3.33 2.38 3.3Z",7:"M-0.89 3.18C-0.9 1.24-0.28-0.65 0.87-2.21H-2.13V-3.18H2.13V-2.48C0.84-0.89 0.17 1.13 0.28 3.18Z",8:"M0.01 3.3C-2.15 3.38-3.04 0.92-1.01-0.08V-0.12C-1.71-0.52-2.04-1.36-1.79-2.14-1.54-2.91-0.77-3.4 0.03-3.3 0.83-3.37 1.57-2.88 1.82-2.12 2.06-1.36 1.75-0.53 1.05-0.12V-0.08C3.03 0.9 2.12 3.43 0.01 3.3ZM0.03 2.48C0.38 2.52 0.72 2.36 0.91 2.06 1.11 1.77 1.13 1.39 0.96 1.08 0.57 0.68 0.08 0.38-0.46 0.24-1.49 0.87-1.34 2.51 0.02 2.48ZM0.43-0.41C1.17-1 1.18-2.49 0.02-2.48-0.3-2.49-0.59-2.33-0.75-2.06-0.9-1.79-0.91-1.46-0.75-1.19-0.46-0.81-0.04-0.54 0.42-0.41Z",9:"M-1.33 3.3C-1.97 3.31-2.59 3.05-3.03 2.58L-2.41 1.88C-0.96 3.23 0.2 1.59 0.11 0.01-0.27 0.53-0.9 0.81-1.55 0.74-2.19 0.66-2.74 0.25-2.99-0.35-3.27-0.99-3.21-1.72-2.84-2.31-2.46-2.9-1.83-3.27-1.13-3.3 2.17-3.26 1.88 3.36-1.33 3.3ZM-1.06-0.08C-0.58-0.12-0.15-0.39 0.08-0.82 0.07-1.94-0.89-2.96-1.79-2.11-2.32-1.48-2.12 0.01-1.06-0.08ZM2.41 3.3C2 3.28 1.67 2.94 1.67 2.52 1.67 2.11 2 1.76 2.41 1.74 3.38 1.71 3.38 3.33 2.41 3.3Z",10:"M-4.48 3.18V2.24H-3.06V-1.94H-4.23V-2.66C-3.71-2.74-3.21-2.92-2.76-3.18H-1.9V2.24H-0.65V3.18ZM2.27 3.3C-0.66 3.38-0.69-3.4 2.27-3.3 5.23-3.39 5.2 3.38 2.27 3.3ZM2.27 2.4C3.71 2.54 3.74-2.56 2.27-2.4 0.8-2.56 0.83 2.53 2.27 2.4Z",11:"M-4.38 3.18V2.24H-2.96V-1.94H-4.13V-2.66C-3.61-2.74-3.11-2.92-2.66-3.18H-1.8V2.24H-0.55V3.18ZM0.55 3.18V2.24H1.97V-1.94H0.8V-2.66C1.32-2.74 1.82-2.92 2.27-3.18H3.13V2.24H4.38V3.18Z",12:"M-4.43 3.24V2.3H-3.01V-1.88H-4.18V-2.6C-3.67-2.68-3.17-2.86-2.71-3.12H-1.85V2.3H-0.6V3.24ZM0.13 3.24V2.57C1.22 1.37 2.79 0.37 3.01-1.23 3.04-2.65 1.37-2.56 0.73-1.62L0.09-2.26C1.03-3.5 3.33-3.69 3.98-2.09 4.62-0.32 2.88 1.1 1.82 2.33 2.69 2.26 3.56 2.24 4.43 2.26V3.24Z",13:"M-4.41 3.18V2.24H-2.99V-1.94H-4.16V-2.66C-3.65-2.74-3.15-2.92-2.69-3.18H-1.83V2.24H-0.58V3.18ZM2.18 3.3C1.36 3.34 0.57 3.01 0.02 2.4L0.57 1.66C2.78 3.88 4.94 0.26 1.38 0.32V-0.52C4.34-0.44 2.86-3.74 0.82-1.79L0.23-2.5C1.21-3.49 3.31-3.71 4.04-2.34 4.24-1.92 4.25-1.45 4.07-1.03 3.88-0.61 3.53-0.29 3.09-0.16V-0.12C5.43 0.57 4.38 3.46 2.18 3.3Z",14:"M-4.53 3.18V2.24H-3.11V-1.94H-4.28V-2.66C-3.76-2.74-3.26-2.92-2.81-3.18H-1.95V2.24H-0.7V3.18ZM2.65 3.18V1.54H-0.16V0.76L2.36-3.18H3.73V0.65H4.53V1.54H3.73V3.18ZM0.98 0.65H2.65C2.65-0.13 2.64-1.34 2.7-2.11H2.66C2.5-1.77 2.32-1.46 2.14-1.12Z",15:"M-4.41 3.12V2.18H-2.99V-2H-4.16V-2.72C-3.65-2.8-3.15-2.98-2.69-3.24H-1.83V2.18H-0.58V3.12ZM2.19 3.24C1.37 3.26 0.59 2.94 0.02 2.36L0.55 1.62C1.3 2.53 3.29 2.63 3.27 1.08 3.33-0.14 1.88-0.42 1.07 0.25L0.52-0.1 0.71-3.24H4.11V-2.27H1.72L1.59-0.73C4.9-2.06 5.56 3.22 2.18 3.24Z",16:"M-4.47 3.18V2.24H-3.05V-1.94H-4.22V-2.66C-3.71-2.74-3.21-2.92-2.75-3.18H-1.89V2.24H-0.64V3.18ZM2.46 3.3C-0.24 3.25-0.35-0.85 0.92-2.48 1.34-2.98 1.96-3.28 2.61-3.3 3.27-3.32 3.9-3.06 4.35-2.58L3.73-1.88C2.29-3.24 1.14-1.59 1.22-0.01 1.54-0.43 2.01-0.7 2.53-0.75 3.05-0.8 3.56-0.63 3.95-0.28 5.09 0.94 4.26 3.39 2.46 3.3ZM2.44 2.42C3.41 2.46 3.65 0.95 3.13 0.36 2.84 0.13 2.45 0.04 2.09 0.13 1.72 0.22 1.41 0.47 1.25 0.81 1.36 1.7 1.61 2.37 2.45 2.42Z",17:"M-4.45 3.18V2.24H-3.03V-1.94H-4.2V-2.66C-3.68-2.74-3.18-2.92-2.73-3.18H-1.87V2.24H-0.62V3.18ZM1.42 3.18C1.42 1.24 2.04-0.65 3.19-2.21H0.18V-3.18H4.45V-2.48C3.15-0.89 2.49 1.13 2.59 3.18Z",18:"M-4.45 3.18V2.24H-3.03V-1.94H-4.2V-2.66C-3.68-2.74-3.18-2.92-2.73-3.18H-1.87V2.24H-0.62V3.18ZM2.31 3.3C0.16 3.38-0.74 0.92 1.3-0.08V-0.12C0.59-0.52 0.26-1.36 0.51-2.14 0.77-2.91 1.53-3.4 2.34-3.3 3.14-3.37 3.88-2.88 4.12-2.12 4.37-1.36 4.05-0.53 3.36-0.12V-0.08C5.33 0.9 4.42 3.43 2.31 3.3ZM2.33 2.48C2.68 2.52 3.02 2.36 3.22 2.06 3.41 1.77 3.43 1.39 3.26 1.08 2.88 0.68 2.39 0.38 1.85 0.24 0.82 0.87 0.96 2.51 2.33 2.48ZM2.73-0.41C3.47-1 3.48-2.49 2.32-2.48 2.01-2.49 1.72-2.33 1.56-2.06 1.4-1.79 1.39-1.46 1.55-1.19 1.85-0.81 2.26-0.54 2.73-0.41Z",19:"M-4.45 3.18V2.24H-3.03V-1.94H-4.2V-2.66C-3.68-2.74-3.18-2.92-2.73-3.18H-1.87V2.24H-0.62V3.18ZM1.91 3.3C1.27 3.31 0.65 3.05 0.21 2.58L0.83 1.88C2.28 3.23 3.44 1.59 3.35 0.01 2.97 0.53 2.33 0.81 1.69 0.74 1.05 0.66 0.5 0.25 0.24-0.35-0.03-0.99 0.03-1.73 0.4-2.31 0.77-2.9 1.41-3.27 2.11-3.3 5.4-3.26 5.12 3.36 1.91 3.3ZM2.18-0.08C2.66-0.12 3.09-0.39 3.32-0.82 3.3-1.94 2.35-2.96 1.45-2.11 0.91-1.48 1.12 0.01 2.18-0.08Z",20:"M-4.63 3.18V2.51C-3.54 1.31-1.98 0.31-1.75-1.29-1.73-2.71-3.4-2.62-4.04-1.68L-4.68-2.32C-3.74-3.56-1.44-3.75-0.79-2.15-0.15-0.38-1.88 1.04-2.95 2.27-2.08 2.2-1.21 2.18-0.33 2.2V3.18ZM2.48 3.3C-0.45 3.38-0.48-3.4 2.48-3.3 5.43-3.39 5.4 3.38 2.48 3.3ZM2.48 2.4C3.92 2.54 3.95-2.56 2.48-2.4 1.01-2.56 1.03 2.53 2.48 2.4Z"},kc=40,Cc={4:{net:Mn,meshScale:.9,numberScale:.08,color:y.red,thumbnailY:8,renderOptions:{fov:180,hideBackface:!0}},6:{net:An,meshScale:.744,numberScale:.1,color:y.yellow,renderOptions:{fov:120,hideBackface:!0}},8:{net:En,meshScale:.85,numberScale:.07,color:y.green,thumbnailY:3,renderOptions:{fov:180,hideBackface:!0}},10:{net:Zp,meshScale:1,numberScale:.06,numberShift:2,color:y.teal,renderOptions:{fov:180}},12:{net:Vn,meshScale:.6,numberScale:.1,color:y.blue,renderOptions:{fov:!1,hideBackface:!0}},20:{net:Dn,meshScale:.6,numberScale:.06,color:y.purple,renderOptions:{fov:!1,hideBackface:!0}}};function Xu(e,s){let t=Cc[e],i=[],r=lo(t.net,n=>{let a=new pe(n.shape,{class:"polygon-tile",style:"stroke-width: 0.5"});i.push(a);let l=new pe(Lv[i.length],{class:"dice-dot"});return l.transform.scale(J.all(t.numberScale)),t.numberShift&&l.transform.translate(0,t.numberShift,0),new xe([a,l])}).group,o=r.children[0].children.map(n=>{let a=n.getTransformed(J.zero).fixFloat(),l=0;(a.x!==0||a.z!==0)&&(l=Math.atan2(a.z,a.x)-ht);let c=a.transform(ft.rotateY(l)),p=0;(c.y!==0||c.z!==0)&&(p=Math.atan2(c.y,c.z));let u=Et.product(ft.rotateX(p),ft.rotateY(l)),f=n.getTransformed(new J(1,0,0)).transform(u).fixFloat().xy,v=Math.atan2(-f.y,f.x);return new J(p,l,v)});return s.append(r.$el),{die:r,faces:i,rotationOptions:o}}var qi=class extends ${constructor(t,i,r){super(t,i,r);this.isAnimating=!1;this.definition=Cc[this.props.faceCount];let o=Xu(this.props.faceCount,this.$el);this.faces=o.faces,this.die=o.die,this.rotationOptions=o.rotationOptions,this.setValue(this.props.value||vt.integer(1,this.props.faceCount));let n=this.die.getProjectedVertices(this.definition.renderOptions);this.path=D.convexHull(...n),this.$outline=h("path",{class:"outline",path:this.path},this.$el),this.props.color||(this.props.color=this.definition.color),this.props.watch("color",({color:a})=>{for(let l of this.faces)l.color=a;this.die.render(this.definition.renderOptions)})}applyChange(t){super.applyChange(t),"value"in t&&this.setValue(t.value)}setValue(t){if(this.value===t)return;this.props.value=this.value=t;let i=this.rotationOptions[this.value-1];this.die.transform.matrix=Et.product(ft.rotateZ(i.z),ft.rotateX(i.x),ft.rotateY(i.y),ft.scaleAll(this.definition.meshScale*kc)),this.die.render(this.definition.renderOptions)}get aggregationCategory(){return this.value}get aggregationCategories(){return I(t=>t+1,this.props.faceCount)}roll(t=2e3){return H(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0,this.$parent.playSound("roll");let i=Math.floor(Math.random()*this.props.faceCount),r=this.rotationOptions[this.value-1],o=this.rotationOptions[i];yield et(n=>{n=wt("sine",n),this.die.transform.matrix=Et.product(ft.translate(new J(0,0,4*n*(1-n)*kc/2)),ft.rotateZ(r.z+(o.z-r.z)*n),ft.rotateX(r.x+(o.x-r.x+4*Math.PI)*n),ft.rotateY(r.y+(o.y-r.y+4*Math.PI)*n),ft.scaleAll(this.definition.meshScale*kc)),this.die.render(this.definition.renderOptions)},t).promise,this.setValue(i+1),this.isAnimating=!1})}doubleClick(){Ut.roll([this],this.$parent)}static makeThumbnail(t,i){var c;let r=Cc[i.faceCount||4],o=h("svg",{width:70,height:70},t),n=h("g",{transform:`translate(35, ${35+((c=r.thumbnailY)!=null?c:0)})`},o),a=Xu(i.faceCount||4,n);for(let p of a.faces)p.color=r.color;let l=a.rotationOptions[a.rotationOptions.length-1];a.die.transform.matrix=Et.product(ft.rotateZ(l.z),ft.rotateX(l.x),ft.rotateY(l.y),ft.scaleAll(r.meshScale*32)),a.die.render()}static altText(t){return` d${t.faceCount||4}`}};qi.type="polyhedral-dice",qi.defaultProps={faceCount:4},qi=w([T],qi);var Aa=[{key:"discrete",label:"",params:[{label:"Min:",int:!0},{label:"Max:",int:!0}],defaults:[1,10],get:(e,s)=>vt.integer(e,s)},{key:"bernoulli",label:"",params:[{label:"p",range:[0,1]}],defaults:[.5],get:e=>vt.bernoulli(e)},{key:"binomial",label:"",params:[{label:"p",range:[0,1]},{label:"n",range:[1,void 0],int:!0}],defaults:[.5,10],get:(e,s)=>vt.binomial(s,e)},{key:"poisson",label:"",params:[{label:"",range:[0,void 0]}],defaults:[1,10],get:e=>vt.poisson(e)},{key:"geometric",label:"",params:[{label:"p",range:[0,1]}],defaults:[.5],get:e=>vt.geometric(e)||0},{key:"continuous",label:"",params:[{label:"Min:"},{label:"Max:"}],defaults:[0,1],get:(e,s)=>vt.uniform(e,s)},{key:"normal",label:"",params:[{label:""},{label:"\xB2",range:[0,void 0]}],defaults:[0,1],get:(e,s)=>vt.normal(e,s)},{key:"exponential",label:"",params:[{label:""}],defaults:[1],get:e=>vt.exponential(e)},{key:"cauchy",label:"",params:[],defaults:[],get:()=>vt.cauchy()}],Ui=class extends ${constructor(t,i,r){super(t,i,r);this.path=new S(P,75,50);this.$body=h("rect",{class:"polygon-tile",rx:6,width:75,height:50},this.$el),h("rect",{class:"polygon-tile",fill:"none",opacity:.7,style:"stroke-width:2px;stroke-dasharray:2px 4px",x:3.5,y:3.5,rx:3,width:68,height:43},this.$el),this.$text=h("text",{x:75/2,fill:"white"},this.$el),this.$outline=h("rect",{class:"outline",rx:6,width:75,height:50},this.$el),this.props.watch("dist",({dist:o})=>this.distribution=Aa.find(n=>n.key===o)),this.props.p1===void 0&&(this.props.p1=this.distribution.defaults[0]),this.props.p2===void 0&&(this.props.p1=this.distribution.defaults[1]),this.props.value===void 0&&this.roll(!1),this.props.watch("value",({value:o})=>this.setValue(o)),this.props.watch("color",({color:o})=>this.$body.setAttr("fill",o))}switchDistribution(t){this.props.dist=t;let i=this.distribution=Aa.find(r=>r.key===t);this.props.p1=i.defaults[0],this.props.p2=i.defaults[1],this.roll(!1)}setValue(t){this.value=t;let i=this.$text.text=mt(t,6),r=M(65/i.length*2,16,32);this.$text.css("font-size",r+"px"),this.$text.setAttr("y",.3*r+26)}get aggregationCategory(){return this.value}get aggregationCategories(){return[]}roll(t=!0,i=500){return H(this,null,function*(){if(t){this.$text.css("opacity",.6),this.$parent.playSound("rng");for(let r=0;r<i;r+=50)this.setValue(this.distribution.get(this.props.p1,this.props.p2)),yield Cs(50);this.$text.css("opacity",1)}this.props.value=this.distribution.get(this.props.p1,this.props.p2)})}doubleClick(){Ut.roll([this],this.$parent)}static makeThumbnail(t){let i=h("svg",{width:85,height:60},t);h("rect",{x:5,y:5,width:75,height:50,class:"polygon-tile",rx:6,fill:y.green},i),h("rect",{class:"polygon-tile",fill:"none",opacity:.7,style:"stroke-width:2px;stroke-dasharray:2px 4px",x:8.5,y:8.5,rx:3,width:68,height:43},i),h("text",{fill:"white",x:42.5,y:41,style:"font-size:32px",text:"?"},i)}static altText(){return""}};Ui.type="random",Ui.defaultProps={color:y.green,dist:"discrete",p1:1,p2:10},Ui=w([T],Ui);var Ov=Wt(Aa.map(e=>e.params.map((s,t)=>({id:s.label.replace(":","").toLowerCase(),type:"input",tileTypes:["random"],label:s.label,value:"number",location:"more",range:s.range,show:i=>i.every(r=>r.distribution===e),get:i=>i.props[t?"p2":"p1"],set:(i,r)=>{r.props[t?"p2":"p1"]=s.int?Math.round(+i):+i,r.roll()}}))));O([{id:"distribution",type:"select",tileTypes:["random"],options:Aa,label:"",location:"more",get:e=>e.distribution.key,set:(e,s)=>s.switchDistribution(e)},...Ov]);var Fr=75,Mc="M9.8-39.1,0-63-9.8-39.1-3-43V60a2.9,2.9,0,0,0,3,3,2.9,2.9,0,0,0,3-3V-43Z";function Ju(e,s){var r;let t=s.color?G.shades(s.color,e):G.rainbow(e),i=(r=s.colors)==null?void 0:r.split(",");return I(o=>(i==null?void 0:i[o])||t[o].hex,e)}function Ea(e,s,t,i=Fr,r=P){let o=Ju(s.length,t);e.removeChildren();for(let[n,a]of s.entries()){let l=s[n+1]?s[n+1]-a:B-a+s[0],c=new hs(r,d.fromPolar(a-ht,i).add(r),l);h("path",{path:c,class:"polygon-tile",fill:o[n]},e)}}var Va=class extends ${constructor(t,i,r){super(t,i,r);this.isAnimating=!1;this.focussedSector=-1;this.path=new q(P,Fr);this.$sectors=h("g",{},this.$el),this.$arrow=h("path",{d:Mc,class:"spinner"},this.$el),this.$outline=h("path",{class:"outline",path:this.path},this.$el),h("circle",{r:4,class:"spinner"},this.$el),t.events.listen(this.$arrow,{move:({posn:o})=>{let n=this.relativePosn(o).angle()+ht;this.$arrow.css("transform",`rotate(${n}rad)`)},end:({lastPosn:o})=>{let n=this.relativePosn(o).angle()+ht;this.setValue(Vt(n));let a=Kt.updateAggregations([this.id]);t.change({changed:[this,...a]})},click:()=>Ut.roll([this],this.$parent)}),t.events.listen(this.$sectors,{click:o=>this.focusOnSector(o),checkIfActive:()=>this.focussedSector!==-1}),this.$arrow.css("cursor","pointer"),this.setValue(this.props.angle||0),this.props.watch("color colors",o=>{let n=this.$sectors.children,a=Ju(n.length,o);for(let[l,c]of n.entries())c.setAttr("fill",a[l])})}applyChange(t){super.applyChange(t),"angle"in t&&this.setValue(t.angle)}format(t,i){var o;if(this.focussedSector<0)return;let r=((o=this.props.colors)==null?void 0:o.split(","))||[];r[this.focussedSector]=i,this.props.colors=r.join(","),this.$parent.change({changed:[this]})}get aggregationCategories(){return this.$sectors.children.map(t=>t.attr("fill"))}setValue(t){t=K(Math.round(t),360),this.props.angle=t,this.$arrow.css("transform",`rotate(${t}deg)`)}roll(t=2e3){return H(this,null,function*(){if(this.isAnimating)return;this.isAnimating=!0,this.$parent.playSound("spin");let i=this.props.angle,r=(4+Math.random())*360;yield et(o=>{let n=rt(i,r,wt("sine",o));this.$arrow.css("transform",`rotate(${n}deg)`)},t).promise,this.setValue(r),this.isAnimating=!1})}doubleClick(t){this.focussedSector>=0||(this.focusOnSector(t),super.focus())}focusOnSector(t){var r,o;let i=(Vt(this.relativePosn(t.posn).angle())+90)%360;this.focussedSector=this.sectorAtAngle(i),(r=this.$outline)==null||r.setAttr("d",this.$sectors.children[this.focussedSector].attr("d")),(o=this.$outline)==null||o.show()}blur(){var t,i;this.focussedSector!==-1&&(this.focussedSector=-1,(t=this.$outline)==null||t.setAttr("d",Gt(this.path)),(i=this.$outline)==null||i.hide(),super.blur())}},Zi=class extends Va{constructor(s,t,i){super(s,t,i);let r=this.makeHandle("c",o=>{let n=(o.angle()+ht)%B;this.props.sectorCount=M(Math.round(B/n),2,16)});r.css("cursor","move"),this.props.watch("sectorCount",({sectorCount:o})=>{let n=B/o;Ea(this.$sectors,I(a=>n*a,o),this.props),r.setCenter(d.fromPolar(n-ht,Fr))})}sectorAtAngle(s){return Math.floor(s*this.props.sectorCount/360)}get aggregationCategory(){let s=this.sectorAtAngle(this.props.angle);return this.$sectors.children[s].attr("fill")}static makeThumbnail(s){let t=h("svg",{width:80,height:80},s),i=new d(40,40);Ea(t,I(o=>B/5*o,5),{},36,i),h("path",{d:Mc,class:"spinner"},t).css("transform","translate(40px, 40px) rotate(-0.8rad) scale(0.5)")}static altText(){return""}};Zi.type="spinner",Zi.defaultProps={sectorCount:5,angle:0},Zi=w([T],Zi);var ji=class extends Va{constructor(t,i,r){super(t,i,r);this.$handles=new Set;for(let n of this.props.sectorSizes.split(","))this.makeVertex(d.fromPolar(W(+n)-ht,Fr));let o;this.$parent.events.listen(this.$outline,{down:({posn:n})=>o=this.makeVertex(this.relativePosn(n)),move:({posn:n})=>this.moveVertex(this.relativePosn(n),o),up:()=>t.change({changed:[this]})}),this.$outline.css("cursor","crosshair"),this.props.watch("sectorSizes",({sectorSizes:n})=>{Ea(this.$sectors,n.split(",").map(a=>W(+a)),this.props)})}applyChange(t){if("sectorSizes"in t)return this.recreate(t);super.applyChange(t)}updateSectors(){this.props.sectorSizes=Array.from(this.$handles).map(t=>Math.round(Vt(t.center.angle()+ht)%360)).sort((t,i)=>t-i).join(",")}sectorAtAngle(t){let i=this.props.sectorSizes.split(",").map(o=>+o),r=i.findIndex(o=>o>=t)-1;return r<0?i.length-1:r}get aggregationCategory(){let t=this.sectorAtAngle(this.props.angle);return this.$sectors.children[t].attr("fill")}makeVertex(t){if(this.$handles.size>=24)return;let i=this.makeHandle("c",r=>{i&&(r.length>2*Fr?(this.deleteVertex(i),i=void 0):this.moveVertex(r,i))},()=>{i&&this.deleteVertex(i)});return i.setAttr("r",8),i.css("cursor","move"),this.$handles.add(i),this.moveVertex(t,i),i}deleteVertex(t){this.$handles.size<=2||(t.remove(),this.$handles.delete(t),this.updateSectors(),this.$parent.change({changed:[this]}))}moveVertex(t,i){if(!i)return;let r=W(tt(Vt(t.angle()),10));i.setCenter(d.fromPolar(r,Fr)),this.updateSectors()}static makeThumbnail(t){let i=h("svg",{width:80,height:80},t),r=new d(40,40),o=[60,180,270,330].map(a=>W(+a));Ea(i,o,{},36,r),h("path",{d:Mc,class:"spinner"},i).css("transform","translate(40px, 40px) rotate(0.4rad) scale(0.5)");for(let a of o){let l=d.fromPolar(a-ht,36).add(r);h("circle",{cx:l.x,cy:l.y,r:3,fill:y.bg},i)}}static altText(){return""}};ji.type="custom-spinner",ji.defaultProps={sectorSizes:"60,180,270,330",angle:0},ji=w([T],ji);var Ac=/(,|^[^\d.-]+|[^\d.-]+$)/g,Qu=[y.red,y.blue,y.green,y.yellow,y.purple,y.orange,y.lime],zs=class extends ${constructor(t,i,r){super(t,i,r);this.focussedSeries=-1;this.default=!0;this.chartColors=(this.props.colors||"").split(","),this.$series=h("g",{},this.$el),this.$outline=h("path",{class:"outline"},this.$el),t.events.listen(this.$el,{click:o=>this.focusOnSeries(o),checkIfActive:()=>this.focussedSeries>=0})}format(t,i){let r=this.focussedSeries;r<0||this.chartColors[r]===i||(this.chartColors[r]=i,this.colorSeries(te(i,this.$parent.flipTheme),r),this.props.colors=this.chartColors.join(","),this.$parent.change({changed:[this]}))}getSeriesColor(t){var o;if(this.default)return y.grey;let i=(o=this.seriesLabels)==null?void 0:o[t],r=this.chartColors[t]||(i!=null&&i.startsWith("#")?i:Qu[t%Qu.length]);return te(r,this.$parent.flipTheme)}doubleClick(t){this.focussedSeries>=0||(this.focusOnSeries(t),!(this.focussedSeries<0)&&(super.focus(),this.$el.addClass("chart-focussed")))}focusOnSeries(t){let i=t.event.target.getAttribute("series-idx")||this.findClosestElement(t);i&&(this.focussedSeries=+i,this.focusSeries(+i))}findClosestElement(t){return""}blur(){this.focussedSeries<0||(this.focussedSeries=-1,this.$el.removeClass("chart-focussed"),super.blur())}};function $o(e){e=e.filter((t,i)=>!i||t.some(Boolean));let s=e[0].map((t,i)=>e.some((r,o)=>o>0&&r[i]));return e.map(t=>t.filter((i,r)=>s[r]))}function tf(e){if(e=$o(e),!e.length||!e[0].length)return[[],[]];e[0].length===1&&(e=e.map((r,o)=>[`${o}`,r[0]]));let s=e.slice(1),t=s.map(r=>r[0]),i=e[0].slice(1).map((r,o)=>({label:r,data:s.map(n=>+n[o+1].replace(Ac,"")||0)}));return[t,i]}function ef(e,s,t=!0){let i=e[0].data.length,r=[];for(let o=0;o<i;++o){let n=[];if(s==="grouped")for(let a of e)n.push([0,a.data[o]]);else if(t){let a=0,l=0,c=e.map(u=>u.data[o]),p=s==="percentage"?99.99/_(c):1;for(let u of c)u<0?(n.push([a,a+u*p]),a+=u*p):(n.push([l,l+u*p]),l+=u*p)}else{let a=0,l=e.map(p=>p.data[o]),c=s==="percentage"?99.99/_(l):1;for(let p of l)n.push([a,a+p*c]),a+=p*c}r.push(n)}return r}var Be=class{constructor(s){this.makeNew=s;this.stack=[]}get(s){return this.stack[s]||(this.stack[s]=this.makeNew()),this.stack[s]}};var Rv=[[1,2,3,4,5]].map(e=>({label:"",data:e}));function Iv(e,s=!1){let t=Qi(e,.25),i=Qi(e,.75),r=1.5*(i-t),o=s?e.filter(c=>Y(c,t-r,i+r)):e,n=Math.min(...o);t=Qi(o,.25);let a=Qi(o,.5);i=Qi(o,.75);let l=Math.max(...o);return[n,t,a,i,l]}var Wi=class extends zs{constructor(t,i,r){super(t,i,r);this.padding=[0,0,25,0];this.$boxPlots=new Be(()=>h("path",{class:"chart-line"}));this.range=[0,5];this.series=[];this.tables=new Map;this.$background=h("path",{fill:"transparent"}),this.$el.prepend(this.$background),this.$axis=h("path",{class:"grid-axis",stroke:y.darkGrey},this.$el),this.$labels=h("g",{class:"axis-labels"},this.$el),this.$focussedOutline=h("path",{class:"chart-shadow"},this.$el),this.$handle=this.makeHandle("h",o=>{this.props.width=Math.max(tt(o.x,25),100)}),this.props.watch("width",({width:o})=>this.updateOutline(o)),this.props.watch("width layout",()=>this.drawChart()),this.props.watch("color",({color:o})=>{this.$labels.setAttr("fill",o),this.$axis.setAttr("stroke",o)}),this.makeInPort("main",{tileTypes:["table"],message:(o,n)=>{o.type==="table"&&(this.tables.set(n,o.table),this.redraw())},disconnect:o=>{this.tables.delete(o),this.redraw()}})}drawChart(){this.default=!this.series.length;let t=this.default?Rv:this.series;this.$series.removeChildren(),this.range[0]=Math.min(...t.map(i=>Math.min(...i.data))),this.range[1]=Math.max(...t.map(i=>Math.max(...i.data)));for(let[i,r]of t.entries())this.drawBoxWhiskerPlot(r.data,i,-25-50*(t.length-1-i));this.drawAxes(t)}drawBoxWhiskerPlot(t,i,r){let o=this.$boxPlots.get(i),n=this.props.layout==="outliers",[a,l,c,p,u]=Iv(t,n).map(g=>this.getX(g)),f=16,v=10,m=`M${a} ${r+v}V${r-v}M${a} ${r}H${l}V${r+f}H${p}V${r-f}H${l}V${r}M${c} ${r+f}V${r-f}M${p} ${r}H${u}M${u} ${r+v}V${r-v}`;if(n){let g=t.map(b=>this.getX(b)).filter(b=>b<a||b>u);for(let b of g)m+=Gt(new q(new d(b,r),4))}o.setAttr("d",m),o.setAttr("series-idx",i),o.setAttr("stroke",this.getSeriesColor(i)),this.$series.append(o)}drawAxes(t){this.$labels.removeChildren();let i=Jr("",this.path.w,this.range,0),r=`M 0 0 h ${this.path.w}`;for(let o=this.range[0];o<=this.range[1]+.001;o+=i[2]){let n=this.getX(o);r+=`M${n},0v5`,h("text",{text:mt(o,4),x:n,y:21},this.$labels)}this.$axis.setAttr("d",r);for(let[o,n]of t.entries()){let a=-25-50*(t.length-1-o),l=n.label;h("text",{text:l,x:-14,y:a,"text-anchor":"end"},this.$labels)}}updateOutline(t=this.props.width||300){let i=(this.series.length||1)*50;this.path=new S(P.shift(0,-i),t,i),this.$outline.draw(this.path),this.$background.draw(this.path),this.$handle.translate(t,-i),this.transform(),this.$parent.selection.update()}colorSeries(t,i){this.$boxPlots.get(i).setAttr("stroke",t),this.$focussedOutline.setAttr("stroke",t)}getX(t){return(t-this.range[0])/(this.range[1]-this.range[0])*this.path.w}redraw(){this.buildSeries(),this.drawChart(),this.updateOutline()}buildSeries(){this.series=[];for(let t of this.tables.values()){let i=$o(t).slice(1);if(i.length)for(let r=0;r<i[0].length;r++){let o=i.map(n=>Number.parseFloat(n[r])).filter(n=>!Number.isNaN(n));o.length&&this.series.push({label:t[0][r],data:o})}}}focusSeries(t){this.$focussedOutline.setAttr("d",this.$boxPlots.get(t).attr("d")),this.$focussedOutline.setAttr("stroke",this.getSeriesColor(t)),this.$focussedOutline.show()}blur(){super.blur(),this.$focussedOutline.hide()}findClosestElement(t){let i=Math.round((this.relativePosn(t.posn).y+25)/50);return""+M(-i,0,this.series.length-1)}static makeThumbnail(t){let[i,r]=[180,45],[o,n,a,l,c]=[0,1,2,3,4].map(b=>5+b/4*170),[p,u,f]=[r/2,14,8],v=h("svg",{width:i,height:r},t),m=h("path",{class:"chart-line",stroke:y.bg,style:"stroke-width: 2px"},v),g=`M${o} ${p-f} V ${p+f}M${o} ${p} H ${n}V${p-u}H${l} V ${p+u}H${n} V ${p}M${a} ${p-u} V ${p+u}M${l} ${p}H${c}M${c} ${p-f}V${p+f}`;m.setAttr("d",g)}static altText(){return""}};Wi.type="box-whisker",Wi.defaultProps={color:y.darkGrey},Wi=w([T],Wi);O([{id:"outliers",type:"checkbox",tileTypes:["box-whisker"],label:"",get:e=>e.props.layout==="outliers",set:(e,s)=>s.props.layout=e?"outliers":void 0}]);var Nv=["A","B","C"],Gv=[[10,20,30],[30,10,40],[20,25,10]].map(e=>({label:"",data:e})),Ki=class extends zs{constructor(t,i,r){super(t,i,r);this.padding=[0,0,25,30];this.tables=[];this.categories=[];this.series=[];this.$rects=new Be(()=>h("rect",{class:"polygon-tile"}));this.$areas=new Be(()=>h("polygon",{opacity:.5}));this.$lines=new Be(()=>h("polyline",{class:"chart-line"}));this.$points=new Be(()=>h("circle",{r:5}));this.$background=h("path",{fill:"transparent"},this.$el),this.$el.prepend(this.$background),this.$axes=h("path",{class:"grid-axis"},this.$el),this.$labels=h("g",{class:"axis-labels"},this.$el),this.$foreground=h("g",{},this.$el),this.$handle=this.makeHandle("c",o=>{this.props.height=Math.max(tt(-o.y,25),100),this.props.width=Math.max(tt(o.x,25),100)}),this.$handle.css("cursor","nesw-resize"),this.props.watch("width height",({width:o,height:n})=>this.updateOutline(o,n)),this.props.watch("kind layout width height",({kind:o,layout:n})=>this.drawChart(o,n)),this.props.watch("color",({color:o})=>{this.$labels.setAttr("fill",o),this.$axes.setAttr("stroke",o)}),this.makeInPort("main",{tileTypes:["table"],message:(o,n)=>{if(o.type!=="table")return;let[a,l]=tf(o.table),c=this.tables.find(p=>p.cable===n);c?Object.assign(c,{categories:a,series:l}):this.tables.push({cable:n,categories:a,series:l}),this.reconcileSeries(),this.drawChart(this.props.kind,this.props.layout)},disconnect:o=>{this.tables=this.tables.filter(n=>n.cable!==o),this.reconcileSeries(),this.drawChart(this.props.kind,this.props.layout)}})}reconcileSeries(){var t,i;this.categories=((t=this.tables[0])==null?void 0:t.categories.slice(0))||[],this.series=((i=this.tables[0])==null?void 0:i.series.map(r=>({label:r.label,data:r.data.slice(0)})))||[];for(let r of this.tables.slice(1)){let o=this.categories.length,n=this.series.length;for(let a of r.series)this.series.push({label:a.label,data:le(0,o)});for(let[a,l]of r.categories.entries()){let c=this.categories.indexOf(l);if(c<0){this.categories.push(l);for(let p of this.series)p.data.push(0);c=this.categories.length-1}for(let[p,u]of r.series.entries())this.series[n+p].data[c]=u.data[a]}}this.seriesLabels=this.series.map(r=>r.label)}updateOutline(t=400,i=250){this.path=new S(P.shift(0,-i),t,i),this.$background.draw(this.path),this.$outline.draw(this.path),this.$handle.setCenter({x:t,y:-i}),this.transform(),this.$parent.selection.update()}getX(t){return(t-this.bounds.xMin)/this.bounds.dx*this.path.w}getY(t){return(t-this.bounds.yMin)/this.bounds.dy*this.path.h}drawChart(t="column",i="grouped"){this.$series.removeChildren(),this.$foreground.removeChildren();let r=["line","area"].includes(t);this.default=!this.series.length;let o=this.default?Gv:this.series,n=this.default?Nv:this.categories,a=ef(o,i,!r),l=Math.min(0,...a.map(g=>Math.min(...g.map(b=>b[1])))),c=Math.max(0,...a.map(g=>Math.max(...g.map(b=>b[1])))),p=t==="row"?this.path.w:this.path.h,u=Jr("",p,[l,c],0),f=[0,n.length-1,1],v=r&&!n.some(g=>Number.isNaN(+g)),m=v?n.map(g=>+g):void 0;if(v){let g=Math.min(...m),b=Math.max(...m);f=Jr("",this.path.w,[g,b],0)}t==="row"&&([u,f]=[f,u]),this.bounds=new bt(f[0],f[1],u[0],u[1]),t==="column"?this.drawColumnChart(a,i):t==="row"?this.drawRowChart(a,i):(m&&([a,m]=this.getSortedData(a,m)),t==="area"&&this.drawAreas(a,m),this.drawLines(a,m),t==="line"&&this.drawPoints(a,m)),this.drawAxes(t,this.path.w,this.path.h,f[2],u[2],v?void 0:n)}getSortedData(t,i){let r=Se(i.length).sort((o,n)=>i[o]-i[n]);return[r.map(o=>t[o]),r.map(o=>i[o])]}drawAxes(t,i,r,o,n,a){var p;this.$labels.removeChildren();let l=`M0 0v${-r}M0 0h${i}`;Y(0,this.bounds.yMin,this.bounds.yMax)&&(l+=`M0 ${-this.getY(0)}h${i}`),Y(0,this.bounds.xMin,this.bounds.xMax)&&(l+=`M${this.getX(0)} 0 v${-r}`);let c=u=>u!=null&&u.startsWith("#")?["",u]:[u,""];if(t==="column"&&a){let u=a.length?i/a.length:0;for(let f=0;f<=a.length;++f){let v=f*u;l+=`M${v} 0L${v} 5`;let[m,g]=c(a[f]);h("text",{text:m,fill:g,x:v+u/2,y:21},this.$labels)}}else for(let u=this.bounds.xMin;u<=this.bounds.xMax;u+=o){let f=this.getX(u);l+=`M${f},0v5`;let v=t==="row"?mt(u,4):(p=a==null?void 0:a[u])!=null?p:mt(u,4),[m,g]=c(v);h("text",{text:m,fill:g,x:f,y:21},this.$labels)}if(t==="row"&&a){let u=a.length?r/a.length:0;for(let f=0;f<=a.length;++f){let v=-f*u;l+=`M0 ${v}h-5`;let[m,g]=c(a[f]);h("text",{text:m,fill:g,x:-12,y:v-u/2+5,"text-anchor":"end"},this.$labels)}}else for(let u=this.bounds.yMin;u<=this.bounds.yMax;u+=n){let f=this.getY(u);l+=`M0 ${-f}h-5`;let v=mt(u,4);h("text",{text:v,x:-10,y:-f+5,"text-anchor":"end"},this.$labels)}this.$axes.setAttr("d",l)}drawColumnChart(t,i){let r=t.length,o=t[0].length,n=this.path.w/r,a=n/4,l=n-a,c=i==="grouped";c&&(l/=o);for(let p=0;p<o;++p)for(let u=0;u<r;++u){let f=t[u][p],v=u*n+a/2+(c?p*l:0),m=[-this.getY(f[0]),-this.getY(f[1])],g=Math.abs(m[1]-m[0]);this.drawRect(p*r+u,p,v,Math.min(...m),l,g)}}drawRowChart(t,i){let r=t.length,o=t[0].length,n=this.path.h/r,a=n/4,l=n-a,c=i==="grouped";c&&(l/=o);for(let p=0;p<o;++p)for(let u=0;u<r;++u){let f=t[u][p],v=u*n+a/2+(c?p*l:0),m=[this.getX(f[0]),this.getX(f[1])],g=Math.abs(m[1]-m[0]);this.drawRect(p*r+u,p,Math.min(...m),-(v+l),g,l)}}drawRect(t,i,r,o,n,a){let l=this.$rects.get(t);this.$series.append(l),l.setAttr("fill",this.getSeriesColor(i)),l.setAttr("x",r),l.setAttr("y",o),l.setAttr("width",n),l.setAttr("height",a),l.setAttr("series-idx",i)}drawLines(t,i){let r=t[0].length;for(let o=0;o<r;++o){let n=t.map((l,c)=>{var p;return`${this.getX((p=i==null?void 0:i[c])!=null?p:c)} ${-this.getY(l[o][1])}`}).join(" "),a=this.$lines.get(o);a.setAttr("stroke",this.getSeriesColor(o)),a.setAttr("points",n),a.setAttr("series-idx",o),this.$series.append(a)}}drawPoints(t,i){var n;let r=t[0].length,o=t.length;for(let a=0;a<r;++a)for(let l=0;l<o;++l){let c=this.$points.get(a*o+l);c.setCenter({x:this.getX((n=i==null?void 0:i[l])!=null?n:l),y:-this.getY(t[l][a][1])}),c.setAttr("fill",this.getSeriesColor(a)),c.setAttr("series-idx",a),this.$foreground.append(c)}}drawAreas(t,i){let r=t[0].length;for(let o=0;o<r;++o){let n=t.map((c,p)=>{var u;return`${this.getX((u=i==null?void 0:i[p])!=null?u:p)} ${-this.getY(c[o][1])}`}).join(" "),a=t.map((c,p)=>{var u;return`${this.getX((u=i==null?void 0:i[p])!=null?u:p)} ${-this.getY(c[o][0])}`}).reverse().join(" "),l=this.$areas.get(o);l.setAttr("fill",this.getSeriesColor(o)),l.setAttr("points",n+" "+a),l.setAttr("series-idx",o),this.$series.append(l)}}colorSeries(t,i){var r,o,n,a;if(this.series.length){(r=this.$lines.stack[i])==null||r.setAttr("stroke",t),(o=this.$areas.stack[i])==null||o.setAttr("stroke",t),(n=this.$areas.stack[i])==null||n.setAttr("fill",t),i===this.focussedSeries&&((a=this.$focussedLine)==null||a.setAttr("stroke",t));for(let l of this.$series.$$(`rect[series-idx="${i}"]`))l.setAttr("fill",t);for(let l of this.$foreground.$$(`circle[series-idx="${i}"]`))l.setAttr("fill",t)}}focusSeries(t){if(this.props.kind==="line"){this.$focussedLine||(this.$focussedLine=h("polyline",{class:"chart-shadow"}),this.$background.insertAfter(this.$focussedLine)),this.$focussedLine.setAttr("points",this.$lines.get(t).attr("points")),this.$focussedLine.setAttr("stroke",this.getSeriesColor(t)),this.$focussedLine.show();return}if(this.$focussedOutline||(this.$focussedOutline=h("path",{class:"chart-outline"},this.$el)),this.props.kind==="area"){let r="M"+Ms(this.$areas.get(t).attr("points").split(" "),2).map(o=>o.join(" ")).join("L")+"Z";this.$focussedOutline.setAttr("d",r)}else{let i=this.$rects.stack.filter(o=>+o.attr("series-idx")===t&&o.css("display")),r="";for(let o of i){let n=+o.attr("height");if(E(0,n))continue;let a=o.attr("width");r+=`M${o.attr("x")} ${o.attr("y")}h${a}v${n}h${-a}Z`}this.$focussedOutline.setAttr("d",r)}this.$focussedOutline.show()}blur(){var t,i;super.blur(),(t=this.$focussedOutline)==null||t.hide(),(i=this.$focussedLine)==null||i.hide()}findClosestElement(t){var o;if(this.props.kind!=="line"&&this.props.kind!=="area")return"";let i=this.relativePosn(t.posn),r=this.$lines.stack.slice(0,this.series.length);return((o=Vs(r,n=>{let a=Ms(n.attr("points").split(" "),2).map(([c,p])=>new d(+c,+p)),l=new ve(...a);return d.distance(i,l.project(i))}))==null?void 0:o.attr("series-idx"))||""}static altText(t){switch(t.kind){case"line":return"";case"area":return"";case"row":return"";default:return""}}};Ki.type="chart",Ki.defaultProps={color:y.darkGrey},Ki=w([T],Ki);O([{id:"chart-type",type:"select",tileTypes:["chart"],radio:!0,label:"",options:[{label:"",key:"column",icon:"column-chart"},{label:"",key:"row",icon:"row-chart"},{label:"",key:"line",icon:"line-chart"},{label:"",key:"area",icon:"area-chart"}],get:e=>e.props.kind||"column",set:(e,s)=>s.props.kind=e},{id:"chart-layout",type:"select",tileTypes:["chart"],radio:!0,label:"",options:[{label:"",key:"grouped",icon:"chart-grouped"},{label:"",key:"stacked",icon:"chart-stacked"},{label:"",key:"percentage",icon:"chart-percentage"}],show:e=>e.some(s=>s.series.length>1),get:e=>e.props.layout||"grouped",set:(e,s)=>s.props.layout=e}]);var _v=[2,4,5],qr=class extends zs{constructor(t,i,r){super(t,i,r);this.series=[];this.$sectors=new Be(()=>h("path",{class:"polygon-tile"}));this.$focussedOutline=h("path",{class:"chart-outline"},this.$el),this.$handle=this.makeHandle("c",o=>{this.props.width=M(tt(o.length,25),50,300)}),this.$handle.css("cursor","ew-resize"),this.props.watch("width",({width:o})=>this.updateOutline(o)),this.props.watch("kind width",({width:o,kind:n})=>this.drawChart(n||"pie",o)),this.makeInPort("main",{tileTypes:["table"],max:1,message:o=>{if(o.type!=="table")return;let n=$o(o.table).slice(1);if(n.length===0)this.series=[];else{let a=n[0].length>1?1:0;this.series=n.map(l=>Math.abs(+l[a].replace(Ac,"")||0)),this.seriesLabels=n.map(l=>l[0])}this.drawChart(this.props.kind,this.props.width)},disconnect:()=>{this.series=[],this.drawChart(this.props.kind,this.props.width)}})}updateOutline(t=100){this.path=new q(P,t),this.$outline.draw(this.path),this.$handle.setTransform({x:t,y:0}),this.transform(),this.$parent.selection.update()}drawChart(t,i=100){var l,c;this.default=!this.series.length||this.series.every(p=>p===0);let r=this.default?_v:this.series,o=_(r),n=r.map(p=>p/o*B);this.$series.removeChildren();let a=-ht;for(let[p,u]of n.entries()){if(u===0)continue;E(u,B)&&(u=B-.001);let f=this.$sectors.get(p);this.$series.append(f),f.setAttr("fill",this.getSeriesColor(p)),f.setAttr("series-idx",p),f.draw(new hs(P,d.fromPolar(a,i),u)),a+=u}t==="donut"&&!this.$donutHole&&(this.$donutHole=h("circle",{class:"donut-hole"},this.$el)),(l=this.$donutHole)==null||l.setAttr("r",i/2),(c=this.$donutHole)==null||c.toggle(t==="donut")}colorSeries(t,i){this.series.length&&this.$sectors.get(i).setAttr("fill",t)}focusSeries(t){this.$focussedOutline.setAttr("d",this.$sectors.get(t).attr("d")),this.$focussedOutline.show()}blur(){super.blur(),this.$focussedOutline.hide()}static altText(t){return t.kind==="donut"?"":""}};qr.type="pie-chart",qr=w([T],qr);O([{id:"chart-type",type:"select",tileTypes:["pie-chart"],radio:!0,label:"",options:[{label:"",key:"pie",icon:"pie-chart"},{label:"",key:"donut",icon:"donut-chart"}],get:e=>e.props.kind||"pie",set:(e,s)=>s.props.kind=e}]);var sf=`<x-pp-tiles class=tabs-panel tab= icon=shapes><x-accordion closed checkboxes><h2 class=m-red data-key=geometry><x-icon name=geometry size=18></x-icon></h2><x-accordion class=subsection closed checkboxes><h3 data-key=polygons></h3><section><div><div class=source-wrap style=min-height:172px><div class=source tile=polygon props='{"shape":"equ-triangle"}'></div><div class=source tile=polygon props='{"shape":"square"}'></div><div class=source tile=polygon props='{"shape":"reg-pentagon"}'></div><div class=source tile=polygon props='{"shape":"reg-hexagon"}'></div><div class=source tile=polygon props='{"shape":"reg-heptagon"}'></div><div class=source tile=polygon props='{"shape":"reg-octagon"}'></div></div><div class=source-wrap style=min-height:218px><div class=source tile=polygon props='{"shape":"trapezium"}'></div><div class=source tile=polygon props='{"shape":"rhombus"}'></div><div class=source tile=polygon props='{"shape":"rhombus-2"}'></div><div class=source tile=polygon props='{"shape":"rectangle"}'></div><div class=source tile=polygon props='{"shape":"right-triangle"}'></div><div class=source tile=polygon props='{"shape":"right-triangle-2"}'></div><div class=source tile=polygon props='{"shape":"chevron"}'></div><div class=source tile=polygon props='{"shape":"kite"}'></div><div class=source tile=polygon props='{"shape":"dart"}'></div></div><div class=source-wrap style=min-height:101px><div class=source tile=rectangle data-caption=></div><div class=source tile=reg-polygon data-caption=></div><div class=source tile=custom-polygon data-caption=></div><div class=source tile=circle data-caption=></div></div></div></section><h3 data-key=polyominoes></h3><section><div class=subtitle></div><div class=source-wrap><svg width=242 height=102><path class="source polygon-tile" tile=polyomino props='{"index":0}'></path><path class="source polygon-tile" tile=polyomino props='{"index":1}'></path><path class="source polygon-tile" tile=polyomino props='{"index":2}'></path><path class="source polygon-tile" tile=polyomino props='{"index":3}'></path><path class="source polygon-tile" tile=polyomino props='{"index":4}'></path><path class="source polygon-tile" tile=polyomino props='{"index":5}'></path><path class="source polygon-tile" tile=polyomino props='{"index":6}'></path><path class="source polygon-tile" tile=polyomino props='{"index":7}'></path><path class="source polygon-tile" tile=polyomino props='{"index":8}'></path><path class="source polygon-tile" tile=polyomino props='{"index":9}'></path><path class="source polygon-tile" tile=polyomino props='{"index":10}'></path><path class="source polygon-tile" tile=polyomino props='{"index":11}'></path></svg></div><div class=subtitle></div><div class=source-wrap><svg width=122 height=82><path class="source polygon-tile" tile=polyomino props='{"index":12}'></path><path class="source polygon-tile" tile=polyomino props='{"index":13}'></path><path class="source polygon-tile" tile=polyomino props='{"index":14}'></path><path class="source polygon-tile" tile=polyomino props='{"index":15}'></path><path class="source polygon-tile" tile=polyomino props='{"index":16}'></path></svg></div></section><h3 data-key=tangram></h3><section><div class=subtitle></div><div class=source-wrap><svg width=148 height=148><path class="source polygon-tile" tile=tangram props='{"index":0,"rot":-90}'></path><path class="source polygon-tile" tile=tangram props='{"index":1,"rot":0}'></path><path class="source polygon-tile" tile=tangram props='{"index":2,"rot":0}'></path><path class="source polygon-tile" tile=tangram props='{"index":3,"rot":0}'></path><path class="source polygon-tile" tile=tangram props='{"index":4,"rot":-90}'></path><path class="source polygon-tile" tile=tangram props='{"index":5,"rot":0}'></path><path class="source polygon-tile" tile=tangram props='{"index":6,"rot":90}'></path></svg></div><div class=subtitle></div><div class=source-wrap><svg width=148 height=190><path class="source polygon-tile" tile=egg props='{"index":0,"rot":-22.5}'></path><path class="source polygon-tile" tile=egg props='{"index":1,"rot":22.5}'></path><path class="source polygon-tile" tile=egg props='{"index":2,"rot":45}'></path><path class="source polygon-tile" tile=egg props='{"index":3,"rot":-45}'></path><path class="source polygon-tile" tile=egg props='{"index":4,"rot":135}'></path><path class="source polygon-tile" tile=egg props='{"index":5,"rot":-135}'></path><path class="source polygon-tile" tile=egg props='{"index":6,"rot":180}'></path><path class="source polygon-tile" tile=egg props='{"index":7,"rot":45}'></path><path class="source polygon-tile" tile=egg props='{"index":8,"rot":-45}'></path></svg></div></section><h3 data-key=penrose></h3><section><div class=subtitle></div><div class=source-wrap style=min-height:118px><div class=source tile=penrose></div><div class=source tile=penrose props='{"index":1}'></div><p class=caption></p></div><div class=subtitle></div><div class=source-wrap style=min-height:274px><div class=source tile=garden props='{"index":1}'></div><div class=source tile=garden props='{"index":3}'></div><div class=source tile=garden props='{"index":4}'></div><div class=source tile=garden props='{"index":0}'></div><div class=source tile=garden props='{"index":6}'></div><div class=source tile=garden props='{"index":7}'></div><div class=source tile=garden props='{"index":2}'></div><div class=source tile=garden props='{"index":5}'></div><p class=caption>Robert Fathauer</p></div></section><h3 data-key=pentagons></h3><section><div class=source-wrap style=min-height:400px><div class="source tight" tile=polygon props='{"shape":"pentagon-1"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-2"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-3"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-4"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-5"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-6"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-7"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-8"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-9"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-10"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-11"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-12"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-13"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-14"}'></div><div class="source tight" tile=polygon props='{"shape":"pentagon-15"}'></div></div><div class=subtitle></div><div class=source-wrap style=min-height:100px><div class=source tile=polygon props='{"shape":"pentagon-16"}' data-caption=></div><div class=source tile=polygon props='{"shape":"pentagon-17"}' data-caption=></div><div class=source tile=polygon props='{"shape":"pentagon-18"}' data-caption=></div></div></section><h3 data-key=solids>3D </h3><section><div class=subtitle></div><div class="source-wrap ui-light-invert" style=min-height:180px><div class=source tile=polyhedron props='{"net":"Tetrahedron"}' data-caption=></div><div class=source tile=polyhedron props='{"net":"Cube"}' data-caption=></div><div class=source tile=polyhedron props='{"net":"Octahedron"}' data-caption=></div><div class=source tile=polyhedron props='{"net":"Dodecahedron"}' data-caption=></div><div class=source tile=polyhedron props='{"net":"Icosahedron"}' data-caption=></div></div><div class=subtitle></div><div class="source-wrap ui-light-invert" style=min-height:90px><div class=source tile=polyhedron props='{"net":"Prism"}' data-caption=></div><div class=source tile=polyhedron props='{"net":"Pyramid"}' data-caption=></div></div></section><h3 data-key=measuring></h3><section><div class=source-wrap style=max-width:220px><div class=source tile=ruler data-caption=><img class=ui-light-invert src=./css/svg/mathigon/ruler.svg width=80 height=80></div><div class=source tile=protractor data-caption=><img class=ui-light-invert src=./css/svg/mathigon/protractor.svg width=80 height=80></div><div class=source tile=set-triangle data-caption=><img class=ui-light-invert src=./css/svg/mathigon/set-triangle.svg width=80 height=80></div><div class=source tile=compass data-caption=><img src=./css/svg/mathigon/compass.svg width=80 height=80></div></div></section><h3 data-key=patterns></h3><section><div><div class=subtitle></div><div class=source-wrap style=min-height:264px><div class=source tile=tantrix props='{"index":0}'></div><div class=source tile=tantrix props='{"index":1}'></div><div class=source tile=tantrix props='{"index":2}'></div><div class=source tile=tantrix props='{"index":3}'></div><div class=source tile=tantrix props='{"index":4}'></div><div class=source tile=tantrix props='{"index":5}'></div><div class=source tile=tantrix props='{"index":6}'></div><div class=source tile=tantrix props='{"index":7}'></div><div class=source tile=tantrix props='{"index":8}'></div><div class=source tile=tantrix props='{"index":9}'></div><div class=source tile=tantrix props='{"index":10}'></div><div class=source tile=tantrix props='{"index":11}'></div><div class=source tile=tantrix props='{"index":12}'></div><div class=source tile=tantrix props='{"index":13}'></div></div><div class=subtitle></div><div class=source-wrap style=min-height:156px><div class=source tile=fractal props='{"index":0}'></div><div class=source tile=fractal props='{"index":1}'></div><div class=source tile=fractal props='{"index":2}'></div><div class=source tile=fractal props='{"index":3}'></div><div class=source tile=fractal props='{"index":4}'></div></div><div class=subtitle></div><div class=source-wrap style=max-width:220px;min-height:132px><div class=source tile=kolam props='{"index":0}'></div><div class=source tile=kolam props='{"index":1}'></div><div class=source tile=kolam props='{"index":2}'></div><div class=source tile=kolam props='{"index":3}'></div><div class=source tile=kolam props='{"index":4}'></div><div class=source tile=kolam props='{"index":5}'></div></div></div></section></x-accordion><h2 class=m-orange data-key=numbers><x-icon name=numbers size=18></x-icon></h2><x-accordion class=subsection closed checkboxes><h3 data-key=number-tiles></h3><section><div class=source-wrap style=min-height:86px><div class=source tile=number-tile props='{"width":1,"value":1}'></div><div class=source tile=number-tile props='{"width":10,"value":10}'></div><div class=source tile=number-tile props='{"width":10,"value":100}'></div></div><div class=source-wrap style=min-height:186px><div class=source tile=number-cube></div><div class=source tile=number-cube props='{"vx":1,"vy":1,"vz":10}'></div><div class=source tile=number-cube props='{"vx":10,"vy":1,"vz":10}'></div><div class=source tile=number-cube props='{"vx":10,"vy":10,"vz":10}'></div><div class=primes><div class=input-row><input class=input-field type=number placeholder=x min=1 max=10 :bind=vx value=5><input class=input-field type=number placeholder=y min=1 max=10 :bind=vy value=5><input class=input-field type=number placeholder=z min=1 max=10 :bind=vz value=5></div><div class=source tile=number-cube props='{"vx":\${round(vx)},"vy":\${round(vy)},"vz":\${round(vz)}}'></div></div></div></section><h3 data-key=number-bars></h3><section><div class=source-wrap style=max-width:240px;min-height:140px><div class=source tile=number-bar props='{"value":1}'></div><div class=source tile=number-bar props='{"value":10}'></div><div class=source tile=number-bar props='{"value":2}'></div><div class=source tile=number-bar props='{"value":9}'></div><div class=source tile=number-bar props='{"value":3}'></div><div class=source tile=number-bar props='{"value":8}'></div><div class=source tile=number-bar props='{"value":4}'></div><div class=source tile=number-bar props='{"value":7}'></div><div class=source tile=number-bar props='{"value":5}'></div><div class=source tile=number-bar props='{"value":6}'></div></div></section><h3 data-key=number-frames></h3><section><div class=source-wrap style=align-items:center;min-height:60px><div class=source tile=ten-frame></div><div class=source tile=ten-frame-counter></div><div class=source tile=ten-frame-counter props='{"value":-1}'></div></div><div class=source-wrap style=min-height:175px><div class=source tile=number-frame props='{"value":1}'></div><div class=source tile=number-frame props='{"value":2}'></div><div class=source tile=number-frame props='{"value":3}'></div><div class=source tile=number-frame props='{"value":4}'></div><div class=source tile=number-frame props='{"value":5}'></div><div class=source tile=number-frame props='{"value":6}'></div><div class=source tile=number-frame props='{"value":7}'></div><div class=source tile=number-frame props='{"value":8}'></div><div class=source tile=number-frame props='{"value":9}'></div><div class=source tile=number-frame props='{"value":10}'></div></div></section><h3 data-key=number-cards></h3><section><div class=source-wrap style=min-height:272px><div class=source tile=number-card props='{"value":1}'></div><div class=source tile=number-card props='{"value":2}'></div><div class=source tile=number-card props='{"value":3}'></div><div class=source tile=number-card props='{"value":4}'></div><div class=source tile=number-card props='{"value":5}'></div><div class=source tile=number-card props='{"value":6}'></div><div class=source tile=number-card props='{"value":7}'></div><div class=source tile=number-card props='{"value":8}'></div><div class=source tile=number-card props='{"value":9}'></div><div class=source tile=number-card props='{"value":10}'></div><div class=source tile=number-card props='{"value":100}'></div><div class=source tile=number-card props='{"value":1000}'></div><div class=primes><input class=input-field type=number min=-9999 max=9999 :bind=q value=25><div class=source tile=number-card props='{"value":\${q}}'></div></div></div></section><h3 data-key=number-line></h3><section><div class=source-wrap style=min-height:102px><div class=source tile=number-line></div><div class=source tile=multi-jump props='{"single":true,"isFlipped":true,"color":"#cd0e66"}'></div><div class=source tile=multi-jump props='{"single":true}'></div><div class=source tile=multi-jump></div></div></section><h3 data-key=primes></h3><section><div class=source-wrap style=min-height:368px><div class=source tile=prime-disk props='{"value":1}'></div><div class=source tile=prime-disk props='{"value":2}'></div><div class=source tile=prime-disk props='{"value":3}'></div><div class=source tile=prime-disk props='{"value":4}'></div><div class=source tile=prime-disk props='{"value":5}'></div><div class=source tile=prime-disk props='{"value":6}'></div><div class=source tile=prime-disk props='{"value":7}'></div><div class=source tile=prime-disk props='{"value":8}'></div><div class=source tile=prime-disk props='{"value":9}'></div><div class=source tile=prime-disk props='{"value":10}'></div><div class=source tile=prime-disk props='{"value":11}'></div><div class=source tile=prime-disk props='{"value":12}'></div><div class=source tile=prime-disk props='{"value":13}'></div><div class=source tile=prime-disk props='{"value":14}'></div><div class=source tile=prime-disk props='{"value":15}'></div><div class=source tile=prime-disk props='{"value":16}'></div><div class=source tile=prime-disk props='{"value":17}'></div><div class=source tile=prime-disk props='{"value":18}'></div><div class=source tile=prime-disk props='{"value":19}'></div><div class=source tile=prime-disk props='{"value":20}'></div><div class=primes><input class=input-field type=number min=1 max=10000 :bind=p value=25><div class=source tile=prime-disk props='{"value":\${round(p)}}'></div></div></div></section><h3 data-key=number-dots></h3><section><div class=source-wrap style=min-height:364px><div class=source tile=number-dot n=2 data-caption=2></div><div class=source tile=number-dot n=3 data-caption=3></div><div class=source tile=number-dot n=4 data-caption=4></div><div class=source tile=number-dot n=5 data-caption=5></div><div class=source tile=number-dot n=6 data-caption=6></div><div class=source tile=number-dot n=7 data-caption=7></div><div class=source tile=number-dot n=8 data-caption=8></div><div class=source tile=number-dot n=9 data-caption=9></div><div class=source tile=number-dot n=10 data-caption=10></div><div class=source tile=number-dot n=11 data-caption=11></div><div class=source tile=number-dot n=12 data-caption=12></div><div class=source tile=number-dot n=13 data-caption=13></div><div class=source tile=number-dot n=14 data-caption=14></div><div class=source tile=number-dot n=15 data-caption=15></div><div class=source tile=number-dot n=16 data-caption=16></div><div class=source tile=number-dot n=17 data-caption=17></div><div class=primes><input class=input-field type=number min=1 max=100 :bind=r value=18><div class=source tile=number-dot :n=r></div></div></div></section><h3 data-key=number-grid></h3><section><div class=source-wrap style=min-height:385px><div class=source tile=number-grid props='{"kind":"addition","rows":6,"cols":6}' data-caption=></div><div class=source tile=number-grid props='{"kind":"multiplication","rows":6,"cols":6}' data-caption=></div><div class=source tile=number-grid></div><div class=source tile=decimal-grid></div></div></section><h3 data-key=number-tools></h3><section><div><div class=subtitle></div><div class=source-wrap style=min-height:46px><div class=source tile=abacus></div></div><div class=subtitle></div><div class=source-wrap style=justify-content:center;min-height:117px><div class=source tile=dot></div><div class=source tile=dot props='{"value":-1}'></div><div class=source tile=dot-machine style="margin:3px 15px 8px"></div></div><div class=subtitle></div><div class=source-wrap style=justify-content:center;align-items:center;min-height:146px><div class=source tile=bucket style=margin-right:8px></div><svg width=24 height=24 style=margin-right:10px><rect class="source polygon-tile" tile=algebra props='{"expr":"1"}'></rect></svg><svg width=24 height=24><rect class="source polygon-tile" tile=algebra props='{"expr":"-1"}'></rect></svg></div></div></section></x-accordion><h2 class=m-yellow data-key=fractions><x-icon name=fractions size=18></x-icon></h2><x-accordion class=subsection closed checkboxes><h3 data-key=fraction-bars></h3><section><div class="source-wrap model" style=min-height:400px><x-select :bind=labels><button value=fraction title=><x-icon name=fractions></x-icon></button><button value=percentage title=>%</button><button class=small value=decimal title=>0.5</button><button value=hidden title=><x-icon name=eye-off size=20 style="margin:2px 6px"></x-icon></button></x-select><div class=source tile=fraction-bar props='{"count":1,"denominator":1,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":2,"denominator":2,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":3,"denominator":3,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":4,"denominator":4,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":5,"denominator":5,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":6,"denominator":6,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":7,"denominator":7,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":8,"denominator":8,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":9,"denominator":9,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":10,"denominator":10,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":11,"denominator":11,"labels":"\${labels}"}'></div><div class=source tile=fraction-bar props='{"count":12,"denominator":12,"labels":"\${labels}"}'></div></div></section><h3 data-key=fraction-circles></h3><section><div class="source-wrap model" style=min-height:240px><x-select :bind=labels><button value=fraction title=><x-icon name=fractions></x-icon></button><button value=percentage title=>%</button><button class=small value=decimal title=>0.5</button><button value=hidden title=><x-icon name=eye-off size=20 style="margin:2px 6px"></x-icon></button></x-select><div class=source tile=fraction-circle props='{"denominator":1,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":2,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":3,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":4,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":5,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":6,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":7,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":8,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":9,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":10,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":11,"labels":"\${labels}"}'></div><div class=source tile=fraction-circle props='{"denominator":12,"labels":"\${labels}"}'></div></div></section></x-accordion><h2 class=m-green data-key=algebra><x-icon name=algebra size=18></x-icon></h2><x-accordion class=subsection closed checkboxes><h3 data-key=algebra-tiles></h3><section><div class=source-wrap style=min-height:388px><svg width=178 height=188><rect class="source polygon-tile" tile=algebra props='{"expr":"1"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"x"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"y"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"xy"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"x2"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"y2"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"x","rot":90}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"y","rot":90}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"xy","rot":90}'></rect></svg><svg width=178 height=188><rect class="source polygon-tile" tile=algebra props='{"expr":"-1"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"-x"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"-y"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"-xy"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"-x2"}'></rect><rect class="source polygon-tile" tile=algebra props='{"expr":"-y2"}'></rect></svg><x-drag min=1 max=10 step=1 name=algebraXSize label=x></x-drag><x-drag min=1 max=10 step=1 name=algebraYSize label=y></x-drag></div></section><h3 data-key=balance></h3><section><div class=source-wrap style=min-height:98px><div class=source tile=token props='{"shape":"circle"}'></div><div class=source tile=token props='{"shape":"square"}'></div><div class=source tile=token props='{"shape":"cross"}'></div><div class=source tile=token props='{"shape":"weight"}'></div><div class=source tile=token props='{"shape":"star"}'></div><div class=source tile=token props='{"shape":"heart"}'></div><div class=source tile=balance></div></div></section><h3 data-key=axes></h3><section><div class=source-wrap style=min-height:126px;align-items:center><div class=source tile=axes></div><div class=source tile=table></div></div></section><h3 data-key=sliders></h3><section><div class=source-wrap style=min-height:120px><div class=source tile=slider props='{"variable":"a","color":"#cd0e66"}'></div><div class=source tile=slider props='{"variable":"b","color":"#0f82f2"}'></div><div class=source tile=slider props='{"variable":"c","color":"#22ab24"}'></div><div class=source tile=slider props='{"variable":"d","color":"#fd8c00"}'></div></div></section></x-accordion><h2 class=m-teal data-key=probability><x-icon name=probability size=18></x-icon></h2><x-accordion class=subsection closed checkboxes><h3 data-key=random></h3><section><div class=source-wrap style=min-height:181px><div class=source tile=dice data-caption=></div><div class=source tile=coin data-caption=></div><div class=source tile=random data-caption=></div><div class=source tile=spinner data-caption=></div><div class=source tile=custom-spinner data-caption=></div></div></section><h3 data-key=charts></h3><section><div><div class=source-wrap style=min-height:322px><div class=source tile=chart data-caption=><svg height=65 viewBox="0 0 90 65" width=90 xmlns=http://www.w3.org/2000/svg><path d="m6 42h11v21h-11z" fill=#cd0e66 /><path d="m17 17h11v46h-11z" fill=#0f82f2 /><path d="m34 29h11v34h-11z" fill=#cd0e66 /><path d="m45 36h11v27h-11z" fill=#0f82f2 /><path d="m62 20h11v43h-11z" fill=#cd0e66 /><path d="m73 4h11v59h-11z" fill=#0f82f2 /><path d="m2 2v61h86" fill=none stroke=var(--canvas-bg) stroke-width=2 /></svg></div><div class=source tile=chart props='{"kind":"row"}' data-caption=><svg height=65 viewBox="0 0 90 65" width=90 xmlns=http://www.w3.org/2000/svg><g fill=#0f82f2><path d="m2 4h84v8h-84z"/><path d="m2 24h39v8h-39z"/><path d="m2 44h67v8h-67z"/></g><path d="m2 52h30v8h-30z" fill=#cd0e66 /><path d="m2 32h50v8h-50z" fill=#cd0e66 /><path d="m2 12h60v8h-60z" fill=#cd0e66 /><path d="m2 2v61h86" fill=none stroke=var(--canvas-bg) stroke-width=2 /></svg></div><div class=source tile=chart props='{"kind":"line"}' data-caption=><svg height=65 viewBox="0 0 90 65" width=90 xmlns=http://www.w3.org/2000/svg><g fill=none><path d="m6 51 40-18 40-8" stroke=#cd0e66 stroke-width=4 /><path d="m6 22 40 23 40-40" stroke=#0f82f2 stroke-width=4 /><path d="m2 2v61h86" stroke=var(--canvas-bg) stroke-width=2 /></g></svg></div><div class=source tile=chart props='{"kind":"area","layout":"stacked"}' data-caption=><svg height=65 viewBox="0 0 90 65" width=90 xmlns=http://www.w3.org/2000/svg><path d="m86 52h-84v-28l42 4 42-24z" fill=#0f82f2 /><path d="m86 63h-84v-12l42-9 42-4z" fill=#cd0e66 /><path d="m2 2v61h86" fill=none stroke=var(--canvas-bg) stroke-width=2 /></svg></div><div class=source tile=pie-chart data-caption=><svg height=65 viewBox="0 0 90 65" width=90 xmlns=http://www.w3.org/2000/svg><g stroke=var(--canvas-bg)><path d="m45 32.48-10.26 28.17a30 30 0 0 1 -17.92-38.42 29.49 29.49 0 0 1 28.18-19.73z" fill=#0f82f2 /><path d="m45 32.48 29.54-5.21a30 30 0 0 1 -24.33 34.73 28.74 28.74 0 0 1 -15.47-1.36z" fill=#22ab24 /><path d="m45 32.48v-29.98a29.74 29.74 0 0 1 29.54 24.77z" fill=#cd0e66 /></g></svg></div><div class=source tile=pie-chart props='{"kind":"donut"}' data-caption=><svg height=65 viewBox="0 0 90 65" width=90 xmlns=http://www.w3.org/2000/svg><g stroke=var(--canvas-bg)><path d="m30 32.5a15 15 0 0 1 15-15v-15a29.49 29.49 0 0 0 -28.18 19.73 30 30 0 0 0 17.92 38.42l5.13-14.07a15 15 0 0 1 -9.87-14.08z" fill=#0f82f2 /><path d="m74.54 27.27-14.78 2.61a15 15 0 0 1 -19.89 16.7l-5.13 14.07a28.74 28.74 0 0 0 15.47 1.35 30 30 0 0 0 24.33-34.73z" fill=#22ab24 /><path d="m59.76 29.88 14.78-2.61a29.74 29.74 0 0 0 -29.54-24.77v15a15 15 0 0 1 14.76 12.38z" fill=#cd0e66 /></g></svg></div><div class=source tile=box-whisker data-caption=></div></div><div class=source-wrap style=min-height:133px;align-items:center><div class=source tile=axes></div><div class=source tile=table></div></div></div></section><h3 data-key=playing-cards></h3><section><div class="source-wrap model" style=justify-content:center;min-height:372px><x-select :bind=suit><button title= value=C><x-icon name=clubs></x-icon></button><button title= value=S><x-icon name=spades></x-icon></button><button title= value=H><x-icon name=hearts></x-icon></button><button title= value=D><x-icon name=diamonds></x-icon></button></x-select><div class=source tile=card props='{"cards":"2\${suit}"}'></div><div class=source tile=card props='{"cards":"3\${suit}"}'></div><div class=source tile=card props='{"cards":"4\${suit}"}'></div><div class=source tile=card props='{"cards":"5\${suit}"}'></div><div class=source tile=card props='{"cards":"6\${suit}"}'></div><div class=source tile=card props='{"cards":"7\${suit}"}'></div><div class=source tile=card props='{"cards":"8\${suit}"}'></div><div class=source tile=card props='{"cards":"9\${suit}"}'></div><div class=source tile=card props='{"cards":"0\${suit}"}'></div><div class=source tile=card props='{"cards":"J\${suit}"}'></div><div class=source tile=card props='{"cards":"Q\${suit}"}'></div><div class=source tile=card props='{"cards":"K\${suit}"}'></div><div class=source tile=card props='{"cards":"A\${suit}"}'></div><div class=source tile=card props='{"cards":"JJ"}'></div><div class=source tile=card props='{"cards":"deck"}' data-caption=52></div></div></section><h3 data-key=polyhedral-dice></h3><section><div class="source-wrap ui-light-invert" style=min-height:180px><div class=source tile=polyhedral-dice data-caption=d4></div><div class=source tile=polyhedral-dice props='{"faceCount":6}' data-caption=d6></div><div class=source tile=polyhedral-dice props='{"faceCount":8}' data-caption=d8></div><div class=source tile=polyhedral-dice props='{"faceCount":10}' data-caption=d10></div><div class=source tile=polyhedral-dice props='{"faceCount":12}' data-caption=d12></div><div class=source tile=polyhedral-dice props='{"faceCount":20}' data-caption=d20></div></div></section><h3 data-key=non-trans-dice></h3><section><div class=subtitle></div><div class=source-wrap style=min-height:82px><div class=source tile=dice props='{"faces":"3,3,3,3,3,6","color":"#cd0e66"}'></div><div class=source tile=dice props='{"faces":"2,2,2,5,5,5","color":"#0f82f2"}'></div><div class=source tile=dice props='{"faces":"1,4,4,4,4,4","color":"#22ab24"}'></div></div><div class=subtitle></div><div class=source-wrap style=min-height:82px><div class=source tile=dice props='{"faces":"3,3,3,3,3,3","color":"#cd0e66"}'></div><div class=source tile=dice props='{"faces":"2,2,2,2,6,6","color":"#0f82f2"}'></div><div class=source tile=dice props='{"faces":"1,1,1,5,5,5","color":"#22ab24"}'></div><div class=source tile=dice props='{"faces":"0,0,4,4,4,4","color":"#fd8c00"}'></div></div><div class=subtitle></div><div class=source-wrap style=max-width:220px;min-height:164px><div class=source tile=dice props='{"faces":"2,2,2,7,7,7","color":"#cd0e66"}'></div><div class=source tile=dice props='{"faces":"1,1,6,6,6,6","color":"#0f82f2"}'></div><div class=source tile=dice props='{"faces":"0,5,5,5,5,5","color":"#22ab24"}'></div><div class=source tile=dice props='{"faces":"4,4,4,4,4,9","color":"#fd8c00"}'></div><div class=source tile=dice props='{"faces":"3,3,3,3,8,8","color":"#eb4726"}'></div></div></section></x-accordion><h2 class=m-blue data-key=applications><x-icon name=lightbulb size=18></x-icon></h2><x-accordion class=subsection closed checkboxes><h3 data-key=music></h3><section><div class=source-wrap style=min-height:211px><div class=source tile=piano data-caption=></div><div class=source tile=song data-caption=></div></div></section><h3 data-key=logic></h3><section><div class=source-wrap style=min-height:93px><div class=subtitle></div><div class=source tile=logic-button data-caption=></div><div class=source tile=logic-switch data-caption=></div><div class=source tile=logic-metronome data-caption=></div></div><div class=source-wrap style=min-height:93px><div class=subtitle></div><div class=source tile=logic-bulb data-caption=></div><div class=source tile=logic-speaker data-caption=></div><div class=source tile=logic-display data-caption=></div></div><div class=source-wrap style=min-height:154px><div class=subtitle></div><div class=source tile=logic-gate props='{"gate":"and"}' data-caption=and></div><div class=source tile=logic-gate props='{"gate":"or"}' data-caption=or></div><div class=source tile=logic-gate props='{"gate":"xor"}' data-caption=xor></div><div class=source tile=logic-gate props='{"gate":"buffer"}' data-caption=buffer></div><div class=source tile=logic-gate props='{"gate":"nand"}' data-caption=nand></div><div class=source tile=logic-gate props='{"gate":"nor"}' data-caption=nor></div><div class=source tile=logic-gate props='{"gate":"xnor"}' data-caption=xnor></div><div class=source tile=logic-gate props='{"gate":"not"}' data-caption=not></div></div><div class=source-wrap style=min-height:96px><div class=subtitle></div><div class=source tile=logic-gate props='{"gate":"sr"}'></div><div class=source tile=logic-gate props='{"gate":"t"}'></div><div class=source tile=logic-gate props='{"gate":"d"}'></div><div class=source tile=logic-gate props='{"gate":"jk"}'></div></div></section><h3 data-key=chess></h3><section><div class=source-wrap style=min-height:130px><div class=source tile=chess-board></div></div><div class=source-wrap style=min-height:99px><div class=source tile=chess-piece props='{"piece":"p"}'></div><div class=source tile=chess-piece props='{"piece":"b"}'></div><div class=source tile=chess-piece props='{"piece":"n"}'></div><div class=source tile=chess-piece props='{"piece":"r"}'></div><div class=source tile=chess-piece props='{"piece":"k"}'></div><div class=source tile=chess-piece props='{"piece":"q"}'></div><div class=source tile=chess-piece props='{"dark":true,"piece":"p"}'></div><div class=source tile=chess-piece props='{"dark":true,"piece":"b"}'></div><div class=source tile=chess-piece props='{"dark":true,"piece":"n"}'></div><div class=source tile=chess-piece props='{"dark":true,"piece":"r"}'></div><div class=source tile=chess-piece props='{"dark":true,"piece":"k"}'></div><div class=source tile=chess-piece props='{"dark":true,"piece":"q"}'></div></div></section><h3 data-key=currency></h3><section><div><div class="source-wrap model" style=min-height:172px><x-select :bind=currency><button title=USD value=USD>$</button><button title=EUR value=EUR style=font-size:1.3em></button><button title=GBP value=GBP style=font-size:1.3em>\xA3</button><button title=CAD value=CAD>C$</button></x-select><div class=source tile=currency props='{"value":1,"currency":"USD"}' :show="currency=='USD'"></div><div class=source tile=currency props='{"value":5,"currency":"USD"}' :show="currency=='USD'"></div><div class=source tile=currency props='{"value":10,"currency":"USD"}' :show="currency=='USD'"></div><div class=source tile=currency props='{"value":25,"currency":"USD"}' :show="currency=='USD'"></div><div class=source tile=currency props='{"value":100,"currency":"USD"}' :show="currency=='USD'"></div><div class=source tile=currency props='{"value":1,"currency":"EUR"}' :show="currency=='EUR'"></div><div class=source tile=currency props='{"value":2,"currency":"EUR"}' :show="currency=='EUR'"></div><div class=source tile=currency props='{"value":5,"currency":"EUR"}' :show="currency=='EUR'"></div><div class=source tile=currency props='{"value":10,"currency":"EUR"}' :show="currency=='EUR'"></div><div class=source tile=currency props='{"value":20,"currency":"EUR"}' :show="currency=='EUR'"></div><div class=source tile=currency props='{"value":50,"currency":"EUR"}' :show="currency=='EUR'"></div><div class=source tile=currency props='{"value":100,"currency":"EUR"}' :show="currency=='EUR'"></div><div class=source tile=currency props='{"value":200,"currency":"EUR"}' :show="currency=='EUR'"></div><div class=source tile=currency props='{"value":1,"currency":"GBP"}' :show="currency=='GBP'"></div><div class=source tile=currency props='{"value":2,"currency":"GBP"}' :show="currency=='GBP'"></div><div class=source tile=currency props='{"value":5,"currency":"GBP"}' :show="currency=='GBP'"></div><div class=source tile=currency props='{"value":10,"currency":"GBP"}' :show="currency=='GBP'"></div><div class=source tile=currency props='{"value":20,"currency":"GBP"}' :show="currency=='GBP'"></div><div class=source tile=currency props='{"value":50,"currency":"GBP"}' :show="currency=='GBP'"></div><div class=source tile=currency props='{"value":100,"currency":"GBP"}' :show="currency=='GBP'"></div><div class=source tile=currency props='{"value":200,"currency":"GBP"}' :show="currency=='GBP'"></div><div class=source tile=currency props='{"value":1,"currency":"CAD"}' :show="currency=='CAD'"></div><div class=source tile=currency props='{"value":5,"currency":"CAD"}' :show="currency=='CAD'"></div><div class=source tile=currency props='{"value":10,"currency":"CAD"}' :show="currency=='CAD'"></div><div class=source tile=currency props='{"value":25,"currency":"CAD"}' :show="currency=='CAD'"></div><div class=source tile=currency props='{"value":50,"currency":"CAD"}' :show="currency=='CAD'"></div><div class=source tile=currency props='{"value":100,"currency":"CAD"}' :show="currency=='CAD'"></div><div class=source tile=currency props='{"value":200,"currency":"CAD"}' :show="currency=='CAD'"></div></div></div></section><h3 data-key=clocks></h3><section><div class="source-wrap ui-light-invert" style=min-height:100px><div class=source tile=clock props='{"clock":"live","color":"#cd0e66"}' data-caption=></div><div class=source tile=clock props='{"clock":"geared","color":"#0f82f2","ms":6300}' data-caption=></div><div class=source tile=clock props='{"clock":"free","color":"#22ab24","h":2,"m":45,"s":0}' data-caption=></div></div></section><h3 data-key=dominoes></h3><section><div class=source-wrap style=min-height:280px><div class=source tile=domino props='{"a":0,"b":0}'></div><div class=source tile=domino props='{"a":1,"b":0}'></div><div class=source tile=domino props='{"a":1,"b":1}'></div><div class=source tile=domino props='{"a":2,"b":0}'></div><div class=source tile=domino props='{"a":2,"b":1}'></div><div class=source tile=domino props='{"a":2,"b":2}'></div><div class=source tile=domino props='{"a":3,"b":0}'></div><div class=source tile=domino props='{"a":3,"b":1}'></div><div class=source tile=domino props='{"a":3,"b":2}'></div><div class=source tile=domino props='{"a":3,"b":3}'></div><div class=source tile=domino props='{"a":4,"b":0}'></div><div class=source tile=domino props='{"a":4,"b":1}'></div><div class=source tile=domino props='{"a":4,"b":2}'></div><div class=source tile=domino props='{"a":4,"b":3}'></div><div class=source tile=domino props='{"a":4,"b":4}'></div><div class=source tile=domino props='{"a":5,"b":0}'></div><div class=source tile=domino props='{"a":5,"b":1}'></div><div class=source tile=domino props='{"a":5,"b":2}'></div><div class=source tile=domino props='{"a":5,"b":3}'></div><div class=source tile=domino props='{"a":5,"b":4}'></div><div class=source tile=domino props='{"a":5,"b":5}'></div><div class=source tile=domino props='{"a":6,"b":0}'></div><div class=source tile=domino props='{"a":6,"b":1}'></div><div class=source tile=domino props='{"a":6,"b":2}'></div><div class=source tile=domino props='{"a":6,"b":3}'></div><div class=source tile=domino props='{"a":6,"b":4}'></div><div class=source tile=domino props='{"a":6,"b":5}'></div><div class=source tile=domino props='{"a":6,"b":6}'></div></div></section><h3 data-key=questions></h3><section><div class="source-wrap ui-light-invert" style=min-height:92px><div class=source tile=question-blank></div><p class=caption></p></div></section></x-accordion></x-accordion><a class=credit href=https://mathigon.org/polypad target=_blank>Powered by Polypad</a></x-pp-tiles>`;var rf='<x-polypad-settings hidden><div class=settings-group><button class="settings-btn undo-btn" data-action=undo data-key=undo><x-icon name=undo></x-icon><div class=tooltip></div></button><button class="settings-btn undo-btn" data-action=redo data-key=undo><x-icon name=redo></x-icon><div class=tooltip></div></button><x-popup animation=pop data-key=grid><button class="settings-btn popup-target"><x-icon name=grid></x-icon><div class=tooltip></div></button><div class=popup-body hidden aria-label=><x-select class=grid-select><button class=grid value=none title=></button><button class=grid value=square2-grid title=><svg viewBox="0 0 48 48" xmlns=http://www.w3.org/2000/svg><g fill=none stroke=#000><path d="m0 24h48"/><path d="m24 48v-48"/><path d="m42 48v-48"/><path d="m6 48v-48"/><path d="m0 42h48"/><path d="m0 6h48"/></g></svg></button><button class="grid fill" value=square-checked title="Checked Square Grid"><svg viewBox="0 0 48 48" xmlns=http://www.w3.org/2000/svg><path d="m4 4h10v10h-10z"/><path d="m24 4h10v10h-10z"/><path d="m44 4h4v10h-4z"/><path d="m4 24h10v10h-10z"/><path d="m24 24h10v10h-10z"/><path d="m44 24h4v10h-4z"/><path d="m4 44h10v4h-10z"/><path d="m24 44h10v4h-10z"/><path d="m44 44h4v4h-4z"/><path d="m0 0h4v4h-4z"/><path d="m14 0h10v4h-10z"/><path d="m34 0h10v4h-10z"/><path d="m0 14h4v10h-4z"/><path d="m14 14h10v10h-10z"/><path d="m34 14h10v10h-10z"/><path d="m0 34h4v10h-4z"/><path d="m14 34h10v10h-10z"/><path d="m34 34h10v10h-10z"/></svg></button><button class=grid value=square-dots title=><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 48 48"><circle cx=44 cy=4 r=1.5 /><circle cx=34 cy=4 r=1.5 /><circle cx=24 cy=4 r=1.5 /><circle cx=14 cy=4 r=1.5 /><circle cx=4 cy=4 r=1.5 /><circle cx=44 cy=14 r=1.5 /><circle cx=34 cy=14 r=1.5 /><circle cx=24 cy=14 r=1.5 /><circle cx=14 cy=14 r=1.5 /><circle cx=4 cy=14 r=1.5 /><circle cx=44 cy=24 r=1.5 /><circle cx=34 cy=24 r=1.5 /><circle cx=24 cy=24 r=1.5 /><circle cx=14 cy=24 r=1.5 /><circle cx=4 cy=24 r=1.5 /><circle cx=44 cy=34 r=1.5 /><circle cx=34 cy=34 r=1.5 /><circle cx=24 cy=34 r=1.5 /><circle cx=14 cy=34 r=1.5 /><circle cx=4 cy=34 r=1.5 /><circle cx=44 cy=44 r=1.5 /><circle cx=34 cy=44 r=1.5 /><circle cx=24 cy=44 r=1.5 /><circle cx=14 cy=44 r=1.5 /><circle cx=4 cy=44 r=1.5 /></svg></button><button class=grid value=tri-dots title=><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 48 48"><circle cx=15 cy=4 r=1.5 /><circle cx=3.5 cy=4 r=1.5 /><circle cx=26.5 cy=4 r=1.5 /><circle cx=38 cy=4 r=1.5 /><circle cx=15 cy=44 r=1.5 /><circle cx=3.5 cy=44 r=1.5 /><circle cx=26.5 cy=44 r=1.5 /><circle cx=38 cy=44 r=1.5 /><circle cx=21 cy=14 r=1.5 /><circle cx=9.5 cy=14 r=1.5 /><circle cx=32.5 cy=14 r=1.5 /><circle cx=44 cy=14 r=1.5 /><circle cx=15 cy=24 r=1.5 /><circle cx=3.5 cy=24 r=1.5 /><circle cx=26.5 cy=24 r=1.5 /><circle cx=38 cy=24 r=1.5 /><circle cx=21 cy=34 r=1.5 /><circle cx=9.5 cy=34 r=1.5 /><circle cx=32.5 cy=34 r=1.5 /><circle cx=44 cy=34 r=1.5 /></svg></button><button class=grid value=tri2-dots title=><svg xmlns=http://www.w3.org/2000/svg viewBox="0 0 48 48"><circle cx=4 cy=15 r=1.5 /><circle cx=4 cy=3.5 r=1.5 /><circle cx=4 cy=26.5 r=1.5 /><circle cx=4 cy=38 r=1.5 /><circle cx=44 cy=15 r=1.5 /><circle cx=44 cy=3.5 r=1.5 /><circle cx=44 cy=26.5 r=1.5 /><circle cx=44 cy=38 r=1.5 /><circle cx=14 cy=21 r=1.5 /><circle cx=14 cy=9.5 r=1.5 /><circle cx=14 cy=32.5 r=1.5 /><circle cx=14 cy=44 r=1.5 /><circle cx=24 cy=15 r=1.5 /><circle cx=24 cy=3.5 r=1.5 /><circle cx=24 cy=26.5 r=1.5 /><circle cx=24 cy=38 r=1.5 /><circle cx=34 cy=21 r=1.5 /><circle cx=34 cy=9.5 r=1.5 /><circle cx=34 cy=32.5 r=1.5 /><circle cx=34 cy=44 r=1.5 /></svg></button><button class=grid value=square-grid title=><svg viewBox="0 0 48 48" xmlns=http://www.w3.org/2000/svg><g fill=none stroke=#000><path d="m0 24h48" stroke-width=2 /><path d="m24 48v-48" stroke-width=2 /><path d="m34 48v-48"/><path d="m44 48v-48"/><path d="m4 48v-48"/><path d="m14 48v-48"/><path d="m0 34h48"/><path d="m0 44h48"/><path d="m0 4h48"/><path d="m0 14h48"/></g></svg></button><button class=grid value=tri-grid title=><svg viewBox="0 0 48 48" xmlns=http://www.w3.org/2000/svg><g fill=none stroke=#000><path d="m.5 44h48"/><path d="m0 24h48"/><path d="m0 34h48"/><path d="m0 44h48"/><path d="m0 4h48"/><path d="m0 14h48"/><path d="m-.5 48 28-48"/><path d="m-.5 27.8 16.2-27.8"/><path d="m-.5 8.4 4.9-8.4"/><path d="m3.9 48-4.4-7.5"/><path d="m11.3 48 28-48"/><path d="m27.5 48-28-48"/><path d="m22.8 48 25.7-44"/><path d="m39 48-28-48"/><path d="m34.5 48 14-24"/><path d="m49.2 45.5-26.5-45.5"/><path d="m48.5 24-14-24"/><path d="m48.5 4-2.2-4"/><path d="m46.3 48 2.2-4"/><path d="m15.7 48-16.2-27.8"/></g></svg></button><button class=grid value=tri2-grid title=><svg viewBox="0 0 48 48" xmlns=http://www.w3.org/2000/svg><g fill=none stroke=#000><path d="m44 47.8v-48"/><path d="m24 48.3v-48"/><path d="m34 48.3v-48"/><path d="m44 48.3v-48"/><path d="m4 48.3v-48"/><path d="m14 48.3v-48"/><path d="m48 48.8-48-28"/><path d="m27.8 48.8-27.8-16.2"/><path d="m8.4 48.8-8.4-4.9"/><path d="m48 44.5-7.5 4.3"/><path d="m48 37.1-48-28"/><path d="m48 20.8-48 28"/><path d="m48 25.5-44-25.7"/><path d="m48 9.3-48 28"/><path d="m48 13.9-24-14.1"/><path d="m45.5-.8-45.5 26.5"/><path d="m24-.2-24 14.1"/><path d="m4-.2-4 2.2"/><path d="m48 2-4-2.2"/><path d="m48 32.6-27.8 16.2"/></g></svg></button></x-select><button class="btn btn-small btn-blue" data-action=resetZoom data-key=pan></button></div></x-popup></div><div class=settings-group data-key=pan><button class=settings-btn data-action=zoomIn><x-icon name=zoom-in></x-icon><div class=tooltip></div></button><button class=settings-btn data-action=zoomOut><x-icon name=zoom-out></x-icon><div class=tooltip></div></button><button class=settings-btn data-action=pan><x-icon name=move></x-icon><div class=tooltip></div></button></div></x-polypad-settings>';var of='<x-polypad-toolbar hidden><div class=bar><div class=check><input type=checkbox></div><button class=tool data-key=move data-tool=move><x-icon size=32 name=cursor></x-icon><div class=tooltip> [V]</div></button><div class=check><input type=checkbox></div><button class=tool data-key=pen data-tool=pen><x-icon size=32 name=pen></x-icon><div class=tooltip> [P]</div></button><div class=check><input type=checkbox></div><button class=tool data-key=geo data-tool=geo><x-icon size=32 name=geo-line></x-icon><div class=tooltip> [G]</div></button><div class=check><input type=checkbox></div><button class=tool data-key=text data-tool=text:text><x-icon size=32 name=text></x-icon><div class=tooltip> [T]</div></button><div class=check><input type=checkbox></div><button class=tool data-key=equation data-tool=text:equation><x-icon size=32 name=equation></x-icon><div class=tooltip> [Q]</div></button><div class=check><input type=checkbox></div><button class=tool data-key=eraser data-tool=eraser><x-icon size=32 name=eraser></x-icon><div class=tooltip> [E]</div></button><div class=check><input type=checkbox></div><label class=tool for=image-upload data-key=image><x-icon name=add-image size=32></x-icon><div class=tooltip></div></label><input id=image-upload type=file multiple hidden><div class=check><input type=checkbox></div><x-popup class=color-picker data-key=color><button class="popup-target rainbow" title=></button><div class=popup-body aria-label=><x-color-picker></x-color-picker></div></x-popup></div><div class=buttons data-tool=geo><button data-tool=geo:line><x-icon name=geo-line size=22></x-icon></button><button data-tool=geo:circle><x-icon name=geo-circle size=22></x-icon></button><button data-tool=geo:rect><x-icon name=geo-rectangle size=22></x-icon></button><button data-tool=geo:angle><x-icon name=geo-angle size=22></x-icon></button></div><x-select class=brushes data-tool=pen><svg width=36 height=80 tabindex=0 data-tool=pen:pen aria-label=Pencil><path class=fill d=M36,48c-.5,0-3-5-3-5H3S.5,48,0,48H0V80H36V48Z></path><rect x=11 y=43 width=14 height=37 transform="translate(36 123) rotate(180)" opacity=0.3></rect><path d=M1.4,47.3l2.2-2.6a2,2,0,0,1,3-.2l2.8,3.9a2.6,2.6,0,0,0,3.3.2l3.6-3.2a2.7,2.7,0,0,1,3.4,0l3.6,3.2a2.6,2.6,0,0,0,3.3-.2l2.8-3.9a2,2,0,0,1,3,.2l2.2,2.6A1.7,1.7,0,0,0,36,48L25.4,19.6a20.3,20.3,0,0,1-14.8,0L0,48A1.7,1.7,0,0,0,1.4,47.3Z fill=#f7eecb></path><path class=fill d=M10.6,19.6a20.3,20.3,0,0,0,14.8,0L18,0Z></path></svg><svg width=36 height=80 tabindex=0 data-tool=pen:marker aria-label=Marker><path class=fill d=M27,21H9V15a11.4,11.4,0,0,1,2.6-7.2L18,0l6.4,7.8A11.4,11.4,0,0,1,27,15Z></path><rect y=37 width=36 height=43 fill=#ccc></rect><rect class=fill x=2 y=29 width=32 height=8></rect><rect x=5 y=21 width=26 height=8 fill=#3a3645></rect><rect x=26 y=37 width=10 height=43 opacity=0.15></rect><rect class=fill y=50 width=18 height=30></rect></svg><svg width=40 height=80 tabindex=0 data-tool=pen:highlighter aria-label=Highlighter><rect y=38 width=40 height=7 fill=#3a3645></rect><rect x=13 y=14 width=14 height=3 fill=#3a3645></rect><path d=M27,17H13C10.9,25.1,8.2,31.8,0,38H40C31,32.2,28.6,25.5,27,17Z fill=#615e6a></path><rect class=fill y=45 width=40 height=35></rect><rect x=7 y=52 width=26 height=28 opacity=0.2></rect><polygon class=fill points="13 0 13 14 27 14 27 7 13 0"></polygon></svg><svg width=36 height=80 tabindex=0 data-tool=pen:ruler aria-label="Straight Lines"><path d=M5,0H31a5,5,0,0,1,5,5V80a0,0,0,0,1,0,0H0a0,0,0,0,1,0,0V5A5,5,0,0,1,5,0Z fill=#ccc></path><path class=fill d=M5,0h5a0,0,0,0,1,0,0V80a0,0,0,0,1,0,0H0a0,0,0,0,1,0,0V5A5,5,0,0,1,5,0Z></path><path d=M36,10v2H24V10Zm-7,8v2h7V18Zm-5,8v2H36V26Zm5,8v2h7V34Zm-5,8v2H36V42Zm5,8v2h7V50Zm-5,8v2H36V58Zm5,8v2h7V66Zm-5,8v2H36V74Z></path></svg></x-select></x-polypad-toolbar>';var nf='@charset "UTF-8";@import url("https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600&display=swap");@font-face{font-family:Mathigon Symbol;font-style:normal;font-weight:400;src:url(../css/fonts/mathigon-symbol.woff2) format("woff2")}*{-webkit-tap-highlight-color:transparent;color:inherit;cursor:inherit}.hidden,[hidden]{display:none!important;visibility:hidden!important}.icon{fill:currentColor;display:inline-block}svg{display:block;overflow:hidden}circle,g,image,line,path,polyline,use{transform-box:fill-box;transform-origin:center}.row{display:flex;flex-wrap:wrap;justify-content:center}.row .grow{flex-grow:1}.row .shrink{flex-shrink:1}.m-red{color:#cd0e66}.m-blue{color:#0f82f2}.m-green{color:#22ab24}.m-yellow{color:#fd8c00}.m-orange{color:#eb4726}.m-purple{color:#6d3bbf}.m-teal{color:#009ea6}.m-lime{color:#bfc212}p{hanging-punctuation:first;margin:0 0 1em}.caption{color:#888;font-size:80%;margin:0 0 .6em;text-align:left}a{cursor:pointer}a,a:hover{text-decoration:none}a,button{touch-action:manipulation}button{box-sizing:content-box;-webkit-user-select:none;-moz-user-select:none;user-select:none}b,strong{font-weight:700}em,i{font-style:italic}button,input,select{background:transparent;border:none;display:inline-block;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;padding:0}input[type=text]{cursor:text}button,select{cursor:pointer}.input-field{-webkit-appearance:none;-moz-appearance:textfield;border:1px solid;border-radius:4px;color:inherit;cursor:text;display:block;line-height:1.7em;padding:0;transition:border .2s,background .2s,box-shadow .2s,color .2s}.input-field:focus{border-color:#0f82f2;box-shadow:0 0 0 3px rgba(15,130,242,.5);outline:none}.input-field::-webkit-inner-spin-button,.input-field::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}.btn{-webkit-touch-callout:none;-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:#181824;border:none;border-radius:24px;color:hsla(0,0%,100%,.95);cursor:pointer;display:inline-block;font-weight:600;height:2em;letter-spacing:.2px;line-height:2em;min-width:48px;outline:none;padding:0 1.2em;text-align:center;transition:transform .3s,background .2s,color .2s,box-shadow .2s,opacity .2s;width:auto}.btn.on,.btn:hover{background-color:#504b5c;box-shadow:0 4px 12px rgba(0,0,0,.25);color:#fff;z-index:10}html.is-tabbing .btn:focus{outline:2px solid #181824;outline-offset:2px}.btn x-icon{fill:currentColor;margin:0 6px -6px 0;opacity:.95;transition:opacity .2s}.btn:active x-icon,.btn:hover x-icon{opacity:1}.btn-small{height:1.6em;line-height:1.6em;padding:0 .8em}.btn-blue{background-color:#0f82f2}.btn-blue:focus,.btn-blue:hover{background-color:#3696f4}.tooltip{-webkit-backdrop-filter:blur(4px);backdrop-filter:blur(4px);background:#181824;border:1px solid #fff;border-radius:16px;color:#fff;font-size:14px;left:50%;line-height:18px;opacity:0;padding:2px 12px;pointer-events:none;position:absolute;top:-22px;transform:translateX(-50%);transition:opacity .1s;white-space:nowrap;z-index:9999}.is-tabbing.not-mobile :focus>.tooltip,.not-mobile :hover>.tooltip{opacity:.8}.snackbar{left:50%;position:fixed;top:52px;transform:translateX(-50%);z-index:500}x-alert{background:#000;border-radius:6px;box-shadow:0 3px 8px rgba(0,0,0,.3);color:#fff;display:none;font-size:16px;line-height:1.4;max-width:300px;padding:8px 20px;width:-moz-max-content;width:max-content}x-alert x-icon{float:left;margin:-2px 6px 20px -4px}x-alert.error{background:#b50c5a}x-alert.warn{background:#e47e00}x-alert.success{background:#1e9620}x-icon{fill:currentColor;display:inline-block;height:24px;width:24px}x-icon svg{display:block}x-icon[name=warning]{fill:#cd0e66}.button x-icon{margin:-10px 3px -10px -8px}.modal-background{-webkit-backdrop-filter:blur(4px);background:rgba(0,0,0,.8);bottom:0;display:none;left:0;position:fixed;right:0;top:44px;transition:background .4s;z-index:400}.modal-background.light{background:hsla(0,0%,100%,.9)}html.webview .modal-background{top:0}x-modal{background:#fff;border-radius:12px;box-shadow:0 6px 32px rgba(0,0,0,.8);box-sizing:border-box;display:none;left:50%;margin-top:22px;max-height:calc(100vh - 84px);max-width:calc(100% - 40px);position:fixed;top:50%;transform:translate(-50%,-50%);width:520px;z-index:401}html[theme=dark] x-modal{background:#2d2c38}x-modal.light{box-shadow:0 4px 20px rgba(0,0,0,.25)}html.webview x-modal{margin-top:0;max-height:calc(100% - 40px)}x-modal .modal-body{-webkit-overflow-scrolling:touch;box-sizing:border-box;height:100%;max-height:calc(100vh - 84px);overflow:auto;overscroll-behavior:contain;padding:24px}@media screen and (max-height:720px){x-modal.interactive{top:42px;transform:translate(-50%)}}.is-safari:not(.is-webview) x-modal,.is-safari:not(.is-webview) x-modal .modal-body{max-height:calc(100vh - 200px)}x-modal h2{margin-top:0}x-modal h2 x-icon{margin:-6px 4px -6px -2px}x-modal h3{margin:1.5em 0 .8em}x-modal h3 x-icon{margin:0 5px -5px 0}x-modal .btn-row{margin:0;text-align:right}x-modal .form-large{margin:0 -8px -10px}x-modal p:last-child:not(.btn-row),x-modal ul:last-child{margin-bottom:0}x-modal .form-checkbox{margin:16px 0}x-modal hr{margin:1.5em 0}x-modal .close{fill:rgba(0,0,0,.4);cursor:pointer;display:block;padding:8px;position:absolute;right:0;top:0;transition:transform .2s,color .2s;z-index:10}html[theme=dark] x-modal .close{fill:hsla(0,0%,100%,.4)}x-modal .close:hover{color:#000;transform:scale(1.4)}html[theme=dark] x-modal .close:hover{color:#fff}x-modal.video{background:#000;border-radius:0;width:1200px}x-modal.video .video-wrap{height:0;padding-bottom:56.25%;position:relative}x-modal.video iframe,x-modal.video video{height:100%;position:absolute;width:100%}x-modal.video .close x-icon{fill:hsla(0,0%,100%,.8);top:-40px}.tile{transform-box:view-box;transform-origin:0 0}.tile .handle:not(.persistent),.tile .outline{display:none}.tile.active .handle,.tile.active .link-handle,.tile.active .outline{display:block!important}.tile .handle{cursor:ew-resize}.tile.no-handles.active .handle{display:none!important}x-polypad:not(.setup-mode) .hidden-tile{display:none}x-polypad:not(.setup-mode) .locked-tile{pointer-events:none}.geo-path.hidden-tile,.geo-point.hidden-tile,.hidden-tile>:not(.outline,.handle){opacity:.4}.link-handle{fill:#0f82f2;stroke:transparent;stroke-width:10}.link-dot{stroke:var(--canvas-bg);fill:#0f82f2;stroke-width:3}.link-bar{stroke:#0f82f2;stroke-width:5px;fill:none;cursor:move}.link-bar path.dashed{stroke-dasharray:6px 10px;stroke-dashoffset:8px}.group-outline,.rotate-bar,.tile .handle,.tile .outline{stroke-width:6px}.group-outline,.rotate-bar,.tile .outline{stroke:var(--canvas-fg);fill:none}.hidden-tile .outline,.locked-tile .outline{stroke-dasharray:10px 16px}.rotate-circle,.tile .handle{fill:var(--canvas-fg)}.tile path.handle{stroke:var(--canvas-fg)}.group-outline,.rotate-bar{pointer-events:none}.group-shadow{fill:var(--canvas-fg);opacity:15%}.rotate-circle,.tile circle.handle{stroke:transparent;stroke-width:8px}.rotate-circle{cursor:grab}.balance,.number-grid-cell circle,.number-tile,.polygon-tile{stroke:var(--canvas-bg);stroke-width:1px}.high-contrast .balance,.high-contrast .number-grid-cell circle,.high-contrast .number-tile,.high-contrast .polygon-tile{stroke:var(--canvas-fg);stroke-width:2px}.number-label line{stroke:#fff;stroke-width:2}.source .number-label line{stroke-width:1}.prime-move,.prime-segment:hover{stroke:var(--canvas-fg);stroke-width:3px}.prime-label{stroke:var(--canvas-bg);stroke-width:4px;stroke-linejoin:round;paint-order:stroke}html.is-safari .prime-label{stroke:none}.grid-axis,.number-line-ticks{stroke-width:3px}.active .grid-axis,.active .number-line-ticks{stroke-width:6px}.axis-gridlines{stroke-width:2px;opacity:.15;pointer-events:none}.penrose-circles{fill:none;stroke-width:2px;stroke:#fff;opacity:.4}.dice-face{stroke-width:4px}.dice-dot{fill:#fff;opacity:.85}.balance-beam{fill:none;stroke-width:8px}.active .balance,.active .balance-beam,.active .bucket{stroke:var(--canvas-fg);stroke-width:6px}.balance-target{fill:none;stroke:var(--canvas-fg);stroke-width:4px;stroke-dasharray:8px 12px;stroke-dashoffset:4px;display:none;pointer-events:none}.spinner{fill:var(--canvas-fg);stroke:var(--canvas-bg)}.spinner,x-pp-tiles .spinner{stroke-width:1px}.utensil .glass{fill:hsla(258,9%,78%,.7)}.utensil .ticks{stroke-width:.6;stroke:var(--canvas-fg);stroke-linecap:butt;pointer-events:none}.utensil .compass-frame,.utensil .compass-legs{fill:#c5c2cc}.utensil .compass-needle,.utensil .compass-top{fill:#656073}.utensil .compass-screw{fill:#c5c2cc}.utensil .compass-pencil{stroke:#656073}.utensil text{fill:var(--canvas-fg);font-size:12px}.polypad.dark .utensil .glass{fill:rgba(101,96,115,.7)}.polypad.dark .utensil .compass-legs{fill:#656073}.polypad.dark .utensil .compass-needle{fill:#c5c2cc}.dot-cell{fill:none;stroke-width:20px;fill-opacity:.3}.dot-label{fill:var(--canvas-bg);font-weight:600}.axis-labels text{stroke:var(--canvas-bg);stroke-width:4px;stroke-linejoin:round;font-size:16px;font-weight:700;paint-order:stroke}html.is-safari .axis-labels text{stroke:none}.bead-gradient{stroke:var(--canvas-bg);fill:url(#sphere-gradient);pointer-events:none}.active .bead-gradient{stroke:var(--canvas-fg);stroke-width:6px}.clock-ticks{stroke-width:1.5px}.clock-label{fill:var(--canvas-fg);font-size:14px}.clock-face{fill:var(--canvas-bg);opacity:.95}.clock-handle{fill:var(--canvas-fg);stroke:transparent;stroke-width:16px;cursor:move;transform-origin:bottom center}.no-labels text{display:none}.bucket-label,.number-line-label,.polygon-label,.prime-label{font-size:18px;font-weight:600}.bucket-label,.polygon-label{fill:#fff}.number-line-label{transform-box:fill-box;transform-origin:center}.bucket-label{font-size:38px;font-weight:400}.fraction .equation text,.number-line .equation text{font-weight:600}.fraction .equation line{stroke-width:2px}.fraction .equation{transform-box:view-box;transform-origin:top left}.number-grid-cell.active circle{stroke:var(--canvas-fg);stroke-width:6px}.number-grid-cell text{font-size:24px}.card-label path,.card-label rect{fill:var(--canvas-fg)}.card-label text{stroke:none;fill:var(--canvas-bg);font-size:14px;font-weight:600}x-pp-tiles .polygon-label{font-size:16px}x-pp-tiles .number-line-label{font-size:15px}.hidden-input{display:none;height:0;overflow:hidden;position:absolute;transform:scale(0);width:0}.problem-box{stroke:#0f82f2;stroke-width:4px;fill:rgba(15,130,242,.25);transition:stroke .3s,fill .3s}.correct .problem-box{stroke:#22ab24;fill:rgba(34,171,36,.25)}.incorrect .problem-box{stroke:#cd0e66;fill:rgba(205,14,102,.25)}.active .problem-box{stroke-width:6px}.problem-text{fill:var(--canvas-fg);color:var(--canvas-fg);cursor:text;font-size:32px;text-align:center}.problem-marker{transform:scale(0);transition:transform .2s cubic-bezier(.33,1.9,.52,.7)}.problem-marker.show{transform:none}@keyframes cursor{0%,to{opacity:1}50%{opacity:0}}.equation{transform-origin:0 0}.equation line,.equation path{fill:none;stroke:currentColor;stroke-width:1.45;transform-box:view-box;transform-origin:top left}.equation text{dominant-baseline:text-before-edge;stroke:currentColor;fill:currentColor;stroke-width:0;font-family:Mathigon Symbol,Source Sans Pro,sans-serif}.equation text.font-normal{font-family:Source Sans Pro,Helvetica,sans-serif}.equation .placeholder{fill:currentColor;opacity:.3}.equation .cursor{stroke:#0f82f2;stroke-width:1.5px;animation:cursor 1s step-end infinite}.equation .range{fill:#87c1f9}.geo-path{fill:none;stroke:currentColor;stroke-width:3px}.geo-path.fill{fill:currentColor;stroke:none;opacity:.5}.geo-path.fill.hover{opacity:.8}.geo-point{fill:currentColor}.geo-point.intersection{stroke:currentColor;stroke-width:3px;fill:var(--canvas-bg)}svg:not(:hover) .geo-point.pending{display:none!important}.geo-shadow{stroke-width:10px;stroke:currentColor;fill:none;display:none}.geo-label{stroke:var(--canvas-bg);stroke-width:4px;stroke-linejoin:round;paint-order:stroke}html.is-safari .geo-label{stroke:none}.table-tile{background:var(--canvas-bg);border-left:1px solid var(--border);border-top:1px solid var(--border);display:grid;width:-moz-fit-content;width:fit-content}.table-tile.active{cursor:text}.table-selection{stroke:var(--canvas-fg);fill:var(--canvas-fg);fill-opacity:10%;stroke-width:5px;pointer-events:none}.table-cell{-webkit-user-modify:read-write-plaintext-only;border-bottom:1px solid var(--border);border-right:1px solid var(--border);box-sizing:border-box;color:var(--canvas-fg);font-size:20px;height:50px;line-height:45px;max-width:200px;min-width:100px;padding:2px 8px;text-align:center;-webkit-user-select:text;-moz-user-select:text;user-select:text;white-space:pre}.table-cell.header{background:var(--header);font-weight:700}.table-cell:focus{outline:none}.table-cell:focus:empty{content:"";display:inline}.table-cell .table-color{border-radius:15px;display:inline-block;height:30px;margin-bottom:-8px;width:30px}.table-hidden{left:0;opacity:0;pointer-events:none;position:fixed;top:0}.chart-line{fill:none;stroke-width:3}.chart-outline{fill:none;stroke-width:6px;stroke:var(--canvas-fg)}.chart-shadow{stroke-width:10px;fill:none;opacity:.4}.donut-hole{fill:var(--canvas-bg)}.chart-focussed{cursor:pointer}@keyframes speaker-move{0%{transform:none}50%{transform:translateX(3px)}to{transform:none}}@keyframes metronome{0%{transform:rotate(-30deg)}50%{transform:rotate(30deg)}to{transform:rotate(-30deg)}}.effects-speaker-move{animation:speaker-move .1s}.polypad svg.overlay,x-polypad{stroke-linecap:round;stroke-linejoin:round;text-anchor:middle}x-polypad{text-anchor:middle;background:var(--canvas-bg);display:block;overflow:hidden;position:relative;touch-action:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}x-polypad .canvas{height:100%;outline:none;width:100%}x-polypad .html-overlay,x-polypad .html-overlay>*{left:0;position:absolute;top:0}x-polypad .selection{stroke:#87c1f9;fill:rgba(135,193,249,.5);display:none}x-polypad .stroke{stroke-width:3px;fill:none}x-polypad .stroke.marker{stroke-width:8px}x-polypad .stroke.highlighter{stroke-width:24px;mix-blend-mode:multiply;opacity:.4}x-polypad .stroke.cut{stroke:var(--canvas-fg);stroke-dasharray:10px}.dark x-polypad .stroke.highlighter{mix-blend-mode:screen}x-polypad[data-tool=text]{cursor:text}x-polypad[data-tool=pan]{cursor:move}x-polypad[data-tool=cutPolygon],x-polypad[data-tool=geoPending],x-polypad[data-tool=geo]{cursor:crosshair}x-polypad[data-tool=pen]{cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAZUlEQVR4AWJwL/AB8DEGJgDCQAz8EX7EbOZIHeFHiV4hKKAWrjzJkY1tXSzfj1vpIx0zY0muKnf3vsnocJBEQIn0gCyyEFeW3qDDQczaJzz+X4mRiOeIsppoz6AHD0wDRvAQHeAAguXO6bw3SrQAAAAASUVORK5CYII=) 5 5,auto;cursor:-webkit-image-set(url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAZUlEQVR4AWJwL/AB8DEGJgDCQAz8EX7EbOZIHeFHiV4hKKAWrjzJkY1tXSzfj1vpIx0zY0muKnf3vsnocJBEQIn0gCyyEFeW3qDDQczaJzz+X4mRiOeIsppoz6AHD0wDRvAQHeAAguXO6bw3SrQAAAAASUVORK5CYII=) 1x,url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAMAAAC6V+0/AAAAJ1BMVEVHcEz///////////////////////8AAAD///9wcHAwMDDf399gYGCQhTdXAAAAB3RSTlMA759wYBCvzmM0WgAAAGdJREFUeNptkVsKwCAMBJP6yKi9/3kLxQYsO5/DisnGXlrtDt5rs6Q4Gy+fu2CNGTHHgivdiM3YtsAdyQ3FrPnOZdabVVYcLKr1DGa0mzNPOXGD+AFSyufyIzmSHF6tqQrR1emS5TkegZUJJUoarYQAAAAASUVORK5CYII=) 2x) 5 5,auto}x-polypad[data-tool=eraser]{cursor:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUBAMAAAB/pwA+AAAAMFBMVEVHcEwAAAAAAAAAAAAAAAAAAAAAAAD////v7+8gICC/v79AQEDT09MAAACfn58wMDBKyk2zAAAAB3RSTlMA759wEGCvta0l/AAAAGRJREFUCNdjYGBgCZO9mOrAAAKG+47XvBYGsZhmlQPBSgUgU78dxKz4xMDAPKMcDDoNGByXQ5hVIgzR5VCwlSEPxnzGIANjHmS4DmPWIjORFCBpQzIMyQoki5Gcg+xIJKfDPQQAeUtQWzzU2P8AAAAASUVORK5CYII=) 10 10,auto;cursor:-webkit-image-set(url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUBAMAAAB/pwA+AAAAMFBMVEVHcEwAAAAAAAAAAAAAAAAAAAAAAAD////v7+8gICC/v79AQEDT09MAAACfn58wMDBKyk2zAAAAB3RSTlMA759wEGCvta0l/AAAAGRJREFUCNdjYGBgCZO9mOrAAAKG+47XvBYGsZhmlQPBSgUgU78dxKz4xMDAPKMcDDoNGByXQ5hVIgzR5VCwlSEPxnzGIANjHmS4DmPWIjORFCBpQzIMyQoki5Gcg+xIJKfDPQQAeUtQWzzU2P8AAAAASUVORK5CYII=) 1x,url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAMAAAC7IEhfAAAAMFBMVEVHcEwAAAAAAAAAAAAAAAABAQEAAAAAAAAAAAAgICBYWFiXl5e/v7////9AQEDPz8/yxGM3AAAACXRSTlMAQHi/z/8Zn+8OOe6YAAAAzklEQVR42sWV0a6EIBBDETmIMKP//7d34zUb3cjStz3PTQs4U8OdKc6JF2mOU+iSl8KFsuSODFhrM39hra7AkzQWqOYXrEKJD3bb7h/s26dpTtD8gQYp33Xmj9hNucDuHXZY3vc4/bqe8QwuNP9Co+QzePOvbP/h+XLA7jHzYVh9QD0sC+YDjBLCxOpDVqYQj+RhdgwzzYc05pAwH2KkAC4APxTKl5GfR35w+ROqQyGPmTy46irIy6Wuq1oAcqXIJaXXnl6kejXrZS//Pv4AjK46OUdio5kAAAAASUVORK5CYII=) 2x) 10 10,auto}x-polypad .geo-paths,x-polypad .geo-points,x-polypad .geo-shadows,x-polypad .grid,x-polypad .selection,x-polypad .strokes,x-polypad:not([data-tool=move]) .tiles{pointer-events:none}x-polypad .grid{opacity:var(--grid-opacity,.25)}x-polypad.high-contrast .grid{opacity:1}x-polypad .geo-shadows{opacity:.3}x-polypad .grid-pattern line,x-polypad .grid-pattern rect{stroke:var(--canvas-fg);fill:none}x-polypad .grid-pattern .filled,x-polypad .grid-pattern circle{fill:var(--canvas-fg);stroke:none}x-polypad .text-edit{-webkit-user-modify:read-write-plaintext-only;word-wrap:normal;font-size:20px;line-height:1.4em;padding:2px 8px;-webkit-user-select:text;-moz-user-select:text;user-select:text;width:-moz-fit-content;width:fit-content}x-polypad .text-edit[contenteditable]{cursor:text}x-polypad .image-drop{background:rgba(15,130,242,.1);border:6px dashed #0f82f2;box-sizing:border-box;display:none;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}x-polypad .panels{position:absolute;right:8px;top:8px}x-polypad .tile-error{background:#fec680;border-radius:6px;bottom:calc(100% + 10px);box-shadow:0 2px 6px rgba(0,0,0,.1);color:#000;font-size:16px;left:-12px;line-height:1.4;padding:5px 10px;position:relative;position:absolute;text-align:left;top:auto;transform-origin:24px bottom -6px;width:260px}x-polypad .tile-error:after{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid #fec680;content:"";display:block;left:50%;left:24px;margin-left:-8px;position:absolute;top:100%}x-polypad .tile-error button{color:#0f82f2;cursor:pointer}x-polypad .tile-error button:focus,x-polypad .tile-error button:hover{text-decoration:underline}x-polypad.handdrawn .canvas{filter:url(#handdrawn)}x-polypad.handdrawn .geo-paths,x-polypad.handdrawn .strokes{filter:url(#pencil)}x-polypad .bg-icon{bottom:-60px;opacity:.1;pointer-events:none;position:absolute;right:-60px}x-polypad .exit-mode{box-shadow:0 3px 6px rgba(0,0,0,.15);left:50%;position:absolute;top:8px;transform:translateX(calc(130px - 50%))}x-polypad .rotate-label{background-color:#181824;border:1px solid;border-color:var(--canvas-bg);border-radius:6px;color:#fff;font-size:14px;font-weight:600;padding:0 7px 1px;pointer-events:none;position:absolute;top:0}.input-field{background:hsla(0,0%,100%,.1);border:1px solid hsla(0,0%,100%,.16);border-radius:5px;line-height:24px;text-align:center}.input-field:focus,.input-field:hover{background-color:hsla(0,0%,100%,.18)}select.input-field{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-image:url("data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22rgba(255%2C%20255%2C%20255%2C%200.5)%22%20d%3D%22m19.9%207.5a1.4%201.4%200%200%200%20-2.1%200l-5.8%205.8-5.8-5.8a1.4%201.4%200%200%200%20-2.1%200%201.5%201.5%200%200%200%200%202.1l6.8%206.9a1.6%201.6%200%200%200%202.2%200l6.8-6.9a1.4%201.4%200%200%200%200-2.1z%22%2F%3E%3C%2Fsvg%3E");background-position:top 6px right 5px;background-repeat:no-repeat;background-size:16px 16px;cursor:pointer;padding:0 24px 0 8px;text-align:left;width:auto}select.input-field option{color:initial}input.toggle[type=checkbox]{-webkit-appearance:none;-moz-appearance:none;appearance:none;height:0;position:absolute;width:0}input.toggle+.control{background:hsla(0,0%,100%,.3);border-radius:12px;content:"";cursor:pointer;display:block;height:10px;padding:1px 0;transition:background .2s;width:32px}input.toggle+.control:after{background-color:#9d9ba2;border-radius:12px;content:"";display:block;height:18px;margin:-4px -1px;transition:transform .2s;width:18px}input.toggle:checked+.control{background:#0f82f2}input.toggle:checked+.control:after{background:#ebebec;transform:translateX(16px)}input.toggle:indeterminate+.control:after{background:#c4c3c7;transform:translateX(8px)}.is-tabbing input.toggle:focus+.control{outline:auto}x-pp-sidebar{--canvas-bg:#fff;--canvas-fg:#181824;border-radius:6px;box-shadow:0 3px 8px rgba(0,0,0,.3);color:hsla(0,0%,100%,.8);height:40px;left:8px;position:absolute;top:8px;transition:height .4s ease-out,width .4s ease-out;z-index:6}x-pp-sidebar.animating{overflow:hidden}x-pp-sidebar.open{height:calc(100% - 16px)}x-pp-sidebar .tabs-header{display:flex;margin-bottom:1px}x-pp-sidebar .tabs-header button{background:#3a3645;border-right:1px solid #3a3645;color:hsla(0,0%,100%,.6);cursor:pointer;display:block;flex-grow:1;height:40px;overflow:hidden;position:relative;transition:color .2s,background .2s,border .2s,flex-grow .4s}x-pp-sidebar .tabs-header button:first-child{border-top-left-radius:6px}x-pp-sidebar .tabs-header button:last-child{border-right:0;border-top-right-radius:6px}x-pp-sidebar .tabs-header button x-icon{display:block;margin:0 12px}x-pp-sidebar .tabs-header button span{left:42px;opacity:0;position:absolute;top:8px;transition:opacity .2s;white-space:nowrap}x-pp-sidebar .tabs-header button .close{margin:0;opacity:0;position:absolute;right:8px;top:8px;transition:opacity .2s}x-pp-sidebar .tabs-header button.active,x-pp-sidebar .tabs-header button:focus,x-pp-sidebar .tabs-header button:hover{background:#181824;color:#fff}x-pp-sidebar .tabs-header button.active span{opacity:1}x-pp-sidebar .tabs-header button.active:hover .close{opacity:.5;transition-delay:.6s}x-pp-sidebar.open .tabs-header button{background:#504e59;border-color:#65636e;flex-grow:0}x-pp-sidebar.open .tabs-header button:focus,x-pp-sidebar.open .tabs-header button:hover{background:#3e3d49}x-pp-sidebar.open .tabs-header button.active{background:#292735;flex-grow:1000}x-pp-sidebar .tabs-body{background:#292735;border-radius:0 0 6px 6px;border-top:1px solid #65636e;bottom:0;position:absolute;top:40px;width:100%}x-pp-sidebar .tabs-panel{-webkit-overflow-scrolling:touch;display:none;height:100%;left:0;overflow:auto;overscroll-behavior:contain;position:absolute;top:0;transition:transform .4s ease-out;width:100%}x-pp-sidebar .tabs-panel.left{transform:translateX(-100%)}x-pp-sidebar .tabs-panel.right{transform:translateX(100%)}x-pp-sidebar h2,x-pp-sidebar h3{border-top:1px solid #65636e;font-weight:600;margin:0;padding:2px 16px}x-pp-sidebar h2{font-size:18px;line-height:36px}x-pp-sidebar h2:first-child{border:none;margin-top:6px}x-pp-sidebar h3{font-size:16px;letter-spacing:.01em;line-height:30px;padding-left:9px}x-pp-sidebar h2 x-icon{fill:#fff;background:currentColor;border-radius:100%;margin:0 8px -6px -6px;padding:3px}x-pp-sidebar .warn{margin:20px 16px;text-align:center}x-pp-sidebar .warn>x-icon{display:block;margin:0 auto 6px}x-pp-sidebar .warn p{line-height:1.4;margin:0}x-pp-sidebar .warn .s-btn-row{margin-top:12px}x-pp-sidebar .section-block{margin:0 16px 16px 42px}x-pp-sidebar .form-row input,x-pp-sidebar .form-row select,x-pp-sidebar .s-btn{height:28px;line-height:28px;transition:background .2s,color .2s}x-pp-sidebar .title-options{display:flex;margin-top:-36px;position:absolute;right:10px}x-pp-sidebar .title-options a,x-pp-sidebar .title-options button,x-pp-sidebar .title-options x-icon{display:block}x-pp-sidebar .title-options a,x-pp-sidebar .title-options button{border-radius:4px;color:hsla(0,0%,100%,.7);cursor:pointer;margin:0 2px;padding:4px;transition:color .2s,background .2s}x-pp-sidebar .title-options a:focus,x-pp-sidebar .title-options a:hover,x-pp-sidebar .title-options button:focus,x-pp-sidebar .title-options button:hover{background:hsla(0,0%,100%,.25);color:#fff}x-pp-sidebar .input-field{box-sizing:border-box;height:30px;line-height:28px}x-pp-sidebar .s-btn{background:hsla(0,0%,100%,.25);font-size:15px;font-weight:600;padding:0 10px;transition:background .2s,color .2s}x-pp-sidebar .s-btn x-icon{margin:0 2px -4px -1px}x-pp-sidebar .s-btn:first-child{border-radius:20px 0 0 20px;padding-left:12px}x-pp-sidebar .s-btn:last-child{border-bottom-right-radius:20px;border-top-right-radius:20px;padding-right:12px}x-pp-sidebar .s-btn:focus,x-pp-sidebar .s-btn:hover{background:hsla(0,0%,100%,.4);color:#fff}x-pp-sidebar .s-btn.delete:focus,x-pp-sidebar .s-btn.delete:hover{background:rgba(205,14,102,.8)}x-pp-sidebar .s-btn.save{background:rgba(34,171,36,.8)}x-pp-sidebar .s-btn.save:focus,x-pp-sidebar .s-btn.save:hover{background:#22ab24}x-pp-sidebar .s-btn.blue{background:rgba(15,130,242,.8)}x-pp-sidebar .s-btn.blue:focus,x-pp-sidebar .s-btn.blue:hover{background:#0f82f2}x-pp-sidebar .s-btn-row .s-btn{margin-right:1px}x-pp-sidebar .s-btn-row .s-btn:last-child{margin:0}x-pp-sidebar .s-btn-row.loading{background:url(/images/loading-white.gif) 50% no-repeat;background-size:20px 20px}x-pp-sidebar .s-btn-row.loading .s-btn{visibility:hidden}x-pp-sidebar .form-row{align-items:center;display:flex;font-size:15px;margin-bottom:1px;padding:2px 0}x-pp-sidebar .form-row>x-icon{margin-right:6px}x-pp-sidebar .form-row span{display:block;flex-grow:1;font-weight:600}x-pp-sidebar .form-row .input-field{width:140px}x-pp-sidebar .form-row .input-field::-moz-placeholder{color:hsla(0,0%,100%,.5)}x-pp-sidebar .form-row .input-field::placeholder{color:hsla(0,0%,100%,.5)}x-pp-sidebar .form-row .input-pair{border-radius:4px 0 0 4px;width:70px}x-pp-sidebar .form-row .input-pair+.input-pair{border-left:none;border-radius:0 4px 4px 0}x-pp-sidebar .form-row .s-btn x-icon{margin:0 -3px -4px}x-pp-tiles h3 .new{background:hsla(0,0%,100%,.4);border-radius:3px;color:#292735;display:inline-block;font-size:11px;line-height:1;margin-left:6px;padding:1px 3px;vertical-align:2px}x-pp-tiles x-accordion{display:block}x-pp-tiles x-accordion .subsection{margin-left:32px;position:relative}x-pp-tiles x-accordion .check{margin:-26px 0 0 42px;position:absolute}x-pp-tiles x-accordion x-accordion .check{margin:-23px 0 0 9px}x-pp-tiles h2,x-pp-tiles h3{cursor:pointer;overflow:hidden;text-overflow:ellipsis;transition:background .2s,border .2s;white-space:nowrap}x-pp-tiles h2:focus,x-pp-tiles h2:hover,x-pp-tiles h3:focus,x-pp-tiles h3:hover{background:hsla(0,0%,100%,.15)}x-pp-tiles h2:focus+.subsection h3:first-child,x-pp-tiles h2:hover+.subsection h3:first-child,x-pp-tiles h3:focus+.subsection h3:first-child,x-pp-tiles h3:hover+.subsection h3:first-child{border-color:transparent}x-pp-tiles.customising h2 x-icon{margin-right:28px}x-pp-tiles.customising h3{padding-left:29px}x-pp-tiles.single .tutorial,x-pp-tiles.single h2,x-pp-tiles.single h3{display:none!important}x-pp-tiles.single .subsection{margin:16px}x-pp-tiles p{color:hsla(0,0%,100%,.85);font-size:16px;line-height:28px;margin:6px 16px}x-pp-tiles .input-row input{border-radius:0;margin-top:-1px}x-pp-tiles .input-row input:focus{z-index:1}x-pp-tiles .input-row input:first-child{border-radius:3px 3px 0 0;margin:0}x-pp-tiles .input-row input:last-child{border-radius:0 0 3px 3px}x-pp-tiles .source-wrap x-select{display:flex;justify-content:center;margin-bottom:8px;width:100%}x-pp-tiles .source-wrap x-select button{border-radius:4px;color:hsla(0,0%,100%,.3);font-size:20px;font-weight:700;height:24px;line-height:24px;margin:0 2px;padding:4px 0;text-align:center;transition:color .2s,background .2s;width:32px}x-pp-tiles .source-wrap x-select button.small{font-size:18px;letter-spacing:-.5px}x-pp-tiles .source-wrap x-select button:hover{background:hsla(0,0%,100%,.1);color:hsla(0,0%,100%,.5)}x-pp-tiles .source-wrap x-select button.active{background:hsla(0,0%,100%,.2);color:#fff}x-pp-tiles .source-wrap x-select x-icon{display:block;margin:0 4px}x-pp-tiles x-drag .handle{font-style:italic;font-weight:600;line-height:18px}x-pp-tiles .tutorial{border-radius:20px;color:hsla(0,0%,100%,.6);margin:-36px 0 0;padding:6px;position:absolute;right:8px;transition:background .2s,color .2s}x-pp-tiles .tutorial:focus,x-pp-tiles .tutorial:hover{background:hsla(0,0%,100%,.15);color:#fff}x-pp-tiles .tutorial x-icon{display:block;margin:0!important}x-pp-tiles .tutorial .tooltip{border:none;left:auto;right:36px;top:5px;transform:none}x-pp-tiles h3+.tutorial{margin-top:-32px}x-pp-tiles .subtitle .tutorial{margin-top:-7px}x-pp-tiles footer{border-top:1px solid #65636e;color:hsla(0,0%,100%,.6);font-size:14px;padding:12px 16px 16px;text-align:center}x-pp-tiles footer a,x-pp-tiles footer button{transition:color .2s}x-pp-tiles footer a:focus,x-pp-tiles footer a:hover,x-pp-tiles footer button:focus,x-pp-tiles footer button:hover{color:#fff}x-pp-sidebar svg{stroke-linecap:round;stroke-linejoin:round;text-anchor:middle}x-pp-sidebar text{pointer-events:none}x-pp-sidebar .source-wrap{display:flex;flex-wrap:wrap;justify-content:space-evenly;margin:0 auto;padding-right:6px}x-pp-sidebar .source-wrap:first-child{margin-top:4px}x-pp-sidebar .source-wrap:last-child{margin-bottom:12px}x-pp-sidebar .source-wrap>.source,x-pp-sidebar .source-wrap>svg{margin:3px 0}x-pp-sidebar .source-wrap>.source.tight{margin:0}x-pp-sidebar .source-wrap .source{cursor:grab;touch-action:none}x-pp-sidebar .source-wrap+.source-wrap{border-top:1px solid #65636e;margin-top:10px;padding-top:6px}x-pp-sidebar .caption,x-pp-sidebar .source:after,x-pp-sidebar .subtitle{color:hsla(0,0%,100%,.5);display:block;font-size:14px;line-height:1.2;text-align:center;width:100%}x-pp-sidebar .source:after{content:attr(data-caption);font-size:12px}x-pp-sidebar .caption{box-sizing:border-box;margin:0;padding:0 16px}x-pp-sidebar .subtitle{border-top:1px solid #65636e;color:hsla(0,0%,100%,.7);font-size:15px;font-weight:600;margin:16px 0 4px;padding-top:12px}x-pp-sidebar .subtitle:first-child{border:0;margin-top:6px;padding:0}x-pp-sidebar .polypad-library .caption{margin-bottom:16px}x-pp-sidebar .primes{align-items:center;display:flex;flex-grow:1;justify-content:center;margin:8px 20px 6px}x-pp-sidebar .primes input{margin-right:12px;width:64px}x-pp-customise .advanced .form-row span{font-weight:400}x-pp-customise .form-row.control{margin-top:6px}x-pp-customise .s-btn-row{margin-top:10px}x-pp-customise button[disabled]{opacity:.4;pointer-events:none}x-pp-customise .custom{color:#0f82f2;margin-left:4px}x-pp-customise .custom:focus,x-pp-customise .custom:hover{text-decoration:underline}x-pp-customise .form-row .input-field{width:120px}x-pp-customise .form-row .input-pair{width:60px}x-pp-customise h4{border-top:1px solid hsla(0,0%,100%,.2);color:hsla(0,0%,100%,.4);font-size:12px;margin:8px 0 0;padding-top:6px;text-transform:uppercase}x-pp-customise p.small{color:hsla(0,0%,100%,.5);font-size:13px;line-height:1.4;margin:5px 0 0}x-pp-customise p.bg-warn{margin:2px 0 8px}x-pp-customise .form-row.color{position:relative}x-pp-customise .form-row.color input{height:26px;opacity:0;position:absolute;right:0;top:2px;width:64px;z-index:-1}x-pp-customise .form-row.color .swatch{border:1px solid hsla(0,0%,60%,.5);border-radius:4px;flex-grow:0;height:26px;width:64px}x-pp-customise .form-row.color input:focus+.swatch{border-color:#0f82f2;box-shadow:0 0 0 3px rgba(15,130,242,.5);outline:none}x-polypad-actionbar{background:#3a3645;box-shadow:0 3px 8px rgba(0,0,0,.3);color:hsla(0,0%,100%,.85);display:none;height:32px;padding:4px 8px 4px 6px;position:absolute;width:-moz-fit-content;width:fit-content}x-polypad-actionbar.pinned{border-radius:20px;bottom:calc(64px + env(safe-area-inset-bottom));left:50%;padding:4px 8px;transform:translateX(-50%);transition:transform .4s}@media screen and (min-width:700px){x-polypad-actionbar.pinned.shifted{transform:translateX(calc(154px - 50%))}}x-polypad-actionbar.pinned.customising{margin-bottom:30px}@media screen and (max-width:600px){x-polypad-actionbar .action.pin{display:none}}x-polypad-actionbar.floating{border-radius:6px 20px 20px 6px;left:0;top:0;will-change:transform}x-polypad-actionbar x-popup{display:block;position:relative}x-polypad-actionbar .popup-body{background:#3a3645;border-radius:6px;box-shadow:0 3px 8px rgba(0,0,0,.3);padding:6px;position:relative;position:absolute;right:-4px}x-polypad-actionbar .popup-body:after{border-bottom:6px solid #3a3645;border-left:6px solid transparent;border-right:6px solid transparent;bottom:100%;content:"";display:block;left:50%;left:auto;margin-left:-6px;position:absolute;right:16px;top:-6px}x-polypad-actionbar.floating .popup-body{top:46px;transform-origin:right top}x-polypad-actionbar.nearBtm .popup-body,x-polypad-actionbar.pinned .popup-body{bottom:46px;top:auto;transform-origin:right bottom}x-polypad-actionbar.nearBtm .popup-body:after,x-polypad-actionbar.pinned .popup-body:after{border-bottom:none;border-top:6px solid #3a3645;bottom:-6px;top:auto}x-polypad-actionbar.floating .tooltip{top:38px}x-polypad-actionbar.pinned .tooltip{bottom:38px;top:auto}x-polypad-actionbar .actions{display:flex}x-polypad-actionbar .action{align-items:center;display:flex;padding:0 8px;position:relative}@media screen and (max-width:460px){x-polypad-actionbar .action{padding:0 6px}}x-polypad-actionbar .popup-target.blue{background:#1873cf}x-polypad-actionbar .popup-target.blue:focus,x-polypad-actionbar .popup-target.blue:hover{background:#0f82f2}x-polypad-actionbar .popup-body.blue label{border-radius:3px;cursor:pointer;display:block;padding:0 8px 0 6px;white-space:nowrap}x-polypad-actionbar .popup-body.blue label:focus,x-polypad-actionbar .popup-body.blue label:hover{background:hsla(0,0%,100%,.15)}x-polypad-actionbar .popup-body.blue input{margin-right:6px;vertical-align:-1px}x-polypad-actionbar .select button,x-polypad-actionbar button.action{border-radius:4px;display:block;height:32px;line-height:32px;transition:background .15s,color .15s;white-space:nowrap}x-polypad-actionbar .select button:focus,x-polypad-actionbar .select button:hover,x-polypad-actionbar button.action:focus,x-polypad-actionbar button.action:hover{background:hsla(0,0%,100%,.2);color:#fff}x-polypad-actionbar .select button x-icon,x-polypad-actionbar button.action x-icon{display:block;margin:0 -3px}x-polypad-actionbar .action span{flex-grow:1;margin-right:8px;white-space:nowrap}x-polypad-actionbar .action x-icon+span{margin-left:6px}x-polypad-actionbar .action x-icon+select{margin-left:8px}x-polypad-actionbar .select{padding:0 2px}x-polypad-actionbar .select button{opacity:.3;padding:0 6px;position:relative}x-polypad-actionbar .select button.active,x-polypad-actionbar .select button:focus,x-polypad-actionbar .select button:hover{opacity:1}x-polypad-actionbar .select button.active{pointer-events:none}x-polypad-actionbar input.input-field{width:45px}x-polypad-actionbar select.input-field{max-width:100px}x-polypad-actionbar .action.wrap{flex-wrap:wrap;width:192px}x-polypad-actionbar .action.wrap button{padding:0 7px}x-polypad-actionbar .action.wide-input .input-field{padding:0 8px;text-align:left}x-polypad-actionbar .input-range{border-radius:4px 0 0 4px}x-polypad-actionbar .input-range+.input-range{border-left:0;border-radius:0 4px 4px 0}x-polypad-actionbar .increment{border:1px solid #807c89;border-radius:4px 0 0 4px;border-right-width:0;font-weight:600;line-height:24px;transition:background .2s;width:20px}x-polypad-actionbar .increment:focus,x-polypad-actionbar .increment:hover{background:rgba(0,0,0,.2)}x-polypad-actionbar .increment+.input-field{border-radius:0;width:45px}x-polypad-actionbar .action .input-field+.increment{border-radius:0 4px 4px 0;border-width:1px 1px 1px 0}x-polypad-actionbar .input-pair{border-radius:4px 0 0 4px;width:40px}x-polypad-actionbar .input-pair+.input-pair{border-radius:0 4px 4px 0;margin-left:-1px;width:39px}x-polypad-actionbar .input-pair:focus{position:relative;z-index:1}x-polypad-actionbar .popup-body{font-size:16px}x-polypad-actionbar .popup-body .action{margin-bottom:3px;padding:2px 6px}x-polypad-actionbar .popup-body .input-field{box-sizing:border-box;width:100px}x-polypad-actionbar .popup-body .action .increment+input.input-field{width:45px}x-polypad-actionbar .popup-body .action span{margin-right:12px}x-polypad-actionbar .popup-body button.action{background:hsla(0,0%,100%,.1);box-sizing:border-box;color:inherit;height:28px;line-height:24px;margin:6px;width:calc(100% - 12px)}x-polypad-actionbar .popup-body button.action:focus,x-polypad-actionbar .popup-body button.action:hover{background:hsla(0,0%,100%,.22)}x-polypad-actionbar .popup-body button.action x-icon{display:inline-block;margin:0 3px -2px 4px}x-polypad-actionbar .action.paginated{flex-wrap:nowrap}x-polypad-actionbar .action.paginated .select{display:flex;flex-grow:1;flex-wrap:wrap;justify-content:center;min-width:150px}x-polypad-actionbar .action.paginated .arrow{height:64px;margin:0 2px}x-polypad-actionbar .action.paginated .arrow[disabled]{opacity:.1;pointer-events:none}x-polypad-actionbar .action.paginated .arrow svg{fill:none;stroke:#fff;stroke-width:2px;stroke-linecap:round}x-color-picker{display:flex;justify-content:center;position:relative;-webkit-user-select:none;-moz-user-select:none;user-select:none}x-color-picker x-select{border-right:1px solid hsla(0,0%,100%,.3);margin:0 14px 0 -2px;width:38px}x-color-picker .color-content{height:90px;width:270px}x-color-picker.custom .palette,x-color-picker:not(.custom) .sliders{display:none}x-color-picker .switch{cursor:pointer;opacity:.4;transition:opacity .2s}x-color-picker .switch:hover{opacity:.6}x-color-picker .switch.active{opacity:1}x-color-picker x-icon.switch{color:#fff}x-color-picker .palette{display:flex;flex-wrap:wrap}x-color-picker .palette button{box-sizing:border-box;cursor:pointer;height:30px;width:30px}x-color-picker .palette button.active{border:3px solid #fff;border-radius:4px;transform:scale(1.2)}html.is-tabbing x-color-picker .palette button:focus,x-color-picker .palette button.active{z-index:1}x-color-picker .sliders{margin:-3px 0}x-color-picker .slider-row{align-items:center;display:flex;height:24px;justify-content:space-between}x-color-picker .slider-row label{color:hsla(0,0%,100%,.6);display:block;font-size:14px;height:24px}x-color-picker .slider{border-radius:4px;box-shadow:inset 0 0 0 1px rgba(0,0,0,.2);height:14px;margin:6px 0;position:relative;width:180px}x-color-picker .handle{background:#fff;border-radius:100%;box-shadow:0 2px 4px rgba(0,0,0,.4);cursor:grab;height:20px;margin:-3px -10px;position:absolute;transition:transform .2s;width:20px}x-color-picker .handle.active,x-color-picker .handle:hover{box-shadow:0 4px 8px rgba(0,0,0,.3);transform:scale(1.2)}x-color-picker .input-field{font-size:16px;height:20px;line-height:20px;width:44px}x-polypad-toolbar{bottom:calc(8px + env(safe-area-inset-bottom));left:50%;position:absolute;transform:translateX(-50%);transition:transform .4s ease-out;width:-moz-fit-content;width:fit-content;z-index:5}@media screen and (min-width:700px){x-polypad-toolbar.shifted{transform:translateX(calc(154px - 50%))}}x-polypad-toolbar .check{position:relative}x-polypad-toolbar .check input{left:14px;position:absolute;top:-18px}x-polypad-toolbar .bar{background:#3a3645;border-radius:26px;box-shadow:0 3px 8px rgba(0,0,0,.3);display:flex;height:44px;padding:1px 12px;position:relative;z-index:1}x-polypad-toolbar.customising .bar{padding-top:30px}x-polypad-toolbar .tool{cursor:pointer;padding:6px;position:relative}x-polypad-toolbar .tool x-icon{fill:#fff;display:block;opacity:.35;transition:opacity .1s}x-polypad-toolbar .tool:focus x-icon,x-polypad-toolbar .tool:hover x-icon{opacity:.7}x-polypad-toolbar .tool.active{cursor:default;pointer-events:none}x-polypad-toolbar .tool.active x-icon{opacity:1}x-polypad-toolbar .tooltip{top:-28px}@media screen and (max-width:410px){x-polypad-toolbar .bar{padding:1px 8px}x-polypad-toolbar .tool{padding:6px 3px}}@media screen and (max-width:350px){x-polypad-toolbar .tool{padding:6px 2px}}x-polypad-toolbar .popup-body{background:#3a3645;border-radius:10px;box-shadow:0 3px 8px rgba(0,0,0,.3);display:none;padding:12px;position:relative;position:absolute;transform-origin:center bottom;z-index:10}x-polypad-toolbar .popup-body:after{border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid #3a3645;content:"";display:block;left:50%;margin-left:-8px;position:absolute;top:100%}x-polypad-toolbar .color-picker{color:#fff;display:block;position:relative}x-polypad-toolbar .color-picker .popup-target{background:linear-gradient(180deg,transparent,rgba(0,0,0,.25));border:1px solid hsla(0,0%,100%,.8);border-radius:100%;cursor:pointer;display:block;height:30px;margin:6px;width:30px}x-polypad-toolbar .color-picker .popup-target.rainbow{background:radial-gradient(#fff,hsla(0,0%,100%,0) 60%),conic-gradient(#cd0e66,#6d3bbf,#0f82f2,#009ea6,#22ab24,#bfc212,#fd8c00,#eb4726,#cd0e66)}x-polypad-toolbar .color-picker .popup-body{bottom:56px;left:-151px}@media screen and (max-width:980px){x-polypad-toolbar .color-picker .popup-body{left:-288px;transform-origin:310px bottom}x-polypad-toolbar .color-picker .popup-body:after{left:310px}}x-polypad-toolbar .brushes,x-polypad-toolbar .buttons{display:none;left:50%;position:absolute;transform:translateX(-50%)}x-polypad-toolbar .brushes.active,x-polypad-toolbar .buttons.active{display:flex}x-polypad-toolbar .buttons{border-radius:20px;bottom:54px;box-shadow:0 2px 4px rgba(0,0,0,.2)}x-polypad-toolbar.customising .buttons{bottom:84px}x-polypad-toolbar .buttons button{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:#7f7c86;color:hsla(0,0%,100%,.9);cursor:pointer;font-size:16px;height:2em;line-height:2em;margin-right:1px;padding:0 16px;transition:background .2s,color .2s;white-space:nowrap}x-polypad-toolbar .buttons button:first-child{border-radius:20px 0 0 20px}x-polypad-toolbar .buttons button:last-child{border-bottom-right-radius:20px;border-top-right-radius:20px;margin-right:0}x-polypad-toolbar .buttons button.active,x-polypad-toolbar .buttons button:focus,x-polypad-toolbar .buttons button:hover{background:#3a3645;color:#fff}x-polypad-toolbar .buttons button.active{cursor:default}x-polypad-toolbar .buttons button x-icon{margin:0 3px -5px -4px}x-polypad-toolbar .brushes{bottom:26px}x-polypad-toolbar .brushes svg{cursor:pointer;filter:saturate(0) contrast(.3) brightness(1.5);margin:0 6px;transition:transform .2s,filter .2s}x-polypad-toolbar .brushes svg:focus,x-polypad-toolbar .brushes svg:hover{transform:translateY(-10px)}x-polypad-toolbar .brushes svg.active{cursor:default;filter:none;transform:translateY(-20px)}x-polypad-settings{display:block;position:absolute;right:8px;top:8px;z-index:4}x-polypad-settings .settings-group{background:#3a3645;border-radius:6px;box-shadow:0 3px 8px rgba(0,0,0,.3);margin-bottom:8px}x-polypad-settings .settings-group:last-child{margin:0}x-polypad-settings .settings-btn{color:hsla(0,0%,100%,.6);cursor:pointer;display:block;padding:8px;position:relative;transition:background .2s,color .2s}x-polypad-settings .settings-btn.logo{background:#292735;border-radius:6px 6px 0 0}x-polypad-settings .settings-btn:focus,x-polypad-settings .settings-btn:not([disabled]):hover{color:#fff}x-polypad-settings .settings-btn x-icon{display:block}x-polypad-settings .settings-btn[disabled]{color:hsla(0,0%,100%,.25);cursor:default}x-polypad-settings .settings-btn.undo-btn{padding:5px 8px}x-polypad-settings .settings-btn.active{color:#fff}x-polypad-settings .tooltip{left:auto;right:44px;top:8px;transform:none}x-polypad-settings .active .tooltip{opacity:0!important}x-polypad-settings x-popup{display:block;position:relative}x-polypad-settings .popup-body{background:#3a3645;border-radius:6px;box-shadow:0 3px 8px rgba(0,0,0,.3);color:hsla(0,0%,100%,.8);font-size:16px;padding:6px;position:relative;position:absolute;right:48px;top:0;transform-origin:right 20px;width:174px}x-polypad-settings .popup-body:after{border-bottom:6px solid transparent;border-left:6px solid #3a3645;border-top:6px solid transparent;content:"";display:block;left:100%;margin-top:-6px;position:absolute;top:50%;top:20px}x-polypad-settings .popup-body .btn{margin:8px 0 6px 6px}x-polypad-settings .grid-select{display:flex;flex-wrap:wrap;margin-bottom:8px}x-polypad-settings .grid{background:hsla(0,0%,100%,.15);border:3px solid #3a3645;border-radius:6px;color:#fff;cursor:pointer;font-size:36px;height:48px;margin:2px;opacity:.6;transition:border .2s,opacity .2s;width:48px}x-polypad-settings .grid:focus,x-polypad-settings .grid:hover{border-color:#1873cf;opacity:.8}x-polypad-settings .grid.active{border-color:#0f82f2;cursor:default;opacity:1}x-polypad-settings .grid svg{border-radius:3px;display:block;height:48px;width:48px}x-polypad-settings .grid path{stroke:#fff}x-polypad-settings .grid circle,x-polypad-settings .grid.fill path{fill:#fff;stroke:none}x-polypad-settings h2{font-size:18px;margin:4px 8px 8px}x-polypad-settings .btn-group{margin:6px 8px}x-polypad-settings .btn-group .btn{border-radius:0;margin:0 1px 0 0;min-width:0}x-polypad-settings .btn-group .btn:first-child{border-radius:20px 0 0 20px}x-polypad-settings .btn-group .btn:last-child{border-radius:0 20px 20px 0}#help .tutorials>*{border-radius:6px;font-size:16px;font-weight:700;margin:6px;padding:8px 0 4px;text-align:center;transition:background .2s;width:170px}#help .tutorials>* x-icon{display:block;margin:0 auto}#help .tutorials>.red{background:rgba(205,14,102,.3)}#help .tutorials>.red:focus,#help .tutorials>.red:hover{background:rgba(205,14,102,.6)}#help .tutorials>.blue{background:rgba(15,130,242,.3)}#help .tutorials>.blue:focus,#help .tutorials>.blue:hover{background:rgba(15,130,242,.6)}#help .tutorials>.green{background:rgba(34,171,36,.3)}#help .tutorials>.green:focus,#help .tutorials>.green:hover{background:rgba(34,171,36,.6)}#help .tutorials>.yellow{background:rgba(253,140,0,.3)}#help .tutorials>.yellow:focus,#help .tutorials>.yellow:hover{background:rgba(253,140,0,.6)}#help .tutorials>.orange{background:rgba(235,71,38,.3)}#help .tutorials>.orange:focus,#help .tutorials>.orange:hover{background:rgba(235,71,38,.6)}#help .tutorials>.purple{background:rgba(109,59,191,.3)}#help .tutorials>.purple:focus,#help .tutorials>.purple:hover{background:rgba(109,59,191,.6)}#help .tutorials>.teal{background:rgba(0,158,166,.3)}#help .tutorials>.teal:focus,#help .tutorials>.teal:hover{background:rgba(0,158,166,.6)}#accessibility code{background:#eee;border:1px solid #c5c2cc;border-radius:4px;box-shadow:0 2px 0 #c5c2cc;color:#333;font-size:95%;padding:0 3px}x-gesture{fill:rgba(0,0,0,.5);stroke:hsla(0,0%,100%,.5);stroke-width:1px;display:none;pointer-events:none;position:absolute;transform-origin:15px 10px;z-index:9999}html[theme=dark] x-gesture{fill:hsla(0,0%,100%,.5);stroke:rgba(0,0,0,.5)}x-drag{background:hsla(0,0%,100%,.5);border-radius:4px;display:block;height:8px;margin:12px 0;position:relative}x-drag .handle{background:#fff;border-radius:100%;color:#000;cursor:grab;font-size:14px;height:20px;left:0;line-height:20px;margin:-6px 0;position:absolute;text-align:center;touch-action:none;width:20px}x-modal{margin-top:0}.polypad{cursor:default;font-family:Source Sans Pro,Helvetica,sans-serif;font-size:18px;height:100%;line-height:1.6;overflow:hidden;position:relative;touch-action:manipulation;-webkit-user-select:none;-moz-user-select:none;user-select:none;width:100%}.polypad.grabbing *{cursor:grabbing!important}.polypad:not(.ready) *{animation:none!important;transition:none!important}.polypad:not(.is-tabbing) :focus{outline:none!important}svg.overlay,x-polypad{height:100%;left:0;position:absolute;top:0;width:100%}x-polypad .panels{right:56px}svg.overlay{pointer-events:none;z-index:10}x-pp-sidebar .credit{border-top:1px solid #65636e;color:hsla(0,0%,100%,.6);display:block;font-size:14px;padding:8px 0;text-align:center}x-pp-sidebar .credit:focus,x-pp-sidebar .credit:hover{text-decoration:underline}.btn,.s-btn{max-width:-webkit-fill-available;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.light-ui x-pp-sidebar{--canvas-bg:#181824;--canvas-fg:#ededed;box-shadow:0 2px 6px rgba(0,0,0,.2),0 0 0 1px rgba(0,0,0,.1);color:#5f5f5f}.light-ui x-pp-sidebar .tabs-header button{background:#ededed;border-right-color:#a6a6a6;color:rgba(95,95,95,.8)}.light-ui x-pp-sidebar .tabs-header button.active,.light-ui x-pp-sidebar .tabs-header button:focus,.light-ui x-pp-sidebar .tabs-header button:hover{background:#ededed;color:#5f5f5f}.light-ui x-pp-sidebar.open .tabs-header button{background:#c2c2c2;border-color:#a6a6a6}.light-ui x-pp-sidebar.open .tabs-header button:focus,.light-ui x-pp-sidebar.open .tabs-header button:hover{background:#d1d1d1}.light-ui x-pp-sidebar .tabs-body,.light-ui x-pp-sidebar.open .tabs-header button.active{background:#ededed}.light-ui x-pp-sidebar .credit,.light-ui x-pp-sidebar .tabs-body,.light-ui x-pp-sidebar h2,.light-ui x-pp-sidebar h3{border-top-color:#a6a6a6}.light-ui x-pp-sidebar x-accordion h2:focus,.light-ui x-pp-sidebar x-accordion h2:hover,.light-ui x-pp-sidebar x-accordion h3:focus,.light-ui x-pp-sidebar x-accordion h3:hover{background:rgba(95,95,95,.2)}.light-ui x-pp-sidebar p{color:rgba(95,95,95,.85)}.light-ui x-pp-sidebar .source-wrap+.source-wrap,.light-ui x-pp-sidebar .subtitle{border-top-color:#a6a6a6}.light-ui x-pp-sidebar .caption,.light-ui x-pp-sidebar .source:after,.light-ui x-pp-sidebar .subtitle{color:#5f5f5f}.light-ui x-pp-sidebar .source-wrap x-select button{color:rgba(95,95,95,.4)}.light-ui x-pp-sidebar .source-wrap x-select button:hover{background:rgba(95,95,95,.2);color:#5f5f5f}.light-ui x-pp-sidebar .source-wrap x-select button.active{background:#0f82f2;color:#fff}.light-ui x-pp-sidebar .ui-light-invert{--canvas-bg:#ededed;--canvas-fg:#3a3645}.light-ui x-pp-sidebar img.ui-light-invert{filter:invert(.5)}.light-ui x-pp-sidebar .credit{color:rgba(95,95,95,.6)}.light-ui .s-btn{background:rgba(58,54,69,.75);color:hsla(0,0%,100%,.9)}.light-ui .s-btn:focus,.light-ui .s-btn:hover{background:#3a3645;color:#fff}.light-ui x-pp-customise h4{border-top-color:#a6a6a6;color:rgba(58,54,69,.5)}.light-ui .form-row input,.light-ui .form-row select{background:rgba(58,54,69,.12)}.light-ui .form-row select{background:rgba(58,54,69,.12) url("data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22%233a3645%22%20d%3D%22m19.9%207.5a1.4%201.4%200%200%200%20-2.1%200l-5.8%205.8-5.8-5.8a1.4%201.4%200%200%200%20-2.1%200%201.5%201.5%200%200%200%200%202.1l6.8%206.9a1.6%201.6%200%200%200%202.2%200l6.8-6.9a1.4%201.4%200%200%200%200-2.1z%22%2F%3E%3C%2Fsvg%3E") no-repeat top 6px right 4px /16px 16px}.light-ui .form-row select:focus,.light-ui .form-row select:hover{background-color:rgba(58,54,69,.3);color:#3a3645}.light-ui x-pp-sidebar .section-block{margin:12px 20px}.light-ui x-polypad-actionbar,.light-ui x-polypad-actionbar .popup-body,.light-ui x-polypad-settings .popup-body,.light-ui x-polypad-settings .settings-group,.light-ui x-polypad-toolbar .bar,.light-ui x-polypad-toolbar .buttons,.light-ui x-polypad-toolbar .popup-body{background:#ededed;box-shadow:0 2px 6px rgba(0,0,0,.2),0 0 0 1px rgba(0,0,0,.1)}.light-ui x-polypad-toolbar .tool x-icon{fill:#5f5f5f}.light-ui x-polypad-toolbar .popup-body:after{border-top-color:#ededed;filter:drop-shadow(0 1px 0 rgba(0,0,0,.2))}.light-ui x-polypad-toolbar .color-picker{color:#5f5f5f}.light-ui x-polypad-toolbar .color-picker .popup-target{border-color:#5f5f5f}.light-ui x-polypad-toolbar .buttons button{background:#ededed;color:#5f5f5f}.light-ui x-polypad-toolbar .buttons button.active,.light-ui x-polypad-toolbar .buttons button:focus,.light-ui x-polypad-toolbar .buttons button:hover{background:#d1d1d1}.light-ui x-polypad-settings .settings-btn{color:rgba(95,95,95,.6)}.light-ui x-polypad-settings .settings-btn.active,.light-ui x-polypad-settings .settings-btn:focus,.light-ui x-polypad-settings .settings-btn:not([disabled]):hover{color:#5f5f5f}.light-ui x-polypad-settings .settings-btn[disabled]{color:rgba(95,95,95,.25)}.light-ui x-polypad-settings .popup-body{color:#5f5f5f}.light-ui x-polypad-settings .popup-body:after{border-left-color:#ededed;filter:drop-shadow(1px 0 0 rgba(0,0,0,.2))}.light-ui x-polypad-settings .grid{background:rgba(95,95,95,.15);border-color:#ededed}.light-ui x-polypad-settings .grid:focus,.light-ui x-polypad-settings .grid:hover{border-color:#7eb8f0}.light-ui x-polypad-settings .grid.active{border-color:#0f82f2;cursor:default;opacity:1}.light-ui x-polypad-settings .grid path{stroke:#5f5f5f}.light-ui x-polypad-settings .grid circle,.light-ui x-polypad-settings .grid.fill path{fill:#5f5f5f;stroke:none}.light-ui x-polypad-actionbar{color:rgba(95,95,95,.85)}.light-ui x-polypad-actionbar .popup-body:after{border-bottom-color:#ededed;filter:drop-shadow(0 -1px 0 rgba(0,0,0,.15))}.light-ui x-polypad-actionbar.nearBtm .popup-body:after,.light-ui x-polypad-actionbar.pinned .popup-body:after{border-top-color:#ededed;filter:drop-shadow(0 1px 0 rgba(0,0,0,.15))}.light-ui x-polypad-actionbar .action.paginated .arrow svg{stroke:rgba(95,95,95,.85)}.light-ui x-polypad-actionbar .select button:focus,.light-ui x-polypad-actionbar .select button:hover,.light-ui x-polypad-actionbar button.action:focus,.light-ui x-polypad-actionbar button.action:hover{background:rgba(95,95,95,.2);color:#5f5f5f}.light-ui x-polypad-actionbar button.popup-target.blue{color:#fff}.light-ui x-polypad-actionbar button.popup-target.blue:focus,.light-ui x-polypad-actionbar button.popup-target.blue:hover{background:#2064ad}.light-ui x-polypad-actionbar .increment{border-color:#807c89}.light-ui x-polypad-actionbar .increment:focus,.light-ui x-polypad-actionbar .increment:hover{background:rgba(0,0,0,.2)}.light-ui x-polypad-actionbar .popup-body button.action{background:rgba(0,0,0,.1)}.light-ui x-polypad-actionbar .popup-body button.action:focus,.light-ui x-polypad-actionbar .popup-body button.action:hover{background:rgba(0,0,0,.22)}.light-ui x-color-picker x-select{border-right-color:#a6a6a6}.light-ui x-color-picker x-icon.switch{color:#5f5f5f}.light-ui x-color-picker .palette button.active{border:3px solid #5f5f5f}.light-ui x-color-picker .slider-row label{color:#5f5f5f}.light-ui x-drag{background:rgba(95,95,95,.5)}.light-ui x-drag .handle{background:#5f5f5f;color:#fff}.light-ui .input-field{background-color:rgba(95,95,95,.15);border-color:#a6a6a6}.light-ui select.input-field{background-image:url("data:image/svg+xml;utf8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2224%22%20height%3D%2224%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20fill%3D%22%23a6a6a6%22%20d%3D%22m19.9%207.5a1.4%201.4%200%200%200%20-2.1%200l-5.8%205.8-5.8-5.8a1.4%201.4%200%200%200%20-2.1%200%201.5%201.5%200%200%200%200%202.1l6.8%206.9a1.6%201.6%200%200%200%202.2%200l6.8-6.9a1.4%201.4%200%200%200%200-2.1z%22%2F%3E%3C%2Fsvg%3E")}.light-ui input.toggle+.control{background:rgba(95,95,95,.3)}.light-ui input.toggle+.control:after{background-color:#a6a6a6}.light-ui input.toggle:checked+.control{background:rgba(15,130,242,.5)}.light-ui input.toggle:checked+.control:after{background:#0f82f2}.light-ui input.toggle:indeterminate+.control:after{background:#3771a9}',zv=e=>!!e.name;document.addEventListener("fullscreenchange",()=>R.resize());var Ur=window.ResizeObserver?new ResizeObserver(()=>R.resize()):void 0,Ec=new Set;ll.get("x-icon").prototype.ready=function(){let e=+this.attr("size")||24;this.css({width:`${e}px`,height:`${e}px`});let s=h("svg",{viewBox:"0 0 24 24"},this);s.css({width:`${e}px`,height:`${e}px`}),this.onAttr("name",t=>s.html=ml[t])};function Bv(e,s){return H(this,null,function*(){var L,A,Z,Q;Ur==null||Ur.observe(e._el);let t=e._el.attachShadow({mode:"open"}),i=document.createElement("style");i.textContent=nf,t.append(i);let r=h("div",{class:"polypad",dir:"ltr",lang:"en",tabindex:"0"});t.append(r._el),s.lightUI&&r.addClass("light-ui"),r.addClass((R.isMobile?"is":"not")+"-mobile"),R.isSafari&&r.addClass("is-safari"),setTimeout(()=>r.addClass("ready")),window.addEventListener("keydown",V=>{V.keyCode===9&&r.addClass("is-tabbing")}),window.addEventListener("mousedown",()=>{r.removeClass("is-tabbing")});let o="";if(s.customSidebar){let V=s.customSidebar.tiles.map(N=>`<div class="source" tile="${N.name}" props='${JSON.stringify(N)}'></div>`).join("");o+=`<x-pp-sidebar><div tab="${s.customSidebar.title}" icon="shapes"><div class="source-wrap" style="align-items:center">${V}</div></div></x-pp-sidebar>`}else(s.sidebarTiles!==!1||s.sidebarSettings!==!1)&&(o+="<x-pp-sidebar hidden>",s.sidebarTiles!==!1&&(o+=sf),s.sidebarSettings!==!1&&(o+='<div class="tabs-panel" tab="" icon="settings"><x-pp-customise></x-pp-customise></div>'),o+="</x-pp-sidebar>");s.toolbar!==!1&&(o+=of),o+='<svg class="overlay"><g class="tiles active"></g></svg><x-polypad></x-polypad>',s.actionbar!==!1&&(o+="<x-polypad-actionbar></x-polypad-actionbar>"),s.settings!==!1&&(o+=rf),r.html=o;let n=new As,a=r.$("x-polypad");yield new Promise(V=>setTimeout(V));let l=a.$("defs");Ec.add(l),s.themeColours&&Object.assign(y,s.themeColours);let c=s.canvasMargin;c!==void 0&&(a.margins=[c,c,c,c]),R.onResize(()=>a.setViewport(a.origin,a.zoom));let p=r.$("x-pp-sidebar"),u=r.$("x-pp-tiles"),f=r.$("x-polypad-toolbar"),v=r.$("x-polypad-settings"),m=r.$("x-polypad-actionbar"),g=r.$("x-pp-customise"),b=r.$(".overlay");if(s.teacherMode)a.setAttr("user-type","teacher");else{let V=(L=p==null?void 0:p.$('h3[data-key="questions"]'))==null?void 0:L.parent;if(V){let N=V.items.pop();N.$heading.remove(),N.$check.remove()}}if(a.load(s.initial||{}),s.customSidebar)for(let V of p.$$(".source"))a.bindSource(V,b);u==null||u.bindPolypad(a,b),g==null||g.bindPolypad(a),p==null||p.bindPolypad(a);for(let V of[f,m])V==null||V.setClass("shifted",!!(p!=null&&p.isOpen)),p==null||p.on("toggle",({open:N})=>V==null?void 0:V.setClass("shifted",N));f==null||f.bindPolypad(a),v==null||v.bindPolypad(a),m==null||m.bindPolypad(a),setTimeout(()=>R.resize()),s.imageUpload?a.enableImageDrop((V,N)=>H(this,null,function*(){N.props.href="";try{N.props.href=yield s.imageUpload(V)}catch(kt){N.delete(),console.error("Failed to upload image :(")}}),f==null?void 0:f.$imageUpload):(A=f==null?void 0:f.$('[for="image-upload"]'))==null||A.hide(),a.on("change-api",V=>n.trigger("change",V)),a.on("undo",V=>n.trigger("undo",V)),a.on("redo",V=>n.trigger("redo",V)),a.on("viewport",()=>{n.trigger("viewport",{x:a.origin.x,y:a.origin.y,zoom:a.zoom})}),a.on("move-selection",()=>{let V=Array.from(a.selection.tiles).map(N=>({id:N.id,x:N.posn.x,y:N.posn.y}));n.trigger("move",{tiles:V})}),a.on("change-selection",V=>{var N;n.trigger("selection",{tiles:(N=V.tiles)==null?void 0:N.map(kt=>kt.id)})}),a.options.watchAll((V,N)=>{N||n.trigger("options",a.options.copy())}),a.events.constrainInBox=!0;let x=r.$("#customise");(Z=r.$("[data-modal=customise]"))==null||Z.on("click",()=>x.open()),(Q=ot(".modal-background"))==null||Q.setAttr("style","position:fixed;z-index:400;top:0;bottom:0;left:0;right:0;background:#000000cc;display:none;transition:background .4s");let k;return{on(V,N){n.on(V,N)},off(V,N){n.off(V,N)},undo(){a.undo()},redo(){a.redo()},serialize(V,N,kt){return a.serialize(V,N,kt)},unSerialize(V){a.load(V)},image(V,N,kt="png"){return a.thumbnail(V,N,kt)},add(V){if(zv(V)){let N=$.create(a,V);return a.trigger("change"),N==null?void 0:N.id}else{let N=we.create(a,V);return N==null?void 0:N.id}},update(V,N){let kt=a.tiles.get(V);kt?kt.applyChange(N):kt=$.create(a,N,V),a.trigger("change")},delete(...V){var N,kt;for(let Te of V)(N=a.tiles.get(Te))==null||N.delete(),(kt=a.strokes.get(Te))==null||kt.delete();a.trigger("change")},paste(V){a.paste(V)},select(...V){a.selection.clear(),a.selection.select(V.map(N=>a.tiles.get(N)).filter(Boolean))},getSelection(){return Array.from(a.selection.tiles).map(V=>V.id)},getViewport(){return{x:a.origin.x,y:a.origin.y,zoom:a.zoom}},setViewport(V,N,kt){a.setViewport(new d(V,N),kt)},setOptions(V){for(let[N,kt]of Object.entries(V))a.options[N]=kt},setTool(V,N){a.setActiveTool(V,N)},pinActionbar(V=!0){m==null||m.setFloating(!V)},resetViewport(){a.resetViewport()},resize(){R.resize()},destroy(){if(Ur==null||Ur.unobserve(e._el),this.clear(),t.innerHTML="",Ec.delete(l),R.isSafari)for(let V of Ec)V.parent.append(V)},clear(){a.clear()},bindKeyboardEvents(V){Sh(r._el),a.bindKeyboardEvents(r,()=>document.activeElement!==e._el);let N={sidebar:p,toolbar:f,canvas:a.$svg,actionbar:m};lp(V,a,N,r),p==null||p.on("pointerdown",()=>{document.activeElement===document.body&&r.focus()})},setTheme(V){throw new Error(".setTheme() is not yet implemented.")},toggleSidebar(V){let N=(p==null?void 0:p.active)===0;V===void 0&&(V=!N),V!==N&&(p==null||p.toggleTab(0))},showGesture(V,N){k||(k=h("x-gesture",{},r));let[kt,Te]=V.split(":"),as=r.$$(kt)[+Te||0];as&&k.start(as,N)},addCustomButton(V,N=""){var Vc;let kt=V==="toolbar",Te=h("button",{class:kt?"tool":"settings-btn"});typeof N=="string"?Te.html=N:Te.append(ot(N));let as=kt?f==null?void 0:f.$(".bar"):v==null?void 0:v.$(".settings-group");return kt?(Vc=z((as==null?void 0:as.children)||[]))==null||Vc.insertBefore(Te):as==null||as.append(Te),Te._el}}})}var Da;function Hv(){return H(this,null,function*(){if(Da)return Da;let e=document.createElement("div");e.setAttribute("style","width:0;height:0;opacity:0;overflow:hidden"),document.body.append(e);let s=e.attachShadow({mode:"open"}),t=document.createElement("style");t.textContent=nf,s.append(t);let i=h("div",{class:"polypad",dir:"ltr",lang:"en",style:"width:1000px;height:1000px",html:"<x-polypad></x-polypad>"});return s.append(i._el),i.addClass((R.isMobile?"is":"not")+"-mobile"),R.isSafari&&i.addClass("is-safari"),yield new Promise(r=>setTimeout(r)),i.addClass("ready"),Da=i.$("x-polypad"),Da})}window.Polypad={create(t){return H(this,arguments,function*(e,s={}){let i=ot(e);if(!i)throw new Error(`Unable to find element ${e}`);let r=s.apiKey||"unknown",o=s.userKey||"",n=encodeURIComponent(location.host||"");return fetch(`https://mathigon.org/api/polypad?key=${r}&user=${o}&domain=${n}`),Bv(i,s)})},toImage(e,s="png",t=800,i=600){return H(this,null,function*(){let r=yield Hv();r.load(e);let o=yield r.thumbnail(t,i,s);return r.clear(),o})},loadFonts(){let e=document.createElement("link");e.href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,300,400i,600i&amp;subset=greek",e.rel="stylesheet",document.head.append(e)},translate(e,s){for(let t of Object.values(e.tiles||{}))t.name==="text"&&(t.html=s(t.html,"html")),t.name==="image"&&(t.href=s(t.href,"url")),t.name==="equation"&&(t.expr=s(t.expr,"expr"))}};})();